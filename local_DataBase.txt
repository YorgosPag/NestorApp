https://console.firebase.google.com/project/pagonis-87766/firestore/databases/-default-/data/~2Fnavigation_companies~2F0Sc66EXtdxyedUqPa9gZ

NestorPagonis
Cloud Firestore
Database
Cloud Firestore
Database
Aggiungi database
Dati
Regole
Indici
Disaster recovery
Utilizzo
Extensions
Proteggi le tue risorse di Cloud Firestore da comportamenti illeciti, come fatturazione fraudolenta o phishing



navigation_companies
0Sc66EXtdxyedUqPa9gZ
(default)

building_floorplans

buildings

contact_relationships

contacts

dxf-overlay-levels

dxf-viewer-levels

dxf_files

floors

navigation_companies

notifications

obligation-sections

opportunities

parking_spots

project_floorplans

projects

storage_units

unit_floorplans

units
navigation_companies

0Sc66EXtdxyedUqPa9gZ

6Kt2diEzFMEUTRfBFoRp

FSwTyNQTookbzLRmUvk5

FftpdXjJKYMkhfJ2MRK8

PXEjVVdbo4VHngDqnzZ2

cgFAPafErQwRc6lF0qSb

xcFsEPYGzC4WWe6oZKT4

y2O9WBw5jVo1McX0QmjA

y6lAYYdJHta5CckDqk76
0Sc66EXtdxyedUqPa9gZ
addedAt
17 dicembre 2025 alle ore 00:34:23 UTC+2
(timestamp)


addedBy
"system"
(string)


complianceLevel
"enterprise"
(string)


contactId
"pzNUy8ksddGCtcQMqumR"
(string)


createdAt
17 dicembre 2025 alle ore 01:24:28 UTC+2
(timestamp)


lastCleaned
17 dicembre 2025 alle ore 01:24:28 UTC+2
(timestamp)


schemaVersion
"2.0.0-pure"
(string)


status
"active"
(string)


updatedAt
17 dicembre 2025 alle ore 01:24:28 UTC+2
(timestamp)


version
1
(number)


LocalitÃ  del database: eur3


https://console.firebase.google.com/project/pagonis-87766/storage/pagonis-87766.firebasestorage.app/files/~2Fcontacts~2Fphotos

NestorPagonis
Storage
pagonis-87766.firebasestorage.app
File
Regole
Utilizzo
Extensions
Proteggi le tue risorse di Storage da comportamenti illeciti, come fatturazione fraudolenta o phishing
gs://pagonis-87766.firebasestorage.app
contacts
photos

Nome
Dimensioni
Tipo
Ultima modifica

GEO_3_PAGONIS_3_photo_1.jpg
156.53 KB	image/jpeg	11 dic 2025

Î“Î¹ÏÏÎ³Î¿Ï‚_Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚_photo_1.jpg
156.53 KB	image/jpeg	13 dic 2025


https://console.firebase.google.com/project/pagonis-87766/storage/pagonis-87766.firebasestorage.app/rules

NestorPagonis
Storage
pagonis-87766.firebasestorage.app
File
Regole
Utilizzo
Extensions
Scrivi Security Rules per controllare l'accesso a Storage in base ai contenuti del tuo database Firestore.
Playground regole
Tipo di simulazione
get
Posizione
/b/pagonis-87766.firebasestorage.app/o
path/to/resource
rules_version = '2';
  service firebase.storage {
    match /b/{bucket}/o {
      // Î Î¡ÎŸÎ£ÎŸÎ§Î—: Public write Î³Î¹Î± floor-plans (Î¼ÏŒÎ½Î¿ Î³Î¹Î± debug)
      match /floor-plans/{allPaths=**} {
        allow read: if true;
        allow write: if true; // Î‘Î¦Î‘Î™Î¡Î•Î£Î¤Î• Î‘Î¡Î“ÎŸÎ¤Î•Î¡Î‘!
      }

      // NEW: Î“Î¹Î± contact photos (PUBLIC Î³Î¹Î± testing)
      match /contacts/photos/{allPaths=**} {
        allow read, write: if true;
      }

      // ÎŒÎ»Î± Î¬Î»Î»Î± ÎºÎ»ÎµÎ¹ÏƒÏ„Î±
      match /{allPaths=**} {
        allow read, write: if false;
      }
    }
  }

  https://console.firebase.google.com/project/pagonis-87766/firestore/databases/-default-/security/rules

  rules_version = '2';

// =============================================================================
// ğŸ”’ PRODUCTION-GRADE FIRESTORE SECURITY RULES
// =============================================================================
//
// ğŸ¯ Î£Î¤Î¡Î‘Î¤Î—Î“Î™ÎšÎ—: Deny-all by default, explicit allow per collection
// ğŸ›¡ï¸ Î‘Î¡Î§Î—: Zero Trust - ÎºÎ±Î¼Î¹Î± Ï€ÏÎ¿ÏƒÎ²Î±ÏƒÎ· Ï‡Ï‰ÏÎ¹Ï‚ authentication & authorization
// âš ï¸ ÎšÎ¡Î™Î£Î™ÎœÎŸ: Î‘Ï…Ï„ÎµÏ‚ Î¿Î¹ rules Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¿Ï…Î½ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î· Î±Ï€Î¿ unauthorized access
//
// =============================================================================

service cloud.firestore {
  match /databases/{database}/documents {

    // =========================================================================
    // ğŸ”“ ADMIN SDK BYPASS - Î Î¡ÎŸÎ£Î©Î¡Î™ÎÎŸ Î“Î™Î‘ PROJECT COMPANY IDS FIX
    // =========================================================================
    // ÎšÎ¡Î™Î£Î™ÎœÎŸ: Î‘Ï…Ï„Î¿ ÎµÏ€Î¹Ï„ÏÎµÏ€ÎµÎ¹ Firebase Admin SDK operations
    // âš ï¸ Î Î¡ÎŸÎ£ÎŸÎ§Î—: ÎœÎ¿Î½Î¿ Î³Î¹Î± migration purposes - Î±Ï†Î±Î¹ÏÎµÎ¹Ï„Î±Î¹ Î¼ÎµÏ„Î± Ï„Î¿ fix
    match /{document=**} {
      allow read, write: if true; // TEMPORARY FULL ACCESS FOR ADMIN SDK
    }

    // =========================================================================
    // ğŸš« DEFAULT DENY-ALL RULE (DISABLED TEMPORARILY)
    // =========================================================================
    // ÎŸÏ€Î¿Î¹Î±Î´Î·Ï€Î¿Ï„Îµ ÏƒÏ…Î»Î»Î¿Î³Î· Ï€Î¿Ï… Î”Î•Î ÎµÏ‡ÎµÎ¹ explicit rule â†’ Î‘Î¡ÎÎ—Î£Î—
    // TEMPORARILY DISABLED FOR ADMIN SDK OPERATIONS
    // match /{document=**} {
    //   allow read, write: if false;
    // }

    // =========================================================================
    // ğŸ“ PROJECTS COLLECTION - PUBLIC READ ACCESS
    // =========================================================================
    match /projects/{projectId} {

      // ğŸ“– READ: Public read access for projects listing (like buildings/units)
      allow read: if true;

      // âœï¸ CREATE: ÎœÎ¿Î½Î¿ authenticated users Î¼Îµ validated data
      allow create: if request.auth != null
                    && isValidProjectData(request.resource.data)
                    && resource == null; // Ensure document doesn't exist

      // ğŸ“ UPDATE: ÎœÎ¿Î½Î¿ authenticated users Î¼Îµ validation + ADMIN SDK BYPASS
      allow update: if (request.auth != null
                    && isValidProjectData(request.resource.data)
                    && resource != null  // Ensure document exists
                    && !isAttemptingToModifySystemFields(request.resource.data, resource.data))
                    || request.auth.token.admin == true; // ğŸ”“ ADMIN SDK BYPASS

      // ğŸ—‘ï¸ DELETE: ÎœÎ¿Î½Î¿ authenticated users
      allow delete: if request.auth != null
                    && resource != null; // Ensure document exists
    }

    // =========================================================================
    // ğŸ‘¥ CONTACT_RELATIONSHIPS COLLECTION - STRICT OWNERSHIP
    // =========================================================================
    match /contact_relationships/{relationshipId} {

      // ğŸ“– READ: ÎœÎ¿Î½Î¿ authenticated users Ï€Î¿Ï… ÎµÎ¹Î½Î±Î¹ source Î® target
      allow read: if request.auth != null
                  && (resource.data.sourceContactId == request.auth.uid
                      || resource.data.targetContactId == request.auth.uid);

      // âœï¸ CREATE: ÎœÎ¿Î½Î¿ authenticated users Î³Î¹Î± Î´Î¹ÎºÎµÏ‚ Ï„Î¿Ï…Ï‚ relationships
      allow create: if request.auth != null
                    && isValidRelationshipData(request.resource.data)
                    && (request.resource.data.sourceContactId == request.auth.uid
                        || request.resource.data.targetContactId == request.auth.uid)
                    && resource == null;

      // ğŸ“ UPDATE: ÎœÎ¿Î½Î¿ owners Î¼Îµ system field protection
      allow update: if request.auth != null
                    && isValidRelationshipData(request.resource.data)
                    && (resource.data.sourceContactId == request.auth.uid
                        || resource.data.targetContactId == request.auth.uid)
                    && !isAttemptingToModifySystemFields(request.resource.data, resource.data);

      // ğŸ—‘ï¸ DELETE: ÎœÎ¿Î½Î¿ owners
      allow delete: if request.auth != null
                    && (resource.data.sourceContactId == request.auth.uid
                        || resource.data.targetContactId == request.auth.uid);
    }

    // =========================================================================
    // ğŸ—„ï¸ DXF_FILES COLLECTION - USER-SCOPED ACCESS
    // =========================================================================
    match /dxf_files/{fileId} {

      // ğŸ“– READ: ÎœÎ¿Î½Î¿ Î¿ owner Ï„Î¿Ï… file
      allow read: if request.auth != null
                  && resource.data.ownerId == request.auth.uid;

      // âœï¸ CREATE: ÎœÎ¿Î½Î¿ authenticated users Î³Î¹Î± Î´Î¹ÎºÎ± Ï„Î¿Ï…Ï‚ files
      allow create: if request.auth != null
                    && isValidDxfFileData(request.resource.data)
                    && request.resource.data.ownerId == request.auth.uid
                    && resource == null;

      // ğŸ“ UPDATE: ÎœÎ¿Î½Î¿ owner Î¼Îµ system field protection
      allow update: if request.auth != null
                    && isValidDxfFileData(request.resource.data)
                    && resource.data.ownerId == request.auth.uid
                    && request.resource.data.ownerId == request.auth.uid
                    && !isAttemptingToModifySystemFields(request.resource.data, resource.data);

      // ğŸ—‘ï¸ DELETE: ÎœÎ¿Î½Î¿ owner
      allow delete: if request.auth != null
                    && resource.data.ownerId == request.auth.uid;
    }

    // =========================================================================
    // ğŸ¢ COMPANIES COLLECTION - READ-ONLY FOR AUTHENTICATED
    // =========================================================================
    match /companies/{companyId} {

      // ğŸ“– READ: ÎœÎ¿Î½Î¿ authenticated users
      allow read: if request.auth != null;

      // âœï¸ CREATE/UPDATE/DELETE: ÎŸÎ§Î™ Î±Ï€Î¿ client - Î¼Î¿Î½Î¿ admin/server
      allow write: if false;
    }

    // =========================================================================
    // ğŸ  BUILDINGS & UNITS - PUBLIC READ ACCESS
    // =========================================================================
    match /buildings/{buildingId} {
      allow read: if true; // Public read access for buildings listing
      allow write: if false; // Admin/server only
    }

    match /units/{unitId} {
      allow read: if true; // Public read access for units listing
      allow write: if false; // Admin/server only
    }

    // =========================================================================
    // ğŸ—ï¸ FLOORS COLLECTION - PUBLIC READ ACCESS
    // =========================================================================
    match /floors/{floorId} {
      allow read: if true; // Public read access for floors listing
      allow write: if false; // Admin/server only
    }

    // =========================================================================
    // ğŸ”” NOTIFICATIONS COLLECTION - PUBLIC READ ACCESS
    // =========================================================================
    match /notifications/{notificationId} {
      allow read: if true; // Public read access for notifications
      allow write: if false; // Admin/server only
    }

    // =========================================================================
    // ğŸ“ CONTACTS COLLECTION - PUBLIC READ ACCESS + ADMIN WRITE
    // =========================================================================
    match /contacts/{contactId} {

      // ğŸ“– READ: Public read access for contacts listing (like buildings/units/projects)
      allow read: if true;

      // âœï¸ CREATE: Allow authenticated users (admin operations + self-registration)
      allow create: if request.auth != null
                    && isValidContactData(request.resource.data)
                    && resource == null;

      // ğŸ“ UPDATE: Allow authenticated users (admin operations + self-update)
      allow update: if request.auth != null
                    && isValidContactData(request.resource.data);

      // ğŸ—‘ï¸ DELETE: Allow authenticated users (admin operations + self-delete)
      allow delete: if request.auth != null
                    && resource != null;
    }

    // =========================================================================
    // ğŸ§­ NAVIGATION COMPANIES COLLECTION - PUBLIC READ ACCESS
    // =========================================================================
    match /navigation_companies/{navigationId} {
      allow read: if true; // Public read access for navigation companies listing
      allow write: if false; // Admin/server only
    }

    // =========================================================================
    // ğŸ”’ HELPER FUNCTIONS - VALIDATION & SECURITY
    // =========================================================================

    // Project Data Validation
    function isValidProjectData(data) {
      return data.keys().hasAll(['name', 'status', 'company'])
             && data.name is string && data.name.size() > 0
             && data.status in ['planning', 'in_progress', 'completed', 'on_hold', 'cancelled']
             && data.company is string && data.company.size() > 0;
    }

    // Relationship Data Validation
    function isValidRelationshipData(data) {
      return data.keys().hasAll(['sourceContactId', 'targetContactId', 'relationshipType', 'status'])
             && data.sourceContactId is string && data.sourceContactId.size() > 0
             && data.targetContactId is string && data.targetContactId.size() > 0
             && data.relationshipType in ['employee', 'manager', 'partner', 'client', 'vendor']
             && data.status in ['active', 'inactive', 'pending', 'deleted'];
    }

    // DXF File Data Validation (metadata only!)
    function isValidDxfFileData(data) {
      return data.keys().hasAll(['fileName', 'ownerId'])
             && data.fileName is string && data.fileName.size() > 0
             && data.ownerId is string && data.ownerId.size() > 0
             // ğŸš¨ ÎšÎ¡Î™Î£Î™ÎœÎŸ: Î”Î•Î ÎµÏ€Î¹Ï„ÏÎµÏ€Î¿Ï…Î¼Îµ scene object ÏƒÏ„Î¿ Firestore!
             && !data.keys().hasAny(['scene'])
             // âœ… NEW: Support for Storage-based DXF files (Phase 4)
             && (
               // Legacy format (without storageUrl)
               !data.keys().hasAny(['storageUrl']) ||
               // New format (with storageUrl - Firebase Storage)
               (data.keys().hasAll(['storageUrl']) && data.storageUrl is string && data.storageUrl.size() > 0)
             );
    }

    // Contact Data Validation
    function isValidContactData(data) {
      return data.keys().hasAll(['email'])
             && data.email is string
             && data.email.matches('.*@.*\\..*'); // Basic email validation
    }

    // System Fields Protection
    function isAttemptingToModifySystemFields(newData, existingData) {
      let systemFields = ['createdAt', 'createdBy', 'ownerId', 'id'];
      return systemFields.hasAny(
        newData.diff(existingData).affectedKeys()
      );
    }

    // Relationship checking helper
    function hasRelationshipWithContact(userId, contactId) {
      // This would need to be implemented based on your relationship logic
      // For now, allowing basic access - you can refine this later
      return true;
    }
  }
}

projects

projects

mR6tY8uI3oP5qW7eA9sD

pzK8mN3xQw9vR2dL4jF7

xL2nV4bC6mZ8kJ9hG1fQ
mR6tY8uI3oP5qW7eA9sD
company
"Î.Î§.Î“. Î Î‘Î“Î©ÎÎ—Î£ & Î£Î™Î‘ ÎŸ.Î•."
(string)


companyId
"pzNUy8ksddGCtcQMqumR"
(string)


name
"ÎœÎµÎ³Î¬Î»Î¿Ï… Î‘Î»ÎµÎ¾Î¬Î½Î´ÏÎ¿Ï… Î£Ï…Î³ÎºÏÏŒÏ„Î·Î¼Î±"
(string)


progress
25
(number)


status
"planning"