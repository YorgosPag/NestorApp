Υλοποίησε Enterprise Color System με React Spectrum/Aria. Κεντρικό, προσβάσιμο, επεκτάσιμο. Παρακάτω πλήρης εντολή.

Στόχος

Ένα ενιαίο color picker stack με όλα τα modes, πλήρη a11y, i18n/RTL, contrast tools, palettes, tokens, tests, docs.

Αρχεία / Δομή

ui/color/EnterpriseColorPicker.tsx (συνθετικό picker)

ui/color/EnterpriseColorField.tsx (HEX/RGB/HSL input)

ui/color/EnterpriseColorDialog.tsx (modal με trap)

ui/color/BrandPalettes.ts (brand + semantic palettes)

ui/color/RecentColorsStore.ts (LRU store)

ui/color/hooks/useContrast.ts (WCAG ratio)

ui/color/types.ts (Color, Mode, Events)

theme/tokens.color.css (CSS variables)

stories/color/*.stories.tsx (Storybook)

tests/color/*.(test|spec).tsx (Jest/RTL + Playwright)

Βιβλιοθήκες

@react-aria/color, @react-stately/color, @react-aria/interactions

@react-aria/overlays για dialog a11y

Προαιρετικά: culori για μετατροπές/contrast, ή δικό μας util

Component API (βασικό)
type ColorMode = "hex" | "rgb" | "hsl";
type PickerVariant = "inline" | "popover" | "dialog";

interface EnterpriseColorPickerProps {
  value: string;                      // #RRGGBB or #RRGGBBAA
  onChange: (c: string) => void;      // live
  onChangeEnd?: (c: string) => void;  // commit
  alpha?: boolean;                    // default true
  modes?: ColorMode[];                // default ["hex","rgb","hsl"]
  palettes?: string[];                // brand tokens
  recent?: boolean;                   // LRU 10
  eyedropper?: boolean;               // if supported
  variant?: PickerVariant;            // default "popover"
  disabled?: boolean;
  readOnly?: boolean;
  labels?: { picker: string; field: string; alpha: string; hue: string; };
  className?: string;
}

Συνθετική αρχιτεκτονική

Area: ColorArea (S×V) με Hue slider.

Alpha slider όταν alpha=true.

Fields: ColorField με switch μεταξύ HEX/RGB/HSL.

Swatches: brand + Recent. Επιλογή με keyboard.

Wheel: προαιρετικά ColorWheel toggle.

Toolbar: Mode switch, Copy, Reset, Eyedropper.

Popover/Dialog: από @react-aria/overlays με focus trap.

Προσβασιμότητα

Όλα τα στοιχεία μέσω React Aria. Roles, aria-label/description, aria-valuetext.

Πλήρες keyboard: Tab, Shift+Tab, Arrows, PageUp/Down, Home/End, Esc.

Focus ring ορατό. Reduced motion σε prefers-reduced-motion.

Dialog: role="dialog", aria-modal="true", labeledby, initial focus, return focus.

Errors: invalid state, helper text.

i18n / RTL

Locale-aware parsing/formatting για RGB/HSL δεκαδικά.

Διαχείριση dir="rtl" για sliders/labels.

Μετάφραση labels από i18n provider.

Palettes

BrandPalettes.ts:

brand: primary, secondary, success, warning, danger.

ui: text, background, border, overlay.

API για custom palettes ανά προϊόν.

RecentColorsStore: LRU σε localStorage με dedupe.

Contrast / WCAG

Hook useContrast(fg, bg) με ratios AA/AAA για text/icon.

Panel στο picker: δείχνει ratio, pass/fail, προτάσεις πιο κοντινών έγκυρων αποχρώσεων.

Επιλογή background sample από theme tokens.

Tokens / Theming

tokens.color.css:

--cp-radius, --cp-gap, --cp-duration, --cp-easing

--cp-popover-z, --cp-popover-shadow

Χρώματα UI όχι hardcoded. Όλα μέσω variables.

Dark/Light υποστήριξη χωρίς αλλαγή κώδικα.

Eyedropper

Χρησιμοποίησε EyeDropper API όταν υπάρχει ("EyeDropper" in window).

Graceful fallback όταν δεν υποστηρίζεται.

Απόδοση

Throttle pointer move σε requestAnimationFrame.

Συμπίεση re-renders με useMemo, React.memo.

Lazy mount για Dialog περιεχόμενο.

Προαιρετικό onChangeEnd για βαριές ροές.

Ασφάλεια

Καμία χρήση dangerouslySetInnerHTML.

Valider για εισόδους HEX/RGB/HSL. Normalization σε canonical HEX(A).

Storybook Scenarios

Inline, Popover, Dialog.

Alpha on/off.

HEX/RGB/HSL switch.

Brand + Recent palettes.

Eyedropper.

RTL.

Reduced motion.

Contrast panel demo με background επιλογή.

Disabled/readonly.

Tests

Unit: parsing/normalization, mode switch, alpha, onChange/onChangeEnd.

A11y: axe clean για όλα τα stories.

Keyboard: πλήρης πλοήγηση σε area/slider/fields/swatches/dialog.

E2E/VR (Playwright): ανοίγει/κλείνει, focus trap, RTL, dark/light, snapshots.

Performance: interaction budget <16ms ανά frame σε drag.

Ενσωμάτωση στο App

Αντικατέστησε όλα τα ad-hoc pickers με EnterpriseColorPicker.

Παρέθεσε μία διεπαφή μορφοποίησης στο settings store: αποθήκευση ως #RRGGBBAA.

Αντιστοίχισε semantic tokens των ρυθμίσεων DXF σε brand/ui palettes.

Migration

Deprecated παλιά props. Κάνε codemod για αλλαγές.

Προσθήκη CHANGELOG.md με breaking changes.

Οδηγός “How to choose colors” στο docs.

Acceptance Criteria

100% λειτουργικότητα όπως παραπάνω.

Axe a11y: 0 violations.

Storybook πλήρες.

Tests green στο CI. Coverage shared UI ≥80%.

No magic numbers. Όλα μέσω tokens.

Χωρίς regressions σε RTL/dark/light.

Bundle impact τεκμηριωμένο.

Bonus (προαιρετικά)

P3/Display-P3 preview αν ο browser υποστηρίζει wide-gamut.

Export helpers: αντιγραφή σε CSS variables, Tailwind config, JSON.

Quick-actions: “Nearest accessible color” κουμπί.

Παράδωσε σε δύο PRs:

Core picker + tokens + tests + stories.

Ενσωμάτωση σε DXF Settings + migration + docs.