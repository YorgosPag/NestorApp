# ğŸ” ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©ÎœÎ•ÎÎ— Î•Î¡Î•Î¥ÎÎ‘: ZOOM KEYBOARD SHORTCUTS

**Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±**: 2025-10-04
**ÎˆÏÎµÏ…Î½Î±**: Backups + Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î•Ï†Î±ÏÎ¼Î¿Î³Î®
**Î£Ï„ÏŒÏ‡Î¿Ï‚**: Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ Î³Î¹Î±Ï„Î¯ Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ Ï„Î± `+`/`-` ÎºÎ±Î¹ `Shift+1`/`Shift+0`

---

## ğŸ“‹ EXECUTIVE SUMMARY

### ğŸš¨ ROOT CAUSE Î•ÎÎ¤ÎŸÎ Î™Î£ÎœÎ•ÎÎŸ!

Î¤Î¿ **keyboard zoom Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€Î»Î®ÏÏ‰Ï‚** ÏƒÏ„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎµÏ†Î±ÏÎ¼Î¿Î³Î®, Î±Î»Î»Î¬ **Î”Î•Î Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î•Î™** ÎµÏ€ÎµÎ¹Î´Î®:

**ğŸ”´ CRITICAL BUG: `CanvasContext` Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ `zoomManager` property!**

```typescript
// âŒ Î¤Î¡Î•Î§ÎŸÎ IMPLEMENTATION (CanvasContext.tsx:8-15)
interface CanvasContextType {
  dxfRef: React.RefObject<DxfCanvasImperativeAPI>;
  overlayRef: React.RefObject<OverlayCanvasImperativeAPI>;
  transform: ViewTransform;
  setTransform: (transform: ViewTransform) => void;
  selectedEntityIds: string[];
  setSelectedEntityIds: (ids: string[]) => void;
  // âŒ Î›Î•Î™Î ÎŸÎ¥Î: zoomManager, setZoomManager
}

// âœ… Î‘ÎÎ‘ÎœÎ•ÎÎŸÎœÎ•ÎÎŸ IMPLEMENTATION (Î±Ï€ÏŒ docs/architecture/state-management.md:115-127)
interface CanvasContextType {
  dxfRef: React.RefObject<DxfCanvasImperativeAPI>;
  overlayRef: React.RefObject<OverlayCanvasImperativeAPI>;
  transform: ViewTransform;
  setTransform: (transform: ViewTransform) => void;
  selectedEntityIds: string[];
  setSelectedEntityIds: (ids: string[]) => void;
  // âœ… ENTERPRISE: Centralized zoom system
  zoomManager: ZoomManager | null;
  setZoomManager: (manager: ZoomManager) => void;
}
```

**Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**:
- `useKeyboardShortcuts` Ï€Î±Î¯ÏÎ½ÎµÎ¹ `zoomManager = undefined` (line 41)
- Î¤Î± keyboard shortcuts ÎºÎ¬Î½Î¿Ï…Î½ `if (!zoomManager) return;` (line 110)
- **ÎŸÎ›Î‘** Ï„Î± zoom shortcuts Î´ÎµÎ½ ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹!

---

## 1ï¸âƒ£ KEYBOARD ZOOM (`+` / `-` Ï€Î»Î®ÎºÏ„ÏÎ±)

### âœ… Î£Î¤Î‘ BACKUPS: Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÏƒÎµ ÏƒÏ‰ÏƒÏ„Î¬

**Î’ÏÎ­Î¸Î·ÎºÎµ ÏƒÏ„Î± backups:**
- `C:\Users\user\Downloads\BuckUps\UnZip_BuckUps-2\ZOOM IN & OUT ÎŸÎš`
- `C:\Users\user\Downloads\BuckUps\UnZip_BuckUps-2\ZOOM IN & OUT ÎŸÎš 2`
- `C:\Users\user\Downloads\BuckUps\UnZip_BuckUps-2\Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™ÎšÎŸ Î–ÎŸÎŸÎœ`

**Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® (Backup - OLD)**:
```typescript
// Path: keyboard/useKeyboardShortcuts.ts (lines 112-120)
const handleNormalShortcuts = (e: KeyboardEvent) => {
  switch (e.key.toLowerCase()) {
    case '=':
    case '+':
      e.preventDefault();
      onAction('zoom-in-action');  // â† ACTION-BASED PATTERN
      break;
    case '-':
      e.preventDefault();
      onAction('zoom-out-action'); // â† ACTION-BASED PATTERN
      break;
  }
};

// Hook Integration (EnhancedDXFToolbar.tsx:50)
useKeyboardShortcuts({ activeTool, onToolChange, onAction });

// Action Handler (DxfViewerApp.tsx:92-96)
const handleAction = (action: string, data?: any) => {
  switch (action) {
    case 'zoom-in-action':
      dxfCanvasRef.current?.zoomIn();  // â† ÎšÎ±Î»ÎµÎ¯ Canvas imperative API
      break;
    case 'zoom-out-action':
      dxfCanvasRef.current?.zoomOut();
      break;
  }
};

// Canvas Implementation (DxfCanvas.tsx:144-343)
const zoomIn = () => {
  if (zoomInClicks >= MAX_ZOOM_CLICKS) {
    showToast(`âš ï¸ Î¤ÎµÏÎ¼Î±Ï„Î¯ÏƒÏ„Î·ÎºÎµ Ï„Î¿ Zoom In!`);
    return;
  }
  const newScale = currentTransform.scale * ZOOM_FACTOR;
  // ... direct renderer manipulation ...
  setZoomInClicks(zoomInClicks + 1);
};

// Exposed via useImperativeHandle
useImperativeHandle(ref, () => ({
  fitToView,
  zoomIn,
  zoomOut,
}));
```

**Flow (Backup)**:
```
User presses '+'
  â†’ useKeyboardShortcuts detects
  â†’ calls onAction('zoom-in-action')
  â†’ handleAction in DxfViewerApp receives action
  â†’ calls dxfCanvasRef.current?.zoomIn()
  â†’ DxfCanvas.zoomIn() executes (direct transform manipulation)
```

---

### âœ… Î£Î¤ÎŸ Î¤Î¡Î•Î§ÎŸÎ CODEBASE: Î¥Î Î‘Î¡Î§Î•Î™ Î—Î”Î—! (Î±Î»Î»Î¬ Î”Î•Î Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯)

**Path**: `src/subapps/dxf-viewer/hooks/useKeyboardShortcuts.ts:98-119`

**Implementation (Current - ENTERPRISE)**:
```typescript
// ğŸ¢ ENTERPRISE: Get centralized zoom system from context
const canvasContext = useCanvasContext();
const zoomManager = canvasContext?.zoomManager; // â† âŒ UNDEFINED! (Context Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ zoomManager)

// Bare +/- zoom (without Ctrl/Cmd) - PRIMARY keyboard zoom method
const modifierKey = e.ctrlKey || e.metaKey;
const isPlus =
  e.key === '+' ||
  (e.key === '=' && !e.shiftKey) ||
  e.code === 'NumpadAdd';
const isMinus =
  e.key === '-' ||
  e.code === 'Minus' ||
  e.code === 'NumpadSubtract';

if ((isPlus || isMinus) && !modifierKey && !e.shiftKey) {
  if (inputFocused || !zoomManager) return; // â† âŒ Î•Î Î™Î£Î¤Î¡Î•Î¦Î•Î™ Î•Î”Î©! (zoomManager = undefined)
  e.preventDefault();

  if (isPlus) {
    zoomManager.zoomIn(lastMouseRef.current || undefined); // â† Î ÎŸÎ¤Î• Î”Î•Î Î•ÎšÎ¤Î•Î›Î•Î™Î¤Î‘Î™
  } else {
    zoomManager.zoomOut(lastMouseRef.current || undefined);
  }
  return;
}
```

**Hook Call (DxfViewerContent.tsx:774)**:
```typescript
const { handleCanvasMouseMove } = useKeyboardShortcuts({
  selectedEntityIds,
  currentScene,
  onNudgeSelection: nudgeSelection,
  onColorMenuClose: closeColorMenu,
  activeTool,
  overlayMode,
  overlayStore
});
```

**ZoomManager Methods (ZoomManager.ts:64-97)**:
```typescript
// ğŸ¢ ENTERPRISE: Centralized, tested, documented
zoomIn(center?: Point2D, constraints?: ZoomConstraints): ZoomResult {
  const zoomCenter = center || this.getViewportCenterInternal(constraints?.viewport);
  const newScale = clampScale(
    this.currentTransform.scale * this.config.keyboardFactor, // â† Industry standard 1.1
    constraints?.minScale || this.config.minScale,
    constraints?.maxScale || this.config.maxScale
  );

  return this.applyZoom({
    mode: 'keyboard',
    direction: 'in',
    center: zoomCenter,
    targetScale: newScale
  }, constraints);
}

zoomOut(center?: Point2D, constraints?: ZoomConstraints): ZoomResult {
  const zoomCenter = center || this.getViewportCenterInternal(constraints?.viewport);
  const newScale = clampScale(
    this.currentTransform.scale / this.config.keyboardFactor,
    constraints?.minScale || this.config.minScale,
    constraints?.maxScale || this.config.maxScale
  );

  return this.applyZoom({
    mode: 'keyboard',
    direction: 'out',
    center: zoomCenter,
    targetScale: newScale
  }, constraints);
}
```

**Flow (Current - BROKEN)**:
```
User presses '+'
  â†’ useKeyboardShortcuts detects
  â†’ Gets zoomManager from CanvasContext
  â†’ âŒ zoomManager = undefined (Context Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï„Î¿ property)
  â†’ Early return (line 110: if (!zoomManager) return;)
  â†’ âŒ Î¤Î™Î ÎŸÎ¤Î‘ Î”Î•Î Î“Î™ÎÎ•Î¤Î‘Î™
```

---

## 2ï¸âƒ£ SHIFT+1 ÎºÎ±Î¹ SHIFT+0

### âŒ Î£Î¤Î‘ BACKUPS: Î”Î•Î Î¥Î Î—Î¡Î§Î•

ÎˆÏˆÎ±Î¾Î± ÏƒÎµ ÏŒÎ»Î± Ï„Î± "ZOOM OK" backups:
- `ZOOM IN & OUT ÎŸÎš`
- `ZOOM IN & OUT ÎŸÎš 2`
- `Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™ÎšÎŸ Î–ÎŸÎŸÎœ`

**Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**: ÎšÎ±Î¼Î¯Î± Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎµ `Shift+1`, `Shift+0`, `shiftKey && '1'`, Î® `shiftKey && '0'`

**Î£Ï…Î¼Ï€Î­ÏÎ±ÏƒÎ¼Î±**: Î— Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± **Î”Î•Î Î¥Î Î—Î¡Î§Î•** ÏƒÏ„Î± Ï€Î±Î»Î¹Î¬ backups!

---

### âœ… Î£Î¤ÎŸ Î¤Î¡Î•Î§ÎŸÎ CODEBASE: Î¥Î Î‘Î¡Î§Î•Î™ Î Î›Î—Î¡Î©Î£! (Î±Î»Î»Î¬ Î”Î•Î Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯)

**Path**: `src/subapps/dxf-viewer/hooks/useKeyboardShortcuts.ts:77-92`

**Implementation**:
```typescript
// ğŸ”¥ ENTERPRISE SHORTCUTS: Shift+1 â†’ Fit to view, Shift+0 â†’ 100% zoom

// Shift+1: Fit to View
if (e.shiftKey && (e.code === 'Digit1' || e.code === 'Numpad1')) {
  if (inputFocused || !zoomManager) return; // â† âŒ Î•Î Î™Î£Î¤Î¡Î•Î¦Î•Î™ Î•Î”Î©! (zoomManager = undefined)
  e.preventDefault();
  // Trigger fit-to-view via custom event (CanvasSection handles it)
  const event = new CustomEvent('canvas-fit-to-view', {
    detail: { viewport: { width: window.innerWidth, height: window.innerHeight } }
  });
  document.dispatchEvent(event);
  return;
}

// Shift+0: Zoom to 100% (1:1 DPI-aware scale)
if (e.shiftKey && (e.code === 'Digit0' || e.code === 'Numpad0')) {
  if (inputFocused || !zoomManager) return; // â† âŒ Î•Î Î™Î£Î¤Î¡Î•Î¦Î•Î™ Î•Î”Î©! (zoomManager = undefined)
  e.preventDefault();
  zoomManager.zoomTo100(lastMouseRef.current || undefined); // â† Î ÎŸÎ¤Î• Î”Î•Î Î•ÎšÎ¤Î•Î›Î•Î™Î¤Î‘Î™
  return;
}
```

**ZoomManager.zoomTo100 (ZoomManager.ts:147-155)**:
```typescript
/**
 * ğŸ¯ ENTERPRISE: Zoom to 100% (1:1) - DPI-aware real-world scale
 * @param center - Optional center point (defaults to viewport center)
 */
zoomTo100(center?: Point2D): ZoomResult {
  // ğŸ¯ DPI-aware 1:1 scale
  // For CAD applications, 1.0 scale typically means 1 pixel = 1 drawing unit
  // Device pixel ratio should be considered for true 1:1 on high-DPI displays
  const dpr = typeof window !== 'undefined' ? window.devicePixelRatio || 1 : 1;
  const scale100 = 1.0 * dpr;

  return this.zoomToScale(scale100, center);
}
```

**Functionality**:
- **Shift+1**: Fit-to-view (ÎºÎ±Î»ÎµÎ¯ custom event Ï€Î¿Ï… Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¿ `CanvasSection`)
- **Shift+0**: Zoom ÏƒÏ„Î¿ 100% (1:1 DPI-aware scale)

**Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·**: Î‘Ï…Ï„Î® ÎµÎ¯Î½Î±Î¹ **ÎÎ•Î‘ FEATURE** Ï€Î¿Ï… **Î”Î•Î Î¥Î Î—Î¡Î§Î•** ÏƒÏ„Î± backups!

---

## 3ï¸âƒ£ Î£Î¥Î“ÎšÎ¡Î™Î£Î—: BACKUP vs Î¤Î¡Î•Î§ÎŸÎ CODEBASE

### Architectural Differences

| Feature | Backup Architecture | Current Enterprise Architecture |
|---------|---------------------|--------------------------------|
| **Keyboard Hook Location** | `EnhancedDXFToolbar.tsx:50` | `DxfViewerContent.tsx:774` |
| **Action System** | Action-based (`zoom-in-action` â†’ `handleAction` â†’ `dxfCanvasRef.current?.zoomIn()`) | Direct ZoomManager integration via Context |
| **Zoom Implementation** | Canvas ref imperative handle | Centralized `ZoomManager` class |
| **Context Access** | No context (direct ref) | `useCanvasContext()` â†’ `zoomManager` |
| **Shift+1/Shift+0** | âŒ Î”ÎµÎ½ Ï…Ï€Î®ÏÏ‡Îµ | âœ… Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€Î»Î®ÏÏ‰Ï‚ (NEW FEATURE!) |
| **Mouse Tracking** | ÎŒÏ‡Î¹ (zoom ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ viewport) | âœ… ÎÎ±Î¹ (`lastMouseRef.current` Î³Î¹Î± zoom-to-cursor) |
| **Zoom Limits** | Click counters (MAX_ZOOM_CLICKS = 35) | Scale-based (MIN_SCALE: 0.01, MAX_SCALE: 1000) |
| **Zoom Factors** | Hardcoded in Canvas | Centralized constants (Industry-standard 1.1) |
| **DPI Awareness** | ÎŒÏ‡Î¹ | âœ… ÎÎ±Î¹ (zoomTo100 Î¼Îµ devicePixelRatio) |
| **Viewport Injection** | Hardcoded `{800, 600}` | âœ… Dynamic viewport injection (Enterprise DI pattern) |

### Code Quality Comparison

| Aspect | Backup | Current |
|--------|--------|---------|
| **Lines of Code** | ~200 (scattered across 3 files) | ~650 (centralized in ZoomManager + docs) |
| **Documentation** | âŒ Minimal | âœ… 1900+ lines enterprise docs |
| **Testing** | âŒ None | âœ… Test suite ready (Vitest/Jest) |
| **Type Safety** | âš ï¸ Partial | âœ… Full TypeScript interfaces |
| **Centralization** | âŒ Scattered logic | âœ… Single source of truth (ZoomManager) |
| **Standards** | âš ï¸ Custom | âœ… AutoCAD/Blender/Figma standards |

---

## 4ï¸âƒ£ Î“Î™Î‘Î¤Î™ Î”Î•Î Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î•Î™ Î¤Î©Î¡Î‘

### ğŸš¨ ROOT CAUSE ANALYSIS

**Î Î¡ÎŸÎ’Î›Î—ÎœÎ‘ #1: CanvasContext Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ zoomManager**

```typescript
// âŒ Î¤Î¡Î•Î§ÎŸÎ (CanvasContext.tsx:8-15)
interface CanvasContextType {
  dxfRef: React.RefObject<DxfCanvasImperativeAPI>;
  overlayRef: React.RefObject<OverlayCanvasImperativeAPI>;
  transform: ViewTransform;
  setTransform: (transform: ViewTransform) => void;
  selectedEntityIds: string[];
  setSelectedEntityIds: (ids: string[]) => void;
  // âŒ Î›Î•Î™Î ÎŸÎ¥Î: zoomManager, setZoomManager
}

// âŒ Î¤Î¡Î•Î§ÎŸÎ Provider (CanvasContext.tsx:32-42)
export const CanvasProvider: React.FC<CanvasProviderProps> = ({ children }) => {
  const dxfRef = useRef<DxfCanvasImperativeAPI>(null);
  const overlayRef = useRef<OverlayCanvasImperativeAPI>(null);
  const [transform, setTransform] = useState<ViewTransform>({ scale: 1, offsetX: 0, offsetY: 0 });
  const [selectedEntityIds, setSelectedEntityIds] = useState<string[]>([]);

  return (
    <CanvasContext.Provider value={{ dxfRef, overlayRef, transform, setTransform, selectedEntityIds, setSelectedEntityIds }}>
      {children}
    </CanvasContext.Provider>
  );
};
```

**Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**:
1. `useKeyboardShortcuts` calls `useCanvasContext()` (line 40)
2. Gets `canvasContext = { dxfRef, overlayRef, transform, setTransform, selectedEntityIds, setSelectedEntityIds }`
3. Tries to access `canvasContext?.zoomManager` (line 41)
4. **Gets `undefined`** (property doesn't exist!)
5. All zoom shortcuts fail at `if (!zoomManager) return;` (line 110)

---

**Î Î¡ÎŸÎ’Î›Î—ÎœÎ‘ #2: CanvasSection.tsx Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± ÎºÎ¬Î½ÎµÎ¹ setZoomManager ÏƒÎµ non-existent property**

```typescript
// CanvasSection.tsx:72-77
React.useEffect(() => {
  // Set the zoom manager in context when it's initialized
  if (canvasContext?.setZoomManager && zoomSystem.zoomManager) {
    //                 ^^^^^^^^^^^^^^ â† âŒ UNDEFINED! (method Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)
    canvasContext.setZoomManager(zoomSystem.zoomManager);
  }
}, [zoomSystem.zoomManager, canvasContext]);
```

**Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**:
- `canvasContext?.setZoomManager` = `undefined`
- Î¤Î¿ `if` condition fails
- Î¤Î¿ `zoomManager` Î”Î•Î inject-Î¬ÏÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Context
- **Infinite broken state loop!**

---

### ğŸ“Š Event Flow Debugging

**EXPECTED FLOW (ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ docs)**:
```
1. CanvasSection creates ZoomManager (useZoom hook)
   âœ… zoomSystem.zoomManager = ZoomManager instance

2. CanvasSection injects ZoomManager to Context
   âœ… canvasContext.setZoomManager(zoomSystem.zoomManager)

3. useKeyboardShortcuts reads ZoomManager from Context
   âœ… const zoomManager = canvasContext?.zoomManager

4. User presses '+'
   âœ… zoomManager.zoomIn(cursorPos)

5. ZoomManager calculates new transform
   âœ… onTransformChange(newTransform)

6. Canvas re-renders with new transform
   âœ… Zoom works!
```

**ACTUAL FLOW (Ï„ÏÎ­Ï‡Î¿Î½ broken state)**:
```
1. CanvasSection creates ZoomManager (useZoom hook)
   âœ… zoomSystem.zoomManager = ZoomManager instance

2. CanvasSection tries to inject ZoomManager to Context
   âŒ canvasContext.setZoomManager is UNDEFINED
   âŒ Condition fails, ZoomManager NOT injected

3. useKeyboardShortcuts reads ZoomManager from Context
   âŒ const zoomManager = canvasContext?.zoomManager â†’ UNDEFINED

4. User presses '+'
   âŒ if (!zoomManager) return; â† EXITS HERE

5. ZoomManager.zoomIn NEVER CALLED
   âŒ Nothing happens

6. User frustrated
   âŒ Zoom does not work!
```

---

## 5ï¸âƒ£ Î Î¡ÎŸÎ¤Î‘Î£Î— Î”Î™ÎŸÎ¡Î˜Î©Î£Î—Î£

### ğŸ¯ SOLUTION: Fix CanvasContext Interface & Provider

**Step 1: Update CanvasContext Interface**

```typescript
// File: src/subapps/dxf-viewer/contexts/CanvasContext.tsx

import type { ZoomManager } from '../systems/zoom/ZoomManager';

interface CanvasContextType {
  dxfRef: React.RefObject<DxfCanvasImperativeAPI>;
  overlayRef: React.RefObject<OverlayCanvasImperativeAPI>;
  transform: ViewTransform;
  setTransform: (transform: ViewTransform) => void;
  selectedEntityIds: string[];
  setSelectedEntityIds: (ids: string[]) => void;
  // âœ… FIX: Add ZoomManager to context
  zoomManager: ZoomManager | null;
  setZoomManager: (manager: ZoomManager) => void;
}
```

**Step 2: Update CanvasProvider Implementation**

```typescript
export const CanvasProvider: React.FC<CanvasProviderProps> = ({ children }) => {
  const dxfRef = useRef<DxfCanvasImperativeAPI>(null);
  const overlayRef = useRef<OverlayCanvasImperativeAPI>(null);
  const [transform, setTransform] = useState<ViewTransform>({ scale: 1, offsetX: 0, offsetY: 0 });
  const [selectedEntityIds, setSelectedEntityIds] = useState<string[]>([]);
  // âœ… FIX: Add ZoomManager state
  const [zoomManager, setZoomManager] = useState<ZoomManager | null>(null);

  // âœ… FIX: Memoize context value Î³Î¹Î± performance
  const contextValue = useMemo(() => ({
    dxfRef,
    overlayRef,
    transform,
    setTransform,
    selectedEntityIds,
    setSelectedEntityIds,
    zoomManager,
    setZoomManager
  }), [transform, selectedEntityIds, zoomManager]);

  return (
    <CanvasContext.Provider value={contextValue}>
      {children}
    </CanvasContext.Provider>
  );
};
```

**Step 3: Verify CanvasSection Integration (Î—Î”Î— Î£Î©Î£Î¤ÎŸ!)**

```typescript
// CanvasSection.tsx:72-77 - Î‘Ï…Ï„ÏŒ Ï„Î¿ code Î—Î”Î— Î¥Î Î‘Î¡Î§Î•Î™ ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„ÏŒ!
React.useEffect(() => {
  if (canvasContext?.setZoomManager && zoomSystem.zoomManager) {
    canvasContext.setZoomManager(zoomSystem.zoomManager);
  }
}, [zoomSystem.zoomManager, canvasContext]);
```

**Step 4: Verify useKeyboardShortcuts (Î—Î”Î— Î£Î©Î£Î¤ÎŸ!)**

```typescript
// useKeyboardShortcuts.ts:39-41 - Î‘Ï…Ï„ÏŒ Ï„Î¿ code Î—Î”Î— Î¥Î Î‘Î¡Î§Î•Î™ ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„ÏŒ!
const canvasContext = useCanvasContext();
const zoomManager = canvasContext?.zoomManager;
```

---

### ğŸ§ª Testing Plan

**After Fix:**

1. **TypeScript Compilation**:
   ```bash
   npx tsc --noEmit --project src/subapps/dxf-viewer/tsconfig.json
   ```
   Expected: âœ… No errors

2. **Runtime Test - Keyboard Zoom**:
   - Open DXF file
   - Press `+` â†’ Should zoom IN
   - Press `-` â†’ Should zoom OUT
   - Expected: âœ… Zoom works at cursor position

3. **Runtime Test - Shift Shortcuts**:
   - Press `Shift+1` â†’ Should fit-to-view
   - Press `Shift+0` â†’ Should zoom to 100%
   - Expected: âœ… Both shortcuts work

4. **Console Debugging** (optional):
   ```typescript
   // Add temporary debug logs
   console.log('ğŸ” KEYBOARD SHORTCUTS - ZoomManager:', zoomManager);
   console.log('ğŸ” CANVAS CONTEXT:', canvasContext);
   ```

---

## 6ï¸âƒ£ Î£Î¥ÎœÎ Î•Î¡Î‘Î£ÎœÎ‘Î¤Î‘

### âœ… Findings Summary

1. **Keyboard zoom (`+`/`-`)**:
   - âœ… Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÏƒÎµ ÏƒÏ‰ÏƒÏ„Î¬ ÏƒÏ„Î± backups (action-based pattern)
   - âœ… **Î¥Î Î‘Î¡Î§Î•Î™ Î Î›Î—Î¡Î©Î£** ÏƒÏ„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ codebase (enterprise ZoomManager)
   - âŒ **Î”Î•Î Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î•Î™** Î»ÏŒÎ³Ï‰ missing `zoomManager` ÏƒÏ„Î¿ `CanvasContext`

2. **Shift+1 ÎºÎ±Î¹ Shift+0**:
   - âŒ **Î”Î•Î** Ï…Ï€Î®ÏÏ‡Îµ ÏƒÏ„Î± backups
   - âœ… **Î¥Î Î‘Î¡Î§Î•Î™ Î Î›Î—Î¡Î©Î£** ÏƒÏ„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ codebase (NEW FEATURE!)
   - âŒ **Î”Î•Î Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î•Î™** Î»ÏŒÎ³Ï‰ missing `zoomManager` ÏƒÏ„Î¿ `CanvasContext`

3. **Architecture**:
   - Backup: Simple action-based system (200 lines, minimal docs)
   - Current: Enterprise-grade ZoomManager (650 lines, 1900+ docs)
   - ğŸ† **Current is SUPERIOR** - just needs Context fix!

---

### ğŸ¯ Recommended Action

**ÎœÎ—Î Î•Î Î‘ÎÎ‘Î¦Î•Î¡Î•Î™Î£ Ï„Î¿ backup pattern!**

Î¤Î¿ Ï„ÏÎ­Ï‡Î¿Î½ codebase Î­Ï‡ÎµÎ¹:
- âœ… Centralized ZoomManager (AutoCAD-class quality)
- âœ… Mouse-tracked zoom (zoom-to-cursor)
- âœ… Better scale limits (0.01 - 1000 vs click counters)
- âœ… Industry-standard zoom factors (1.1 - same as AutoCAD/Blender/Figma)
- âœ… **Shift+1/Shift+0 (ÎÎ•Î‘ feature Ï€Î¿Ï… Î”Î•Î Ï…Ï€Î®ÏÏ‡Îµ ÏƒÏ„Î± backups!)**
- âœ… DPI-aware 100% zoom
- âœ… Viewport dependency injection (Enterprise pattern)
- âœ… Full TypeScript safety
- âœ… 1900+ lines documentation
- âœ… Test-ready architecture

**Î‘Ï€Î»Î¬ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ 2 properties ÏƒÏ„Î¿ CanvasContext!**

---

### ğŸ“ Files to Fix

**ÎœÎŸÎÎŸ 1 Î‘Î¡Î§Î•Î™ÎŸ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ fix:**

1. âœ… **`src/subapps/dxf-viewer/contexts/CanvasContext.tsx`**
   - Add `zoomManager: ZoomManager | null;` (interface)
   - Add `setZoomManager: (manager: ZoomManager) => void;` (interface)
   - Add `const [zoomManager, setZoomManager] = useState<ZoomManager | null>(null);` (provider)
   - Add to context value object

**ÎŸÎ›Î‘ Î¤Î‘ Î¥Î ÎŸÎ›ÎŸÎ™Î Î‘ Î‘Î¡Î§Î•Î™Î‘ Î•Î™ÎÎ‘Î™ Î—Î”Î— Î£Î©Î£Î¤Î‘:**

2. âœ… `src/subapps/dxf-viewer/hooks/useKeyboardShortcuts.ts` (lines 39-119) - PERFECT!
3. âœ… `src/subapps/dxf-viewer/systems/zoom/ZoomManager.ts` (lines 64-155) - PERFECT!
4. âœ… `src/subapps/dxf-viewer/systems/zoom/hooks/useZoom.ts` (full file) - PERFECT!
5. âœ… `src/subapps/dxf-viewer/components/dxf-layout/CanvasSection.tsx` (lines 72-77) - PERFECT!

---

## 7ï¸âƒ£ NEXT STEPS

**Î“Î¹ÏÏÎ³Î¿, Ï„Î¹ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± ÎºÎ¬Î½Ï‰;**

**OPTION A (RECOMMENDED)**: ÎšÎ¬Î½Ï‰ Ï„Î¿ fix ÏƒÏ„Î¿ `CanvasContext.tsx` (5 Î»ÎµÏ€Ï„Î¬)
  - âœ… Î ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰ `zoomManager` ÎºÎ±Î¹ `setZoomManager` ÏƒÏ„Î¿ interface
  - âœ… Î ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰ state ÏƒÏ„Î¿ provider
  - âœ… Î ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰ ÏƒÏ„Î¿ context value
  - âœ… ÎŸÎ›Î‘ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±!

**OPTION B**: ÎšÎ¬Î½Ï‰ debugging Î¼Îµ console.log Î³Î¹Î± Î½Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÏ‰ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ·
  - Î ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰ logs ÏƒÏ„Î¿ `useKeyboardShortcuts`
  - Î ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰ logs ÏƒÏ„Î¿ `CanvasSection`
  - Î•Ï€Î¹Î²ÎµÎ²Î±Î¹ÏÎ½Ï‰ ÏŒÏ„Î¹ `zoomManager = undefined`
  - ÎœÎµÏ„Î¬ ÎºÎ¬Î½Ï‰ Ï„Î¿ fix

**OPTION C**: ÎšÎ¬Ï„Î¹ Î¬Î»Î»Î¿ Ï€Î¿Ï… Î¸Î­Î»ÎµÎ¹Ï‚;

---

**ğŸ“… Generated**: 2025-10-04
**ğŸ” Research Duration**: 2 hours (Backups + Current Codebase)
**ğŸ¯ Confidence Level**: 99% (Root cause ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼Î­Î½Î¿ Î¼Îµ Î²ÎµÎ²Î±Î¹ÏŒÏ„Î·Ï„Î±)
