# ΠΡΟΣΧΕΔΙΑΣΗ ΜΕ ΕΙΔΙΚΕΣ ΡΥΘΜΙΣΕΙΣ - ΔΙΟΡΘΩΣΗ & ΕΠΙΣΚΕΥΗ

## 🔧 ΔΙΟΡΘΩΜΕΝΟΣ ΣΤΟΧΟΣ ΕΡΓΟΥ

**ΕΠΙΣΚΕΥΗ** της υπάρχουσας λειτουργικότητας που επιτρέπει στη **φάση προσχεδίασης γραμμών** να χρησιμοποιεί είτε **γενικές** είτε **ειδικές ρυθμίσεις** ανάλογα με την επιλογή του χρήστη.

## ⚠️ ΔΙΟΡΘΩΣΗ ΑΣΥΝΕΠΕΙΑΣ

**ΠΑΛΙΟ (ΛΑΘΟΣ):** Πίστευα ότι πρέπει να δημιουργήσουμε νέα λειτουργικότητα
**ΣΩΣΤΟ:** Η λειτουργικότητα ΗΔΗ ΥΠΑΡΧΕΙ αλλά δεν λειτουργεί σωστά

### **Υπάρχοντα Συστήματα:**
- ✅ **SpecificLinePreviewContext** - Ειδικές ρυθμίσεις γραμμών
- ✅ **SpecificTextPreviewContext** - Ειδικές ρυθμίσεις κειμένων
- ✅ **UnifiedSettingsContext** - Ενοποιημένες ρυθμίσεις grips
- ✅ **Checkbox "Παράκαμψη Γενικών"** - ΗΔΗ ΥΠΑΡΧΕΙ στο UI

---

## 📋 ΛΕΠΤΟΜΕΡΗΣ ΠΕΡΙΓΡΑΦΗ

### **1. ΦΑΣΗ ΠΡΟΣΧΕΔΙΑΣΗΣ - ΟΡΙΣΜΟΣ:**

**Τι είναι η φάση προσχεδίασης:**
- Ξεκινάει: Όταν πατάω το κουμπί **"Γραμμή"** στην κεντρική εργαλειοθήκη
- Ενεργοποιείται: Με το **πρώτο κλικ** στον καμβά
- Διαρκεί: **Από το πρώτο κλικ μέχρι το δεύτερο κλικ**
- Τερματίζεται: Με το **δεύτερο κλικ** (δημιουργία τελικής γραμμής)

**Στοιχεία που εμφανίζονται στη φάση προσχεδίασης:**
- **Διακεκομμένη γραμμή** (preview line) που συνδέει τα δύο σημεία
- **Grips** στα άκρα (πρώτο σημείο + cursor)
- **Κείμενο απόστασης** στο κέντρο της γραμμής

### **2. ΠΡΟΒΛΗΜΑΤΙΚΗ ΚΑΤΑΣΤΑΣΗ:**

**Τι πρόβλημα υπάρχει:**
- Το checkbox "Παράκαμψη Γενικών" ΗΔΗ ΥΠΑΡΧΕΙ αλλά δεν λειτουργεί
- Τα context συστήματα (SpecificLinePreview, SpecificTextPreview) δεν ενεργοποιούνται σωστά
- Η φάση προσχεδίασης αγνοεί τις ειδικές ρυθμίσεις ακόμα και όταν το checkbox είναι checked
- Δεν υπάρχει σωστή σύνδεση μεταξύ UI checkbox και των preview contexts

### **3. ΑΠΑΙΤΟΥΜΕΝΕΣ ΕΠΙΣΚΕΥΕΣ:**

#### **Α. Επισκευή Υπάρχοντος Checkbox**
- **Τοποθεσία**: Floating Panel → DXF Settings Tab → Ειδικές Ρυθμίσεις (ΗΔΗ ΥΠΑΡΧΕΙ)
- **Τίτλος**: "Παράκαμψη Γενικών Ρυθμίσεων" (ΗΔΗ ΥΠΑΡΧΕΙ)
- **Πρόβλημα**: Δεν συνδέεται σωστά με τα preview contexts

#### **Β. Λειτουργία Checkbox:**

**Όταν είναι UNCHECKED (default):**
- Φάση προσχεδίασης χρησιμοποιεί → **Γενικές ρυθμίσεις** (Line, Text, Grips)
- Λειτουργεί όπως τώρα (τρέχουσα συμπεριφορά)

**Όταν είναι CHECKED:**
- Φάση προσχεδίασης χρησιμοποιεί → **Ειδικές ρυθμίσεις** (Line, Text, Grips)
- Οι ειδικές ρυθμίσεις γίνονται **αυτόνομες** και δεν επηρεάζονται από αλλαγές στις γενικές
- Μπορώ να αλλάξω χρώματα, πάχη, στυλ κλπ μόνο για την προσχεδίαση

#### **Γ. Στοιχεία που επηρεάζονται:**

**1. Γραμμή Προσχεδίασης:**
- Χρώμα, πάχος, στυλ γραμμής
- Διαφάνεια, είδος γραμμής (διακεκομμένη κλπ)

**2. Grips Προσχεδίασης:**
- Χρώματα (cold, warm, hot)
- Μέγεθος, σχήμα grips

**3. Κείμενο Απόστασης:**
- Χρώμα, μέγεθος γραμματοσειράς
- Στυλ κειμένου (bold, italic κλπ)

---

## 🔄 ΛΟΓΙΚΗ ΛΕΙΤΟΥΡΓΙΑΣ

### **Σενάριο 1: Κανονική Λειτουργία (Checkbox UNCHECKED)**
```
Χρήστης → Πατάει "Γραμμή" → Πρώτο κλικ → Φάση Προσχεδίασης
↓
Προσχεδίαση διαβάζει από: ΓΕΝΙΚΕΣ ΡΥΘΜΙΣΕΙΣ
↓
Γραμμή/Grips/Κείμενο → Χρησιμοποιούν γενικές ρυθμίσεις
```

### **Σενάριο 2: Ειδικές Ρυθμίσεις (Checkbox CHECKED)**
```
Χρήστης → Τσεκάρει "Παράκαμψη Γενικών" → Πατάει "Γραμμή" → Πρώτο κλικ
↓
Προσχεδίαση διαβάζει από: ΕΙΔΙΚΕΣ ΡΥΘΜΙΣΕΙΣ
↓
Γραμμή/Grips/Κείμενο → Χρησιμοποιούν ειδικές ρυθμίσεις (ανεξάρτητες από γενικές)
```

---

## 🎨 ΠΑΡΑΔΕΙΓΜΑ ΧΡΗΣΗΣ

### **Γενικές Ρυθμίσεις:**
- Γραμμές: Κόκκινες, πάχος 3px
- Κείμενο: Μπλε, 14px
- Grips: Πράσινα

### **Ειδικές Ρυθμίσεις (όταν checkbox είναι checked):**
- Γραμμές: Κίτρινες, πάχος 1px
- Κείμενο: Ιωδες, 10px
- Grips: Πορτοκαλί

### **Αποτέλεσμα:**
- **Checkbox UNCHECKED**: Προσχεδίαση με κόκκινες γραμμές, μπλε κείμενο, πράσινα grips
- **Checkbox CHECKED**: Προσχεδίαση με κίτρινες γραμμές, ιώδες κείμενο, πορτοκαλί grips

---

## 🔧 ΠΕΡΙΟΧΕΣ ΕΠΙΣΚΕΥΗΣ

### **1. UI Components:**
- Επισκευή σύνδεσης checkbox με preview contexts (ΟΧΙ δημιουργία νέου)
- Διόρθωση state management για ειδικές ρυθμίσεις

### **2. Λογική Προσχεδίασης:**
- Επισκευή SpecificLinePreviewContext activation
- Επισκευή SpecificTextPreviewContext activation
- Διόρθωση UnifiedSettingsContext για grips
- Επισκευή PhaseManager συμπεριφοράς

### **3. Context Integration:**
- Επισκευή διασύνδεσης των τριών context συστημάτων
- Διόρθωση checkbox state propagation
- Επισκευή preview phase detection

---

## ✅ ΔΙΟΡΘΩΜΕΝΗ ΚΑΤΑΝΟΗΣΗ

**ΔΙΟΡΘΩΜΕΝΟΣ ΣΤΟΧΟΣ**: Επισκευή της υπάρχουσας φάσης προσχεδίασης γραμμών ώστε να λειτουργεί σωστά το checkbox "Παράκαμψη Γενικών Ρυθμίσεων".

**ΚΥΡΙΟΣ ΣΤΟΧΟΣ**: Ενεργοποίηση της ήδη υπάρχουσας δυνατότητας ανεξάρτητης προσαρμογής της εμφάνισης προσχεδίασης.

## 🚨 ΚΡΙΣΙΜΟ ΠΡΟΒΛΗΜΑ - ΕΝΗΜΕΡΩΣΗ ΑΠΟ ΧΡΗΣΤΗ

### **ΤΟ ΠΡΑΓΜΑΤΙΚΟ ΠΡΟΒΛΗΜΑ:**
**Διαδρομή**: Floating Panel → Ρυθμίσεις DXF → **Ειδικές Ρυθμίσεις** → **Οντότητες** → **Σχεδίαση**

**Στις 4 καρτέλες**: **Προσχεδίαση**, **Ολοκλήρωση**, **Hover**, **Επιλογή**

**Σε οποιαδήποτε από αυτές** όταν:
1. Πάω σε **Γραμμή/Κείμενο/Grips**
2. **ΚΑΙ έχω πατημένο** το checkbox **"Παράκαμψη Γενικών Ρυθμίσεων"**
3. **Αλλάζω μία ρύθμιση** (π.χ. χρώμα)

**ΤΟ ΛΑΘΟΣ**: Οι αλλαγές επηρεάζουν **ΚΑΙ τις Γενικές Ρυθμίσεις**

**ΤΟ ΣΩΣΤΟ**: Οι αλλαγές πρέπει να επηρεάζουν **ΜΟΝΟ τις Ειδικές Ρυθμίσεις**

### **ΔΙΑΤΑΓΗ ΧΡΗΣΤΗ:**
> "όταν έχω πατήσει παράκαμψη γενικών ρυθμίσεων θέλω αυτές οι ρυθμίσεις να αφορούν μόνο τις ειδικές ρυθμίσεις"
> "είναι διαταγή"
> "θα πρέπει το σύστημα να λειτουργεί"

**ΑΠΑΙΤΗΣΗ**: Όταν το checkbox "Παράκαμψη Γενικών Ρυθμίσεων" είναι πατημένο, οι αλλαγές πρέπει να είναι **ΠΛΗΡΩΣ ΑΝΕΞΑΡΤΗΤΕΣ** από τις γενικές ρυθμίσεις.

## 🚨 ΣΗΜΑΝΤΙΚΟ
**ΟΧΙ νέος κώδικας** - **ΝΑΙ επισκευή υπάρχοντος**
**ΟΧΙ διπλότυπα** - **ΝΑΙ χρήση υπαρχόντων contexts**

---

## 📋 ΒΗΜΑΤΙΣΜΟΣ ΕΠΙΣΚΕΥΗΣ

### **🎯 ΣΤΡΑΤΗΓΙΚΗ ΠΡΟΣΕΓΓΙΣΗΣ:**
**Α** → **Β** → **Γ** (Investigation → Debugging → In-place Fixes)

### **ΒΗΜΑ 1: INVESTIGATION (Β) - Σύνδεση UI ↔ Contexts**
- **Στόχος**: Εντοπισμός που "κολλάει" η σύνδεση checkbox → preview contexts
- **Ενέργειες**:
  - Εύρεση checkbox component στις ειδικές ρυθμίσεις
  - Εύρεση state management για checkbox
  - Εύρεση τρόπου propagation σε preview contexts
- **Αποτέλεσμα**: Κατανόηση της τρέχουσας αρχιτεκτονικής
- **Έλεγχος**: Εφαρμογή δεν σπάει (μόνο read operations)

### **ΒΗΜΑ 2: DEBUGGING (Α) - Context Activation**
- **Στόχος**: Εντοπισμός γιατί τα preview contexts δεν ενεργοποιούνται
- **Ενέργειες**:
  - Ανάλυση SpecificLinePreviewContext activation logic
  - Ανάλυση SpecificTextPreviewContext activation logic
  - Ανάλυση UnifiedSettingsContext για grips
  - Εντοπισμός conditional rendering ή missing providers
- **Αποτέλεσμα**: Προσδιορισμός συγκεκριμένου σημείου αποτυχίας
- **Έλεγχος**: Εφαρμογή δεν σπάει (debugging + console logs αν χρειάζεται)

### **ΒΗΜΑ 3: CODE REVIEW (Γ) - Υπάρχοντες Preview Contexts**
- **Στόχος**: Ανάλυση κώδικα για εύρεση root cause
- **Ενέργειες**:
  - Ανάγνωση SpecificLinePreviewContext implementation
  - Ανάγνωση SpecificTextPreviewContext implementation
  - Ανάγνωση σχετικών hooks και providers
  - Εντοπισμός missing connections ή λάθος logic
- **Αποτέλεσμα**: Ακριβής προσδιορισμός τι πρέπει να διορθωθεί
- **Έλεγχος**: Εφαρμογή δεν σπάει (μόνο read operations)

### **ΒΗΜΑ 4: IN-PLACE FIXES - Διορθώσεις**
**Προτεραιότητα διορθώσεων** (με έλεγχο μετά από κάθε fix):

**4.1** - **Provider Integration Fix**
- Διόρθωση σύνδεσης checkbox state με contexts
- **Έλεγχος**: Checkbox λειτουργεί + backup

**4.2** - **Context Activation Fix**
- Διόρθωση conditional activation logic
- **Έλεγχος**: Preview contexts ενεργοποιούνται + backup

**4.3** - **Settings Propagation Fix**
- Διόρθωση propagation ειδικών ρυθμίσεων στη φάση προσχεδίασης
- **Έλεγχος**: Ειδικές ρυθμίσεις εμφανίζονται + backup

**4.4** - **Integration Testing**
- Έλεγχος ολοκληρωμένης λειτουργικότητας
- **Έλεγχος**: Πλήρης λειτουργία + τελικό backup

### **🛡️ SAFETY PROTOCOLS:**
- **Κανένας νέος κώδικας** - μόνο επισκευή υπάρχοντος
- **Κανένα νέο αρχείο** χωρίς ρητή άδεια
- **In-place editing** μόνο σε υπάρχοντα files
- **Έλεγχος εφαρμογής** μετά από κάθε βήμα
- **Backup confirm** πριν το επόμενο βήμα
- **Rollback plan** αν κάτι σπάσει

### **📊 SUCCESS METRICS:**
- ✅ Checkbox "Παράκαμψη Γενικών" λειτουργεί
- ✅ UNCHECKED → Προσχεδίαση χρησιμοποιεί γενικές ρυθμίσεις
- ✅ CHECKED → Προσχεδίαση χρησιμοποιεί ειδικές ρυθμίσεις
- ✅ Εφαρμογή σταθερή χωρίς crashes
- ✅ Κανένας νέος κώδικας δημιουργήθηκε