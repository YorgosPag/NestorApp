# ADR-ACC-002: Invoicing System â€” Î£ÏÏƒÏ„Î·Î¼Î± Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚

| Metadata | Value |
|----------|-------|
| **Status** | DRAFT |
| **Date** | 2026-02-09 |
| **Category** | Accounting / Invoicing |
| **Author** | Î“Î¹ÏÏÎ³Î¿Ï‚ Î Î±Î³ÏÎ½Î·Ï‚ + Claude Code (Anthropic AI) |
| **Parent** | [ADR-ACC-000](./ADR-ACC-000-founding-decision.md) |
| **Module** | M-003: Invoicing |

---

## 1. Context

ÎŸ Î±ÏÏ‡Î¹Ï„Î­ÎºÏ„Î¿Î½Î±Ï‚-Î¼Î·Ï‡Î±Î½Î¹ÎºÏŒÏ‚ ÎµÎºÎ´Î¯Î´ÎµÎ¹ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î± Î³Î¹Î±:
- **Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚** (ÎšÎ‘Î” 71112000): Î¼ÎµÎ»Î­Ï„ÎµÏ‚, Î Î•Î‘, Î¬Î´ÎµÎ¹ÎµÏ‚, ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î±Ï…Î¸Î±Î¹ÏÎ­Ï„Ï‰Î½, Î·Î»ÎµÎºÏ„ÏÎ¿Î½Î¹ÎºÎ­Ï‚ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÏ„Î¹ÏÎ¯Ï‰Î½
- **ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÏ„Î¹ÎºÎ¬ Î­ÏÎ³Î±** (ÎšÎ‘Î” 41202003 / 41201001): ÎµÏÎ³Î¿Î»Î±Î²Î¯ÎµÏ‚ ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î®Ï‚

ÎšÎ¬Î¸Îµ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ¬ Î½Î± Î´Î¹Î±Î²Î¹Î²Î±ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿ **myDATA/Î‘Î‘Î”Î•** (ADR-ACC-003).

### Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚
- ÎˆÎºÎ´Î¿ÏƒÎ· ÎŸÎ›Î© Ï„ÏÏ€Ï‰Î½ Ï€Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½
- Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¦Î Î‘ 24%
- Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Ï€Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· Ï†ÏŒÏÎ¿Ï… (20% Î® 3% Î±Î½Î¬Î»Î¿Î³Î± ÎšÎ‘Î”)
- Î£ÏÎ½Î´ÎµÏƒÎ· Ï€ÎµÎ»Î¬Ï„Î· Î¼Îµ CRM contacts
- myDATA Î´Î¹Î±Î²Î¯Î²Î±ÏƒÎ· (MARK Î±ÏÎ¹Î¸Î¼ÏŒÏ‚)
- Î£ÎµÎ¹ÏÎ­Ï‚ Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·Ï‚ (modular)
- AI-assisted invoice drafting
- PDF generation & ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ·

---

## 2. Document Types (Î¤ÏÏ€Î¿Î¹ Î Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÏÎ½)

### 2.1 Î•ÎºÎ´Î¹Î´ÏŒÎ¼ÎµÎ½Î± Î Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÎ¬

| myDATA Î¤ÏÏ€Î¿Ï‚ | ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ | Î•Î»Î»Î·Î½Î¹ÎºÎ¬ | Î§ÏÎ®ÏƒÎ· | Phase |
|-------------|---------|----------|-------|-------|
| 2.1 | `service_invoice` | Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ Î Î±ÏÎ¿Ï‡Î®Ï‚ Î¥Ï€Î·ÏÎµÏƒÎ¹ÏÎ½ (Î¤Î Î¥) | ÎœÎµÎ»Î­Ï„ÎµÏ‚, Î Î•Î‘, Î¬Î´ÎµÎ¹ÎµÏ‚ â†’ Î½Î¿Î¼Î¹ÎºÎ¬ Ï€ÏÏŒÏƒÏ‰Ï€Î± Î® Î”Î¦ Î¼Îµ Î‘Î¦Îœ | 1 |
| 1.1 | `sales_invoice` | Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ Î ÏÎ»Î·ÏƒÎ·Ï‚ | ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÏ„Î¹ÎºÎ¬ Î­ÏÎ³Î± (Ï…Î»Î¹ÎºÎ¬ + ÎµÏÎ³Î±ÏƒÎ¯Î±) | 1 |
| 11.1 | `retail_receipt` | Î‘Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î›Î¹Î±Î½Î¹ÎºÎ®Ï‚ Î ÏÎ»Î·ÏƒÎ·Ï‚ | Î ÏÎ»Î·ÏƒÎ· ÏƒÎµ Î¹Î´Î¹ÏÏ„Î· (Ï‡Ï‰ÏÎ¯Ï‚ Î‘Î¦Îœ) | 1 |
| 11.2 | `service_receipt` | Î‘Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î Î±ÏÎ¿Ï‡Î®Ï‚ Î¥Ï€Î·ÏÎµÏƒÎ¹ÏÎ½ (Î‘Î Î¥) | Î¥Ï€Î·ÏÎµÏƒÎ¯Î± ÏƒÎµ Î¹Î´Î¹ÏÏ„Î· (Î Î•Î‘ ÏƒÎµ Î¹Î´Î¹ÏÏ„Î·) | 1 |
| 5.1 | `credit_invoice` | Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÏŒ Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ | Î‘ÎºÏÏÏ‰ÏƒÎ·/Î¼ÎµÏÎ¹ÎºÎ® ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î® | 1 |
| 2.2 | `service_invoice_eu` | Î¤Î Î¥ Î•Î½Î´Î¿ÎºÎ¿Î¹Î½Î¿Ï„Î¹ÎºÏŒ | Î¥Ï€Î·ÏÎµÏƒÎ¯Î± ÏƒÎµ EU (Î¼Î· ÎµÎ½ÎµÏÎ³ÏŒ â€” ÎŸÎ§Î™ ÎµÎ½Î´Î¿ÎºÎ¿Î¹Î½Î¿Ï„Î¹ÎºÎ­Ï‚) | 2+ |
| 2.3 | `service_invoice_3rd` | Î¤Î Î¥ Î¤ÏÎ¯Ï„ÎµÏ‚ Î§ÏÏÎµÏ‚ | Î¥Ï€Î·ÏÎµÏƒÎ¯Î± ÎµÎºÏ„ÏŒÏ‚ EU | 2+ |

### 2.2 Î£Ï…Î½Î·Î¸Î­ÏƒÏ„ÎµÏÎ± Î£ÎµÎ½Î¬ÏÎ¹Î± Î“Î¹ÏÏÎ³Î¿Ï…

| Î£ÎµÎ½Î¬ÏÎ¹Î¿ | Î¤ÏÏ€Î¿Ï‚ | ÎšÎ‘Î” | Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· |
|---------|-------|-----|-------------|
| Î Î•Î‘ ÏƒÎµ ÎµÏ„Î±Î¹ÏÎµÎ¯Î± | Î¤Î Î¥ (2.1) | 71112000 | 20% (Î±Î½ >300â‚¬) |
| Î Î•Î‘ ÏƒÎµ Î¹Î´Î¹ÏÏ„Î· | Î‘Î Î¥ (11.2) | 71112000 | 0% |
| Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® Î¼ÎµÎ»Î­Ï„Î· ÏƒÎµ ÎµÏ„Î±Î¹ÏÎµÎ¯Î± | Î¤Î Î¥ (2.1) | 71112000 | 20% (Î±Î½ >300â‚¬) |
| Î†Î´ÎµÎ¹Î± (Î¼Î­ÏƒÏ‰ Î¤Î•Î•) | Î¤Î Î¥ (2.1) | 71112000 | 20% (Î±Î½ >300â‚¬) |
| ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÏ„Î¹ÎºÏŒ Î­ÏÎ³Î¿ | Î¤Î  (1.1) | 41202003/41201001 | 3% (Î±Î½ >300â‚¬) |
| Î‘ÎºÏÏÏ‰ÏƒÎ· Ï„Î¹Î¼Î¿Î»Î¿Î³Î¯Î¿Ï… | Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÏŒ (5.1) | â€” | Î‘Î½Ï„Î¹Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ |

---

## 3. Invoice Data Schema

### 3.1 Invoice (Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿)

```typescript
interface Invoice {
  // â”€â”€ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± â”€â”€
  invoiceId: string;                    // Auto-generated UUID
  series: string;                       // Î£ÎµÎ¹ÏÎ¬ (Ï€.Ï‡. "Î‘")
  number: number;                       // Î‘ÏÎ¾Ï‰Î½ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ (Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï‚)
  displayNumber: string;                // "Î‘-42" (computed)
  type: InvoiceType;                    // Enum: service_invoice, sales_invoice, ÎºÎ»Ï€.
  mydataType: string;                   // myDATA ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ (2.1, 1.1, ÎºÎ»Ï€.)

  // â”€â”€ Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚ â”€â”€
  issueDate: string;                    // Î—Î¼/Î½Î¯Î± Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ (ISO)
  serviceDate: string | null;           // Î—Î¼/Î½Î¯Î± Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ (Î±Î½ â‰  issue)
  dueDate: string | null;               // Î—Î¼/Î½Î¯Î± Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ (Î±Î½ Ï€Î¯ÏƒÏ„Ï‰ÏƒÎ·)

  // â”€â”€ Î•ÎºÎ´ÏŒÏ„Î·Ï‚ (ÎµÎ¼ÎµÎ¯Ï‚) â”€â”€
  issuer: {
    companyId: string;                  // â†’ accounting settings
    // Snapshot (Î´ÎµÎ½ Î±Î»Î»Î¬Î¶ÎµÎ¹ Î±Î½ Î±Î»Î»Î¬Î¾Î¿Ï…Î½ Ï„Î± settings)
    name: string;
    vatNumber: string;                  // Î‘Î¦Îœ
    taxOffice: string;                  // Î”ÎŸÎ¥
    address: string;
    profession: string;                 // "Î‘ÏÏ‡Î¹Ï„Î­ÎºÏ„Î¿Î½Î±Ï‚ ÎœÎ·Ï‡Î±Î½Î¹ÎºÏŒÏ‚"
    kadCode: string;                    // ÎšÎ‘Î” Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±Ï‚
  };

  // â”€â”€ Î ÎµÎ»Î¬Ï„Î·Ï‚ â”€â”€
  customer: {
    contactId: string;                  // â†’ CRM contacts (Firestore)
    // Snapshot
    name: string;
    vatNumber: string;                  // Î‘Î¦Îœ Ï€ÎµÎ»Î¬Ï„Î· (ÎºÎµÎ½ÏŒ Î±Î½ Î¹Î´Î¹ÏÏ„Î·Ï‚ Ï‡Ï‰ÏÎ¯Ï‚)
    taxOffice: string;                  // Î”ÎŸÎ¥ Ï€ÎµÎ»Î¬Ï„Î·
    address: string;
    customerType: 'company' | 'individual' | 'public_sector';
  };

  // â”€â”€ Î“ÏÎ±Î¼Î¼Î­Ï‚ â”€â”€
  lineItems: InvoiceLineItem[];

  // â”€â”€ Î£ÏÎ½Î¿Î»Î± â”€â”€
  subtotalNet: number;                  // ÎšÎ±Î¸Î±ÏÏŒ Ï€Î¿ÏƒÏŒ (Ï€ÏÎ¿ Î¦Î Î‘)
  vatAmount: number;                    // Î¦Î Î‘
  totalGross: number;                   // Î£ÏÎ½Î¿Î»Î¿ (Î¼ÎµÏ„Î¬ Î¦Î Î‘)
  withholdingTaxAmount: number;         // Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· Ï†ÏŒÏÎ¿Ï… (20% Î® 3%)
  withholdingTaxRate: number;           // 0.20 | 0.03 | 0
  totalPayable: number;                 // Î Î»Î·ÏÏ‰Ï„Î­Î¿ (gross - withholding)

  // â”€â”€ Î¦Î Î‘ â”€â”€
  vatRate: number;                      // 0.24 (24%)
  vatExemptionReason: string | null;    // Î‘Î½ Î¦Î Î‘ 0%

  // â”€â”€ Î Î»Î·ÏÏ‰Î¼Î® â”€â”€
  paymentMethod: PaymentMethod;
  paymentStatus: 'pending' | 'partial' | 'paid';
  payments: InvoicePayment[];           // Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Ï€Î»Î·ÏÏ‰Î¼ÏÎ½

  // â”€â”€ myDATA â”€â”€
  mydataStatus: 'draft' | 'pending' | 'submitted' | 'accepted' | 'rejected';
  mydataMark: string | null;            // ÎœÎ‘Î¡Îš Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ (Î¼ÎµÏ„Î¬ Î±Ï€Î¿Î´Î¿Ï‡Î®)
  mydataUid: string | null;             // ÎœÎ¿Î½Î±Î´Î¹ÎºÏŒ ID Î‘Î‘Î”Î•
  mydataSubmittedAt: string | null;
  mydataErrors: string[];               // Î¤Ï…Ï‡ÏŒÎ½ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± Î‘Î‘Î”Î•

  // â”€â”€ Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÏŒ (Î±Î½ type = credit_invoice) â”€â”€
  relatedInvoiceId: string | null;      // Î‘Î½Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿
  creditReason: string | null;

  // â”€â”€ Î¦Î¿ÏÎ¿Î»Î¿Î³Î¹ÎºÎ¬ â”€â”€
  fiscalYear: number;
  quarter: 1 | 2 | 3 | 4;
  kadCode: string;                      // ÎšÎ‘Î” (71112000 Î® 412xxxxx)

  // â”€â”€ myDATA Classification â”€â”€
  incomeClassification: {
    category: string;                   // "1.3" (ÎˆÏƒÎ¿Î´Î± Î Î±ÏÎ¿Ï‡Î®Ï‚ Î¥Ï€Î·ÏÎµÏƒÎ¹ÏÎ½)
    e3Code: string;                     // ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î•3
  };

  // â”€â”€ Meta â”€â”€
  notes: string;                        // Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚/Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚
  internalNotes: string;                // Î•ÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ (Î´ÎµÎ½ ÎµÎºÏ„Ï…Ï€ÏÎ½Î¿Î½Ï„Î±Î¹)
  createdAt: string;
  updatedAt: string;
  createdBy: string;                    // userId
}
```

### 3.2 Invoice Line Item (Î“ÏÎ±Î¼Î¼Î® Î¤Î¹Î¼Î¿Î»Î¿Î³Î¯Î¿Ï…)

```typescript
interface InvoiceLineItem {
  lineNumber: number;                   // 1, 2, 3...
  description: string;                  // "Î•Î½ÎµÏÎ³ÎµÎ¹Î±ÎºÏŒ Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ (Î Î•Î‘)"
  quantity: number;                     // 1
  unit: string;                         // "Ï„ÎµÎ¼.", "ÏÏÎµÏ‚", "Ï„.Î¼."
  unitPrice: number;                    // Î¤Î¹Î¼Î® Î¼Î¿Î½Î¬Î´Î±Ï‚ (ÎºÎ±Î¸Î±ÏÎ®)
  discount: number;                     // ÎˆÎºÏ€Ï„Ï‰ÏƒÎ· (0-100%)
  netAmount: number;                    // quantity Ã— unitPrice Ã— (1 - discount)
  vatRate: number;                      // 0.24
  vatAmount: number;                    // netAmount Ã— vatRate
  totalAmount: number;                  // netAmount + vatAmount
}
```

### 3.3 Payment Method

```typescript
type PaymentMethod =
  | 'cash'                              // ÎœÎµÏ„ÏÎ·Ï„Î¬
  | 'bank_transfer'                     // Î¤ÏÎ±Ï€ÎµÎ¶Î¹ÎºÎ® ÎºÎ±Ï„Î¬Î¸ÎµÏƒÎ·
  | 'card'                              // ÎšÎ¬ÏÏ„Î± (Ï‡ÏÎµÏ‰ÏƒÏ„Î¹ÎºÎ®/Ï€Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÎ®)
  | 'check'                             // Î•Ï€Î¹Ï„Î±Î³Î®
  | 'credit'                            // Î Î¯ÏƒÏ„Ï‰ÏƒÎ· (Ï€Î»Î·ÏÏ‰Î¼Î® Î±ÏÎ³ÏŒÏ„ÎµÏÎ±)
  | 'mixed';                            // ÎœÎ¹ÎºÏ„ÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚

interface InvoicePayment {
  paymentId: string;
  date: string;
  amount: number;
  method: PaymentMethod;
  bankTransactionId: string | null;     // â†’ bank reconciliation
  notes: string;
}
```

---

## 4. Invoice Series (Î£ÎµÎ¹ÏÎ­Ï‚ Î‘ÏÎ¯Î¸Î¼Î·ÏƒÎ·Ï‚)

### 4.1 Schema

```typescript
interface InvoiceSeries {
  seriesId: string;
  prefix: string;                       // "Î‘", "Î’", "Î Î™Î£"
  description: string;                  // "ÎšÏÏÎ¹Î± ÏƒÎµÎ¹ÏÎ¬ Ï„Î¹Î¼Î¿Î»Î¿Î³Î¯Ï‰Î½"
  documentTypes: InvoiceType[];         // Î Î¿Î¹Î± Ï€Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯
  currentNumber: number;                // Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿Ï‚ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚
  startNumber: number;                  // Î‘ÏÏ‡Î¹ÎºÏŒÏ‚ (ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ 1)
  fiscalYear: number;                   // Î£Îµ Ï€Î¿Î¹Î¿ Î­Ï„Î¿Ï‚ Î±Î½Î®ÎºÎµÎ¹
  resetOnNewYear: boolean;              // ÎœÎ·Î´ÎµÎ½Î¯Î¶ÎµÎ¹ ÎºÎ¬Î¸Îµ Ï‡ÏÏŒÎ½Î¿;
  isActive: boolean;
  createdAt: string;
}
```

### 4.2 Phase 1 Configuration

| Î£ÎµÎ¹ÏÎ¬ | Prefix | Document Types | Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· |
|-------|--------|----------------|----------|
| ÎšÏÏÎ¹Î± | Î‘ | Î¤Î Î¥, Î¤Î , Î‘Î Î¥, Î‘Î›Î  | ÎœÎ¯Î± ÏƒÎµÎ¹ÏÎ¬ Î³Î¹Î± ÏŒÎ»Î± (Phase 1) |
| Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÎ¬ | Î Î™Î£ | Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÏŒ | ÎÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î® ÏƒÎµÎ¹ÏÎ¬ |

### 4.3 ÎœÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ¬ (Phase 2+)

- Î Î¿Î»Î»Î±Ï€Î»Î­Ï‚ ÏƒÎµÎ¹ÏÎ­Ï‚ Î±Î½Î¬ Ï„ÏÏ€Î¿ (Î‘: Î¤Î Î¥, Î’: Î‘Î Î¥)
- Î£ÎµÎ¹ÏÎ¬ Î±Î½Î¬ Ï…Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±
- Î£ÎµÎ¹ÏÎ¬ Î±Î½Î¬ ÎšÎ‘Î” (Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ¬ vs ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÏ„Î¹ÎºÎ¬)

---

## 5. Withholding Tax Logic (Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· Î¦ÏŒÏÎ¿Ï…)

### 5.1 Decision Tree

```
Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ ÎµÎºÎ´Î¯Î´ÎµÏ„Î±Î¹
  â†“
Î ÎµÎ»Î¬Ï„Î·Ï‚ = Î¹Î´Î¹ÏÏ„Î·Ï‚;
  ÎÎ‘Î™ â†’ Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· = 0%
  ÎŸÎ§Î™ â†“
Î Î¿ÏƒÏŒ â‰¤ 300â‚¬;
  ÎÎ‘Î™ â†’ Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· = 0% (Î±Î»Î»Î¬ Î´Î·Î»ÏÎ½ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î‘Î Î¥ Î¼Îµ ÎºÏ‰Î´. 10)
  ÎŸÎ§Î™ â†“
ÎšÎ‘Î” = 71112000 (Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚);
  ÎÎ‘Î™ â†’ Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· = 20%
  ÎŸÎ§Î™ â†“
ÎšÎ‘Î” = 412xxxxx (ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î­Ï‚);
  ÎÎ‘Î™ â†’ Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· = 3%
  ÎŸÎ§Î™ â†’ Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· = 0% (fallback)
```

### 5.2 Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚

```
ÎšÎ±Î¸Î±ÏÏŒ Ï€Î¿ÏƒÏŒ:       1.000,00â‚¬
Î¦Î Î‘ 24%:            +240,00â‚¬
ÎœÎ¹ÎºÏ„ÏŒ ÏƒÏÎ½Î¿Î»Î¿:      1.240,00â‚¬
Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· 20%:    -200,00â‚¬  (ÎµÏ€Î¯ Ï„Î¿Ï… ÎºÎ±Î¸Î±ÏÎ¿Ï)
Î Î»Î·ÏÏ‰Ï„Î­Î¿:          1.040,00â‚¬
```

**Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒ**: Î— Ï€Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÏ„Î±Î¹ ÎµÏ€Î¯ Ï„Î¿Ï… **ÎºÎ±Î¸Î±ÏÎ¿Ï** Ï€Î¿ÏƒÎ¿Ï (Ï€ÏÎ¿ Î¦Î Î‘).

### 5.3 Implementation

```typescript
function calculateWithholding(invoice: {
  netAmount: number;
  kadCode: string;
  customerType: 'company' | 'individual' | 'public_sector';
}): { rate: number; amount: number } {
  // Î™Î´Î¹ÏÏ„ÎµÏ‚ â†’ 0%
  if (invoice.customerType === 'individual') {
    return { rate: 0, amount: 0 };
  }

  // Î Î¿ÏƒÏŒ â‰¤ 300â‚¬ â†’ 0%
  if (invoice.netAmount <= 300) {
    return { rate: 0, amount: 0 };
  }

  // Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ (71xxxxxx) â†’ 20%
  if (invoice.kadCode.startsWith('71')) {
    return { rate: 0.20, amount: invoice.netAmount * 0.20 };
  }

  // ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î­Ï‚ (41xxxxxx) â†’ 3%
  if (invoice.kadCode.startsWith('41')) {
    return { rate: 0.03, amount: invoice.netAmount * 0.03 };
  }

  return { rate: 0, amount: 0 };
}
```

---

## 6. CRM Integration (Î ÎµÎ»Î¬Ï„ÎµÏ‚)

### 6.1 Contact â†’ Customer Mapping

Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¹Ï‚ **Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎµÏ‚ CRM contacts** (Firestore) Ï‰Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚.

```
CRM Contact                      Invoice Customer
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
contactId              â†’         customer.contactId
displayName            â†’         customer.name
vatNumber (Î‘Î¦Îœ)        â†’         customer.vatNumber
taxOffice (Î”ÎŸÎ¥)        â†’         customer.taxOffice
address                â†’         customer.address
type (individual/co.)  â†’         customer.customerType
```

### 6.2 Snapshot Pattern

ÎšÎ±Ï„Î¬ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¹Î¼Î¿Î»Î¿Î³Î¯Î¿Ï…, Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï€ÎµÎ»Î¬Ï„Î· Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï‰Ï‚ **snapshot** ÏƒÏ„Î¿ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿. Î‘Î½ Î±ÏÎ³ÏŒÏ„ÎµÏÎ± Î±Î»Î»Î¬Î¾Î¿Ï…Î½ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏ„Î¿ CRM, Ï„Î± Ï€Î±Î»Î¹Î¬ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î± **Î´ÎµÎ½ ÎµÏ€Î·ÏÎµÎ¬Î¶Î¿Î½Ï„Î±Î¹** (Ï†Î¿ÏÎ¿Î»Î¿Î³Î¹ÎºÎ® Î±Ï€Î±Î¯Ï„Î·ÏƒÎ· â€” Ï„Î¿ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ Î±Î½Ï„Î¹ÎºÎ±Ï„Î¿Ï€Ï„ÏÎ¯Î¶ÎµÎ¹ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î·Î¼/Î½Î¯Î± Î­ÎºÎ´Î¿ÏƒÎ·Ï‚).

### 6.3 Î‘Î¦Îœ Validation

- **Î•Î»Î»Î·Î½Î¹ÎºÏŒ Î‘Î¦Îœ**: 9 ÏˆÎ·Ï†Î¯Î±, Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿Ï‚ modulo
- **Î‘Î‘Î”Î• lookup**: Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Î¼Î­ÏƒÏ‰ Î“Î“Î Î£ API (Î¼ÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÏŒ)
- **EU VAT**: VIES validation (Î±Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÎµÎ½Î´Î¿ÎºÎ¿Î¹Î½Î¿Ï„Î¹ÎºÎ­Ï‚)

```typescript
function validateGreekVAT(afm: string): boolean {
  if (afm.length !== 9 || !/^\d{9}$/.test(afm)) return false;
  let sum = 0;
  for (let i = 0; i < 8; i++) {
    sum += parseInt(afm[i]) * Math.pow(2, 8 - i);
  }
  const check = (sum % 11) % 10;
  return check === parseInt(afm[8]);
}
```

---

## 7. Invoice Workflow (Î¡Î¿Î® ÎˆÎºÎ´Î¿ÏƒÎ·Ï‚)

### 7.1 Manual Flow

```
[1] Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘
    Î§ÏÎ®ÏƒÏ„Î·Ï‚ â†’ "ÎÎ­Î¿ Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿"
    Î•Ï€Î¹Î»Î¿Î³Î®: Ï„ÏÏ€Î¿Ï‚, Ï€ÎµÎ»Î¬Ï„Î·Ï‚ (CRM), Î³ÏÎ±Î¼Î¼Î­Ï‚, ÎšÎ‘Î”
    Auto-fill: Î¦Î Î‘, Ï€Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ·, ÏƒÏÎ½Î¿Î»Î±
    â†“
[2] PREVIEW
    Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Ï„Î¹Î¼Î¿Î»Î¿Î³Î¯Î¿Ï… (PDF-like)
    ÎŸ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î± Ï€Î¿ÏƒÎ¬
    â†“
[3] Î•ÎšÎ”ÎŸÎ£Î—
    Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· (ÏƒÎµÎ¹ÏÎ¬ + Î±ÏÎ¾Ï‰Î½)
    Status â†’ 'draft' â†’ 'pending' (myDATA)
    â†“
[4] myDATA Î”Î™Î‘Î’Î™Î’Î‘Î£Î—
    Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿ Î‘Î‘Î”Î• (ADR-ACC-003)
    ÎœÎ‘Î¡Îš Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ â†’ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹
    Status â†’ 'accepted' Î® 'rejected'
    â†“
[5] PDF & Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î— (Î¥Î²ÏÎ¹Î´Î¹ÎºÏŒ)
    Generate PDF Î¼Îµ ÎœÎ‘Î¡Îš
    ÎšÎ¿Ï…Î¼Ï€Î¯ "ğŸ“§ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® email" â†’ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÏ€Î¹Î»Î­Î³ÎµÎ¹
    (ÎŸÎ§Î™ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ â€” manual trigger)
    â†“
[6] Î Î›Î—Î¡Î©ÎœÎ—
    ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ (Î¼ÎµÏ„ÏÎ·Ï„Î¬/Ï„ÏÎ¬Ï€ÎµÎ¶Î±/ÎºÎ¬ÏÏ„Î±)
    â†’ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎ³Î³ÏÎ±Ï†Î® ÏƒÏ„Î¿ Î’Î¹Î²Î»Î¯Î¿ Î•-Î• (M-002)
    â†’ Bank reconciliation matching (M-009)
```

### 7.2 AI-Assisted Flow (Î¼Î­ÏƒÏ‰ Telegram/Voice)

```
Admin: "Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î¿Î½ Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿ 500â‚¬ Î³Î¹Î± Î Î•Î‘"
  â†“
[1] AI Intent â†’ admin_create_invoice (Î½Î­Î¿ UC module)
[2] AI Entities â†’ recipient: "Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚", amount: 500, service: "Î Î•Î‘"
[3] CRM Lookup â†’ findContactByName("Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚")
[4] Auto-determine:
    - Î¤ÏÏ€Î¿Ï‚: Î¤Î Î¥ (Ï€ÎµÎ»Î¬Ï„Î·Ï‚ = ÎµÏ„Î±Î¹ÏÎµÎ¯Î±) Î® Î‘Î Î¥ (Ï€ÎµÎ»Î¬Ï„Î·Ï‚ = Î¹Î´Î¹ÏÏ„Î·Ï‚)
    - ÎšÎ‘Î”: 71112000 (Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚)
    - Î¦Î Î‘: 500 Ã— 24% = 120â‚¬
    - Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ·: 500 Ã— 20% = 100â‚¬ (Î±Î½ ÎµÏ„Î±Î¹ÏÎµÎ¯Î± + >300â‚¬)
    - Î Î»Î·ÏÏ‰Ï„Î­Î¿: 500 + 120 - 100 = 520â‚¬
[5] Admin confirms via Telegram
[6] Invoice created â†’ myDATA â†’ PDF
```

---

## 8. Invoice PDF Template

### 8.1 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Î•ÎšÎ”ÎŸÎ¤Î—Î£                              Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ     â”‚
â”‚  Î Î±Î³ÏÎ½Î·Ï‚ ÎÎ­ÏƒÏ„. Î“ÎµÏÏÎ³Î¹Î¿Ï‚               Î Î±ÏÎ¿Ï‡Î®Ï‚       â”‚
â”‚  Î‘ÏÏ‡Î¹Ï„Î­ÎºÏ„Ï‰Î½ ÎœÎ·Ï‡Î±Î½Î¹ÎºÏŒÏ‚                 Î¥Ï€Î·ÏÎµÏƒÎ¹ÏÎ½     â”‚
â”‚  Î‘Î¦Îœ: xxxxxxxxx                                     â”‚
â”‚  Î”ÎŸÎ¥: xxxxxxxx                        Î£ÎµÎ¹ÏÎ¬: Î‘      â”‚
â”‚  Î£Î±Î¼Î¿Î¸ÏÎ¬ÎºÎ·Ï‚ 16, 563 34                Î‘Ï.: 42       â”‚
â”‚  Î•Î»ÎµÏ…Î¸Î­ÏÎ¹Î¿ ÎšÎ¿ÏÎ´ÎµÎ»Î¹ÏŒ, Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·     Î—Î¼/Î½Î¯Î±: ...   â”‚
â”‚  Î¤: 2310 55 95 95 | Îœ: 6974 050 023                 â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Î Î•Î›Î‘Î¤Î—Î£                                             â”‚
â”‚  Î•Ï€Ï‰Î½Ï…Î¼Î¯Î±: ...                                       â”‚
â”‚  Î‘Î¦Îœ: ...                Î”ÎŸÎ¥: ...                   â”‚
â”‚  Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ...                                      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  # â”‚ Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®          â”‚ Î Î¿Ïƒ. â”‚ Î¤Î¹Î¼Î®  â”‚ Î£ÏÎ½Î¿Î»Î¿    â”‚
â”‚  1 â”‚ Î•Î½ÎµÏÎ³ÎµÎ¹Î±ÎºÏŒ Î Î¹ÏƒÏ„.   â”‚  1   â”‚500,00 â”‚ 500,00    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                            ÎšÎ±Î¸Î±ÏÏŒ:      500,00â‚¬      â”‚
â”‚                            Î¦Î Î‘ 24%:     120,00â‚¬      â”‚
â”‚                            ÎœÎ¹ÎºÏ„ÏŒ:       620,00â‚¬      â”‚
â”‚                            Î Î±ÏÎ±ÎºÏ. 20%: -100,00â‚¬     â”‚
â”‚                            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚                            Î Î›Î—Î¡Î©Î¤Î•ÎŸ:    520,00â‚¬      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Î¤ÏÏŒÏ€Î¿Ï‚ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚: Î¤ÏÎ±Ï€ÎµÎ¶Î¹ÎºÎ® ÎºÎ±Ï„Î¬Î¸ÎµÏƒÎ·                â”‚
â”‚  Î•Î˜ÎÎ™ÎšÎ— Î¤Î¡Î‘Î Î•Î–Î‘                                      â”‚
â”‚  IBAN: GR68 0110 2230 0000 2234 0068 448             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  myDATA MARK: XXXXXXXXXXXXXXXX                       â”‚
â”‚  ÎšÎ‘Î”: 71112000                                       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚: ...                                     â”‚
â”‚  Î“Î»ÏÏƒÏƒÎ±: Î•Î»Î»Î·Î½Î¹ÎºÎ¬                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 PDF Generation

- **Server-side**: React PDF (`@react-pdf/renderer`) Î® `puppeteer`
- **License**: MIT (ÎµÏ€Î¹Ï„ÏÎµÏ€Ï„Î®)
- **Template**: Config-driven (logo, IBAN, ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚)
- **MARK**: Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Î¼ÏŒÎ½Î¿ Î±Î½ myDATA accepted

---

## 9. Service Types (Î¤Ï…Ï€Î¿Î»ÏŒÎ³Î¹Î¿ Î¥Ï€Î·ÏÎµÏƒÎ¹ÏÎ½)

Î ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î³Î¹Î± Î³ÏÎ®Î³Î¿ÏÎ· Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·:

| ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ | Î¥Ï€Î·ÏÎµÏƒÎ¯Î± | ÎšÎ‘Î” | ÎœÎ¿Î½Î¬Î´Î± | Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· |
|---------|----------|-----|--------|----------|
| `pea` | Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ Î•Î½ÎµÏÎ³ÎµÎ¹Î±ÎºÎ®Ï‚ Î‘Ï€ÏŒÎ´Î¿ÏƒÎ·Ï‚ (Î Î•Î‘) | 71112000 | Ï„ÎµÎ¼. | |
| `arch_study` | Î‘ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® ÎœÎµÎ»Î­Ï„Î· | 71112000 | Ï„ÎµÎ¼. | |
| `building_permit` | ÎŸÎ¹ÎºÎ¿Î´Î¿Î¼Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± | 71112000 | Ï„ÎµÎ¼. | ÎœÎ­ÏƒÏ‰ e-Î†Î´ÎµÎ¹ÎµÏ‚ |
| `legalization` | Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Î‘Ï…Î¸Î±Î¹ÏÎ­Ï„Î¿Ï… | 71112000 | Ï„ÎµÎ¼. | N.4495/2017 |
| `building_id` | Î—Î»ÎµÎºÏ„ÏÎ¿Î½Î¹ÎºÎ® Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± ÎšÏ„Î¹ÏÎ¯Î¿Ï… | 71112000 | Ï„ÎµÎ¼. | |
| `inspection` | Î‘Ï…Ï„Î¿ÏˆÎ¯Î± / Î¤ÎµÏ‡Î½Î¹ÎºÎ® ÎˆÎºÎ¸ÎµÏƒÎ· | 71112000 | ÏÏÎµÏ‚ | |
| `supervision` | Î•Ï€Î¯Î²Î»ÎµÏˆÎ· ÎˆÏÎ³Î¿Ï… | 71112000 | Î¼Î®Î½Î± | |
| `consulting` | Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î£Ï…Î¼Î²Î¿Ï…Î»ÎµÏ…Ï„Î¹ÎºÎ® | 71112000 | ÏÏÎµÏ‚ | |
| `construction` | ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÏ„Î¹ÎºÎ­Ï‚ Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚ | 41202003 | Îº.Î±. | Î•ÏÎ³Î¿Î»Î±Î²Î¯Î± |
| `construction_res` | ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÏ„Î¹ÎºÎ­Ï‚ Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚ (ÎŸÎ¹ÎºÎ¹ÏƒÏ„Î¹ÎºÎ¬) | 41201001 | Îº.Î±. | Î•ÏÎ³Î¿Î»Î±Î²Î¯Î± |
| `custom` | Î†Î»Î»Î· Î¥Ï€Î·ÏÎµÏƒÎ¯Î± | config | â€” | Î•Î»ÎµÏÎ¸ÎµÏÎ· Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® |

**Config-driven**: ÎŸ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î´Î¹ÎºÎ­Ï‚ Ï„Î¿Ï… Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚.

---

## 10. Issuer Defaults (Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î•ÎºÎ´ÏŒÏ„Î·)

Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ `accounting/{companyId}/settings/invoicing`:

```typescript
interface InvoicingSettings {
  issuer: {
    displayName: string;     // "Î Î±Î³ÏÎ½Î·Ï‚ ÎÎ­ÏƒÏ„. Î“ÎµÏÏÎ³Î¹Î¿Ï‚"
    profession: string;      // "Î‘ÏÏ‡Î¹Ï„Î­ÎºÏ„Ï‰Î½ ÎœÎ·Ï‡Î±Î½Î¹ÎºÏŒÏ‚"
    address: {
      street: string;        // "Î£Î±Î¼Î¿Î¸ÏÎ¬ÎºÎ·Ï‚ 16"
      postalCode: string;    // "563 34"
      city: string;          // "Î•Î»ÎµÏ…Î¸Î­ÏÎ¹Î¿ ÎšÎ¿ÏÎ´ÎµÎ»Î¹ÏŒ"
      region: string;        // "Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·"
    };
    phone: string;           // "2310 55 95 95"
    mobile: string;          // "6974 050 023"
  };
  bankAccounts: Array<{
    bankName: string;        // "Î•Î˜ÎÎ™ÎšÎ— Î¤Î¡Î‘Î Î•Î–Î‘"
    iban: string;            // "GR68 0110 2230 0000 2234 0068 448"
    isDefault: boolean;      // true
  }>;
  language: 'el';            // ÎœÏŒÎ½Î¿ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬
  cashLimit: 500;            // Hard block >500â‚¬
  emailDelivery: 'hybrid';   // 'auto' | 'hybrid' | 'manual'
}
```

> **Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·**: Î¤Î± ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± (Î‘Î¦Îœ, Î”ÎŸÎ¥) Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ company settings (ADR-ACC-000), ÎŸÎ§Î™ hardcoded.

---

## 11. Firestore Structure

```
accounting/{companyId}/
  â”œâ”€â”€ settings/
  â”‚   â””â”€â”€ invoicing                     â† Series config, defaults, IBAN, issuer
  â”‚
  â”œâ”€â”€ invoice_series/{seriesId}         â† Î£ÎµÎ¹ÏÎ­Ï‚ Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·Ï‚
  â”‚
  â”œâ”€â”€ invoices/{invoiceId}              â† Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î±
  â”‚   â””â”€â”€ payments/{paymentId}          â† Î Î»Î·ÏÏ‰Î¼Î­Ï‚ (subcollection)
  â”‚
  â””â”€â”€ service_catalog/{serviceId}       â† ÎšÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½
```

---

## 12. UI Pages

| Route | Î£ÎµÎ»Î¯Î´Î± | Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± |
|-------|--------|------------|
| `/accounting/invoices` | Î›Î¯ÏƒÏ„Î± Î¤Î¹Î¼Î¿Î»Î¿Î³Î¯Ï‰Î½ | Î¦Î¯Î»Ï„ÏÎ±: Î·Î¼/Î½Î¯Î±, Ï€ÎµÎ»Î¬Ï„Î·Ï‚, status, myDATA |
| `/accounting/invoices/new` | ÎÎ­Î¿ Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ | Î¦ÏŒÏÎ¼Î± Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ |
| `/accounting/invoices/[id]` | Î ÏÎ¿Î²Î¿Î»Î® | Details + PDF preview + payment history |
| `/accounting/invoices/[id]/edit` | Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± | ÎœÏŒÎ½Î¿ Î±Î½ draft (Ï€ÏÎ¹Î½ myDATA) |
| `/accounting/invoices/[id]/pdf` | PDF | Generate & download |
| `/accounting/invoices/[id]/credit` | Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÏŒ | Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï€Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÎ¿Ï Î³Î¹Î± Î±Ï…Ï„ÏŒ |

---

## 13. Validation Rules

| ÎšÎ±Î½ÏŒÎ½Î±Ï‚ | Î¤ÏÏ€Î¿Ï‚ | ÎœÎ®Î½Ï…Î¼Î± |
|---------|-------|--------|
| Î ÎµÎ»Î¬Ï„Î·Ï‚ required | error | "Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÎµÎ»Î¬Ï„Î·" |
| â‰¥1 Î³ÏÎ±Î¼Î¼Î® | error | "Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î¼Î¯Î± Î³ÏÎ±Î¼Î¼Î®" |
| Î Î¿ÏƒÏŒ > 0 | error | "Î¤Î¿ Ï€Î¿ÏƒÏŒ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î¸ÎµÏ„Î¹ÎºÏŒ" |
| Î‘Î¦Îœ Ï€ÎµÎ»Î¬Ï„Î· (Î±Î½ ÎµÏ„Î±Î¹ÏÎµÎ¯Î±) | error | "Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Î‘Î¦Îœ Ï€ÎµÎ»Î¬Ï„Î·" |
| Î‘Î¦Îœ format | error | "ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î‘Î¦Îœ" |
| ÎšÎ‘Î” required | error | "Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎšÎ‘Î” Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±Ï‚" |
| ÎœÎµÎ³Î¬Î»Î¿ Ï€Î¿ÏƒÏŒ (>10.000â‚¬) | warning | "Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ Ï€Î¿ÏƒÏŒ" |
| Î Î»Î·ÏÏ‰Î¼Î® Î¼ÎµÏ„ÏÎ·Ï„Î¬ >500â‚¬ | **error** | "Î‘Ï€Î±Î³Î¿ÏÎµÏÎµÏ„Î±Î¹ Ï€Î»Î·ÏÏ‰Î¼Î® Î¼ÎµÏ„ÏÎ·Ï„ÏÎ½ >500â‚¬ (Î.4446/2016)" |

---

## 14. Income Classification (myDATA)

| Î¤ÏÏ€Î¿Ï‚ Î Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï | ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Î•ÏƒÏŒÎ´Ï‰Î½ | ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î•3 |
|--------------------|--------------------|------------|
| Î¤Î Î¥ (2.1) â€” Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ | category1_3 (ÎˆÏƒÎ¿Î´Î± Î Î±ÏÎ¿Ï‡Î®Ï‚ Î¥Ï€Î·ÏÎµÏƒÎ¹ÏÎ½) | 561_003 |
| Î¤Î  (1.1) â€” ÎšÎ±Ï„Î±ÏƒÎºÎµÏ…Î­Ï‚ | category1_1 (ÎˆÏƒÎ¿Î´Î± Î ÏÎ»Î·ÏƒÎ·Ï‚ Î‘Î³Î±Î¸ÏÎ½) | 561_001 |
| Î‘Î Î¥ (11.2) | category1_3 | 561_003 |
| Î Î¹ÏƒÏ„Ï‰Ï„Î¹ÎºÏŒ (5.1) | Î‘Î½Ï„Î¹Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÏÏ‡Î¹ÎºÎ®Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚ | â€” |

---

## 15. Dependencies

| Module | Î£Ï‡Î­ÏƒÎ· | Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® |
|--------|-------|-----------|
| **M-001** (Company Setup) | **BLOCKED BY** | Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ settings (Î‘Î¦Îœ, Î”ÎŸÎ¥, ÎšÎ‘Î”, IBAN) |
| **M-002** (Income/Expense Book) | **FEEDS** | ÎšÎ¬Î¸Îµ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ â†’ ÎµÎ³Î³ÏÎ±Ï†Î® ÎµÏƒÏŒÎ´Î¿Ï… |
| **M-004** (myDATA) | **TRIGGERS** | ÎšÎ¬Î¸Îµ Ï„Î¹Î¼Î¿Î»ÏŒÎ³Î¹Î¿ â†’ myDATA Î´Î¹Î±Î²Î¯Î²Î±ÏƒÎ· |
| **M-005** (VAT Engine) | **FEEDS** | Î¦Î Î‘ ÎµÎºÏÎ¿ÏÎ½ â†’ Ï„ÏÎ¹Î¼Î·Î½Î¹Î±Î¯Î± Î´Î®Î»Ï‰ÏƒÎ· |
| **M-009** (Bank Reconciliation) | **LINKS** | Î Î»Î·ÏÏ‰Î¼Î® â†’ Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¯Ï‡Î¹ÏƒÎ· Ï„ÏÎ±Ï€ÎµÎ¶. ÎºÎ¯Î½Î·ÏƒÎ·Ï‚ |
| **CRM Contacts** | **READS** | Î ÎµÎ»Î¬Ï„Î·Ï‚ = CRM contact |

---

## 16. Open Questions

| # | Î•ÏÏÏ„Î·ÏƒÎ· | Status | Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ· |
|---|---------|--------|----------|
| 1 | IBAN â€” Ï€Î¿Î¹Î± Ï„ÏÎ¬Ï€ÎµÎ¶Î±; | RESOLVED | Î•Î¸Î½Î¹ÎºÎ® Î¤ÏÎ¬Ï€ÎµÎ¶Î±: `GR68 0110 2230 0000 2234 0068 448` |
| 2 | Logo/Header â€” ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÎºÎ´ÏŒÏ„Î· | RESOLVED | Î Î±Î³ÏÎ½Î·Ï‚ ÎÎ­ÏƒÏ„. Î“ÎµÏÏÎ³Î¹Î¿Ï‚, Î‘ÏÏ‡Î¹Ï„Î­ÎºÏ„Ï‰Î½ ÎœÎ·Ï‡Î±Î½Î¹ÎºÏŒÏ‚, Î£Î±Î¼Î¿Î¸ÏÎ¬ÎºÎ·Ï‚ 16, 563 34, Î•Î»ÎµÏ…Î¸Î­ÏÎ¹Î¿ ÎšÎ¿ÏÎ´ÎµÎ»Î¹ÏŒ, Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·, Î¤: 2310 55 95 95, Îœ: 6974 050 023 |
| 3 | Î“Î»ÏÏƒÏƒÎ± Ï„Î¹Î¼Î¿Î»Î¿Î³Î¯Î¿Ï… | RESOLVED | ÎœÏŒÎ½Î¿ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬ |
| 4 | ÎœÎµÏ„ÏÎ·Ï„Î¬ >500â‚¬ | RESOLVED | **Î‘Ï…ÏƒÏ„Î·ÏÏŒ block** â€” Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î­ÎºÎ´Î¿ÏƒÎ· |
| 5 | Auto-email Ï„Î¹Î¼Î¿Î»Î¿Î³Î¯Î¿Ï… | RESOLVED | **Î¥Î²ÏÎ¹Î´Î¹ÎºÏŒ** â€” ÎºÎ¿Ï…Î¼Ï€Î¯ "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® email" (ÏŒÏ‡Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿, Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÏ€Î¹Î»Î­Î³ÎµÎ¹) |

---

## 17. Decision Log

| Date | Decision | Author |
|------|----------|--------|
| 2026-02-09 | ADR Created â€” Invoicing system design | Î“Î¹ÏÏÎ³Î¿Ï‚ + Claude Code |
| 2026-02-09 | Phase 1: 1 ÏƒÎµÎ¹ÏÎ¬ (Î‘), modular Î³Î¹Î± Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ | Î“Î¹ÏÏÎ³Î¿Ï‚ |
| 2026-02-09 | Snapshot pattern: ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï€ÎµÎ»Î¬Ï„Î· freeze ÎºÎ±Ï„Î¬ Î­ÎºÎ´Î¿ÏƒÎ· | Claude Code |
| 2026-02-09 | Î Î±ÏÎ±ÎºÏÎ¬Ï„Î·ÏƒÎ·: auto-detect Î±Ï€ÏŒ ÎšÎ‘Î” + customerType + Ï€Î¿ÏƒÏŒ | Claude Code |
| 2026-02-09 | Service catalog: 11 Ï€ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ + custom | Claude Code |
| 2026-02-09 | PDF: server-side generation (react-pdf Î® puppeteer) | Claude Code |
| 2026-02-09 | IBAN: Î•Î¸Î½Î¹ÎºÎ® Î¤ÏÎ¬Ï€ÎµÎ¶Î± GR68 0110 2230 0000 2234 0068 448 | Î“Î¹ÏÏÎ³Î¿Ï‚ |
| 2026-02-09 | Header: "Î Î±Î³ÏÎ½Î·Ï‚ ÎÎ­ÏƒÏ„. Î“ÎµÏÏÎ³Î¹Î¿Ï‚ â€” Î‘ÏÏ‡Î¹Ï„Î­ÎºÏ„Ï‰Î½ ÎœÎ·Ï‡Î±Î½Î¹ÎºÏŒÏ‚" | Î“Î¹ÏÏÎ³Î¿Ï‚ |
| 2026-02-09 | Î“Î»ÏÏƒÏƒÎ±: ÎœÏŒÎ½Î¿ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬ (no dual language) | Î“Î¹ÏÏÎ³Î¿Ï‚ |
| 2026-02-09 | ÎœÎµÏ„ÏÎ·Ï„Î¬ >500â‚¬: Hard block (ÎŸÎ§Î™ warning) | Î“Î¹ÏÏÎ³Î¿Ï‚ |
| 2026-02-09 | Email Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®: Î¥Î²ÏÎ¹Î´Î¹ÎºÏŒ â€” manual trigger, ÏŒÏ‡Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ | Î“Î¹ÏÏÎ³Î¿Ï‚ |

---

*ADR Format based on: Michael Nygard's Architecture Decision Records*
