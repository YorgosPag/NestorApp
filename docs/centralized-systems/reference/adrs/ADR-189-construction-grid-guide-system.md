# ADR-189: Construction Grid & Guide System (Κάνναβος & Οδηγοί)

| Field | Value |
|-------|-------|
| **Status** | ALL COMMANDS COMPLETE ✅ + Phase 2 Enhancements: B1 Bubbles ✅, B2 Auto Grid ✅, B3 Dimensions ✅, B5 Drag ✅, B6 Colors ✅, B28 Rotation ✅, B29 Rotate Group ✅, B30 Rotate All ✅, B31 Polar Array ✅, B32 Scale Grid ✅, B33 Equalize ✅, B36 Measure→Guide ✅. 14/14 commands + 12 enhancements. |
| **Date** | 2026-02-22 |
| **Module** | DXF Viewer / Grid System |
| **Inspiration** | LH Λογισμική — Fespa / Τέκτων (Master) |
| **Priority** | TBD |

---

## 1. Σκοπός

Σχεδιασμός ενός συστήματος **Κάνναβου / Οδηγών** (Construction Grid & Guides) για τον DXF Viewer,
εμπνευσμένο από τη λογική του Fespa/Τέκτων της LH Λογισμική.

Ο κάνναβος χρησιμεύει ως **δομικό πλέγμα αναφοράς** για τη σωστή τοποθέτηση
αρχιτεκτονικών και στατικών στοιχείων σε μία κάτοψη κτιρίου.

---

## 2. Γνωστές Πληροφορίες (από έρευνα)

### 2.1 Τι είναι ο Κάνναβος

- Πλέγμα γραμμών (**οδηγών**) με **διακριτά και ενεργά σημεία τομής**
- Τα σημεία τομής ονομάζονται **σημεία έλξης (snap points)**
- Οι κορυφές δομικών στοιχείων (πλάκες, υποστυλώματα, τοιχώματα) **έλκονται αυτόματα** στα snap points κατά την εισαγωγή ή μετακίνηση

### 2.2 Αυτόματη Ονομασία Αξόνων

- Ο κάνναβος αναθέτει αυτόματα **αλφαριθμητικές θέσεις** (π.χ. A1, B1, Γ2...)
- Εμφανίζεται σε: κατόψεις, τομές, λεπτομέρειες υποστυλωμάτων, αναπτύγματα δοκών
- Επιτρέπει αναγνώριση θέσης στο εργοτάξιο απευθείας από το σχέδιο

### 2.3 Εξέλιξη Ονομασίας (Fespa)

| Έκδοση | Ονομασία | Ρόλος |
|--------|----------|-------|
| Fespa ≤ 6.x | **Κάνναβος** | Βασικό πλέγμα με snap points |
| Fespa 7.x+ | **Οδηγός** (Guide) | Μετονομασία του παλιού κάνναβου |
| Fespa 7.x+ | **Κάνναβος** (νέος) | Ενεργή οντότητα — αυτόματη ονομασία αξόνων |

### 2.4 Ρυθμίσεις (μερικές)

- **Βήμα (spacing)**: Απόσταση μεταξύ γραμμών πλέγματος
- **Κύριος κάνναβος**: Κύρια γραμμή πλέγματος
- **Βοηθητικός κάνναβος**: Ενδιάμεσες γραμμές
- **Βήμα zoom**: Παράμετρος μεγέθυνσης ρόδας mouse
- **Toggle snap**: Πλήκτρο **Delete** ή **S** κατά τη σχεδίαση

### 2.5 Σημεία Έλξης (Snap Points)

- ΟΧΙ μόνο στον κάνναβο — **όλες** οι οντότητες (στατικές, γραμμικές) διαθέτουν snap points
- Υποστηρίζονται: endpoints, intersections, midpoints κ.λπ.
- Αυτό ήδη υπάρχει στο DXF Viewer μας (ProSnapEngineV2, 13 snap types)

---

## 3. Πληροφορίες από Γιώργο (εμπειρία Τέκτων)

> Περιγραφή λειτουργίας βάσει πρακτικής γνώσης του Τέκτονα/Fespa.

### 3.1 Toolbar & Εντολές

Στην κεντρική εργαλειοθήκη υπάρχει πλήκτρο **"Οδηγός"**. Πατώντας το ανοίγει μενού:

| # | Εντολή | Κλικ | Τι κάνει |
|---|--------|------|----------|
| 1ο | **Οδηγός X** | **1 κλικ** | Κατακόρυφη γραμμή — πολύ μεγάλο μήκος ("άπειρη") |
| 2ο | **Οδηγός Z** | **1 κλικ** | Οριζόντια γραμμή — πολύ μεγάλο μήκος ("άπειρη") |
| 3ο | **Οδηγός XZ** | **3 κλικ** | Λοξή/ελεύθερη γωνία — **πεπερασμένο μήκος** (ο χρήστης ορίζει αρχή, κατεύθυνση, τέλος) |
| 4ο | **Κάθετη** | **2 βήματα** | Δημιουργεί γραμμή **κάθετη σε υφιστάμενο οδηγό** — απεριόριστο μήκος |
| 5ο | **Σε Τμήματα** | **2 κλικ + input** | Χωρίζει απόσταση σε ισαπέχοντα snap points (X markers) — χωρίς γραμμές |
| 6ο | **Ανά Απόσταση** | **2 κλικ + input** | Snap points ανά σταθερή απόσταση (π.χ. ανά 10μ) — χωρίς γραμμές |
| 7ο | **Σε Τμήματα Τόξου** | **1 κλικ + input** | Υποδιαιρεί υφιστάμενο τόξο σε ισαπέχοντα X markers |
| 8ο | **Ανά Απόσταση Τόξου** | **1 κλικ + input** | X markers ανά σταθερή απόσταση πάνω σε τόξο |
| 9ο | **Τομή Κύκλων** | **2 κλικ** | X markers στα σημεία τομής δύο κύκλων |
| 10ο | **Τομή Τόξου & Ευθείας** | **2 κλικ** | X markers στα σημεία τομής γραμμής με τόξο/κύκλο |
| 11ο | **Παράλληλοι** ⭐ | **1 κλικ + keyboard** | Παράλληλη γραμμή σε σταθερή απόσταση — πολύ συχνή χρήση |
| 12ο | **Διαγραφή Οδηγού** | **1 κλικ** | Διαγράφει μία γραμμή-οδηγό |
| 13ο | **Προσθήκη Σημείου** | **N κλικ** | Προσθέτει μεμονωμένα X markers ελεύθερα |
| 14ο | **Διαγραφή Σημείου** | **1 κλικ** | Διαγράφει ένα X marker |

**Βασική λογική**: Κάθε "οδηγός" (pass/run) είναι μία **μεμονωμένη, πολύ μεγάλη γραμμή-οδηγός** που τοποθετείται με κλικ. Δεν δημιουργείται ολόκληρο πλέγμα με μία εντολή — ο χρήστης τοποθετεί μία-μία τις γραμμές-οδηγούς.

### 3.2 Visual Appearance (από screenshot Τέκτονα)

Παρατηρήσεις από πραγματικό screenshot του Fespa-Tekton:

| Χαρακτηριστικό | Περιγραφή |
|----------------|-----------|
| **Χρώμα οδηγού** | Λεπτή, ανοιχτόχρωμη γραμμή (γκρι/λευκή) πάνω σε σκούρο φόντο |
| **Μήκος** | Εκτείνεται σε **ολόκληρο το viewport** και πέρα |
| **Πάχος** | Πολύ λεπτή (1px) — ξεκάθαρα βοηθητική, όχι δομική |
| **Σταυρόνημα** | Δύο λευκές γραμμές σε σχήμα σταυρού (+) — αυτό είναι ο **cursor**, ΟΧΙ οδηγοί |
| **Status bar** | Δείχνει: `"Δώστε τους κατά Χ οδηγούς"` — prompt για τοποθέτηση |
| **Συντεταγμένες** | `X=0.50` — η τρέχουσα θέση X σε μέτρα |
| **Snap step** | `Sn=0.05` — βήμα snap 5cm |
| **Floors** | Tabs ορόφων (Όροφ.-1, Όροφ.0, Όροφ.1 ... Όροφ.22) — οδηγοί ανά όροφο |

### 3.3 Ροή Τοποθέτησης Οδηγού (workflow)

Βήμα-βήμα, όπως περιέγραψε ο Γιώργος:

**Οδηγός X (κατακόρυφος)** — 1ο πλήκτρο στο μενού:
1. Επιλογή "Οδηγός X" από αριστερό μενού
2. Μετακίνηση σταυρονήματος στην οθόνη
3. **Ένα κλικ** → δημιουργείται κατακόρυφη λεπτή γραμμή
4. Μπορείς να συνεχίσεις με επιπλέον κλικ για περισσότερους οδηγούς

**Οδηγός Z (οριζόντιος)** — 2ο πλήκτρο στο μενού:
- **Ακριβώς ίδια συμπεριφορά** με τον Οδηγό X
- Επιλογή → μετακίνηση σταυρονήματος → **ένα κλικ** → οριζόντια γραμμή

**Κοινό X/Z**: Και οι δύο τύποι δημιουργούνται με **ένα μόνο κλικ**.

**Οδηγός XZ (λοξός)** — 3ο πλήκτρο στο μενού:
1. **1ο κλικ**: "Επιλέξτε το ένα άκρο του οδηγού" → ορίζει αρχή
2. **2ο κλικ**: "Επιλέξτε άλλο ένα σημείο του οδηγού" → ορίζει κατεύθυνση/γωνία
3. **3ο κλικ**: "Επιλέξτε το τέλος του οδηγού" → ορίζει μήκος/τέλος

**Βασική διαφορά**: Οι X/Z οδηγοί είναι **"άπειροι"** (πολύ μεγάλοι), ενώ ο XZ οδηγός έχει **πεπερασμένο μήκος** που ορίζεται από τα 3 κλικ.

### 3.4 Οπτικές Ενδείξεις (από 2ο screenshot)

Στο screenshot φαίνονται και οι 3 τύποι οδηγών μαζί:
- **Οδηγός X**: κατακόρυφος, εκτείνεται σε ολόκληρο το ύψος
- **Οδηγός Z**: οριζόντιος, εκτείνεται σε ολόκληρο το πλάτος
- **Οδηγός XZ**: διαγώνιος, με **ορατή αρχή και τέλος** (πεπερασμένο μήκος)

Πράσινες ενδείξεις κατά τη δημιουργία:
- **+** (σταυρός) = σταυρόνημα / cursor
- **○** (κύκλος) = σημείο snap / σημείο αναφοράς
- **X** = σημείο κλικ / ένδειξη τοποθέτησης

### 3.5 Snap Points στα Σημεία Τομής Οδηγών

Όταν τα snaps είναι ενεργοποιημένα:

| Κατάσταση | Ένδειξη | Περιγραφή |
|-----------|---------|-----------|
| **Ανενεργό** (σταυρόνημα μακριά) | Μικρό λευκό **X** | Μόνιμα ορατό στα σημεία τομής οδηγών |
| **Ενεργό** (σταυρόνημα κοντά) | Μικρό λευκό **+** | Το X μετατρέπεται σε + όταν ενεργοποιείται η έλξη |

**Βασική αρχή**: Κάθε σημείο τομής δύο οδηγών (ανεξαρτήτως τύπου — X∩Z, X∩XZ, Z∩XZ) γίνεται **αυτόματα snap point** με μόνιμη οπτική ένδειξη.

**Λεπτομέρεια UX**: Η εναλλαγή X → + δίνει **οπτική ανατροφοδότηση** στον χρήστη ότι η έλξη ενεργοποιήθηκε, χωρίς να χρειάζεται να κοιτάξει αλλού (π.χ. status bar).

### 3.6 Κάθετη (4ο πλήκτρο)

Δημιουργεί νέα γραμμή **κάθετη σε υφιστάμενο οδηγό**, με απεριόριστο μήκος.

**Workflow (2 βήματα):**
1. **Επιλογή υφιστάμενης**: "Επιλέξτε γραμμή-οδηγό για προσθήκη καθέτου επ' αυτής"
   - Μετακινείς το σταυρόνημα κοντά σε έναν υφιστάμενο οδηγό
   - Ο οδηγός **χρωματίζεται** (highlight) όταν πλησιάζεις — οπτική ένδειξη επιλογής
   - Κλικ → επιλέγεται ο οδηγός
2. **Τοποθέτηση καθέτου**: "Επιλέξτε σημείο για προσθήκη"
   - Κλικ σε οποιοδήποτε σημείο → δημιουργείται νέα γραμμή **κάθετη** στην επιλεγμένη
   - Η νέα γραμμή έχει **απεριόριστο μήκος** (όπως οι X/Z)

**Χρήση**: Ιδανική για γρήγορη δημιουργία κάθετων αξόνων σε λοξούς οδηγούς (XZ), χωρίς να υπολογίζεις γωνία χειροκίνητα.

### 3.7 Σε Τμήματα (5ο πλήκτρο)

Χωρίζει μια απόσταση σε **ισαπέχοντα snap points** (μικρά X markers). **Δεν** δημιουργεί γραμμές — μόνο σημεία έλξης.

**Workflow (2 κλικ + input):**
1. **1ο κλικ**: "Επιλέξτε το πρώτο σημείο" → ορίζει αρχή
2. **2ο κλικ**: "Επιλέξτε το 2ο σημείο" → ορίζει τέλος
3. **Popup dialog**: "Δώστε αριθμό τμημάτων" → input πεδίο + OK/Ακύρωση
4. **Αποτέλεσμα**: Δημιουργούνται **ισαπέχοντα X markers** ανάμεσα στα δύο σημεία

**Παράδειγμα**: 2 κλικ + αριθμός τμημάτων = 3 → δημιουργούνται **3 X markers**:
- Ένα στο 1ο κλικ (αρχή)
- Ένα στο κέντρο (ισαπέχον)
- Ένα στο 2ο κλικ (τέλος)

**Σημαντικό**: Τα X markers λειτουργούν ακριβώς όπως τα snap points τομής οδηγών (§3.5) — μόνιμα ορατά, X → + κατά την έλξη. Λειτουργεί ακόμα και σε **κενή οθόνη** (δεν χρειάζεται υφιστάμενους οδηγούς).

**Διόρθωση — συμπεριφορά με υφιστάμενους οδηγούς**: Όταν υπάρχουν ήδη γραμμές-οδηγοί με σημεία τομής (X markers), η εντολή "Σε Τμήματα" μπορεί να χρησιμοποιηθεί μεταξύ δύο σημείων τομής. Τα νέα X markers τοποθετούνται **πάνω ακριβώς στον υφιστάμενο οδηγό** μεταξύ των δύο σημείων.

### 3.8 Ανά Απόσταση (6ο πλήκτρο)

Δημιουργεί snap points (X markers) ανά **σταθερή απόσταση** μεταξύ δύο σημείων.

**Workflow (2 κλικ + input):**
1. **1ο κλικ**: "Επιλέξτε το πρώτο σημείο" → ορίζει αρχή
2. **2ο κλικ**: "Επιλέξτε το δεύτερο σημείο" → ορίζει τέλος
3. **Popup dialog**: "Δώστε μήκος" → input σε μέτρα (π.χ. 10)
4. **Αποτέλεσμα**: X markers ανά σταθερή απόσταση, από αρχή μέχρι τέλος

**Παράδειγμα**: 2 κλικ + μήκος 10μ → X markers κάθε 10 μέτρα:
- 1ο X στο πρώτο κλικ (αρχή)
- 2ο X στα 10μ
- 3ο X στα 20μ
- ...τελευταίο X στο δεύτερο κλικ (τέλος)
- **ΣΗΜΕΙΩΣΗ**: Η τελευταία απόσταση μπορεί να είναι **μικρότερη** αν η συνολική απόσταση δεν είναι ακριβές πολλαπλάσιο

**Διαφορά "Σε Τμήματα" vs "Ανά Απόσταση":**

| | Σε Τμήματα (5ο) | Ανά Απόσταση (6ο) |
|--|------------------|-------------------|
| **Input** | Αριθμός τμημάτων | Μήκος σε μέτρα |
| **Αποτέλεσμα** | Πάντα ισαπέχοντα | Σταθερή απόσταση, τελευταίο τμήμα μπορεί να μικρότερο |
| **Παράδειγμα** | "3 τμήματα" → 2 ενδιάμεσα σημεία | "ανά 10μ" → σημεία κάθε 10μ |

### 3.9 Σε Τμήματα Τόξου (7ο πλήκτρο) ✅ IMPLEMENTED

Υποδιαιρεί ένα υφιστάμενο τόξο/κύκλο σε ισαπέχοντα snap points.

**Workflow:**
1. "Επιλέξτε τόξο για πρόσθεση οδηγού" → κλικ σε υφιστάμενο τόξο
2. Popup: "Δώστε αριθμό τμημάτων" → αριθμός + OK
3. X markers εμφανίζονται **πάνω στο τόξο** σε ισαπέχουσες θέσεις

**Implementation (2026-02-21):**
- Keyboard chord: **G→T**
- Entity picking: `pointToArcDistance()` for arcs, circumference distance for circles
- Geometry: `computeArcSegmentPoints()` — Circle: N points (no duplicate start=end), Arc: N+1 points (includes endpoints)
- DXF convention: counterclockwise sweep from startAngle to endAngle
- Files: `useConstructionPointState.ts`, `useCanvasClickHandler.ts`, `CanvasSection.tsx`

### 3.10 Ανά Απόσταση Τόξου (8ο πλήκτρο) ✅ IMPLEMENTED

Ίδια λογική με "Ανά Απόσταση" αλλά πάνω σε τόξο/κύκλο.

**Workflow:**
1. "Επιλέξτε τόξο για πρόσθεση οδηγού" → κλικ σε τόξο
2. Εμφανίζεται δυναμική γραμμή από το άκρο του τόξου μέχρι το σταυρόνημα
3. Prompt: "Δώστε μήκος" → αριθμός σε μέτρα
4. X markers ανά σταθερή απόσταση πάνω στο τόξο

**Implementation (2026-02-21):**
- Keyboard chord: **G→U**
- Geometry: `computeArcDistancePoints()` — angleStep = distance/radius, wraps around for circles, includes endpoint for arcs
- Files: `useConstructionPointState.ts`, `useCanvasClickHandler.ts`, `CanvasSection.tsx`

### 3.11 Τομή Κύκλων (9ο πλήκτρο) ✅ IMPLEMENTED

Βρίσκει αυτόματα τα σημεία τομής δύο κύκλων.

**Workflow:**
1. "Επιλέξτε τον πρώτο κύκλο" → κλικ
2. "Επιλέξτε τον δεύτερο κύκλο" → κλικ
3. X markers εμφανίζονται στα **σημεία τομής** των δύο κύκλων (0, 1 ή 2 σημεία)

**Implementation (2026-02-21):**
- Keyboard chord: **G→O**
- 2-step state machine: `circleIntersectStep` (0=pick first arc/circle, 1=pick second)
- Geometry: `computeCircleCircleIntersection()` — Radical line algorithm: d between centers, a = (r1²-r2²+d²)/(2d), h = sqrt(r1²-a²), perpendicular offsets
- Angular range filtering: `isPointInArcRange()` for arcs (not full circles)
- Returns 0, 1, or 2 points; warning notification on 0 results
- Files: `useConstructionPointState.ts`, `useCanvasClickHandler.ts`, `CanvasSection.tsx`

### 3.12 Τομή Τόξου & Ευθείας (10ο πλήκτρο) ✅ IMPLEMENTED

Βρίσκει τα σημεία τομής γραμμής με τόξο ή κύκλο.

**Workflow:**
1. "Επιλέξτε γραμμή" → κλικ σε ευθεία
2. "Επιλέξτε τόξο" → κλικ σε τόξο **ή** κύκλο (λειτουργεί και στα δύο)
3. X markers στα σημεία τομής

**Implementation (2026-02-21):**
- Keyboard chord: **G→I**
- 2-step state machine: `arcLineStep` (0=pick line, 1=pick arc/circle)
- Geometry: `computeLineArcIntersection()` — Parametric line-circle quadratic (at²+bt+c=0), filter t∈[0,1] + angular range
- Returns 0, 1, or 2 points; warning notification on 0 results
- Files: `useConstructionPointState.ts`, `useCanvasClickHandler.ts`, `CanvasSection.tsx`

### 3.13 Παράλληλοι (11ο πλήκτρο) ⭐ ΠΟΛΥ ΣΥΧΝΗ ΧΡΗΣΗ

Δημιουργεί γραμμή-οδηγό **παράλληλη** σε υφιστάμενη, σε καθορισμένη απόσταση.

**Workflow:**
1. "Επιλέξτε γραμμή" → μετακίνηση σταυρονήματος κοντά σε οδηγό → η γραμμή **φωτίζεται** (highlight) → κλικ
2. Εμφανίζεται **δυναμική γραμμή** (real-time preview) που ενώνει το σταυρόνημα με τον υφιστάμενο οδηγό
3. Prompt: "Δώστε απόσταση" → **πληκτρολόγηση στο keyboard + Enter** (ΟΧΙ popup dialog)
4. Δημιουργείται παράλληλη γραμμή στην πλευρά που βρίσκεται το σταυρόνημα

**UX λεπτομέρεια**: Η πλευρά (αριστερά/δεξιά ή πάνω/κάτω) καθορίζεται από τη **θέση του σταυρονήματος** σε σχέση με τον υφιστάμενο οδηγό. Η δυναμική γραμμή δίνει real-time ανατροφοδότηση.

### 3.14 Διαγραφή Οδηγού (12ο πλήκτρο)

**Workflow:**
1. "Επιλέξτε γραμμή για διαγραφή" → κλικ σε γραμμή-οδηγό → διαγράφεται

### 3.15 Προσθήκη Σημείου (13ο πλήκτρο)

Προσθέτει μεμονωμένα X markers (snap points) ελεύθερα στον καμβά.

**Workflow:**
1. "Δώσε νέο σημείο οδηγού" → κλικ → X marker
2. Συνεχίζεις με όσα κλικ θέλεις → κάθε κλικ = νέο X marker

### 3.16 Διαγραφή Σημείου (14ο πλήκτρο)

**Workflow:**
1. "Επιλέξτε σημείο οδηγού για διαγραφή" → μετακίνηση κοντά σε X marker
2. Το X μετατρέπεται σε + (snap feedback) → κλικ → διαγράφεται

### 3.17 Γενικές Ιδιότητες Οδηγών

| Ιδιότητα | Τιμή |
|----------|------|
| **Εκτύπωση** | ❌ ΔΕΝ εκτυπώνονται — είναι **μόνο βοηθητικές** |
| **Αποθήκευση** | ✅ Σώζονται μαζί με το σχέδιο |
| **Εμφάνιση** | Πολύ λεπτές, αχνό χρώμα — ο χρήστης **αντιλαμβάνεται αμέσως** ότι είναι βοηθητικές |
| **Μαζική διαγραφή** | ✅ Εντολή "Νέος Οδηγός" στο κεντρικό μενού → **διαγράφει ΟΛΕΣ** τις γραμμές + σημεία ταυτόχρονα |

**ΣΗΜΑΝΤΙΚΗ ΔΙΕΥΚΡΙΝΙΣΗ**: Στο screenshot:
- Η γραμμή κυκλωμένη με **πράσινο** = ο **οδηγός** (μόνο ένας δημιουργήθηκε)
- Οι δύο λευκές γραμμές σε σχήμα **+** = το **σταυρόνημα** (cursor), ΟΧΙ οδηγοί

---

## 4. Ανοιχτά Ερωτήματα (προς συμπλήρωση)

> Επόμενες ερωτήσεις — ο Γιώργος θα απαντήσει σταδιακά.

### 4.1 Τοποθέτηση Οδηγών

- [x] **Q1**: Ακριβείς συντεταγμένες; → **Μόνο κλικ**. Αν snap ενεργό, ο οδηγός τοποθετείται στο πλησιέστερο snap point.
- [x] **Q2**: Μετακίνηση (drag) μετά; → **ΟΧΙ στον Τέκτονα**. ✅ Θα προστεθεί στη δική μας υλοποίηση (βελτίωση).
- [x] **Q3**: Αυτόματη ονομασία; → **Ανώνυμες** στον Τέκτονα. ✅ Θα προστεθούν labels (βελτίωση).

### 4.2 Εμφάνιση

- [x] **Q4**: Τι χρώμα/στυλ έχει ο οδηγός; → **Πολύ λεπτός, αχνό χρώμα** — ξεκάθαρα βοηθητική
- [x] **Q5**: Ονομασία στις άκρες; → **ΟΧΙ στον Τέκτονα**. ✅ Θα προστεθούν axis bubbles (βελτίωση).
- [x] **Q6**: Εκτυπώνεται στα σχέδια ή είναι μόνο βοηθητική; → **ΔΕΝ εκτυπώνεται** — μόνο βοηθητική

### 4.3 Snap & Αλληλεπίδραση

- [x] **Q7**: Οι οδηγοί έχουν snap points; → **ΝΑΙ**, τα σημεία τομής είναι μόνιμα snap points
- [x] **Q8**: Όταν δύο οδηγοί τέμνονται, το σημείο τομής γίνεται ειδικό snap point; → **ΝΑΙ** (βλ. §3.5)
- [x] **Q9**: Μετακίνηση στοιχείων μαζί; → **ΟΧΙ στον Τέκτονα** — ανεξάρτητα. Πιθανή μελλοντική βελτίωση (optional link).

### 4.4 Υπόλοιπες εντολές μενού

- [x] **Q10**: Ποιες είναι οι υπόλοιπες εντολές; → **14 συνολικά** — πλήρης λίστα στο §3.1
- [ ] **Q11**: Υπάρχει εντολή "Κάνναβος" που δημιουργεί αυτόματα ολόκληρο πλέγμα; (Ή μόνο μεμονωμένους οδηγούς;)

### 4.5 Ειδικές Περιπτώσεις

- [x] **Q12**: Υποστηρίζονται λοξοί οδηγοί (γωνία ≠ 0° ή 90°); → **ΝΑΙ**, μέσω "Οδηγός XZ" (3 κλικ)
- [ ] **Q13**: Πόσους οδηγούς μπορείς να βάλεις; (Δεκάδες; Χωρίς όριο;) — πιθανώς χωρίς όριο
- [ ] **Q14**: Μπορείς να ομαδοποιήσεις οδηγούς σε "κάνναβο" (group); — πιθανώς ΟΧΙ στον Τέκτονα

---

## 4. Βελτιώσεις πέρα από τον Τέκτονα (ΕΓΚΕΚΡΙΜΕΝΕΣ)

> Λειτουργίες που **δεν υπάρχουν** στον Τέκτονα αλλά θα υλοποιηθούν στο δικό μας σύστημα.

### 4.1 Εγκεκριμένες Βελτιώσεις (Γιώργος ✅)

| # | Βελτίωση | Περιγραφή | Προτεραιότητα |
|---|----------|-----------|---------------|
| B1 | **Axis Labels με Bubbles** ✅ | Κυκλάκια στις άκρες οδηγών (Α, Β, Γ / 1, 2, 3) — πρότυπο Revit/AutoCAD. X→κορυφή, Y→δεξιά πλευρά | ⭐ Υψηλή |
| B2 | **Αυτόματη δημιουργία πλέγματος** ✅ | Εντολή "Κάνναβος" (G→B): ισαπέχουσες ή ανισαπέχουσες αποστάσεις. Toolbar dropdown + shortcut | ⭐ Υψηλή |
| B3 | **Διαστάσεις μεταξύ οδηγών** ✅ | Annotations απόστασης (π.χ. "5.00μ") — X→κορυφή, Y→δεξιά πλευρά (μακριά από χάρακα) | Μεσαία |
| B4 | **Κλείδωμα οδηγών (Lock)** | Lock/unlock ανά οδηγό για αποφυγή κατά λάθος διαγραφής | Μεσαία |
| B5 | **Drag μετακίνηση** | Drag & drop για μετακίνηση τοποθετημένου οδηγού με real-time preview | ⭐ Υψηλή |
| B6 | **Χρώματα / Στυλ ανά ομάδα** ✅ | Per-guide color via context menu (8-χρωμη παλέτα + reset). resolveStyle() respects guide.style overrides | ⭐ Υψηλή |
| B8 | **Οδηγός από υφιστάμενη οντότητα** | Κλικ σε DXF entity (τοίχος, γραμμή) → αυτόματος οδηγός πάνω του | Μεσαία |
| B9 | **Ακτινικοί οδηγοί** | Ακτίνες από κεντρικό σημείο ανά γωνία (30°/45°/60°) — κυκλικές κατασκευές | Μεσαία |
| B12 | **Snap μεσαίου** | Αυτόματο snap στο μέσον μεταξύ δύο παράλληλων οδηγών | Μεσαία |

### 4.2 Οπτική Διαφοροποίηση Οδηγών (ΚΡΙΣΙΜΟ)

> Ο Γιώργος τονίζει: οι γραμμές-οδηγοί πρέπει να είναι **αμέσως αναγνωρίσιμες** ως βοηθητικές.

**Τεχνικές rendering:**

| Τεχνική | Περιγραφή | Εφαρμογή |
|---------|-----------|----------|
| **Sub-pixel πάχος** | Line width < 1px (π.χ. 0.5px) — πιο λεπτή από οποιαδήποτε DXF entity | Canvas strokeWidth |
| **Χαμηλή αδιαφάνεια** | Alpha 0.25–0.40 — ημιδιαφανείς, δεν κυριαρχούν | globalAlpha ή rgba |
| **Dashed pattern** | Μικρές παύλες (π.χ. [4, 4]) — οπτικά διαφορετικές από solid entity γραμμές | setLineDash |
| **Ξεχωριστό χρώμα** | Muted χρώμα (π.χ. cyan, pale blue) — ΟΧΙ το ίδιο με entities | Configurable via settings |
| **Σταθερό πάχος στο zoom** | Οι οδηγοί παραμένουν 0.5px ανεξαρτήτως zoom level — δεν παχαίνουν | Inverse scale transform |

**Αρχή**: Ο χρήστης πρέπει να ξεχωρίζει αμέσως τι είναι **δομικό στοιχείο** και τι είναι **βοηθητικός οδηγός**, ακόμα και αν το σχέδιο είναι γεμάτο γραμμές.

### 4.3 Εγκεκριμένες Πρόσθετες Βελτιώσεις (Γιώργος ✅)

| # | Βελτίωση | Περιγραφή | Προτεραιότητα |
|---|----------|-----------|---------------|
| B7 | **Ομαδοποίηση (Groups)** | Ομαδοποίηση οδηγών σε named groups (π.χ. "Δομικός Κάνναβος", "MEP") | Μεσαία |
| B11 | **Info Panel** | Side panel με ιδιότητες επιλεγμένου οδηγού (θέση, γωνία, μήκος) | Χαμηλή |
| B13 | **Keyboard Shortcuts** | G+X=Οδηγός X, G+Z=Οδηγός Z, G+P=Παράλληλοι κ.λπ. | ⭐ Υψηλή |
| B14 | **Multi-select οδηγών** | Batch operations: διαγραφή, lock, αλλαγή χρώματος πολλών | Μεσαία |
| B15 | **Toggle ορατότητας** | Κουμπί εμφάνισης/απόκρυψης ΟΛΩΝ των οδηγών (χωρίς διαγραφή) | ⭐ Υψηλή |
| B16 | **Οδηγός σε γωνία** | Κλικ + γωνία (π.χ. 45°) → λοξός οδηγός χωρίς 3 κλικ | Μεσαία |
| B17 | **Copy/Offset pattern** | Αντιγραφή ομάδας οδηγών με μετατόπιση | Μεσαία |
| B18 | **Coordinate labels** | Labels δίπλα στα X markers (x=5.00, z=3.00) — toggle | Χαμηλή |

### 4.4 Αλληλεπίδραση με Υφιστάμενες Οντότητες (Γιώργος ✅)

> Ιδέα Γιώργου: κλικ σε **οποιαδήποτε υφιστάμενη οντότητα** (γραμμή, τόξο, κύκλος) → popup → επιλογή δημιουργίας οδηγών/σημείων.

#### Για ευθύγραμμα τμήματα (γραμμές, polylines):

| Ενέργεια | Περιγραφή |
|----------|-----------|
| **Snap points κατά μήκος** | Κλικ σε γραμμή → popup "Πλήθος σημείων" → X markers ισαπέχοντα πάνω στην οντότητα |
| **Οδηγός ίδιου μήκους** | Δημιουργία γραμμής-οδηγού ακριβώς πάνω στη γραμμή (ίδιο μήκος) |
| **Οδηγός με επέκταση** | Ίδια κατεύθυνση αλλά **απεριόριστο μήκος** — η γραμμή επεκτείνεται και στις δύο πλευρές |

#### Για κύκλους:

| Ενέργεια | Περιγραφή |
|----------|-----------|
| **Snap points στην περιφέρεια** | Κλικ σε κύκλο → popup "Πλήθος σημείων" → X markers ισαπέχοντα στην περιφέρεια |
| **Ακτινικοί οδηγοί** | Γραμμές-οδηγοί **από το κέντρο** → περνούν από την περιφέρεια → **επεκτείνονται πολύ μακριά** |

#### Για τόξα:

| Ενέργεια | Περιγραφή |
|----------|-----------|
| **Snap points στο τόξο** | Κλικ σε τόξο → popup "Πλήθος σημείων" → X markers πάνω στο τόξο |
| **Ακτινικοί οδηγοί** | Γραμμές από κέντρο τόξου → περνούν από σημεία στο τόξο → επεκτείνονται |

#### Για ορθογώνια (rectangles/polylines):

| Ενέργεια | Περιγραφή |
|----------|-----------|
| **Snap points ανά πλευρά** | Υποδιαίρεση κάθε πλευράς σε N σημεία |
| **Οδηγοί ανά πλευρά** | Γραμμές-οδηγοί πάνω σε κάθε πλευρά με απεριόριστη επέκταση |

**Κοινή αρχή**: Ο χρήστης κάνει κλικ σε **οποιαδήποτε** υφιστάμενη οντότητα → popup με επιλογές → δημιουργεί snap points ή/και γραμμές-οδηγούς **πάνω στην οντότητα** ή **επεκτεινόμενες** από αυτή.

### 4.5 Εγκεκριμένες Βελτιώσεις — Γύρος 3 (Γιώργος ✅)

| # | Βελτίωση | Περιγραφή | Προτεραιότητα |
|---|----------|-----------|---------------|
| B19 | **Symmetric/Mirror guides** | Άξονας συμμετρίας → οι οδηγοί αντικατοπτρίζονται αυτόματα | Μεσαία |
| B20 | **Guide Undo/Redo** | Ctrl+Z αναιρεί τελευταίο οδηγό, Ctrl+Y επαναφέρει | ⭐ Υψηλή |
| B21 | **Snap priority** | Ρύθμιση προτεραιότητας: τομές > endpoints > midpoints | Χαμηλή |
| B22 | **Right-click context menu** | Δεξί κλικ σε οδηγό → Lock, Delete, Color, Properties, Add Points | ⭐ Υψηλή |

### 4.6 Πάρε/Δώσε Παραμέτρους — Property Eyedropper (ΚΕΝΤΡΙΚΟΠΟΙΗΜΕΝΟ)

> Ιδέα Γιώργου, εμπνευσμένη από τον Τέκτονα (εικονίδια "σύριγγας").
> **ΣΗΜΑΝΤΙΚΟ**: Αυτή η λειτουργία θα είναι **γενική κεντρικοποιημένη** σε ολόκληρη την εφαρμογή, ΟΧΙ μόνο στους οδηγούς.

| Εντολή | Εικονίδιο | Workflow |
|--------|-----------|---------|
| **Πάρε Παραμέτρους** | Σύριγγα (αναρρόφηση) | Κλικ σε entity → αντιγράφονται οι ιδιότητές του (χρώμα, πάχος, layer, στυλ...) |
| **Δώσε Παραμέτρους** | Σύριγγα (έγχυση) | Κλικ σε target entity → εφαρμόζονται οι αποθηκευμένες ιδιότητες |

**Πιθανές παράμετροι (TBD — χρειάζεται ξεχωριστό ADR):**
- Χρώμα γραμμής / γέμισμα
- Πάχος γραμμής
- Στυλ γραμμής (solid, dashed, dotted)
- Layer assignment
- Font / μέγεθος κειμένου
- Ιδιότητες οδηγών (αν εφαρμοστεί σε guides)

**→ Θα δημιουργηθεί ξεχωριστό ADR για το Property Eyedropper System**

### 4.7 Εγκεκριμένες Βελτιώσεις — Γύρος 4 (Γιώργος ✅)

| # | Βελτίωση | Περιγραφή | Προτεραιότητα |
|---|----------|-----------|---------------|
| B23 | **Structural presets** | Προκαθορισμένα πλέγματα μηχανικού (ανά 4μ, 5μ, 6μ, 8μ — τυπικά ανοίγματα) | Μεσαία |
| B24 | **Offset from entity edge** | Οδηγός σε ακριβή απόσταση από ακμή οντότητας (π.χ. 10cm από τοίχο) | Μεσαία |
| B25 | **Intersection table** | Πίνακας συντεταγμένων ΟΛΩΝ των σημείων τομής — exportable | Χαμηλή |
| B26 | **Export coordinates** | Εξαγωγή σε CSV/Excel για τοπογράφους/εργοτάξιο | Χαμηλή |
| B27 | **Import coordinates** | Εισαγωγή από τοπογράφο → αυτόματη δημιουργία οδηγών | Χαμηλή |

### 4.8 Περιστροφή Οδηγών (Γιώργος ✅)

> Κρίσιμη λειτουργία — σε πραγματικά projects τα κτίρια σπάνια ευθυγραμμίζονται με τους άξονες X/Y.

| # | Βελτίωση | Περιγραφή | Προτεραιότητα |
|---|----------|-----------|---------------|
| B28 | **Περιστροφή μεμονωμένου οδηγού** ✅ | Επιλογή οδηγού → ορισμός κέντρου περιστροφής → γωνία (PromptDialog keyboard) → X/Y→XZ μετατροπή | ✅ Υλοποιήθηκε |
| B29 | **Περιστροφή ομάδας οδηγών** ✅ | Click guides → toggle selection → click empty → PromptDialog γωνία → `RotateGuideGroupCommand` | ✅ Υλοποιήθηκε |
| B30 | **Περιστροφή ολόκληρου κάνναβου** ✅ | 1-click pivot → PromptDialog γωνία → RotateAllGuidesCommand σε ΟΛΟΥΣ τους visible/unlocked οδηγούς | ✅ Υλοποιήθηκε |

**Workflow περιστροφής μεμονωμένης (B28):**
1. Επιλογή οδηγού (κλικ)
2. "Ορίστε κέντρο περιστροφής" → κλικ σε σημείο (snap-enabled)
3. **Δύο τρόποι**: (α) πληκτρολόγηση γωνίας + Enter, ή (β) drag με real-time preview
4. Ο οδηγός περιστρέφεται — ο κατακόρυφος γίνεται λοξός κ.λπ.

**Workflow περιστροφής ολόκληρου κάνναβου (B30):**
1. Εντολή "Περιστροφή Κάνναβου"
2. "Ορίστε κέντρο περιστροφής" → κλικ
3. Γωνία (keyboard ή drag) → ΟΛΟΣ ο κάνναβος περιστρέφεται
4. **Use case**: Κτίριο υπό γωνία 15° στο οικόπεδο → grid rotation 15° → οδηγοί ευθυγραμμίζονται με τους τοίχους

### 4.9 Πρόσθετες Ιδέες (προς συζήτηση)

| # | Βελτίωση | Περιγραφή | Προτεραιότητα |
|---|----------|-----------|---------------|
| B31 | **Polar array οδηγών** ✅ | 1-click center → PromptDialog count → `PolarArrayGuidesCommand` → N XZ guides at 360°/N intervals (±10000 extent) | ✅ Υλοποιήθηκε |
| B32 | ✅ **Κλιμάκωση κάνναβου (Scale)** | Αλλαγή κλίμακας ολόκληρου grid — μεγέθυνση/σμίκρυνση | Μεσαία |
| B33 | **Smart equalize** ✅ | 3+ same-axis guides → `EqualizeGuidesCommand` → ισαπόσταση (κρατάει first/last, redistributes intermediates) | ✅ Υλοποιήθηκε |
| B34 | **Guide constraints** | Παραμετρική σχέση: "πάντα 5μ μεταξύ τους" | Χαμηλή |
| B35 | **Construction line (XLINE)** | Προσωρινή γραμμή — αυτο-διαγράφεται μετά σχεδίαση entity | Μεσαία |
| B36 | **Measure → Guide** ✅ | Μετά μέτρηση: notification με "Create Guides" button → αυτόματη δημιουργία X/Y οδηγών στα σημεία μέτρησης | ⭐ Υψηλή |
| B37 | **Guide from selection** | Πολλά entities → αυτόματοι οδηγοί στις ακμές/κέντρα | Μεσαία |
| B38 | **Custom labels** | Ελεύθερο κείμενο σε οδηγό: "Φέρων τοίχος" | Μεσαία |

### 4.10 Context-Aware Guides — Έξυπνοι Οδηγοί Βάσει Γεωμετρίας (Γιώργος ✅)

> Ιδέα Γιώργου: Οι οδηγοί **καταλαβαίνουν** τη γεωμετρία — δημιουργούνται βάσει υφιστάμενων σχημάτων.

#### B39 — Περιμετρικοί Οδηγοί (Perimeter Offset Guides)

Επιλογή κλειστού σχήματος (π.χ. 4 τοίχοι = δωμάτιο) → δημιουργία οδηγών:

| Επιλογή | Workflow |
|---------|---------|
| **Εξωτερικά περιμετρικά** | Οδηγοί σε **offset εξωτερικά** — απόσταση ορίζεται με πληκτρολόγιο |
| **Εσωτερικά περιμετρικά** | Οδηγοί σε **offset εσωτερικά** — απόσταση ορίζεται με πληκτρολόγιο |
| **Αμφίπλευρα** | Και εξωτερικά και εσωτερικά — διαφορετικές αποστάσεις |

**Use case**: 4 τοίχοι δωματίου → "βάλε κάνναβο 10cm εξωτερικά" → οδηγοί για ακρυλικό/μόνωση.

#### B40 — Υποδιαίρεση Τοίχου (Wall Subdivision Guides)

Κλικ σε ορθογώνιο στοιχείο (τοίχος 25cm × 5.50μ) → **κάθετοι μικροί οδηγοί εντός**:

| Βήμα | Ενέργεια |
|------|----------|
| 1 | Κλικ στον τοίχο (ορθογώνιο) |
| 2 | Popup: "Απόσταση μεταξύ οδηγών" (π.χ. 50cm) ή "Αρχή από:" (κλικ ή αρχή τοίχου) |
| 3 | Δημιουργούνται **μικρές κάθετες γραμμές** ανάμεσα στις 2 μεγάλες παράλληλες πλευρές |
| 4 | Οι μικροί οδηγοί ξεκινούν από το αρχικό σημείο με σταθερό βήμα |

**Use case**: Τοίχος 5.50μ → υποδιαίρεση ανά 50cm → 11 κάθετοι οδηγοί εντός τοίχου → θέσεις σιδηροπλισμού ή θέσεις πλίνθων.

### 4.11 Πρόσθετες Ιδέες (προς συζήτηση)

| # | Βελτίωση | Περιγραφή |
|---|----------|-----------|
| B41 | **Κέντρο δωματίου** | Επιλογή ορίων δωματίου → αυτόματος οδηγός στο **κέντρο βάρους** (centroid) |
| B42 | **Διχοτόμος γωνίας** | 2 τεμνόμενοι οδηγοί → αυτόματος οδηγός στη **διχοτόμο** της γωνίας |
| B43 | **Εφαπτομένη** | Οδηγός εφαπτόμενος σε κύκλο/τόξο σε συγκεκριμένο σημείο |
| B44 | **Extension guide** | Η οντότητα τελειώνει → ο οδηγός **συνεχίζει** στην ίδια κατεύθυνση (άπειρα) |
| B45 | **Grid from boundary** | Επιλογή κλειστού πολυγώνου → γέμισμα με πλέγμα σε ορισμένο spacing |
| B46 | **Parametric grid** | Μεταβλητές: a=5μ, b=3μ → αλλαγή a=6μ → αυτόματη ενημέρωση πλέγματος |
| B47 | **Snap σε κλάσματα** | Snap στο 1/3, 1/4, 1/5 σημείο μεταξύ δύο οδηγών |
| B48 | **Guide heatmap** | Χρωματική ένδειξη πυκνότητας — όπου υπάρχουν πολλοί οδηγοί κοντά → αχνό highlight |

### 4.12 Σύστημα Χρωματικής Απόδοσης Οδηγών (Visual Rendering System)

> Κρίσιμο για τη χρηστικότητα: ο χρήστης πρέπει να **ξεχωρίζει αμέσως** τον τύπο, την ομάδα, και την κατάσταση κάθε οδηγού.

#### Α. Χρωματική Ιεραρχία ανά Τύπο Οδηγού

| Τύπος | Προτεινόμενο Στυλ | Πάχος | Αδιαφάνεια |
|-------|-------------------|-------|------------|
| **Οδηγός X/Z** (άπειροι) | Solid, muted χρώμα | 0.5px | 30-40% |
| **Οδηγός XZ** (πεπερασμένος) | Dashed `[6, 3]` | 0.5px | 35-45% |
| **Κάθετη** (σε υφιστάμενη) | Dot-dash `[4, 2, 1, 2]` | 0.5px | 30-40% |
| **Παράλληλοι** | Solid, ίδιο χρώμα με parent | 0.5px | 25-35% |
| **Snap points (X)** | Solid X marker | 3-4px | 50-60% |
| **Construction lines** (B35) | Πολύ αχνό, dotted `[2, 4]` | 0.3px | 15-25% |
| **Ακτινικοί** (B9/B31) | Dash `[8, 4]` | 0.5px | 30-40% |

#### Β. Χρωματική Ιεραρχία ανά Ομάδα (Group)

| Ομάδα | Default Χρώμα | Hex | Χρήση |
|-------|---------------|-----|-------|
| **Δομικός Κάνναβος** | Γαλάζιο (Cyan) | `#00BCD4` | Κύρια δομικά στοιχεία |
| **Αρχιτεκτονικός** | Πορτοκαλί (Amber) | `#FFB300` | Αρχιτεκτονικές γραμμές |
| **MEP / Η-Μ** | Πράσινο (Teal) | `#26A69A` | Ηλεκτρομηχανολογικά |
| **Βοηθητικός** | Γκρι (Neutral) | `#9E9E9E` | Πρόχειροι / προσωρινοί |
| **Custom Group** | Επιλογή χρήστη | User color picker | Ελεύθερα |

**Σημαντικό**: Κάθε ομάδα χρησιμοποιεί **τόσο χρώμα ΟΣΟ και dash pattern** → color-blind friendly.

#### Γ. Οπτική Κατάσταση (Visual States)

| Κατάσταση | Εμφάνιση | Πότε |
|-----------|----------|------|
| **Normal** | Βασικό χρώμα + λεπτή | Ανενεργός οδηγός |
| **Hover** | Φωτεινότερο + ελαφρώς παχύτερο (0.5→1px) | Σταυρόνημα κοντά |
| **Selected** | Highlight χρώμα + πάχος 1.5px + glow | Επιλεγμένος |
| **Locked** | Muted + εικονίδιο κλειδαριάς | Κλειδωμένος (B4) |
| **Dragging** | Dynamic preview + dashed | Κατά τη μετακίνηση (B5) |
| **Creating** | Animated dashes (marching ants) | Κατά τη δημιουργία |

#### Δ. Δυναμική Αδιαφάνεια βάσει Zoom

| Zoom Level | Αδιαφάνεια Οδηγών | Λόγος |
|------------|-------------------|-------|
| Πολύ μακριά (< 20%) | 15-20% | Δεν εμποδίζουν τη γενική εικόνα |
| Κανονικό (20-200%) | 30-40% | Ισορροπία ορατότητας |
| Κοντινό (> 200%) | 20-30% | Δεν κρύβουν τις λεπτομέρειες entities |

**Αρχή**: Οι οδηγοί **δεν κυριαρχούν ποτέ** — πάντα δευτερεύοντες οπτικά.

#### Ε. Θέματα (Dark / Light Canvas)

| Canvas | Οδηγοί | Snap Points |
|--------|--------|-------------|
| **Dark background** | Ανοιχτά χρώματα (cyan, pale blue, light green) | Λευκά X/+ markers |
| **Light background** | Σκούρα χρώματα (dark blue, dark green, gray) | Σκούρα X/+ markers |

#### ΣΤ. Νέες Βελτιώσεις Rendering (προς συζήτηση)

| # | Βελτίωση | Περιγραφή |
|---|----------|-----------|
| B49 | **Color theme presets** | Έτοιμα χρωματικά πακέτα: "Structural", "Architecture", "MEP" |
| B50 | **Guide Layer Panel** | Πάνελ σαν Photoshop layers: show/hide/lock/color ανά ομάδα |
| B51 | **Gradient fade** | Οι "άπειροι" οδηγοί ξεθωριάζουν (fade out) στα άκρα του viewport |
| B52 | **Animated creation** | Κατά τη δημιουργία: "marching ants" animation στη γραμμή |
| B53 | **Dash pattern per type** | Κάθε τύπος οδηγού έχει **μοναδικό** dash pattern (ξεχωρίζει ακόμα χωρίς χρώμα) |
| B54 | **Σταθερό pixel-size** | Οδηγοί πάντα 0.5px ανεξαρτήτως zoom — δεν παχαίνουν/λεπταίνουν |
| B55 | **Print style override** | Κατά εκτύπωση: option να συμπεριληφθούν ως ελαφρύ γκρι dashed |

---

## 7. Ανάλυση Κεντρικοποίησης

> Ποια συστήματα πρέπει να υλοποιηθούν **κεντρικοποιημένα** ώστε να ωφελούν και άλλα σημεία του DXF Viewer.

### 7.1 ΠΡΕΠΕΙ να κεντρικοποιηθούν (ωφελούν πολλά σημεία)

| # | Σύστημα | Ωφελεί | Τρέχουσα κατάσταση |
|---|---------|--------|--------------------|
| C1 | **Guide Rendering Engine** | Οδηγοί, Color Layers, Annotations, Dimensions | Κάθε overlay σχεδιάζει μόνο του — χρειάζεται ενιαίο rendering pipeline |
| C2 | **Property Eyedropper** (§4.6) | ΟΛΕΣ οι οντότητες + οδηγοί + color layers | ΔΕΝ υπάρχει — νέο κεντρικό σύστημα |
| C3 | **Visual State Machine** (hover/select/drag/lock) | Οδηγοί, DXF entities, Color Layer polygons, Grips | Μερικώς υπάρχει (grips) — χρειάζεται γενίκευση |
| C4 | **Layer Management Panel** (B50) | DXF layers, Color Layers, Guide groups | Υπάρχει για DXF + Color Layers — χρειάζεται extension |
| C5 | **Keyboard Shortcut Registry** (B13) | Οδηγοί, Drawing tools, Snap, Zoom, Navigation | Μερικώς υπάρχει — χρειάζεται registry pattern |
| C6 | **Context Menu System** (B22) | Οδηγοί, DXF entities, Color Layers, Canvas | Υπάρχει (EntityContextMenu) — χρειάζεται extension |
| C7 | **Undo/Redo Stack** (B20) | Οδηγοί, Drawing, Entity edits, Color Layers | ΔΕΝ υπάρχει καθολικά — νέο κεντρικό σύστημα |
| C8 | **Snap Integration** (guide snap points) | Ήδη κεντρικοποιημένο (ProSnapEngineV2) | ✅ Υπάρχει — χρειάζεται extension για guide snap type |

### 7.2 ΜΠΟΡΟΥΝ να κεντρικοποιηθούν (προαιρετικά)

| # | Σύστημα | Ωφελεί | Σημείωση |
|---|---------|--------|----------|
| C9 | **Coordinate Import/Export** (B26/B27) | Οδηγοί, DXF entities, Survey data | Μελλοντικό — δεν είναι urgent |
| C10 | **Measurement/Dimension Engine** (B3) | Οδηγοί, Entity dimensions, Area calc | Μερικώς υπάρχει — extensible |
| C11 | **Constraint Engine** (B34) | Οδηγοί, Parametric entities | Πολύ advanced — Phase 3+ |
| C12 | **Multi-select + Batch Operations** (B14) | Οδηγοί, DXF entities, Color Layers | Μερικώς υπάρχει (marquee) — extend |

### 7.3 ΜΕΝΟΥΝ ειδικά του Guide System (δεν κεντρικοποιούνται)

| Σύστημα | Λόγος |
|---------|-------|
| Guide Data Model (οδηγοί, snap points) | Ειδικό του κάνναβου |
| Guide Toolbar / Menu | Ειδικό UI |
| Περιμετρικοί / Wall subdivision (B39/B40) | Ειδική γεωμετρική λογική |
| Structural presets (B23) | Domain-specific |
| Axis Labels + Bubbles (B1) | Ειδικό rendering |

### 7.4 Σύνοψη Κεντρικοποίησης

```
                    ┌─────────────────────────────┐
                    │   ΚΕΝΤΡΙΚΟΠΟΙΗΜΕΝΑ ΣΥΣΤΗΜΑΤΑ │
                    └──────────┬──────────────────┘
                               │
          ┌────────────────────┼─────────────────────┐
          │                    │                      │
    ┌─────▼──────┐    ┌───────▼────────┐    ┌───────▼────────┐
    │  Rendering │    │  Interaction   │    │    Data        │
    │  Engine    │    │  Engine        │    │    Engine      │
    ├────────────┤    ├────────────────┤    ├────────────────┤
    │ C1 Render  │    │ C3 State Mach. │    │ C7 Undo/Redo  │
    │ C4 Layers  │    │ C5 Shortcuts   │    │ C8 Snap Ext.  │
    │ Colors     │    │ C6 Context Menu│    │ C9 Import/Exp │
    │ Dash patt. │    │ C2 Eyedropper  │    │ C11 Constraints│
    │ Opacity    │    │ C12 Multi-sel. │    │               │
    └─────┬──────┘    └───────┬────────┘    └───────┬────────┘
          │                   │                      │
          └───────────────────┼──────────────────────┘
                              │
          ┌───────────────────┼───────────────────────┐
          │                   │                        │
    ┌─────▼──────┐    ┌──────▼──────┐    ┌────────────▼─┐
    │  GUIDES    │    │  DXF        │    │  COLOR       │
    │  SYSTEM    │    │  ENTITIES   │    │  LAYERS      │
    │  (ADR-189) │    │  (existing) │    │  (existing)  │
    └────────────┘    └─────────────┘    └──────────────┘
```

### 7.5 Extended Centralized Systems — AI/3D/Cloud (C14-C20)

> Βάσει industry research (Autodesk, Bentley, Trimble, Graphisoft) και τάσεων ConTech.
> Επεκτείνουν τα C1-C13 για AI, 3D rendering, collaboration, και plugin extensibility.

| # | Σύστημα | Ωφελεί | Σημείωση |
|---|---------|--------|----------|
| **C14** | **AI Integration Layer** | Guides, Entities, Layouts | Hooks για ML models (TensorFlow.js, cloud APIs). Headless API για AI agents. |
| **C15** | **3D Rendering Pipeline** | Guides, DXF, Hatches | Μετάβαση 2D→3D rendering. WebGL/Three.js abstraction. |
| **C16** | **Collaboration Engine** | Ολα τα shared features | Real-time co-editing via WebSockets. Conflict resolution (CRDT). |
| **C17** | **Simulation Interface** | Guides, Energy/Materials | API σε external sim tools (EnergyPlus, structural analysis). |
| **C18** | **AR/VR Exporter** | Guides, Models | Export σε Unity/UE4 compatible formats. Spatial anchors. |
| **C19** | **Data Validation Engine** | Grids, Constraints | ML-based checks + building code validation. |
| **C20** | **Modular Plugin System** | Όλα | Plugin API για custom extensions τρίτων. |

### 7.6 Global Market Systems (C21-C25)

> Νέα systems για 5G/IoT, Robotics, EU Compliance, Metaverse, Quantum readiness.

| # | Σύστημα | Ωφελεί | Σημείωση |
|---|---------|--------|----------|
| **C21** | **5G/IoT Integration Layer** | Guides, Sites | Real-time data από 5G smart sites (CSCEC pattern). Sensor feeds → grid updates. |
| **C22** | **Robotics Export Engine** | BIM, Grids | Robot paths, G-code, waypoints. Cobots, drones, humanoids. |
| **C23** | **EN Compliance Validator** | Όλα | Auto-check vs EN ISO 19650, CEN/TC 442, DIN/VOB. Country-specific rules. |
| **C24** | **Metaverse Pipeline** | Rendering | Export σε Unity/UE5, VR walkthroughs, haptic integration. |
| **C25** | **Quantum API Wrapper** | Optimization | Hooks για quantum computing σε μελλοντικές βελτιστοποιήσεις. |

> **Σύνολο**: C1-C25 = **25 κεντρικοποιημένα συστήματα**.

**Updated Centralization Diagram:**

```
                    ┌─────────────────────────────────┐
                    │   ΚΕΝΤΡΙΚΟΠΟΙΗΜΕΝΑ ΣΥΣΤΗΜΑΤΑ     │
                    │      C1-C13 + C14-C20            │
                    └──────────┬──────────────────────┘
                               │
       ┌───────────────────────┼────────────────────────┐
       │                       │                         │
 ┌─────▼──────┐    ┌──────────▼──────────┐    ┌────────▼────────┐
 │  Rendering │    │    Interaction      │    │     Data        │
 │  Engine    │    │    Engine           │    │     Engine      │
 ├────────────┤    ├─────────────────────┤    ├─────────────────┤
 │ C1 Render  │    │ C3 State Machine   │    │ C7 Undo/Redo   │
 │ C4 Layers  │    │ C5 Shortcuts       │    │ C8 Snap Ext.   │
 │ C15 3D     │    │ C6 Context Menu    │    │ C9 Import/Exp  │
 │ Pipeline   │    │ C2 Eyedropper      │    │ C11 Constraints│
 │            │    │ C12 Multi-sel.     │    │ C19 Validation │
 └─────┬──────┘    └──────────┬──────────┘    └────────┬────────┘
       │                      │                         │
       └──────────────────────┼─────────────────────────┘
                              │
       ┌──────────────────────┼─────────────────────────┐
       │                      │                          │
 ┌─────▼──────┐    ┌─────────▼─────────┐    ┌──────────▼──────┐
 │   NEW      │    │   CROSS-CUTTING   │    │   ECOSYSTEM     │
 │   LAYER    │    │   SERVICES        │    │   SERVICES      │
 ├────────────┤    ├───────────────────┤    ├─────────────────┤
 │ C14 AI     │    │ C16 Collab.      │    │ C18 AR/VR Exp. │
 │ Integration│    │ C17 Simulation   │    │ C20 Plugin Sys. │
 │ Layer      │    │ C13 Auto-Dim.    │    │                 │
 └─────┬──────┘    └────────┬──────────┘    └────────┬────────┘
       │                    │                         │
       └────────────────────┼─────────────────────────┘
                            │
       ┌────────────────────┼─────────────────────────┐
       │                    │                          │
 ┌─────▼──────┐    ┌───────▼──────┐    ┌──────────────▼─┐
 │  GUIDES    │    │  DXF         │    │  COLOR         │
 │  SYSTEM    │    │  ENTITIES    │    │  LAYERS        │
 │  (ADR-189) │    │  (existing)  │    │  (existing)    │
 └────────────┘    └──────────────┘    └────────────────┘
```

### 4.13 UI: Floating Panel με Tabs (Γιώργος ✅)

> Με 55+ features, χρειάζεται σωστή οργάνωση UI χωρίς clutter.

**Αρχιτεκτονική 3 επιπέδων** (Figma/Photoshop/Blender pattern):

#### Επίπεδο 1: Floating Panel (κύρια πρόσβαση)
- Εμφανίζεται **μόνο** όταν ενεργοποιείται ο κάνναβος
- Draggable, minimizable, dockable στο πλάι
- Εξαφανίζεται όταν κλείνει ο κάνναβος
- **5 tabs**:
  - **Βασικά**: Οδηγός X/Z/XZ, Κάθετη, Παράλληλοι, Αυτόματο Πλέγμα
  - **Σημεία**: Σε Τμήματα, Ανά Απόσταση, Τομές, Προσθήκη/Διαγραφή
  - **Entity**: Από Οντότητα, Περιμετρικοί, Υποδιαίρεση, Extension
  - **Transform**: Μετακίνηση, Περιστροφή, Scale, Mirror, Copy/Offset
  - **⚙ Ρυθμίσεις**: Χρώματα, Groups, Αδιαφάνεια, Dash, Themes

#### Επίπεδο 2: Right-click Context Menu (γρήγορη πρόσβαση)
- Δεξί κλικ σε **οδηγό** → Lock, Delete, Color, Rotate, Properties
- Δεξί κλικ σε **entity** → Οδηγός πάνω στο entity, Snap points κατά μήκος

#### Επίπεδο 3: Keyboard Shortcuts (power users)
- G = Toggle panel, G+X = Οδηγός X, G+Z = Οδηγός Z
- G+P = Παράλληλοι, G+V = Toggle ορατότητας, Ctrl+Z = Undo

### 4.14 Σχέση με Hatches (Γραμμοσκιάσεις) — Μελλοντική Πρόβλεψη

> Ο Γιώργος ρώτησε: πρέπει να προβλέψουμε τώρα κάτι για hatches (σιδηροπλισμός, πλακάκια);

**Απόφαση**: Guides και Hatches = **ξεχωριστά συστήματα**, αλλά με **κοινή υποδομή**.

| | Κάνναβος (Guides) | Hatches (Γραμμοσκιάσεις) |
|--|-------------------|--------------------------|
| **Σκοπός** | Βοηθητική γεωμετρία — ΔΕΝ αντιπροσωπεύει φυσικό στοιχείο | Αναπαράσταση **πραγματικού** pattern (σιδηροπλισμός, πλακάκια, μπετόν) |
| **Εμφάνιση** | Λεπτές αχνές γραμμές | Pattern fill σε κλειστό boundary |
| **Εκτύπωση** | ❌ ΟΧΙ | ✅ ΝΑΙ — εμφανίζεται στα σχέδια |
| **ADR** | ADR-189 (αυτό) | Ξεχωριστό ADR (μελλοντικό) |

**Κοινή υποδομή που πρέπει να προβλέψουμε ΤΩΡΑ:**

| Shared System | Πώς βοηθάει Guides | Πώς βοηθάει Hatches |
|---------------|--------------------|--------------------|
| **Rendering Engine (C1)** | Σχεδιάζει γραμμές/dash | Σχεδιάζει patterns/fills |
| **Snap Integration (C8)** | Guide snap points | Hatch origin alignment |
| **Subdivision Logic** | "Σε Τμήματα" / "Ανά Απόσταση" | Tile layout spacing |
| **Boundary Detection** | Περιμετρικοί οδηγοί (B39) | Hatch boundary selection |

**Παραδείγματα αλληλεπίδρασης:**
- Σχεδιάζεις πλάκα → βάζεις **οδηγούς** ανά 15cm → μετά εφαρμόζεις **hatch σιδηροπλισμού** πάνω στους οδηγούς
- Σχεδιάζεις δάπεδο → βάζεις **οδηγούς υποδιαίρεσης** → μετά εφαρμόζεις **hatch πλακακιών** 60×60cm
- Ο κάνναβος **βοηθάει** στην τοποθέτηση — το hatch **δείχνει** το αποτέλεσμα

**→ Θα δημιουργηθεί ξεχωριστό ADR για Hatch/Pattern System όταν φτάσουμε εκεί**

### 4.15 Μελλοντική Αλυσίδα: Κάνναβος → Hatches → Smart Layouts

> Ο Γιώργος ρώτησε: θα χρησιμεύει ο κάνναβος για αυτοματισμούς τοποθέτησης (π.χ. είδη υγιεινής σε μπάνιο);
> **Απάντηση: ΝΑΙ** — ο κάνναβος είναι το **θεμέλιο** μιας αλυσίδας 3 επιπέδων.

**Αλυσίδα εξάρτησης:**

| Επίπεδο | Σύστημα | ADR | Κατάσταση |
|---------|---------|-----|-----------|
| 1 | **Κάνναβος** (οδηγοί, snap, subdivision) | ADR-189 | ← ΤΩΡΑ |
| 2 | **Hatches/Patterns** (πλακάκια, σιδηροπλισμός) | TBD | Μελλοντικό |
| 3 | **Smart Layouts** (αυτοματισμοί τοποθέτησης) | TBD | Μελλοντικό |

**Smart Layouts — τι θα χρειαστεί (υψηλό επίπεδο):**
- **Block Library**: Βιβλιοθήκη symbols (νιπτήρας, λεκάνη, ντουζιέρα, μπανιέρα, κρεβάτι, πάγκος κ.λπ.)
- **Placement Rules**: Κανόνες τοποθέτησης (ελάχιστες αποστάσεις, building codes, accessibility)
- **Room Type Recognition**: Αναγνώριση τύπου δωματίου (μπάνιο, κουζίνα, υπνοδωμάτιο)
- **Optimization**: Αλγόριθμος βέλτιστης τοποθέτησης βάσει διαστάσεων δωματίου

**Τι πρέπει να προβλέψουμε ΤΩΡΑ στον κάνναβο:**
- Το **Rendering Engine (C1)** πρέπει να μπορεί να σχεδιάζει blocks/symbols (μελλοντικά)
- Η **υποδιαίρεση χώρου** (B40) πρέπει να επιστρέφει ζώνες (π.χ. "υγρή ζώνη" / "στεγνή ζώνη")
- Οι **περιμετρικοί οδηγοί** (B39) πρέπει να υποστηρίζουν ελάχιστα offsets (building codes)
- Τα **snap points** πρέπει να είναι extensible ώστε blocks να "κουμπώνουν" σε αυτά

### 4.16 Πρόβλεψη για 3D

> Ο Γιώργος ρώτησε: αν αργότερα θέλουμε 3D (όψεις τοίχων, φωτιστικά, μπρίζες, υδραυλικά), πρέπει να προβλέψουμε τώρα;
> **Απάντηση: ΝΑΙ** — ελάχιστες αλλαγές τώρα, μεγάλο κέρδος αργότερα.

**Τι πρέπει να κάνουμε ΤΩΡΑ (χωρίς να χτίσουμε 3D):**

| Πρόβλεψη | Υλοποίηση | Κέρδος |
|----------|-----------|--------|
| **Coordinates** | `{x: number; y: number; z?: number}` αντί `{x, y}` | Ίδιο data model σε 2D και 3D |
| **Rendering** | Αφαιρετικό interface (IRenderEngine) | Swap Canvas 2D → WebGL/Three.js χωρίς rewrite |
| **Plane-awareness** | Κάθε κάνναβος ανήκει σε plane (XY/XZ/YZ) | Κάνναβος σε κάτοψη (XY) ΚΑΙ σε όψη τοίχου (XZ) |
| **Snap** | Dimension-agnostic engine | Snap σε 2D κάτοψη ΚΑΙ σε 3D elevation |

**Μελλοντικά use cases 3D κάνναβου:**
- Όψη τοίχου: οδηγοί για θέσεις ανοιγμάτων (πόρτες/παράθυρα)
- Όψη τοίχου: οδηγοί για ηλεκτρολογικά (μπρίζες, διακόπτες, φωτιστικά)
- Κάτοψη: οδηγοί για υδραυλικά (σωληνώσεις στο δάπεδο)
- Τομή: οδηγοί για ύψη δοκών, πλακών

### 4.17 Αυτόματη Τοποθέτηση Διαστάσεων — ΚΕΝΤΡΙΚΟΠΟΙΗΜΕΝΟ

> Ο Γιώργος ρώτησε: η αυτόματη μέτρηση/τοποθέτηση διαστάσεων μπορεί να χρησιμοποιηθεί αλλού;
> **Απάντηση: ΝΑΙ** — πρέπει να γίνει κεντρικοποιημένο σύστημα (νέο C-system).

**Auto-Dimensioning Engine (C13)** — χρησιμεύει σε:

| Χρήση | Παράδειγμα |
|-------|-----------|
| Μεταξύ οδηγών (B3) | "5.00μ" μεταξύ αξόνων κάνναβου |
| Μεταξύ entities | Τοίχος-τοίχος, πόρτα-παράθυρο |
| Floor plans | Αυτόματες διαστάσεις δωματίων |
| Elevations (3D) | Ύψος ανοιγμάτων, θέσεις μπριζών |
| MEP | Αποστάσεις σωληνώσεων |

**→ Θα δημιουργηθεί ξεχωριστό ADR για Auto-Dimensioning System**

### 4.18 Extended Enhancements — Industry Research & AI Readiness (B56-B93)

> Βασισμένο σε έρευνα αγοράς CAD/BIM (Autodesk, Trimble, Bentley, Graphisoft, McNeel, Dassault)
> και τάσεις κατασκευαστικών εταιρειών (Skanska, Bechtel, AECOM, Vinci, Bouygues).
> Στόχος: **Future-proof & AI-ready** — η υποδομή πρέπει να τις υποστηρίζει από τον σχεδιασμό.

#### 4.18.1 AI & Machine Learning (Υψηλή Προτεραιότητα)

API hooks για ML models (TensorFlow.js ή cloud APIs). Headless API ανεξάρτητο UI.

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B56** | AI Auto-Grid Generation | Αυτόματη δημιουργία πλέγματος βάσει ανάλυσης DXF (detect walls → suggest spacing). Input: "Optimize for concrete slab". | Autodesk Dreamcatcher, Grasshopper |
| **B57** | Predictive Snap Suggestions | ML προβλέπει επόμενα snap points βάσει ιστορικού χρήστη (π.χ. "συχνά 4m spacing"). | Revit Dynamo AI extensions |
| **B58** | Anomaly Detection | Scan grids για errors (uneven spacing, clashes) — προτείνει fixes. | Tekla AI clash detection |
| **B59** | Generative Variants | Πολλαπλά grid layouts (3-5 variants) βάσει constraints (loads, terrain, cost). | Bentley Generative Components |
| **B60** | Natural Language Input | "Φτιάξε κάνναβο 5x5μ για κτίριο 20x30, αξόνες Α-Δ / 1-5" → auto-generate. | NLP/LLM integration |
| **B61** | Learning from User Edits | ML μαθαίνει από manual adjustments → αυτόματα update global presets. | ArchiCAD ML pilots |

**Υποδομή ΤΩΡΑ**: Headless `createGrid(config)` API ανεξάρτητο UI. Visual State Machine (C3) → "Ghost/AI-suggested" state.

#### 4.18.2 3D/4D & VR/AR Επέκταση (Μεσαία Προτεραιότητα)

Επέκταση από B28-B30/B46 σε πολυδιάστατα (Revit levels + grids pattern).

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B62** | 3D Grid Volumes | Grids σε 3D (XY + Z planes) — volumetric snaps για elevations. | Revit 3D datum grids |
| **B63** | 4D Sequencing | Time-based grids (phase 1: foundation; phase 2: upper levels). | Tekla 4D BIM |
| **B64** | VR Preview Mode | Export grids σε VR (Oculus/HTC) για walkthrough — onsite alignment. | Skanska VR safety, BIMx |
| **B65** | AR Overlay | Mobile app: overlay grids on camera feed (HoloLens-style) για εργοτάξιο. | Autodesk AR tools, Bechtel onsite |
| **B66** | Point Cloud Integration | Import scans → auto-align grids to real terrain/buildings. | Trimble RealWorks |

**Υποδομή ΤΩΡΑ**: `{x, y, z?}` coordinates. `plane: 'xy' | 'xz' | 'yz'` στο Data Model.

#### 4.18.3 Collaboration & Cloud (Υψηλή Προτεραιότητα)

Σύγχρονες κατασκευές απαιτούν real-time sharing (BIM 360 pattern).

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B67** | Real-Time Co-Editing | Multi-user: βλέπεις τους οδηγούς άλλων live, conflict resolution. | Bentley iTwin |
| **B68** | Version Control | Git-like για grids: branches, merges, history. | Autodesk BIM 360 |
| **B69** | Cloud Sync | Auto-save grids σε cloud — access από mobile/desktop. | Vectorworks Cloud |
| **B70** | Commenting on Guides | Σημειώσεις/tags σε οδηγούς (π.χ. "Ελέγξτε spacing εδώ") — shareable. | Revit worksharing |
| **B71** | Blockchain Audit | Immutable logs για edits — legal/compliance σε μεγάλα projects. | AECOM digital twins |

#### 4.18.4 Sustainability & Optimization (Μεσαία Προτεραιότητα)

Green design focus (Skanska, Vinci sustainability programs).

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B72** | Eco-Grid Presets | Grids optimized για υλικά (ελάχιστο ατσάλι μέσω spacing algo). | Bentley sustainability tools |
| **B73** | Energy Simulation Hooks | Σύνδεση με sim tools (EnergyPlus) — adjust grids για solar/ventilation. | ArchiCAD EcoDesigner |
| **B74** | Material Waste Calculator | Εκτίμηση σπατάλης υλικών βάσει grid spacing — πρόταση βελτιώσεων. | Trimble Tekla |
| **B75** | Carbon Footprint Estimator | Υπολογισμός CO₂ από grid design — AI optimize για χαμηλές εκπομπές. | Autodesk Insight |

#### 4.18.5 Advanced Geometry & Parametrics (Υψηλή Προτεραιότητα)

Επέκταση B34/B46 σε πιο σύνθετες γεωμετρίες.

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B76** | Non-Linear Grids | Curved/organic grids (Bezier, NURBS) για freeform architecture. | Rhino advanced curves |
| **B77** | Adaptive Spacing | Dynamic spacing που αλλάζει βάσει φορτίων (πυκνότερο κοντά σε στηρίξεις). | SolidWorks parametrics |
| **B78** | Constraint Solver | Επίλυση εξισώσεων (π.χ. "total span=20m, n=5 → auto-space 4m"). | Grasshopper solvers |
| **B79** | GIS Integration | Import geospatial data → grids ευθυγραμμισμένα με τοπογραφία. | MicroStation GIS |
| **B80** | Fractal Subdivision | Recursive snaps (υποδιαίρεση μέσων σημείων αναδρομικά). | Advanced math, Rhino |

**Υποδομή ΤΩΡΑ**: Constraint Engine (C11) hooks. Batch generation API χωρίς performance penalty (Spatial Indexing).

#### 4.18.6 UI/UX & Accessibility (Μεσαία Προτεραιότητα)

Βελτιώσεις πέρα από B13/B22/B50 — inclusivity & accessibility.

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B81** | Voice Commands | "Add vertical guide at 5m" — hands-free λειτουργία. | Autodesk voice pilots |
| **B82** | Accessibility Mode | High-contrast grids, screen reader support για labels. | WCAG σε CAD (Autodesk) |
| **B83** | Tutorial Overlays | Guided tours για νέους χρήστες ("Click here for parallel"). | SketchUp tutorials |
| **B84** | Customizable Toolbar | Drag-drop εργαλείων στο panel — user-defined layouts. | Vectorworks |
| **B85** | Mobile Optimization | Touch gestures για guides σε tablets (pinch-zoom snaps). | ArchiCAD mobile |

#### 4.18.7 Data & Integration Extensions (Χαμηλή Προτεραιότητα)

Επέκταση C9/C11 για ecosystem ανοιχτό σε τρίτους.

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B86** | API for Extensions | Open API: 3rd-party plugins (π.χ. custom AI grids). | Revit API |
| **B87** | IoT Sensor Link | Real-time: guides update από site sensors (π.χ. level changes). | Bechtel IoT |
| **B88** | IFC Export | Grids ως IFC elements για BIM interoperability. | Tekla IFC |
| **B89** | Analytics Dashboard | Stats: grid complexity, edit history — project management. | BIM 360 analytics |
| **B90** | Scripting Language | Built-in (Lua/Python) για custom guide scripts. | MicroStation VBA |

#### 4.18.8 Security & Compliance (Υψηλή Προτεραιότητα)

Για large-scale projects με πολλούς συνεργάτες.

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B91** | Role-Based Access | Admins: edit grids — Viewers: μόνο view. | Autodesk Vault |
| **B92** | Encryption for Grids | Encrypted data για sensitive projects (infrastructure). | Turner Construction security |
| **B93** | Compliance Checkers | Auto-validate vs building codes (spacing min/max). | ArchiCAD code checking |

> **Σύνολο**: B56-B93 = **38 νέα features** σε 8 κατηγορίες.

### 4.19 Global Market Innovations — B94-B120

> Βάσει έρευνας Revit 2026, Bentley OpenBuildings, Glodon 5D BIM, PKPM-AID, CSCEC smart sites,
> EN ISO 19650, CEN/TC 442, BIM 6.0 lifecycle trends, quantum computing readiness.

#### 4.19.1 China-Specific Innovations (Υψηλή — Market Penetration)

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B94** | 5G Real-Time Grid Sync | Sync grids με onsite 5G data — auto-updates βάσει hazards/αλλαγών. | CSCEC 5G smart sites |
| **B95** | Seismic-Aware Grids | Auto-optimize grid spacing βάσει σεισμικών κανονισμών (GB 50011). | PKPM seismic analysis |
| **B96** | 5D Grid Cost Simulator | Ενσωμάτωση κόστους/χρόνου στο grid — αυτόματα quantity takeoff. | Glodon 5D BIM (Cubicost) |
| **B97** | Vertical AI Modules | Domain-specific AI models (δομικός/οικονομικός/ενεργειακός κάνναβος). | China vertical AI trend |

#### 4.19.2 European Compliance & Green (Υψηλή — EU Mandates)

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B98** | EN ISO 19650 Templates | Pre-built workflows για information delivery κατά ISO 19650. | EU BIM standards |
| **B99** | CEN Data Dictionary Integration | Auto-map grid properties σε EU data dictionaries (CEN/TC 442). | buildingSMART CDE |
| **B100** | EU Green Deal Checker | Validate grids vs sustainability mandates (BREEAM, LEED, EU Taxonomy). | EU EcoDesigner trend |
| **B101** | DIN/VOB Grid Standards | Templates για γερμανικά/ευρωπαϊκά πρότυπα κατασκευής. | Bentley Speedikon |

#### 4.19.3 Metaverse & Immersive (Μεσαία — 2026 Trends)

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B102** | Metaverse Grid Export | Export σε Unity/UE5 για virtual collaboration environments. | Trends 2026 |
| **B103** | Haptic VR Snaps | Tactile feedback στο VR κατά snap σε guides — immersive σχεδιασμός. | Robotics haptics |
| **B104** | AR Onsite Grid Overlay | AR glasses overlay grids σε πραγματικό εργοτάξιο — real-time alignment. | Revit AR / HoloLens |

#### 4.19.4 Robotics & Autonomous (Υψηλή — Construction 2.0)

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B105** | Robot Path Generation | Δημιουργία paths από grids για cobots (rebar, bricklaying). | China rebar robots |
| **B106** | Drone Auto-Grid Mapping | Drones σαρώνουν εργοτάξιο → auto-update grid as-built vs design. | CSCEC drones |
| **B107** | Humanoid Robot Interface | API για humanoid robot control μέσω grid waypoints. | Trends 2026 humanoids |
| **B108** | Agentic AI for Sites | AI agents ως "digital crew" — αυτόνομη εκτέλεση tasks βάσει grid. | Procore AI trends |

#### 4.19.5 Quantum & Advanced Computing (Χαμηλή — Long-Term)

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B109** | Quantum Solver Hooks | API hooks για quantum computing σε complex grid optimization. | Future quantum trends |
| **B110** | Electro-Industrial Stack | Simulate AI power demands πάνω σε grids (data center layouts). | China grid AI power |

#### 4.19.6 BIM 6.0 & Lifecycle (Μεσαία)

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B111** | BIM 6.0 Data Flows | Lifecycle data continuity πέρα από 5D (maintenance, demolition). | BIM trends 2026 |
| **B112** | Predictive Clash AI | AI προβλέπει clashes πριν την κατασκευή βάσει grid patterns. | Revit/Dynamo AI |

#### 4.19.7 Additional Features

| # | Βελτίωση | Περιγραφή | Έμπνευση |
|---|----------|-----------|----------|
| **B113** | Multi-Language Support | UI/standards σε κινεζικά, γερμανικά, αγγλικά, ελληνικά + localized standards. | PKPM/Glodon i18n |
| **B114** | Power Grid Simulation | Simulate ενεργειακές ανάγκες AI data centers βάσει grid layout. | China AI power trend |
| **B115-B120** | Custom Extension Slots | 6 reserved slots για user-defined/market-specific extensions. | Plugin architecture |

> **Σύνολο B94-B120**: 27 νέα features (21 concrete + 6 extension slots).
> **Συνολικά features ADR-189**: B1-B120 = **120 features**.
> **Στρατηγική**: MVP (B1-B55) → Industry expansion (B56-B93) → Global market (B94-B120).

---

## 5. Υπάρχουσα Υποδομή στο DXF Viewer μας

| Σύστημα | Κατάσταση | Σχετικότητα |
|---------|-----------|-------------|
| **Grid System** (visual grid) | ✅ Υπάρχει | Βασικός visual grid — ΔΕΝ είναι construction grid |
| **Snap System** (ProSnapEngineV2) | ✅ Υπάρχει | 13 snap types, spatial index, throttled detection |
| **Ruler System** | ✅ Υπάρχει | Rulers στα άκρα — μπορεί να χρησιμοποιηθεί για labels αξόνων |
| **Overlay System** | ✅ Υπάρχει | Μπορεί να φιλοξενήσει grid lines ως ειδικό layer |
| **Level System** | ✅ Υπάρχει | Ανά level/floor — κάνναβος ανά όροφο; |
| **Entity System** | ✅ Υπάρχει | Υποστήριξη line/polyline — grid lines ως entities |

---

---

## 8. Implementation Design (Enterprise CAD/BIM Patterns)

> Ενότητες που μετατρέπουν το ADR από "feature list" σε **υλοποιήσιμο spec**.
> Patterns από: Revit, AutoCAD, Archicad, Tekla, Bentley, IFC/buildingSMART.

### 8.1 Datum Extents & Scope Boxes (Revit pattern)

Στα BIM εργαλεία τα grids/levels είναι **datums** με κανόνες "extents" και μηχανισμό ελέγχου ανά view.

#### View Extents Model

| Τύπος | Περιγραφή |
|-------|-----------|
| **Global Extents** | Ο οδηγός εκτείνεται σε ολόκληρο το σχέδιο — default |
| **View-specific Extents** | Ο οδηγός εμφανίζεται μέχρι ένα σημείο σε **αυτό** το view (floor tab / view mode) |
| **Scope Box** | Ορθογώνιο/πολύγωνο "περιοχής" που ορίζει extents + visibility για ομάδα οδηγών |

#### Scope Box Αντικείμενο

- Ορθογώνιο ή πολύγωνο στο canvas
- Οι οδηγοί **εντός** scope box εμφανίζονται, εκτός = κρυφοί
- Ένας scope box μπορεί να αντιστοιχεί σε **ομάδα οδηγών** (group)
- **Propagate extents**: "Εφάρμοσε τα ίδια extents σε άλλους ορόφους/views"

#### Bubble Rules (ετικέτες αξόνων)

| Κανόνας | Περιγραφή |
|---------|-----------|
| **Bubble ανά άκρο** | Εμφάνιση ετικέτας στην αρχή, στο τέλος, ή και στα δύο |
| **Hide/Show ανά άκρο** | Κρύψε bubble στο ένα άκρο, δείξε στο άλλο |
| **Auto-offset** | Αν ο οδηγός κόβεται από crop/scope box, το bubble μετατοπίζεται εκτός crop |
| **Collision avoidance** | Bubbles δεν επικαλύπτονται — αυτόματη μετατόπιση |

### 8.2 Snap Tracking & Alignment Paths (AutoCAD pattern — ΚΕΝΤΡΙΚΟΠΟΙΗΜΕΝΟ)

> AutoCAD: Object Snap Tracking (F11) + Polar Tracking — προσωρινές "γραμμές ευθυγράμμισης".
> Αυτό είναι **διαφορετικό** από μόνιμους οδηγούς — snap-driven, αυτόματο.

#### Temporary Tracking Lines

| Χαρακτηριστικό | Περιγραφή |
|----------------|-----------|
| **Εμφάνιση** | Αυτόματα, μόνο κατά τη σχεδίαση — εξαφανίζονται μόλις τελειώσεις |
| **Πηγή** | Ξεκινούν από snap points (endpoints, intersections, guide points) |
| **Κατεύθυνση** | Οριζόντια/κατακόρυφη ή σε polar angles (0°/30°/45°/60°/90°) |
| **Στυλ** | Πολύ αχνό dashed — ακόμα πιο αχνό από τους μόνιμους οδηγούς |
| **Αποθήκευση** | ΟΧΙ — δεν αποθηκεύονται, δεν εκτυπώνονται |

#### Tracking Point Primitives

- Hover πάνω σε snap point → **tracking point** ενεργοποιείται
- Μετακίνηση σταυρονήματος → εμφανίζεται **tracking line** από εκείνο το σημείο
- Πολλαπλά tracking points ταυτόχρονα → τομή tracking lines = ακριβής θέση

#### Priority & Conflict Rules

| Προτεραιότητα | Τύπος |
|---------------|-------|
| 1 (υψηλότερη) | Guide intersection snap |
| 2 | Entity endpoint snap |
| 3 | Tracking line intersection |
| 4 | Entity midpoint snap |
| 5 | Grid snap |
| 6 (χαμηλότερη) | Polar tracking |

#### UI / Shortcuts

| Shortcut | Ενέργεια |
|----------|----------|
| **F11** | Toggle Object Snap Tracking |
| **F10** | Toggle Polar Tracking |
| **Shift+Right-click** | Snap override menu |
| Polar presets | 0°/90° (default), 0°/45°/90°, 0°/30°/60°/90°, 0°/15°/... |

### 8.3 Curved / Radial Grid System ως First-Class (Archicad pattern)

> Archicad: ρητή έννοια curved grid system (κυκλικά + ακτινικά grids) με αυτόματη ονομασία.

#### Grid System Types

| Τύπος | Περιγραφή | Ονομασία |
|-------|-----------|----------|
| **Linear** | Ευθύγραμμοι οδηγοί X/Z | Α, Β, Γ... / 1, 2, 3... |
| **Radial** | Ακτινικοί οδηγοί από κέντρο | R1, R2, R3... ή A°, B°... |
| **Circular** | Ομόκεντροι κύκλοι (δακτύλιοι) | C1, C2... ή D=5.00, D=10.00 |

#### Naming Schemes per Direction

| Κατεύθυνση | Default | Παραδείγματα |
|------------|---------|-------------|
| **X-direction** | Αριθμοί (1, 2, 3...) | 1, 2, 2A, 3... |
| **Z-direction** | Γράμματα (Α, Β, Γ...) | Α, Β, Γ... ή A, B, C... |
| **Radial** | R + αριθμός | R1, R2, R3... |
| **Circular** | C + αριθμός ή D= | C1, C2... |
| **Εξαιρέσεις** | Αποφυγή Ι/Ο (μοιάζουν 1/0) | Παράλειψη I, O σε naming |

#### Axis Bubbles Rules για Κυκλικά

- Ακτινικοί: bubble στην εξωτερική πλευρά, **στρέφεται** προς το κέντρο
- Κυκλικοί: bubble στην αρχή του τόξου, label = ακτίνα ή αριθμός

### 8.4 IFC Interoperability (buildingSMART — future-proof)

> IfcGrid / IfcGridAxis — επίσημες BIM οντότητες. Δεν υλοποιούμε τώρα, αλλά **σχεδιάζουμε** για compatibility.

#### IFC Mapping

| Δικό μας | IFC Entity | Geometry |
|----------|-----------|----------|
| Οδηγός X/Z (ευθύγραμμος) | `IfcGridAxis` | `IfcLine` |
| Οδηγός XZ (λοξός) | `IfcGridAxis` | `IfcLine` με direction |
| Κυκλικός οδηγός | `IfcGridAxis` | `IfcCircle` |
| Παράλληλος (offset) | `IfcGridAxis` | `IfcOffsetCurve2D` |
| Ομάδα οδηγών | `IfcGrid` | Contains N × `IfcGridAxis` |
| Axis label | `IfcGridAxis.AxisTag` | String identifier |

#### Schema Versioning

- Κάθε save format περιέχει `schemaVersion: number`
- Αν αύριο προστεθεί IFC export → migration path χωρίς να σπάσουν παλιά saves
- Forward-compatible: αγνοούνται άγνωστα πεδία

### 8.5 Coordinate System & Plane Locks (Bentley pattern)

#### Axis Convention Contract

| Σύστημα | X | Y/Z | Χρήση |
|---------|---|-----|-------|
| **DXF standard** | → Δεξιά | ↑ Πάνω (Y) | Αρχείο DXF |
| **Viewer canvas** | → Δεξιά | ↓ Κάτω (Y inverted) | Screen rendering |
| **UI Labels** | X (οριζόντιος) | Z (κάθετος) — convention Fespa/Τέκτων | Status bar, prompts |
| **3D (μελλοντικό)** | X | Y | Z (ύψος) |

**ΣΗΜΑΝΤΙΚΟ**: Ο Τέκτονας χρησιμοποιεί **X/Z** (ΟΧΙ X/Y) στην κάτοψη. Πρέπει:
- Internal: πάντα `{x, y, z?}` (standard)
- UI display: configurable label mapping (X/Y ή X/Z)

#### Plane Lock

| Mode | Περιγραφή |
|------|-----------|
| **XY plane** (default) | Κάτοψη — ο κάνναβος σχεδιάζεται στο XY |
| **XZ plane** | Όψη τοίχου — κάνναβος σε τοίχο (μελλοντικό) |
| **YZ plane** | Πλάγια όψη (μελλοντικό) |
| **Custom plane** | Ορισμός arbitrary plane (πολύ μελλοντικό) |

#### Numerical Precision & Tolerances

| Παράμετρος | Τιμή | Χρήση |
|------------|------|-------|
| **Snap tolerance** | 5px (screen) | Πόσο κοντά πρέπει ο cursor |
| **Intersection tolerance** | 0.001mm (world) | Πότε θεωρούνται 2 γραμμές ότι τέμνονται |
| **Dedup tolerance** | 0.01mm (world) | Πότε θεωρούνται 2 σημεία ίδια |
| **Coordinate precision** | 6 decimals | Εσωτερική αποθήκευση |
| **Display precision** | 2 decimals (configurable) | UI εμφάνιση |

### 8.6 Data Model & Persistence Schema

#### Core Entities

```typescript
interface GuideLine {
  id: string;                    // Immutable UUID
  type: 'x' | 'z' | 'xz' | 'perpendicular' | 'parallel' | 'radial';
  plane: 'xy' | 'xz' | 'yz';   // 3D-ready
  origin: Point3D;               // {x, y, z?}
  direction?: Vector3D;          // For xz/radial
  endPoint?: Point3D;            // For finite lines (xz)
  parentId?: string;             // For perpendicular/parallel (reference)
  offset?: number;               // For parallel (distance from parent)
  groupId?: string;              // Group membership
  label?: string;                // Axis label (Α, Β, 1, 2...)
  style: GuideStyleRef;          // Color, dash, opacity
  locked: boolean;
  visible: boolean;
  floor: string | 'global';      // Per-floor or global
  schemaVersion: number;
}

interface GuidePoint {
  id: string;
  position: Point3D;
  sourceType: 'intersection' | 'subdivision' | 'distance' | 'manual';
  sourceGuideIds?: string[];     // Which guides created this point
  groupId?: string;
  visible: boolean;
  floor: string | 'global';
}

interface GuideGroup {
  id: string;
  name: string;                  // "Δομικός Κάνναβος"
  color: string;                 // Hex color
  dashPattern: number[];         // [6, 3] etc.
  opacity: number;               // 0.0 - 1.0
  locked: boolean;
  visible: boolean;
  scopeBoxId?: string;           // Optional scope box
}

interface ScopeBox {
  id: string;
  boundary: Point3D[];           // Polygon vertices
  appliesTo: string[];           // Guide group IDs
  floors: string[];              // Which floors
}

type Point3D = { x: number; y: number; z?: number };
type Vector3D = { dx: number; dy: number; dz?: number };
type GuideStyleRef = { groupId?: string; override?: Partial<GuideStyle> };
```

#### Per-Floor vs Global Grid

| Στρατηγική | Περιγραφή |
|-----------|-----------|
| **Global grid** | Κοινός κάνναβος σε ΟΛΟΥΣ τους ορόφους (structural grid) |
| **Per-floor overrides** | Μικρές αλλαγές ανά όροφο (π.χ. extra guide σε όροφο 3) |
| **Per-floor grid** | Εντελώς διαφορετικός κάνναβος ανά όροφο (σπάνιο) |

### 8.7 Interaction State Machine

#### Command Lifecycle

```
[idle] → (select command) → [preview] → (click/input) → [commit] → [idle]
                                  ↓
                            (Esc/cancel) → [idle]
```

#### Input Modes

| Mode | Trigger | Behavior |
|------|---------|----------|
| **Click mode** | Default | Κλικ στο canvas |
| **Numeric input** | Πληκτρολόγηση αριθμού | Capture keyboard → apply value |
| **Popup dialog** | Σύνθετη εντολή (Σε Τμήματα) | Modal dialog → OK/Cancel |
| **Drag mode** | Mouse down + move | Real-time preview |

#### Cancel/Confirm Semantics

| Πλήκτρο | Ενέργεια |
|---------|----------|
| **Esc** | Cancel τρέχουσα εντολή, επιστροφή στο idle |
| **Enter** | Confirm numeric input |
| **Right-click** | Cancel ή context menu (configurable) |
| **Double-click** | Ολοκλήρωση multi-step εντολής |

### 8.8 Hit-Testing & Selection Rules

| Παράμετρος | Τιμή | Σημείωση |
|------------|------|----------|
| **Pick tolerance** | 5px (screen-space) | Ανεξάρτητο zoom |
| **Priority: Guide vs Entity** | Entity > Guide (default) | Configurable |
| **Hover intent** | 150ms delay | Αποφυγή flickering |
| **Multi-select rectangle** | Shift+drag ή marquee mode | Batch selection |

### 8.9 Performance Budgets

| Μετρική | Στόχος |
|---------|--------|
| **Max guides** | 500 γραμμές + 5000 σημεία χωρίς lag |
| **Render time** | < 2ms per frame (60fps budget: 16ms) |
| **Pan/Zoom** | 60fps σε max guide density |
| **Snap lookup** | < 1ms (spatial index: R-tree ή grid hash) |
| **Input latency** | < 50ms click-to-visual |

#### Optimization Strategy

- **Spatial Index**: R-tree ή grid hash για guide points → O(log n) lookup
- **Render Batching**: Ομαδοποίηση γραμμών ανά group → single drawCall per group
- **View Frustum Culling**: Σχεδίαση μόνο ορατών guides (viewport intersection)
- **Level-of-Detail**: Σε πολύ μακρινό zoom → μόνο major axes, κρύψε minor

### 8.10 QA Plan & Acceptance Criteria

#### Test Matrix

| Κατηγορία | Tests |
|-----------|-------|
| **Snap correctness** | Guide intersection, endpoint, midpoint — pixel-perfect |
| **Precision** | Coordinate round-trip (create → save → load → verify) |
| **Rotation** | Single guide, group, whole grid — angle accuracy |
| **Parallel offset** | Distance accuracy ±0.001mm |
| **Arc subdivision** | Equal arc-length segments |
| **Undo/Redo** | Full round-trip: create → undo → redo → verify identical |
| **Import/Export** | Coordinate CSV round-trip, IFC mapping (μελλοντικό) |

#### Golden Tests (Geometry)

- 2 perpendicular lines → intersection at exact point
- Parallel offset 5.000m → verify distance = 5.000m ±0.001mm
- Arc subdivision N=4 → verify equal arc lengths
- Rotation 45° → verify coordinates with trigonometric precision

### 8.11 Observability

#### Counters & Metrics

| Counter | Σκοπός |
|---------|--------|
| `guide.count.lines` | Πλήθος γραμμών-οδηγών |
| `guide.count.points` | Πλήθος snap points |
| `guide.render.time_ms` | Χρόνος rendering per frame |
| `guide.snap.candidates` | Snap candidates ανά frame |
| `guide.input.latency_ms` | Click-to-visual latency |
| `guide.undo.depth` | Βάθος undo stack |

#### Error Taxonomy

| Error | Αιτία | Χειρισμός |
|-------|-------|-----------|
| **Near-parallel** | 2 γραμμές σχεδόν παράλληλες → unstable intersection | Threshold: αν γωνία < 0.1° → ignore intersection |
| **Degenerate arc** | Ακτίνα → 0 ή → ∞ | Minimum radius threshold |
| **Huge coordinates** | Σημεία σε > 10km | Warning + auto-clip |
| **Duplicate guide** | Ίδια θέση/κατεύθυνση | Auto-dedup with tolerance |

### 8.12 Grid Labels & Drawings (Tekla pattern)

#### Label Placement Policies

| Policy | Περιγραφή |
|--------|-----------|
| **Top/Bottom** | Labels πάνω ή/και κάτω (Z-direction guides) |
| **Left/Right** | Labels αριστερά ή/και δεξιά (X-direction guides) |
| **Collision avoidance** | Αυτόματη μετατόπιση αν labels επικαλύπτονται |
| **Outside viewport** | Αν ο οδηγός κόβεται, label μετατοπίζεται στο visible edge |

#### Formatting Policies

| Ρύθμιση | Default | Παραδείγματα |
|---------|---------|-------------|
| **Μονάδες** | Μέτρα (m) | m, cm, mm, ft, in |
| **Δεκαδικά** | 2 | 5.00, 5.000 |
| **Rounding** | Nearest 0.01 | 5.005 → 5.01 |
| **Prefix** | Κανένα | "Ax-", "Grid-" |

#### Label Templates

| Template | Format | Παράδειγμα |
|----------|--------|-----------|
| **Structural** | Αριθμοί + Γράμματα | 1, 2, 3 / Α, Β, Γ |
| **Architectural** | Letters + Numbers | A, B, C / 1, 2, 3 |
| **MEP** | Prefix + Number | MEP-1, MEP-2 |
| **Custom** | User-defined | Ελεύθερο |

---

## 10. Future-Proofing & AI Readiness (Βλέποντας στο Μέλλον)

> Στρατηγικές προβλέψεις βάσει industry research (Autodesk, Trimble, Bentley, Graphisoft, McNeel).
> Αυτές οι λειτουργίες μπορεί να υλοποιηθούν σε Phase 3+, αλλά η **υποδομή** (Data Model & Rendering & API)
> πρέπει να τις υποστηρίζει **από τον σχεδιασμό**.

### 10.1 Παραμετρική Σύνδεση (Parametric Entity Binding — "Μαγνητικός Κάνναβος")

Η μετάβαση από CAD σε BIM απαιτεί ο κάνναβος να μην είναι απλώς οπτικός οδηγός,
αλλά **μαγνητικός σκελετός** ελέγχου γεωμετρίας.

| Concept | Περιγραφή | Υποδομή που χρειάζεται ΤΩΡΑ |
|---------|-----------|------------------------------|
| **Magnetic Guides** | Entity (κολόνα, τοίχος) "κουμπώνει" σε οδηγό. Drag οδηγού → entity ακολουθεί αυτόματα. | Guide Data Model: πεδίο `attachedEntityIds: string[]` στο `GuideLine`. |
| **Grid Auto-Heal** | Διαγραφή ενδιάμεσου άξονα → αυτόματη ανακατανομή αποστάσεων γειτονικών (αν υπάρχει constraint ισαπόστασης). | Constraint Engine (C11) hooks. |
| **Bidirectional Binding** | Μετακίνηση entity → ο οδηγός "ακολουθεί" (weak binding mode). | Event system: `onEntityMoved → updateGuidePosition`. |

**Γιατί είναι κρίσιμο**: Αυτό είναι το **#1 differentiator** μεταξύ CAD και BIM.
Χωρίς parametric binding, ο κάνναβος παραμένει "static reference lines".
Με parametric binding, γίνεται **"intelligent structural skeleton"**.

### 10.2 AI & Generative Design (Παραγωγικός Σχεδιασμός)

| Concept | Περιγραφή | Υποδομή ΤΩΡΑ |
|---------|-----------|--------------|
| **AI Prompt to Grid** | Text input: "Δημιούργησε δομικό κάνναβο 20x30m με υποστυλώματα ανά 5m". AI κάνει parse + καλεί headless API. | Headless `createGrid(config)` API ανεξάρτητο UI. |
| **Auto-Optimum Layout** | Επιλογή περιγράμματος → αλγόριθμος προτείνει 3 εναλλακτικούς καννάβους βάσει κατασκευαστικών κανόνων. | B39 (Περιμετρικοί Οδηγοί) → bounding polygon API. |
| **Predictive Snapping** | AI μαθαίνει pattern χρήστη. 3 οδηγοί ανά 4μ → ghost preview 4ου στα 4μ πριν κλικ (Tab to accept). | Visual State Machine (C3): "Ghost/AI-suggested" state. |

### 10.3 Computer Vision & Scan-to-BIM

| Concept | Περιγραφή | Υποδομή ΤΩΡΑ |
|---------|-----------|--------------|
| **Raster to Grid (OCR)** | Εισαγωγή 2D κάτοψης (εικόνα/PDF). AI → edge detection → αναγνώριση τοίχων → αυτόματοι κεντρικοί άξονες. | Batch guide generation API. Spatial Indexing. |
| **Point Cloud Alignment** | Ευθυγράμμιση κάνναβου με νέφη σημείων (point clouds) από 3D scanners εργοταξίου. | 3D coordinates `{x, y, z?}` στο Data Model. |

### 10.4 Digital Twin & IoT Readiness

| Concept | Περιγραφή |
|---------|-----------|
| **Spatial Anchors** | Κάθε σημείο τομής (X marker) αποκτά μοναδικό ID (π.χ. `Node_A1`) + σύνδεση με εξωτερικά δεδομένα (αισθητήρες θερμοκρασίας, asset tags συντήρησης). |
| **Clash Rule Zones** | Η περιοχή μεταξύ αξόνων ορίζεται ως "Zone". Ασύμβατο hatch σε zone (π.χ. σωληνώσεις σε ζώνη ρεύματος) → κάνναβος κόκκινος. |
| **Live Construction Tracking** | Αισθητήρες εργοταξίου ενημερώνουν grid positions σε real-time (IoT → WebSocket → Guide update). |

### 10.5 Στρατηγική Υλοποίησης Future Features

```
Phase 1 (ΤΩΡΑ):   Core B1-B55 + Data Model + Rendering + Snap Integration
                    └── Η υποδομή πρέπει ΗΔΗ να υποστηρίζει extensions

Phase 2 (Μεσαία):  B56-B61 (AI basics) + B76-B80 (Advanced Geometry)
                    + C14 (AI Layer) + C19 (Validation)
                    └── Quick wins με μεγάλο ROI

Phase 3 (Future):   B62-B66 (3D/VR/AR) + B67-B71 (Collaboration)
                    + C15 (3D Pipeline) + C16 (Collab Engine)
                    └── Μετάβαση σε full BIM/3D

Phase 4 (Vision):   B72-B75 (Sustainability) + B86-B93 (Ecosystem)
                    + C17-C20 (Simulation, AR/VR, Plugins)
                    └── Πλήρες ecosystem — competing με enterprise tools
```

> **Αρχή**: Η υποδομή C1-C20 ήδη χτίζεται ως **καθαρό API** ανεξάρτητο UI.
> Αυτό σημαίνει ότι στο μέλλον ένα AI Agent ή LLM integration μπορεί
> να καλεί τις ίδιες συναρτήσεις στο παρασκήνιο.

### 10.6 Βαθιά Ανάλυση Βιομηχανίας — Προτάσεις P1-P8

> Βάσει ακαδημαϊκής έρευνας (TU Delft LoC Grid, SAO optimization papers),
> industry leaders (ALLPLAN 2025 AI Visualizer, Tekla rebar digitization),
> και κατασκευαστικών προτύπων (ανοχές bolt-ball grid, LandXML).
> **3 Μακρο-τάσεις**: Generative Design, Design-to-Fabrication, AI as Design Partner.

#### P1: Βελτιστοποίηση Κάνναβου με Στόχους (Optimization Objectives)

**Σχέση με**: B2 (Auto Grid), B56 (AI Auto-Grid), B59 (Generative Variants)
**Βάθος**: Ο χρήστης δεν δίνει μόνο αποστάσεις, αλλά και **στόχους** (objective functions):
- "Ελαχιστοποίησε χρήση υλικού για κολώνες ανά 5μ"
- "Μεγιστοποίησε φυσικό φωτισμό για προσανατολισμό ΝΝΔ"
- "Ελαχιστοποίησε κόστος θεμελίωσης για έδαφος κατηγορίας Γ"

**Τεχνική**: Εισαγωγή Parametric Objectives στο `createGrid(config)` API.
Αναζήτηση σε design space (Bayesian optimization ή SAO — Sequential Approximate Optimization).

#### P2: AI Προτάσεις "Έξυπνων Οδηγών" (Smart Guide Suggestions)

**Σχέση με**: B57 (Predictive Snap), B61 (Learning from Edits)
**Βάθος**: Contextual pattern recognition με domain-specific γνώση:
- 2 κάθετοι οδηγοί ανά 15cm σε τοίχο → "Θα ήθελες να συνεχίσω σε όλο το μήκος;"
- Οδηγοί για οπλισμό Φ10 → "Να εφαρμόσω τυπικό βήμα 15/20cm σε όλη την πλάκα;"
- Pattern: τοίχος + 2 παράλληλοι → "Πρόσθεση ενδιάμεσου για σωλήνωση;"

**Τεχνική**: Pattern matching + lightweight ML model. Contextual prompts μέσω C3 (Visual State Machine).

#### P3: Εξαγωγή σε Μορφότυπα Κατασκευής (Fabrication-Ready Exports)

**Σχέση με**: B26 (CSV Export), B88 (IFC Export), C9 (Import/Export)
**Βάθος**: Πέρα από CSV — μορφότυπα που "διαβάζουν" μηχανήματα εργοταξίου:
- **LandXML**: Για σταθμούς χωροστάθμησης (total stations) → αυτοματοποιημένη χάραξη κτιρίου
- **DSTV/NC**: Για CNC κοπή μεταλλικών στοιχείων βάσει καννάβου
- **Rebar schedules**: Πίνακες οπλισμού βάσει θέσεων καννάβου

**Τεχνική**: Exporters per μορφότυπο. Plugin system (C20) για custom exporters.

#### P4: "Συμμορφούμενος" Κάνναβος (Tolerance-Aware Grid) ⭐ ΝΕΑ ΙΔΕΑ

**Σχέση με**: B93 (Compliance Checkers) — αλλά πιο βαθύ
**Βάθος**: Κάθε snap point / guide line αποκτά **tolerance zone**:
- Κολόνα στο σημείο A1 → εμφάνιση κύκλου ανοχής ±5mm (κατά EN 13670)
- Δοκός στον οδηγό Z3 → ανοχή ±10mm κατά μήκος
- Visual: αχνός κύκλος/ζώνη γύρω από snap point (toggle on/off)

**Τεχνική**: Νέα ιδιότητα `tolerance?: number` στο `GuidePoint` + `GuideLine`.
Rendering: Circle/band overlay σε tolerance mode. Ρύθμιση ανά `GuideGroup`.

#### P5: Ιεραρχικός Κάνναβος (Hierarchical & Scalable Grids)

**Σχέση με**: B23 (Structural Presets), B30 (Grid Rotation)
**Βάθος**: Parent-child σχέση μεταξύ καννάβων:
- **Βασικός δομικός κάνναβος**: 8x8μ (κολόνες, τοίχα)
- **Βοηθητικός λεπτομέρειας**: 0.5x0.5μ μέσα σε φάτνωμα (οπλισμός, είδη υγιεινής)
- **Μεταφορά parent → μετακίνηση child**: Αν αλλάξει θέση η κολόνα A1, ο εσωτερικός κάνναβος ακολουθεί

**Τεχνική**: `parentGridId?: string` στο `GuideGroup`. Transform inheritance (translation + rotation).
Εξέλιξη: Groups of groups με ιεραρχικό μετασχηματισμό.

#### P6: Κάνναβος με Χρονική Διάσταση (4D Grids — Construction Phasing)

**Σχέση με**: B63 (4D Sequencing)
**Βάθος**: Σύνδεση καννάβου με χρονοδιάγραμμα έργου:
- Στάδιο 1: Θεμελίωση → ενεργός κάνναβος A (βασικά σημεία)
- Στάδιο 2: Σκελετός → ενεργός κάνναβος B (υποστυλώματα + δοκοί)
- Στάδιο 3: Τοιχοποιία → ενεργός κάνναβος C (χωρίσματα)
- Timeline slider: φιλτράρισμα εμφάνισης κατά φάση

**Τεχνική**: `constructionPhase?: string` στο `GuideLine` + `GuideGroup`.
Filter UI: dropdown ή timeline slider ανά φάση κατασκευής.

#### P7: Κάνναβος με Βάση Σχέσεις (Constraint Satisfaction)

**Σχέση με**: B34 (Equidistant), B78 (Constraint Solver)
**Βάθος**: Ορισμός καννάβου από **σχέσεις αντί αριθμών**:
- "Ο άξονας Β = μέση απόσταση μεταξύ Α και Γ"
- "Απόσταση Γ-Δ = 1.5 × απόσταση Α-Β"
- "Τρεις ισαπέχοντες μεταξύ Α και Ε"
- Αλλαγή Α-Β → αυτόματη ενημέρωση Γ-Δ (live)

**Τεχνική**: Lightweight constraint solver (simplex ή Newton-Raphson).
`constraints?: ConstraintDef[]` στο `GuideGroup`. C11 (Constraint Engine) integration.

#### P8: Βιβλιοθήκη Patterns Καννάβων (Grid Pattern Library)

**Σχέση με**: B23 (Structural Presets) — αλλά πολύ πιο εξελιγμένο
**Βάθος**: Αποθήκευση + κοινοποίηση custom grid patterns:
- "Τυπική πτέρυγα νοσοκομείου" (6×4 κάνναβος, 7.2m ανοίγματα, central corridor)
- "Γέφυρα — τυπικό άνοιγμα" (3 δοκοί, ενίσχυση στηρίξεων)
- "Κατοικία — μπάνιο" (υδραυλικός κάνναβος 0.5m)

**Parametric patterns**: Αποθηκεύονται ΟΧΙ μόνο θέσεις, αλλά και **σχέσεις** (P7).
Κατά την εφαρμογή: prompt για παραμέτρους (αριθμός αξόνων, μήκος, βήμα).

**Τεχνική**: JSON schema για patterns. Cloud sharing (C16 Collaboration Engine).
Pattern = `{ guides: GuideLine[], constraints: ConstraintDef[], params: ParamDef[] }`.

### 10.7 Παγκόσμιες Τάσεις 2025-2026 — Προτάσεις P9-P12

> Βάσει έρευνας σε: Κίνα (PKPM-AID, Glodon, Country Garden Robotics),
> Ευρώπη (Nemetschek AI-first + Google Cloud), Mega-Projects (Linear Engineering),
> και Robotics/Drones layout automation.
> Στόχος: Absolute AI-readiness + construction site integration.

#### P9: AI Copilot Δομικής & Περιβαλλοντικής Βελτιστοποίησης (PKPM/Glodon Pattern)

**Έμπνευση**: PKPM-AID (πρώτο εμπορικό AI δομικού σχεδιασμού, PKPM + Arup).
Glodon: απευθείας BOQ + LCA (Life Cycle Assessment) από BIM μοντέλα.

**Βάθος**: Ο κάνναβος γίνεται **"δυναμικός φορέας κόστους και άνθρακα"**:
- Μεγαλώνεις βήμα από 5m σε 6m → AI υπολογίζει **άμεσα** αλλαγή στον οπλισμό
- Δυναμική ενημέρωση CO₂ footprint κατά το drag ενός οδηγού
- Real-time cost estimation ανά αλλαγή spacing

**Τεχνική**: Νέα properties στο Data Model:
- `materialCostIndex?: number` — δείκτης κόστους υλικού ανά grid cell
- `embodiedCarbon?: number` — ενσωματωμένος άνθρακας (kgCO₂/m²)
- Διασύνδεση C17 (Simulation Interface) → real-time feedback στο UI κατά drag

#### P10: Συνεχής Ανίχνευση Ανωμαλιών — AI Watchdog (Nemetschek/Google Cloud Pattern)

**Έμπνευση**: Nemetschek "AI-first" στρατηγική σε συνεργασία με Google Cloud.
Continuous anomaly detection 24/7 στο background.

**Βάθος**: Αντί ο χρήστης να τρέξει "Clash Detection" στο τέλος, **AI watchdog σιωπηλά παρακολουθεί**:
- Οδηγός στα 4.95m αντί 5.0m (human error) → "Impact-based recommendation" **αμέσως**
- Uneven spacing pattern σε δομικό κάνναβο → πρόταση διόρθωσης
- Παράλληλοι οδηγοί σε πολύ μικρή απόσταση (< min structural span) → warning
- Δεν δείχνει μόνο σφάλμα — δείχνει **λύση + impact**

**Τεχνική**: Background Web Worker με ML heuristics (C14 AI Integration Layer).
UI: Διακριτικό "AI Tip" badge δίπλα στον cursor. Non-intrusive notifications.

#### P11: Δυναμική Αντιστάθμιση Συντεταγμένων — Mega-Projects (Linear Engineering Pattern)

**Έμπνευση**: Κινεζικές έρευνες για τεράστια γραμμικά έργα (σιδηρόδρομοι, ενεργειακά δίκτυα).
Πρόβλημα: floating-point jitter σε μεγάλες συντεταγμένες (X > 1,000,000).

**Βάθος**: Σε mega-projects (χιλιόμετρα), οι WebGL/Canvas coordinates χάνουν ακρίβεια:
- Floating-point 64-bit → ~15 significant digits
- X: 4,500,000.123 → visual "τρέμουλο" (jitter) στο rendering
- Λύση: **Dynamic coordinate offset** — μετατόπιση origin στη θέση κάμερας

**Τεχνική**:
- Data Model: αποθηκεύει **absolute coordinates** (μεγάλοι αριθμοί)
- Rendering Engine (C1): αφαιρεί camera offset **πριν** σχεδιάσει → τοπικό rendering σε μικρούς αριθμούς
- Pattern: `renderX = worldX - cameraX` → pixel-perfect rendering ανεξαρτήτως κλίμακας
- Bonus: Ελαχιστοποιεί z-fighting σε μελλοντικό 3D (C15)

#### P12: Robotics & Drones Layout Export (Site Execution Pattern)

**Έμπνευση**: Country Garden (Κίνα) — κατασκευαστικά ρομπότ. Trimble layout robots.
Drones για aerial survey + grid verification στο εργοτάξιο.

**Βάθος**: Ο κάνναβος γίνεται **"Robotics-ready"**:
- X markers → **Robotic Waypoint Mesh** → ρομπότ χάραξης μαρκάρει στο μπετό
- Ακρίβεια: χιλιοστομετρική (±1mm) — laser/χρώμα πάνω σε πλάκα
- Drones: verification flights → σύγκριση as-built vs design grid
- Μορφότυπα: G-code, Robotic APIs JSON/XML, Trimble Layout Manager

**Τεχνική**: C9 (Import/Export) → νέοι exporters:
- `exportToGcode(guides)` → G-code waypoints για layout robots
- `exportToRoboticAPI(guides)` → JSON schema συμβατό με autonomous machines
- `exportToDroneFlightPlan(guides)` → verification flight path πάνω από grid points
- X markers + axis labels embedded στα waypoint data

### 10.8 Global Market Deep Proposals — P13-P16

> Βάσει Revit 2026, CSCEC 5G/robotics, EN ISO 19650, quantum computing trends.
> Αναρίθμηση P13-P16 (τα P9-P12 ήδη υπάρχουν σε §10.7).

#### P13: 5G Smart Construction Ecosystem

**Έμπνευση**: CSCEC 5G sites — full IoT/AI integration στο εργοτάξιο.
**Βάθος**: Ο κάνναβος γίνεται **live data endpoint** — 5G sensors τροφοδοτούν:
- Real-time hazard detection → auto-adjust grid safety zones
- Structural monitoring → grid alerts αν settlement > tolerance
- Worker tracking → grid-based safety perimeter enforcement

**Τεχνική**: C21 (5G/IoT Layer) → WebSocket feeds → Guide Data Model update.
Δεν αλλάζει geometry — αλλάζει **metadata + visual alerts** σε real-time.

#### P14: BIM-Robotics Bridge

**Έμπνευση**: China rebar robots, bricklaying cobots, drone verification flights.
**Βάθος**: Auto-generate robot task sequences από grid topology:
- Rebar robot: grid intersections → rebar placement coordinates + bending angles
- Bricklaying cobot: grid cells → wall segments → brick course paths
- Drone: grid verification → as-built vs design deviation map

**Τεχνική**: C22 (Robotics Export Engine) → task graph generation.
Input: `GuideLine[]` + `GuidePoint[]`. Output: robot-specific instructions.

#### P15: EU-China Hybrid Standards

**Έμπνευση**: Η ανάγκη για cross-market compliance σε global projects.
**Βάθος**: Templates που αυτόματα μετατρέπουν standards:
- Grid labels: Eurocode → GB (China) → AS (Australia) → AISC (USA)
- Seismic zones: EN 1998 ↔ GB 50011 ↔ ASCE 7
- Fire zones: EN 1991-1-2 ↔ GB 50016
- Material specs: EN 206 (concrete) ↔ GB/T 14902

**Τεχνική**: C23 (EN Compliance Validator) + standard mapping engine.
User selects target market → auto-validate + suggest corrections.

#### P16: Quantum-Enhanced Grid Optimization

**Έμπνευση**: Quantum computing trends — combinatorial optimization.
**Βάθος**: Massive grid variant generation (πέρα από B59 Generative Variants):
- Κλασικά: 100 variants σε 30 δευτερόλεπτα
- Quantum: 10,000 variants σε 5 δευτερόλεπτα
- Use cases: Mega-project grid optimization, multi-constraint satisfaction

**Τεχνική**: C25 (Quantum API Wrapper) → abstract interface.
Σήμερα: classical solver. Αύριο: quantum solver (swap engine, same API).

> **Σύνολο P1-P16**: 16 deep proposals ← ακαδημαϊκή + βιομηχανική + παγκόσμια έρευνα (Ευρώπη, ΗΠΑ, Κίνα).
> **Κλειδί**: Η αρχιτεκτονική C1-C25 + headless API ήδη υποστηρίζει **ΟΛΑ** αυτά χωρίς refactoring.

---

## 9. Proposed Implementation TOC

> Οδηγός για τη σειρά υλοποίησης — αναφορά σε ενότητες του ADR.

1. **Terminology & Coordinate Conventions** → §8.5
2. **Data Model + Storage Schema + Versioning** → §8.6
3. **Rendering Pipeline** (order, batching, DPI, constant-pixel widths) → §4.12, §4.2
4. **Interaction State Machine** (commands, cancel/confirm, numeric input) → §8.7
5. **Snap Integration** (priority, tracking, tolerances) → §8.2, §8.5
6. **View/Floor Model** (global vs per-floor, extents/scope boxes) → §8.1
7. **Labels/Bubbles** (placement, collision, visibility rules) → §8.3, §8.12
8. **Performance Budgets & Benchmarks** → §8.9
9. **QA Plan + Acceptance Criteria** → §8.10
10. **Future Interop Appendix** (IFC mapping, import/export) → §8.4
11. **Regulated Markets Strategy** (compliance, fabrication, plugins) → §11

---

## 11. Στρατηγική Διείσδυσης σε Ρυθμιζόμενες Αγορές (China Strategy)

> Βάσει έρευνας στην κινεζική αγορά AEC (2025-2026): PKPM-AID, Glodon, PowerChina "电建数绘",
> Gstarsoft "1+1+N" model, CSCEC/CRCC prefabrication, TU Delft LoC Grid.
> Η Κίνα οδηγεί τις εξελίξεις στην ενσωμάτωση AI σε mega-projects υποδομής.

### 11.1 Τρεις Κυρίαρχες Κατευθύνσεις (Κίνα 2025-2026)

| Τάση | Περιγραφή | Σημασία για ADR-189 |
|------|-----------|---------------------|
| **AI-mandatory (όχι AI-ready)** | Από 2026, η κινεζική κυβέρνηση απαιτεί BIM正向设计 (Forward Design) σε 24 πιλοτικές πόλεις. Εθνική πλατφόρμα ελέγχου μελετών (全国施工图审查平台) χρησιμοποιεί AI. | Το grid δεν είναι overlay — είναι **θεμέλιο** υποχρεωτικού ψηφιακού μοντέλου. C19 + C14 πρέπει να υποστηρίζουν αυτόματο compliance checking. |
| **Κάθετη ενοποίηση (Ecosystem)** | Πλατφόρμες που καλύπτουν ΟΛΟ τον κύκλο ζωής: 勘察→设计→施工→运维 (έρευνα→σχεδιασμός→κατασκευή→συντήρηση). PKPM "设计智能体 Agent" (Design AI Agents). | Το C20 (Plugin System) είναι η "καρδιά" — API για τρίτους. Μοντέλο "1+1+N" (1 πλατφόρμα + 1 πρότυπο + Ν εφαρμογές). |
| **Prefabrication + Smart Sites** | CSCEC, CRCC: μαζική προκατασκευή. 智慧工地监管平台 (Smart Site Supervision). Σύνδεση ψηφιακού μοντέλου → εργοτάξιο (total stations, ρομπότ). | P3 (Fabrication Exports) + P4 (Tolerances) + P12 (Robotics) = κρίσιμα για prefab. Λάθος χιλιοστών στο grid → αδυναμία συναρμολόγησης. |

### 11.2 Απαιτήσεις Ρυθμιζόμενων Αγορών (CN1-CN6)

| # | Απαίτηση | Σύνδεση ADR | Περιγραφή | Κινεζική Αναγκαιότητα |
|---|----------|-------------|-----------|----------------------|
| **CN1** | Υποχρεωτική BIM Forward Design | C19, C14 | Grids δημιουργούνται ως μέρος αρχικού μοντέλου, ΟΧΙ ύστερο overlay. Enforce creation flow. | Νομοθεσία 2026 για κυβερνητικά έργα σε 24 πόλεις |
| **CN2** | Αυτόματος Έλεγχος Συμμόρφωσης | C19 | Grid αυτο-ελέγχεται vs τοπικούς κανονισμούς (αποστάσεις, ύψη). JSON output για κρατικές πλατφόρμες. | Εθνικό σύστημα ελέγχου μελετών (AI-based) |
| **CN3** | Εξαγωγή CNC & Ρομποτική Κατασκευή | P3, C9 | IFC για prefab, DSTV για χάλυβα, G-code για ρομπότ οπλισμού. | Τεράστια κλίμακα προκατασκευής (CSCEC, CRCC) |
| **CN4** | NURBS & Σύνθετη Γεωμετρία | B76 | Grids πάνω σε NURBS επιφάνειες (φράγματα, ουρανοξύστες). | PowerChina "电建数绘" — υδροηλεκτρικά / mega-projects |
| **CN5** | Plugin API για Τοπικά Οικοσυστήματα | C20 | Αρθρωτό, τεκμηριωμένο API — κινεζικές εταιρείες αναπτύσσουν πρόσθετα. | Μοντέλο "1+1+N" (Gstarsoft 浩辰软件) |
| **CN6** | Υπολογισμός Άνθρακα & Βελτιστοποίηση Υλικών | B74, B75, P9 | Grid προτείνει βελτιστοποίηση για μείωση υλικών/CO₂. | Πολιτική "双碳" (Dual Carbon) + "好房子" (Green Housing) |

### 11.3 Εφαρμοσιμότητα στην Ελληνική/Ευρωπαϊκή Αγορά

Οι απαιτήσεις CN1-CN6 δεν αφορούν μόνο την Κίνα — αντικατοπτρίζουν παγκόσμιες τάσεις:

| CN | Αντίστοιχη Ευρωπαϊκή Τάση |
|----|---------------------------|
| CN1 | EU BIM Mandate (UK Level 2, Nordic BIM, ISO 19650) |
| CN2 | Eurocode compliance checking, CE marking automation |
| CN3 | Industry 4.0 (Γερμανία), Offsite Manufacturing (UK) |
| CN4 | Infrastructure projects (TEN-T, ΤΑΠ pipeline) |
| CN5 | Open BIM Alliance, buildingSMART plugins |
| CN6 | EU Taxonomy, LEED/BREEAM, Green Deal targets |

> **Στρατηγικό πλεονέκτημα**: Σχεδιάζοντας για τις πιο απαιτητικές αγορές (Κίνα),
> το σύστημα αυτόματα καλύπτει και τις λιγότερο ρυθμιζόμενες (Ελλάδα, ΕΕ).

### 11.4 Niche High-Complexity Markets

| Τύπος Έργου | Γιατί χρειάζεται advanced grid | Σύνδεση ADR |
|-------------|-------------------------------|-------------|
| **Φράγματα** | NURBS επιφάνειες, curved grids, τεράστιες κλίμακες | B76, P11 |
| **Σήραγγες** | Κυλινδρικοί κάνναβοι, curved + 3D | B76, B62 |
| **Γέφυρες** | Γραμμικά mega-projects, coordinate offset | P11, P5 |
| **Ουρανοξύστες** | Πολλοί όροφοι, per-floor grids, 4D phasing | §8.1, P6 |
| **Εργοστάσια prefab** | Χιλιοστομετρική ακρίβεια, CNC/robot export | P3, P4, P12 |

---

## 6. Πηγές

- [LH Λογισμική — Ενεργή οντότητα κάνναβος στο Fespa (Video)](https://www.lhlogismiki.gr/video/fespa-kannavos/)
- [Fespa Manual — Εγχειρίδιο Αναφοράς](https://www.lhlogismiki.gr/book/fespa-manual/)
- [Fespa — Εισαγωγή Δεδομένων](https://www.lhlogismiki.gr/proionta/statika/fespa/skyrodema-eisagogi-dedomenon/)
- [Fespa 4 Manual — DocPlayer (μερικό)](https://docplayer.gr/2296012-Fespa-4-for-windows-to-episiuo-egheiridio-anaforas-a-egheiridio-heirisuoy-athina-septeuvrios-2007.html)
- [Tekton — Σχεδιαστικό Πρόγραμμα](https://www.lhlogismiki.gr/proionta/sxediastika/tekton/)
- [Revit — Grid/Level Datums & Scope Boxes](https://help.autodesk.com/view/RVT/2024/ENU/?guid=GUID-GRID)
- [AutoCAD — Object Snap Tracking (OTRACK)](https://help.autodesk.com/view/ACD/2024/ENU/?guid=GUID-OSNAP-TRACKING)
- [Archicad — Curved Grid System](https://graphisoft.com/downloads/archicad)
- [buildingSMART — IFC IfcGrid/IfcGridAxis](https://standards.buildingsmart.org/IFC/RELEASE/IFC4/ADD2_TC1/HTML/schema/ifcproductextension/lexical/ifcgrid.htm)
- [Tekla — Grid Labels & Customization](https://support.tekla.com/doc/tekla-structures)
- [Autodesk Dreamcatcher — Generative Design](https://autodeskresearch.com/projects/dreamcatcher)
- [Bentley Generative Components](https://www.bentley.com/software/generativecomponents/)
- [Bentley iTwin — Digital Twins](https://www.bentley.com/software/itwin-platform/)
- [Rhino Grasshopper — Algorithmic Design](https://www.grasshopper3d.com/)
- [Trimble RealWorks — Point Cloud Processing](https://geospatial.trimble.com/products-and-solutions/trimble-realworks)
- [Vectorworks — Cloud Services](https://www.vectorworks.net/cloud-services)
- [Autodesk BIM 360 — Construction Management](https://construction.autodesk.com/)
- [ArchiCAD EcoDesigner — Energy Evaluation](https://graphisoft.com/solutions/ecodesigner)
- [Autodesk Insight — Building Performance](https://insight.autodesk.com/)

---

## Changelog

| Ημερομηνία | Αλλαγή |
|-----------|--------|
| 2026-02-19 | Δημιουργία ADR — Αρχικά ευρήματα από web research |
| 2026-02-19 | Πρώτη περιγραφή Γιώργου: Toolbar "Οδηγός", Οδηγός X/Z |
| 2026-02-19 | Ανάλυση screenshot Τέκτονα: visual appearance, status bar, snap step |
| 2026-02-19 | Διόρθωση: οι 2 λευκές γραμμές = σταυρόνημα (cursor), ΟΧΙ οδηγοί. Workflow τοποθέτησης. |
| 2026-02-19 | Πλήρης λίστα 14 εντολών Οδηγού — workflows, τόξα, παράλληλοι, διαγραφές, γενικές ιδιότητες |
| 2026-02-19 | Εγκεκριμένες βελτιώσεις B1-B12 + οπτική διαφοροποίηση + νέες ιδέες B13-B18 |
| 2026-02-19 | B13-B18 εγκρίθηκαν. Νέα ιδέα: αλληλεπίδραση με entities (§4.4) — snap points + guides σε γραμμές/κύκλους/τόξα |
| 2026-02-19 | B19-B22 εγκρίθηκαν. Property Eyedropper (§4.6) — κεντρικοποιημένο σύστημα. Ιδέες B23-B27 |
| 2026-02-19 | B23-B27 εγκρίθηκαν. Περιστροφή οδηγών B28-B30. Νέες ιδέες B31-B38 |
| 2026-02-19 | B31-B38 εγκρίθηκαν. Context-aware guides B39-B40. Ιδέες B41-B48 |
| 2026-02-19 | B41-B48 εγκρίθηκαν. Πλήρες Visual Rendering System (§4.12). Ιδέες B49-B55 |
| 2026-02-19 | B49-B55 εγκρίθηκαν. **Συλλογή απαιτήσεων ΟΛΟΚΛΗΡΩΘΗΚΕ** — 55 features. Ανάλυση κεντρικοποίησης (§7) |
| 2026-02-19 | UI: Floating Panel 3 επιπέδων (§4.13). Hatches vs Guides πρόβλεψη (§4.14) |
| 2026-02-19 | Implementation Design (§8): Scope Boxes, Snap Tracking, Curved Grid, IFC mapping, Coordinate System, Data Model, State Machine, Hit-testing, Performance, QA, Observability, Labels. Proposed TOC (§9) |
| 2026-02-19 | Industry Research & AI Readiness: B56-B93 (38 νέα features σε 8 κατηγορίες: AI/ML, 3D/4D, VR/AR, Collaboration, Sustainability, Geometry, UI/UX, Security). C14-C20 (7 νέα κεντρικοποιημένα συστήματα). §10 Future-Proofing (Parametric Binding, Generative Design, Scan-to-BIM, Digital Twin). **Σύνολο: 93 features + 20 centralized systems** |
| 2026-02-19 | Deep Industry Analysis P1-P8: Optimization Objectives (P1), Smart Guide Suggestions (P2), Fabrication-Ready Exports (P3), Tolerance-Aware Grid (P4), Hierarchical Grids (P5), 4D Phasing (P6), Constraint Satisfaction (P7), Grid Pattern Library (P8). Πηγές: TU Delft LoC Grid, ALLPLAN 2025, SAO papers, EN 13670, LandXML. |
| 2026-02-19 | Global Trends P9-P12: AI Copilot κόστους/άνθρακα (P9, PKPM/Glodon), AI Watchdog ανωμαλιών (P10, Nemetschek/Google Cloud), Dynamic Coordinate Offset mega-projects (P11, Linear Engineering), Robotics & Drones export (P12, G-code/waypoints). |
| 2026-02-19 | §11 China Strategy: Ρυθμιζόμενες αγορές CN1-CN6 (BIM Forward Design, Compliance Checking, CNC/Robotics Export, NURBS, Plugin API, Carbon). Εφαρμοσιμότητα ΕΕ. Niche markets. |
| 2026-02-19 | Global Market Expansion: §4.19 B94-B120 (27 features: 5G, seismic, 5D cost, EU compliance, metaverse, robotics, quantum, BIM 6.0). §7.6 C21-C25 (5G/IoT, Robotics Export, EN Compliance, Metaverse, Quantum). §10.8 P13-P16 (5G ecosystem, BIM-Robotics bridge, EU-China hybrid standards, quantum optimization). **ΤΕΛΙΚΟ: 120 features + 16 proposals + 6 CN requirements + 25 systems** |
| 2026-02-19 | **Phase 1A Implementation START**: guide-types.ts, guide-store.ts, guide-commands.ts, guide-renderer.ts, GuideSnapEngine.ts, useGuideState.ts, toolbar tools, DxfCanvas step 2.5, CanvasSection wiring |
| 2026-02-19 | **CRITICAL BUG FIX**: GuideStore immutable updates — `useSyncExternalStore` needs new array references on mutation. Fixed push→spread, splice→filter, in-place→map |
| 2026-02-19 | i18n translations (EN+EL) for all guide tools and snap modes |
| 2026-02-19 | Fix guide-delete hit tolerance (10→30px), guide-parallel distance limit removed |
| 2026-02-20 | Guide hover highlight (HIGHLIGHT_GUIDE_STYLE: gold, 2px, solid, 0.9 opacity) in delete/parallel modes |
| 2026-02-20 | Two-step parallel guide workflow: Step 1 click → select reference (highlight), Step 2 → prompt dialog for distance |
| 2026-02-20 | Intersection ✕ markers at all X/Y guide crossing points |
| 2026-02-20 | **Centralized PromptDialog system** (systems/prompt-dialog/): store + hook + component. Reusable across all DXF viewer tools for numeric/text input |
| 2026-02-20 | **Three-step parallel workflow**: Step 1 click → select reference (highlight), Step 2 click → choose side (left/right or above/below), Step 3 → prompt dialog for distance. Replaces two-step workflow |
| 2026-02-20 | **Smoother PromptDialog animation**: 350ms `cubic-bezier(0.16, 1, 0.3, 1)` entrance, soft scale (0.97→1), minimal translateY (-4px→0) |
| 2026-02-20 | **Phase 1A PARTIAL** — 4/14 commands: X ✅, Z ✅, Parallel ✅, Delete ✅ |
| 2026-02-20 | **Phase 1B START**: Keyboard chord shortcuts (G→X/Z/P/D/V) via chord leader pattern in EnhancedDXFToolbar |
| 2026-02-20 | **GuideContextMenu**: Right-click on guide → Delete, Lock/Unlock, Edit Label, Toggle Visibility. Imperative handle pattern (no parent re-render) |
| 2026-02-20 | **GuideStore expanded**: `setGuideLocked()`, `setGuideLabel()` methods for context menu operations |
| 2026-02-20 | **Guide visibility toggle button**: Eye/EyeOff action button in toolbar, connected to GuideStore singleton via useSyncExternalStore |
| 2026-02-20 | **Hotkey labels in dropdown**: Guide tools show G→X, G→Z, G→P, G→D in toolbar dropdown menu |
| 2026-02-20 | **Phase 1B COMPLETE** — Keyboard chords, context menu, visibility toggle, locking, label editing |
| 2026-02-20 | **Phase 1C START**: Diagonal (XZ) guides — `GridAxis` extended with `'XZ'`, `Guide` interface with optional `startPoint`/`endPoint`, indigo color `#6366F1` |
| 2026-02-20 | **CreateDiagonalGuideCommand**: Full undo/redo support, `addDiagonalGuideRaw()` in GuideStore |
| 2026-02-20 | **3-click diagonal workflow**: Click 1→start, Click 2→direction, Click 3→projected endpoint. Ghost preview: step 1 free direction, step 2 constrained |
| 2026-02-20 | **Diagonal rendering**: `drawDiagonalGuideLine()`, `renderGhostDiagonalGuide()`, indigo dashed line, intersection markers XZ∩X/Y |
| 2026-02-20 | **Snap to diagonal segments**: `projectPointOnSegment()` + `pointToSegmentDistance()` utilities in GuideSnapEngine |
| 2026-02-20 | **Diagonal guide keyboard chord**: G→K, toolbar dropdown entry with Slash icon |
| 2026-02-20 | **Fix parallel-from-diagonal**: CreateParallelGuideCommand handles XZ references (shifts start/end perpendicularly), cross product sign detection, ghost diagonal preview for XZ parallel |
| 2026-02-20 | **Fix guide-delete for XZ**: Hit detection uses `pointToSegmentDistance` for diagonal guides |
| 2026-02-20 | **Perpendicular guide tool (G→N)**: 1-click — X→Y swap, Y→X swap, XZ→perpendicular diagonal through projection point. Hover highlight in perpendicular mode |
| 2026-02-20 | **Phase 1C Construction Snap Points**: ConstructionPointStore (singleton+observer), 4 tools: Segment Points (G→S), Distance Points (G→A), Add Point (G→Q), Delete Point (G→W) |
| 2026-02-20 | **ConstructionPointSnapEngine**: Reads directly from singleton store (no manual sync), X marker rendering with highlight/snap feedback |
| 2026-02-20 | **Batch undo/redo**: AddConstructionPointBatchCommand uses groupId — entire Segments/Distance batch undone atomically |
| 2026-02-21 | **Guide Panel UI (§4.13)**: Floating panel (ADR-084 pattern) — guides grouped by axis (X/Y/XZ), construction points grouped by batch. Per-item: visibility, lock, delete, label edit. Keyboard chord G→L |
| 2026-02-21 | **GuideStore.setGuideVisible()**: Individual guide visibility toggle (separate from global visibility) |
| 2026-02-21 | **EventBus: 'grid:guide-panel-highlight'**: Panel hover → canvas gold highlight communication |
| 2026-02-21 | **CanvasSection merge highlight**: Tool-based highlight takes priority, panel highlight fills gap when no tool active |
| 2026-02-21 | **Snap-to-guide visual indicators**: SnapIndicatorOverlay — `case 'guide':` (═ double-line + tick), `case 'construction_point':` (◇ diamond + dot) |
| 2026-02-21 | **Snap tolerance increase**: Guide 7→12px, ConstructionPoint 6→8px — πιο εύκολο grab |
| 2026-02-21 | **ImmediateSnapStore entityId**: Snap-based guide highlight κατά τη σχεδίαση (guide φωτίζεται χρυσό) |
| 2026-02-21 | **Auto-enable snap on guide creation**: EventBus `grid:guide-added` → `setSnapEnabled(true)`. Sync `grid:snap-toggled` → SnapContext |
| 2026-02-21 | **CRITICAL FIX — 5 barriers removed for snap-to-guide**: (1) SnapOrchestrator early-exit on 0 entities, (2) useSnapManager setEnabled guard on entityCount>0, (3) useSnapManager initialize skip on 0 entities, (4) DEFAULT_PRO_SNAP_SETTINGS.enabled=false, (5) **ROOT CAUSE**: SnapContext.ALL_MODES missing GUIDE+CONSTRUCTION_POINT → enabledModes never included them → orchestrator always skipped GuideSnapEngine |
| 2026-02-21 | **§3.9 Arc Segments (G→T)**: Click arc/circle → prompt for segment count → equally-spaced X markers along arc. Circle: N points no duplicate. Arc: N+1 points (includes endpoints) |
| 2026-02-21 | **§3.10 Arc Distance (G→U)**: Click arc/circle → prompt for distance → X markers at fixed arc-length intervals. Circle: wraps around. Arc: includes endpoint |
| 2026-02-21 | **§3.12 Arc-Line Intersection (G→I)**: 2-click (line → arc/circle) → 0-2 X markers at intersection points. Parametric line-circle quadratic + angular range filter. Warning notification on 0 results |
| 2026-02-21 | **Arc geometry engine**: `computeArcSegmentPoints()`, `computeArcDistancePoints()`, `computeLineArcIntersection()` — pure math, DXF counterclockwise convention |
| 2026-02-21 | **Entity picking**: ArcPickableEntity/LinePickableEntity interfaces, hit-test via `pointToArcDistance()` for arcs, circumference distance for circles, `pointToLineDistance()` for lines |
| 2026-02-21 | **§3.11 Circle-Circle Intersection (G→O)**: 2-click (arc/circle → arc/circle) → 0-2 X markers. Radical line algorithm: d, a=(r1²-r2²+d²)/(2d), h=sqrt(r1²-a²), perpendicular offsets. `isPointInArcRange()` for arc angular filtering |
| 2026-02-21 | **14/14 guide commands COMPLETE** — All §3.1-§3.16 commands implemented |
| 2026-02-21 | **B5: Guide Drag & Drop (G→M)**: Live drag-move for X/Y/XZ guides. MoveGuideCommand with undo/redo. DraggingGuideState in useCanvasMouse (follows DraggingOverlayBodyState pattern). moveDiagonalGuideById() for XZ. Hover highlight on guide-move. Movement threshold check. Locked guides blocked |
| 2026-02-22 | **B1: Axis Label Bubbles**: Κυκλάκια A,B,C (X-guides, κορυφή) και 1,2,3 (Y-guides, δεξιά πλευρά). AutoCAD/Revit style. Screen-space rendering. Per-guide colors στα bubbles |
| 2026-02-22 | **B2: Auto Grid Generation (G→B)**: Toolbar dropdown entry + keyboard chord. PromptDialog for spacing pattern (equal/custom). Toolbar integration via toolDefinitions.tsx |
| 2026-02-22 | **B3: Dimension Annotations**: Αποστάσεις μεταξύ διαδοχικών οδηγών. X-axis→κορυφή, Y-axis→δεξιά πλευρά (μακριά από χάρακα). Screen-space text rendering |
| 2026-02-22 | **B6: Per-Guide Color Customization**: 8-χρωμη παλέτα (Cyan, Tomato, Indigo, Purple, Green, Orange, Red, Yellow) + reset. Context menu inline swatches. `resolveStyle()` respects `guide.style` overrides. `GuideStore.setGuideColor()` method |
| 2026-02-22 | **B36: Measure → Guide Integration**: `onMeasurementComplete` callback chain (useDrawingHandlers → useCanvasEffects → CanvasSection). Toast notification with "Create Guides" action button. Auto-creates X/Y guides at measurement points |
| 2026-02-22 | **FIX: B6 Color palette**: Changed `onClick` to `onSelect` with `preventDefault()` — prevents Radix DropdownMenu auto-close |
| 2026-02-22 | **FIX: Y-axis rendering**: Dimensions AND bubbles moved from LEFT to RIGHT edge — away from vertical ruler |
| 2026-02-22 | **B28: Guide Rotation (G→H)**: 2-step workflow (click guide → click pivot) + PromptDialog for angle. `RotateGuideCommand` with full undo/redo. X/Y→XZ axis conversion (±10000 extent). `replaceGuideWithRotated()` + `restoreGuideSnapshot()` in GuideStore. 13 files modified, 344 lines added |
| 2026-02-22 | **B30: Rotate All Guides (G→J)**: 1-click pivot → PromptDialog for angle → `RotateAllGuidesCommand` applies rotation to ALL visible/unlocked guides atomically. Batch undo restores all original snapshots. Reuses B28 geometry (±10000 extent, `rotatePoint()`). 10 files modified |
| 2026-02-22 | **B29: Rotate Guide Group (G→F)**: Click guides → toggle selection (multi-select) → click empty space → pivot → PromptDialog angle → `RotateGuideGroupCommand`. Smart click: near guide=toggle, far=pivot. Set-based selection state. 12 files modified |
| 2026-02-22 | **B33: Smart Equalize (G→Y)**: Select 3+ same-axis guides (click toggle) → click empty space → auto-equalize spacing. `EqualizeGuidesCommand` — keeps first/last, redistributes intermediates. No PromptDialog. Validation: same axis + ≥3. 12 files modified |
| 2026-02-22 | **FIX: Terminology**: Αντικατάσταση «περασιά» → «οδηγός» σε ΟΛΟΥΣ τους i18n, JSDoc, και ADR-189 docs (55 replacements) |
| 2026-02-22 | **B31: Polar Array (G→2)**: 1-click center → PromptDialog count → `PolarArrayGuidesCommand` creates N XZ diagonal guides at equal angles (360°/N). Full undo/redo. Radar icon. 14 files modified, 200 lines added |
| 2026-02-22 | **B32: Scale Grid (G→3)**: 1-click origin → PromptDialog scale factor → `ScaleAllGuidesCommand` scales all visible/unlocked guides. X/Y keep axis type (linear offset scaling), XZ scales both endpoints. Preserves axis type unlike rotation. Scaling icon. 14 files, 223 lines added |

---

## 12. Phase 1A Implementation Details (2026-02-19 → 2026-02-20)

### 12.1 Files Created (9)

| File | Lines | Purpose |
|------|-------|---------|
| `systems/guides/guide-types.ts` | ~110 | Guide interface, GuideRenderStyle, GUIDE_COLORS, GUIDE_LIMITS, HIGHLIGHT/GHOST/DEFAULT styles |
| `systems/guides/guide-store.ts` | ~180 | GuideStore singleton — CRUD, observer pattern, `useSyncExternalStore`-safe immutable ops |
| `systems/guides/guide-commands.ts` | ~200 | CreateGuideCommand, DeleteGuideCommand, CreateParallelGuideCommand — ICommand pattern |
| `systems/guides/guide-renderer.ts` | ~230 | GuideRenderer — infinite lines, ghost preview, hover highlight, intersection ✕ markers |
| `systems/guides/index.ts` | ~20 | Barrel exports |
| `hooks/state/useGuideState.ts` | ~120 | React hook bridging GuideStore — useSyncExternalStore + command dispatch |
| `snapping/engines/GuideSnapEngine.ts` | ~100 | BaseSnapEngine subclass — snap to X/Y guide offsets |
| `systems/prompt-dialog/prompt-dialog-store.ts` | ~140 | PromptDialogStore — Promise-based `prompt()`, singleton, observer |
| `systems/prompt-dialog/usePromptDialog.ts` | ~70 | React hook — `prompt()`, `confirm()`, `cancel()`, reactive snapshot |
| `systems/prompt-dialog/PromptDialog.tsx` | ~200 | Modal overlay — input, validation, Enter/Escape, unit suffix, dark theme |
| `systems/prompt-dialog/index.ts` | ~25 | Barrel exports |

### 12.2 Files Modified (9)

| File | Changes |
|------|---------|
| `snapping/extended-types.ts` | Added `GUIDE` to ExtendedSnapType enum |
| `snapping/orchestrator/SnapEngineRegistry.ts` | Register GuideSnapEngine |
| `ui/toolbar/types.ts` | Added guide-x, guide-z, guide-parallel, guide-delete to ToolType |
| `ui/toolbar/toolDefinitions.tsx` | New "Guides" tool group with 4 tools |
| `canvas-v2/dxf-canvas/DxfCanvas.tsx` | guides/guidesVisible/ghostGuide/highlightedGuideId props, step 2.5 rendering |
| `components/dxf-layout/CanvasLayerStack.tsx` | Pass-through guide props |
| `components/dxf-layout/CanvasSection.tsx` | useGuideState, usePromptDialog, parallel ref state, highlightedGuideId, ghostGuide, PromptDialog render |
| `hooks/canvas/useCanvasClickHandler.ts` | Priority 1.6 guide click routing — X/Z placement, delete, parallel ref selection |
| `i18n/locales/{en,el}/dxf-viewer.json` | Guide tool labels, snap mode labels, prompt dialog translations |

### 12.3 Architecture Decisions

1. **Guides are NOT DXF entities** — they live in `GuideStore` (separate from `ISceneManager`), do not export to DXF
2. **Rendering at step 2.5** — between grid (step 2) and rulers (step 3) in DxfCanvas RAF loop
3. **Immutable state for React** — `useSyncExternalStore` requires new array references; all mutations use spread/filter/map
4. **Centralized PromptDialog** — Promise-based `prompt()` callable from any hook; single overlay rendered in CanvasSection
5. **Three-step parallel workflow** — Step 1: click to select reference guide (highlight), Step 2: click on desired side (determines ±sign), Step 3: typed distance in prompt dialog (sign × distance = final offset)
6. **PromptDialog soft entrance** — 350ms `cubic-bezier(0.16, 1, 0.3, 1)` animation, state machine `closed→entering→open`, createPortal to document.body at z-10001

### 12.4 Features Implemented

- [x] Vertical guide (X) — 1 click placement
- [x] Horizontal guide (Z/Y) — 1 click placement
- [x] Parallel guide — 3-step: click reference → click side → distance dialog
- [x] Delete guide — 1 click (30px tolerance)
- [x] Ghost guide preview during placement
- [x] Guide hover highlight (gold, 2px, in delete/parallel modes)
- [x] Intersection ✕ markers at X/Y crossings
- [x] Guide snap engine (snaps to guide offsets)
- [x] Undo/redo (via ICommand pattern)
- [x] Global visibility toggle
- [x] Per-axis color coding (cyan X, tomato Y, purple parallel)
- [x] i18n translations (EN + EL)
- [x] Centralized prompt dialog (reusable system)

---

## 13. Phase 1B Implementation Details (2026-02-20)

### 13.1 Files Created (1)

| File | Lines | Purpose |
|------|-------|---------|
| `ui/components/GuideContextMenu.tsx` | ~200 | Right-click context menu for guides: Delete, Lock/Unlock, Edit Label, Toggle Visibility, Cancel |

### 13.2 Files Modified (10)

| File | Changes |
|------|---------|
| `config/keyboard-shortcuts.ts` | Added `DXF_GUIDE_CHORD_MAP`, `GUIDE_CHORD_LEADER`, `GUIDE_CHORD_TIMEOUT_MS` for chord shortcuts |
| `ui/toolbar/EnhancedDXFToolbar.tsx` | Chord leader system: G press starts 350ms window, second key (X/Z/P/D/V) resolves to guide action |
| `ui/toolbar/toolDefinitions.tsx` | Hotkey labels (G→X, G→Z, G→P, G→D) in dropdown + Eye/EyeOff toggle-guides action button |
| `ui/toolbar/types.ts` | Added `hotkey?: string` to dropdown options, `guidesVisible?: boolean` to toolbar props |
| `ui/toolbar/ToolButton.tsx` | Render hotkey badge in dropdown items |
| `hooks/useDxfViewerState.ts` | Handle `toggle-guides` action via GuideStore singleton |
| `hooks/state/useGuideState.ts` | Added `getStore()` accessor for direct lock/label operations |
| `hooks/canvas/useCanvasContextMenu.ts` | PRIORITY 0.5: Guide hit-testing on right-click → GuideContextMenu.open() |
| `systems/guides/guide-store.ts` | Added `setGuideLocked()`, `setGuideLabel()` mutation methods |
| `components/dxf-layout/CanvasSection.tsx` | GuideContextMenu ref + handlers (delete, lock, edit label), JSX render |
| `components/dxf-layout/ToolbarSection.tsx` | `useSyncExternalStore` for guidesVisible → toolbar toggle button |
| `i18n/locales/{en,el}/dxf-viewer.json` | Added: editLabel, enterLabel, showGuides, hideGuides translations |

### 13.3 Architecture Decisions

1. **Chord shortcut pattern** — G key starts 350ms chord window; if no second key, falls back to grip-edit. Preserves backward compatibility
2. **Guide context menu follows imperative handle pattern** — `forwardRef` + `useImperativeHandle` for `open(x, y, guide)`, same as EntityContextMenu
3. **Hit-testing in context menu hook** — PRIORITY 0.5 (before drawing/entity menus), 30px tolerance, world-space distance calculation
4. **GuideStore direct access for non-undoable ops** — Lock/label changes are immediate (no Command pattern), accessible via `getStore()`
5. **Guide visibility via singleton subscription** — ToolbarSection subscribes directly to GuideStore for toggle button state, avoiding prop drilling

### 13.4 Features Implemented

- [x] Keyboard chord shortcuts: G→X (vertical), G→Z (horizontal), G→P (parallel), G→D (delete), G→V (visibility)
- [x] Right-click context menu on guides (Delete, Lock/Unlock, Edit Label, Toggle All, Cancel)
- [x] Guide visibility toggle button in toolbar (Eye/EyeOff icon)
- [x] Hotkey labels displayed in guide dropdown menu
- [x] Guide locking (prevents delete/move)
- [x] Guide label editing via PromptDialog

---

## 14. Phase 1C Implementation Details (2026-02-20)

### 14.1 Data Model Extension

Extended `Guide` interface (backward compatible — optional fields):
```typescript
// guide-types.ts
interface Guide {
  // ... existing fields ...
  readonly startPoint?: Point2D;  // Only for XZ diagonal guides
  readonly endPoint?: Point2D;    // Only for XZ diagonal guides
}
```

Extended `GridAxis`:
```typescript
type GridAxis = 'X' | 'Y' | 'XZ';
```

New type guard and math utilities:
- `isDiagonalGuide(guide)` — type narrowing for XZ guides
- `pointToSegmentDistance(point, segStart, segEnd)` — clamped perpendicular distance
- `projectPointOnSegment(point, segStart, segEnd)` — returns `{ snapPoint, distance, t }`

### 14.2 Files Modified (21 — Phase 1C diagonal commit)

| File | Changes |
|------|---------|
| `ai-assistant/grid-types.ts` | `GridAxis = 'X' \| 'Y'` → `'X' \| 'Y' \| 'XZ'` |
| `systems/guides/guide-types.ts` | `startPoint?`, `endPoint?` on Guide, `XZ: '#6366F1'` color, `isDiagonalGuide()`, `pointToSegmentDistance()`, `projectPointOnSegment()` |
| `config/color-config.ts` | `GUIDE_XZ: '#6366F1'` (indigo) |
| `systems/guides/guide-store.ts` | `addDiagonalGuideRaw()`, `findNearestGuide()` XZ branch |
| `systems/guides/guide-commands.ts` | `CreateDiagonalGuideCommand` class, `CreateParallelGuideCommand` XZ support |
| `systems/guides/guide-renderer.ts` | `drawDiagonalGuideLine()`, `renderGhostDiagonalGuide()`, `resolveDiagonalStyle()`, `drawDiagonalIntersectionMarkers()` |
| `systems/guides/index.ts` | Barrel exports for new commands and utilities |
| `snapping/engines/GuideSnapEngine.ts` | XZ snap via `projectPointOnSegment()` |
| `hooks/state/useGuideState.ts` | `addDiagonalGuide()` method |
| `hooks/canvas/useCanvasClickHandler.ts` | Priority 1.6 guide-xz 3-click routing, guide-perpendicular handler, XZ hit detection in delete/parallel |
| `components/dxf-layout/CanvasSection.tsx` | Diagonal 3-click state, ghost diagonal preview, XZ parallel ghost, perpendicular highlight |
| `components/dxf-layout/CanvasLayerStack.tsx` | `ghostDiagonalGuide` prop pass-through |
| `canvas-v2/dxf-canvas/DxfCanvas.tsx` | `ghostDiagonalGuide` prop, ref, render in RAF loop |
| `ui/toolbar/types.ts` | `'guide-xz'`, `'guide-perpendicular'` in ToolType |
| `ui/toolbar/toolDefinitions.tsx` | Slash + CornerDownRight icons, dropdown entries G→K, G→N |
| `config/keyboard-shortcuts.ts` | `K` (diagonal), `N` (perpendicular) in chord map |
| `systems/tools/ToolStateManager.ts` | `guide-xz`, `guide-perpendicular` registry entries |
| `constants/property-statuses-enterprise.ts` | `GUIDE_XZ`, `GUIDE_PERPENDICULAR` labels |
| `i18n/locales/en/dxf-viewer.json` | "Diagonal Guide", "Perpendicular Guide" |
| `i18n/locales/el/dxf-viewer.json` | "Λοξός Οδηγός", "Κάθετος Οδηγός" |
| `systems/phase-manager/PhaseManager.ts` | Guide tool awareness |

### 14.3 Architecture Decisions

1. **Extended Interface (Option B)** — Optional `startPoint?`/`endPoint?` on Guide, not discriminated union. Backward compatible with 15+ existing files
2. **XZ guides are finite segments** — Unlike infinite X/Y offset lines, diagonals have start and end points
3. **3-click state machine** — Step 0→start, Step 1→direction (free ghost), Step 2→end (constrained projection onto direction). Follows AutoCAD construction line pattern
4. **Projection math for Step 2** — `t = dot(AP, AB) / dot(AB, AB)` gives unclamped parameter; endpoint placed along direction line
5. **Perpendicular to XZ** — Projects click onto reference, creates perpendicular diagonal centered on projection point with half-reference-length in each direction
6. **Parallel-from-XZ** — Shifts start/end perpendicularly using normal vector `(-dy/len, dx/len) * distance * sign`; sign via cross product
7. **Indigo (#6366F1) for XZ** — Visually distinct from cyan (X) and tomato (Y)

### 14.4 Features Implemented

- [x] Diagonal (XZ) guide — 3-click placement (start → direction → projected end)
- [x] Ghost diagonal preview (free direction + constrained to direction)
- [x] Diagonal rendering (indigo dashed, finite segment)
- [x] Diagonal intersection markers (XZ ∩ X/Y crossings)
- [x] Snap to diagonal segments (perpendicular projection, clamped)
- [x] Diagonal undo/redo (CreateDiagonalGuideCommand)
- [x] Keyboard chord G→K
- [x] Parallel from diagonal (perpendicular shift of start/end)
- [x] Ghost preview for XZ parallel (shifted diagonal follows cursor)
- [x] Delete diagonal guides (pointToSegmentDistance hit detection)
- [x] Perpendicular guide tool — 1-click (G→N): X→Y, Y→X, XZ→perpendicular diagonal
- [x] Hover highlight in perpendicular mode
- [x] i18n translations (EN + EL)

---

## 15. Phase 1C — Construction Snap Points (2026-02-20)

### 15.1 Data Model

New `ConstructionPoint` interface in `guide-types.ts`:
```typescript
interface ConstructionPoint {
  readonly id: string;           // Unique ID (crypto.randomUUID)
  readonly point: Point2D;       // World coordinates
  readonly label: string | null; // Optional text label
  visible: boolean;              // Visibility toggle
  locked: boolean;               // Lock prevents delete
  readonly createdAt: string;    // ISO timestamp
  readonly groupId: string | null; // Batch link for Segments/Distance
}
```

Constants: `CONSTRUCTION_POINT_LIMITS = { MAX_POINTS: 5000, MIN_DISTANCE: 0.001, HIT_RADIUS_PX: 6 }`

### 15.2 Files Created (4)

| File | Lines | Purpose |
|------|-------|---------|
| `systems/guides/construction-point-store.ts` | ~300 | ConstructionPointStore singleton — addPoint, addPointsBatch, restorePoint, restorePointsBatch, removePointById, removePointsByGroupId, findNearestPoint, clearAll. Observer + immutable arrays for useSyncExternalStore |
| `systems/guides/construction-point-commands.ts` | ~120 | ICommand classes: AddConstructionPointCommand, AddConstructionPointBatchCommand, DeleteConstructionPointCommand |
| `hooks/state/useConstructionPointState.ts` | ~130 | React hook — useSyncExternalStore bridge, computeSegmentPoints(), computeDistancePoints() math |
| `snapping/engines/ConstructionPointSnapEngine.ts` | ~90 | BaseSnapEngine subclass — reads directly from singleton store (no setPoints call needed) |

### 15.3 Files Modified (17)

| File | Changes |
|------|---------|
| `systems/guides/guide-types.ts` | ConstructionPoint interface, CONSTRUCTION_POINT_LIMITS constant |
| `systems/guides/guide-renderer.ts` | `renderConstructionPoints()`, `drawConstructionPointMarker()` — X/+ markers, gold highlight, snap feedback |
| `systems/guides/index.ts` | Barrel exports for new store, commands, types |
| `snapping/extended-types.ts` | `CONSTRUCTION_POINT` in ExtendedSnapType enum, default enabled, priority, tolerance 6px |
| `snapping/orchestrator/SnapEngineRegistry.ts` | Register ConstructionPointSnapEngine instance |
| `config/tolerance-config.ts` | `CONSTRUCTION_POINT: 1` in SNAP_ENGINE_PRIORITIES |
| `ui/toolbar/types.ts` | 4 new ToolType entries: guide-segments, guide-distance, guide-add-point, guide-delete-point |
| `ui/toolbar/toolDefinitions.tsx` | 4 dropdown entries with icons (ScissorsLineDashed, Ruler, Plus, Minus) and hotkeys |
| `systems/tools/ToolStateManager.ts` | 4 tool state entries (segments/distance: non-continuous; add/delete: continuous) |
| `config/keyboard-shortcuts.ts` | G→S (segments), G→A (distance), G→Q (add point), G→W (delete point) |
| `constants/property-statuses-enterprise.ts` | GUIDE_SEGMENTS, GUIDE_DISTANCE, GUIDE_ADD_POINT, GUIDE_DELETE_POINT labels |
| `hooks/canvas/useCanvasClickHandler.ts` | Priority 1.8–1.86 click routing for 4 tools |
| `components/dxf-layout/CanvasSection.tsx` | cpState hook, segments/distance 2-step state, prompt dialogs, highlightedPointId, ghostSegmentLine |
| `components/dxf-layout/CanvasLayerStack.tsx` | constructionPoints, highlightedPointId, ghostSegmentLine props |
| `canvas-v2/dxf-canvas/DxfCanvas.tsx` | constructionPoints, highlightedPointId, ghostSegmentLine props + refs + render calls (step 2.6) |
| `ui/components/ProSnapToolbar.tsx` | CONSTRUCTION_POINT key in SNAP_MODE_KEYS record |
| `i18n/locales/{en,el}/dxf-viewer.json` | Tool labels, dialog texts, snap mode labels |

### 15.4 Architecture Decisions

1. **Singleton Store read** — ConstructionPointSnapEngine reads directly from `getGlobalConstructionPointStore()` in `findSnapCandidates()` (no manual sync/setPoints call needed). Avoids complex wiring through SnapOrchestrator → SnapEngineRegistry chain
2. **Batch undo via groupId** — Segments/Distance tools create multiple points with shared `groupId`. `AddConstructionPointBatchCommand.undo()` calls `removePointsByGroupId()` → atomic batch removal. `redo()` restores all via `restorePointsBatch()`
3. **Ghost segment line** — Reuses same `{ start, end }` pattern as ghostDiagonalGuide. Rendered via `renderGhostDiagonalGuide()` (same visual style)
4. **X → + snap feedback** — Default ✕ marker (4px, white 0.5α). On snap → + pattern (horizontal+vertical). On delete hover → gold glow highlight
5. **Rendering at step 2.6** — After guides (2.5), before rulers (3). Ensures points appear above guides but below UI

### 15.5 Math: Segment Points

```typescript
// segmentCount + 1 points (including start and end)
for (let i = 0; i <= segmentCount; i++) {
  const t = i / segmentCount;
  points.push({ x: start.x + t * dx, y: start.y + t * dy });
}
```

### 15.6 Math: Distance Points

```typescript
// Fixed interval along direction vector, always includes start and end
let d = distance;
while (d < totalLen - MIN_DISTANCE) {
  points.push({ x: start.x + ux * d, y: start.y + uy * d });
  d += distance;
}
```

### 15.7 Features Implemented

- [x] Add Point tool (G→Q) — 1-click, continuous mode
- [x] Delete Point tool (G→W) — 1-click near marker, gold hover highlight, continuous mode
- [x] Segment Points tool (G→S) — 2-click + dialog (segment count ≥ 2), batch create
- [x] Distance Points tool (G→A) — 2-click + dialog (distance > 0), batch create
- [x] Ghost segment preview (dashed line from start to cursor during step 1)
- [x] X marker rendering (white ✕, snapped +, delete highlight gold)
- [x] Snap to construction points (ConstructionPointSnapEngine, reads from singleton)
- [x] Batch undo/redo (groupId-based atomic operations)
- [x] Keyboard chord shortcuts (G→S/A/Q/W)
- [x] i18n translations (EN + EL)
- [x] ProSnapToolbar integration (CONSTRUCTION_POINT mode toggle)

---

## 16. Guide Panel UI — §4.13 (2026-02-21)

### 16.1 Overview

Floating panel showing all guides and construction points with per-item actions.
Pattern: CursorSettingsPanel (FloatingPanel ADR-084 compound component).

- **Position**: Top-right, 320×480px, draggable
- **Toggle**: Keyboard chord G→L or toolbar action
- **Architecture**: `GuidePanel` → `GuideListSection` + `ConstructionPointSection`

### 16.2 Files Created (4)

| File | Lines | Purpose |
|------|-------|---------|
| `ui/panels/guide-panel/GuidePanel.tsx` | ~180 | Main FloatingPanel wrapper — global actions bar, empty state, stats footer |
| `ui/panels/guide-panel/GuideListSection.tsx` | ~170 | Guides grouped by axis (X/Y/XZ) with Radix Collapsible, per-item actions |
| `ui/panels/guide-panel/ConstructionPointSection.tsx` | ~120 | Points grouped by groupId, batch delete support |
| `ui/panels/guide-panel/index.ts` | 1 | Barrel export |

### 16.3 Files Modified (12)

| File | Change |
|------|--------|
| `systems/guides/guide-store.ts` | +`setGuideVisible(id, visible)` method — individual guide visibility |
| `systems/events/EventBus.ts` | +`'grid:guide-panel-highlight'` event type |
| `hooks/common/useToolbarState.ts` | +`showGuidePanel` state + `toggleGuidePanel` callback |
| `hooks/useDxfViewerState.ts` | +`toggle-guide-panel` action case |
| `layout/FloatingPanelsSection.tsx` | +`showGuidePanel` prop, conditional GuidePanel render |
| `app/DxfViewerContent.tsx` | Destructure + pass `showGuidePanel` prop |
| `config/keyboard-shortcuts.ts` | +`L` key in `DXF_GUIDE_CHORD_MAP` → `action:toggle-guide-panel` |
| `components/dxf-layout/CanvasSection.tsx` | +`panelHighlightGuideId` state, EventBus subscription, merged highlight |
| `i18n/locales/en/dxf-viewer.json` | +22 keys in `guidePanel` section |
| `i18n/locales/el/dxf-viewer.json` | +22 keys in `guidePanel` section (Greek) |

### 16.4 Component Architecture

```
GuidePanel (FloatingPanel ADR-084)
  ├─ FloatingPanel.Header (title: "Guides & Points", icon: Ruler)
  └─ FloatingPanel.Content
       ├─ <nav> Global Actions Bar
       │    ├─ Toggle All Visibility (Eye/EyeOff)
       │    ├─ Snap Toggle (Magnet)
       │    ├─ Delete All Guides (Trash2)
       │    └─ Delete All Points (Trash2)
       ├─ Empty state ("No guides or points yet")
       ├─ GuideListSection
       │    ├─ Collapsible "Vertical (X)" — cyan dot
       │    │    └─ GuideItem × N (color dot, label/offset, Eye, Lock, Pencil, Trash2)
       │    ├─ Collapsible "Horizontal (Y)" — tomato dot
       │    │    └─ GuideItem × N
       │    └─ Collapsible "Diagonal (XZ)" — indigo dot
       │         └─ GuideItem × N
       ├─ ConstructionPointSection
       │    ├─ Collapsible "grp_xxx" — amber dot
       │    │    ├─ PointItem × N (coordinates, delete)
       │    │    └─ "Delete Group" button
       │    └─ Collapsible "Individual Points" — amber dot
       │         └─ PointItem × N
       └─ <footer> "5 guides, 12 points"
```

### 16.5 Per-Item Actions

| Action | Guide | Point | Method |
|--------|-------|-------|--------|
| Visibility toggle | ✅ Eye/EyeOff | — | `GuideStore.setGuideVisible()` |
| Lock/Unlock | ✅ Lock/Unlock | — | `GuideStore.setGuideLocked()` |
| Delete | ✅ Trash2 (disabled when locked) | ✅ Trash2 | `useGuideState.removeGuide()` / `useConstructionPointState.deletePoint()` |
| Edit label | ✅ Pencil → PromptDialog | — | `GuideStore.setGuideLabel()` |
| Hover highlight | ✅ gold on canvas | — | EventBus `'grid:guide-panel-highlight'` |
| Delete group | — | ✅ (batch by groupId) | `ConstructionPointStore.removePointsByGroupId()` |

### 16.6 Canvas Highlight Merge

```typescript
// Tool-based highlight takes priority (delete/parallel/perpendicular tools)
// Panel highlight fills gap when no tool is active
const effectiveHighlightedGuideId = highlightedGuideId ?? panelHighlightGuideId;
```

### 16.7 Keyboard Chord

| Leader | Second Key | Action |
|--------|------------|--------|
| G | L | `action:toggle-guide-panel` → `handleAction('toggle-guide-panel')` |

### 16.8 Reused Centralized Systems

- FloatingPanel (ADR-084) — compound component
- Radix Collapsible — group collapse
- Shadcn Button/Tooltip — action buttons
- EventBus — panel → canvas communication
- PromptDialog — label editing
- PANEL_LAYOUT tokens — spacing
- GUIDE_COLORS — color dots per axis
- useSyncExternalStore — tear-free subscriptions

## 17. Phase 2 Enhancements — B1/B2/B3/B6/B36 (2026-02-22)

### 17.1 B1: Axis Label Bubbles

Screen-space circular labels at guide edges:
- **X guides** (vertical): bubbles at **top** (y=14px), labels A, B, C...
- **Y guides** (horizontal): bubbles at **right edge** (x=viewport.width-14px), labels 1, 2, 3...
- Per-guide color support via `guide.style.color`
- `autoLabel(index, axis)` generates labels automatically
- `drawBubble(ctx, x, y, label, color)` renders filled circle with centered text

### 17.2 B2: Auto Grid Generation (G→B)

- **Toolbar**: guide-grid entry in dropdown, `Grid` icon
- **Keyboard chord**: G→B
- **ToolType**: `'guide-grid'` added to union
- **i18n**: EN "Auto Grid", EL "Αυτόματο Πλέγμα"
- **Workflow**: Click origin → PromptDialog for spacing pattern → generate guides

### 17.3 B3: Dimension Annotations Between Guides

Screen-space distance labels between consecutive guides:
- **X guides**: dimensions rendered at **top** of viewport
- **Y guides**: dimensions rendered at **right edge** (away from ruler)
- `renderAxisDimensions()` in GuideRenderer
- Measurements formatted as "5.00μ" with proper scaling

### 17.4 B6: Per-Guide Color Customization

- **GUIDE_COLOR_PALETTE**: 8 colors (Cyan, Tomato, Indigo, Purple, Green, Orange, Red, Yellow)
- **GuideStore.setGuideColor(id, color)**: Sets or resets (`null`) per-guide style
- **resolveStyle()**: Checks `guide.style` first, then falls back to axis defaults
- **Context menu**: "Color" item with `onSelect+preventDefault` to keep menu open
- **Palette UI**: Inline swatch row with reset button (`RotateCcw` icon)
- **CSS**: `GuideColorPalette.module.css` — `.paletteRow`, `.swatch`, `.swatchActive`, `.currentSwatch`, `.resetButton`

### 17.5 B36: Measure → Guide Integration

- **Callback chain**: `useDrawingHandlers` → `useCanvasEffects` → `CanvasSection`
- **MEASURE_TOOLS_FOR_GUIDES**: `measure-distance`, `measure-distance-continuous`, `measure-angle`
- **onMeasurementComplete**: Fires after measurement tool completes with all points
- **Notification**: Toast with "Create Guides" action button (5s duration)
- **Guide creation**: Extracts unique X/Y offsets from measurement points → `guideState.addGuide()`

### 17.6 Files Modified (Session 2026-02-22)

| File | Changes |
|------|---------|
| `systems/guides/guide-renderer.ts` | B1 bubbles, B3 dimensions, B6 resolveStyle, Y-axis right-edge rendering |
| `systems/guides/guide-store.ts` | B6 setGuideColor() method |
| `systems/guides/guide-types.ts` | B6 GUIDE_COLOR_PALETTE constant |
| `systems/guides/index.ts` | B6 barrel export |
| `ui/components/GuideContextMenu.tsx` | B6 color palette UI, onSelect fix |
| `ui/components/GuideColorPalette.module.css` | B6 swatch styles (NEW) |
| `ui/toolbar/toolDefinitions.tsx` | B2 guide-grid dropdown entry |
| `ui/toolbar/types.ts` | B2 guide-grid ToolType |
| `config/keyboard-shortcuts.ts` | B2 G→B shortcut |
| `components/dxf-layout/CanvasSection.tsx` | B2 handleGridOriginSet, B6 handleGuideContextChangeColor, B36 handleMeasurementComplete |
| `hooks/canvas/useCanvasClickHandler.ts` | B2 grid origin click handler |
| `hooks/canvas/useCanvasEffects.ts` | B36 onMeasurementComplete passthrough |
| `hooks/drawing/useDrawingHandlers.ts` | B36 MEASURE_TOOLS_FOR_GUIDES, onMeasurementComplete callback |
| `constants/property-statuses-enterprise.ts` | B2 GUIDE_GRID label |
| i18n (el/en dxf-viewer.json + tool-hints.json) | B2, B6, B36 translations |

## 18. B28: Guide Rotation — Implementation Details (2026-02-22)

### 18.1 Architecture

3-step workflow: Click guide → Click pivot → PromptDialog for angle (degrees).
X/Y axis guides convert to XZ (diagonal) after rotation — finite ±10000 unit segments centered on pivot.
XZ guides rotate their existing startPoint/endPoint. Full undo restores original axis type via snapshot.

### 18.2 Core Components

| Component | Purpose |
|-----------|---------|
| `RotateGuideCommand` | ICommand — pre-calculates rotated endpoints, stores Guide snapshot for undo |
| `GuideStore.replaceGuideWithRotated()` | Replaces guide with new XZ endpoints, preserves id/label/style/locked |
| `GuideStore.restoreGuideSnapshot()` | Full snapshot restore for undo — reverts axis type + offset |
| `useGuideState.rotateGuide()` | Creates + executes RotateGuideCommand, emits `grid:guide-rotated` |
| `useCanvasClickHandler` | Step 0: find nearest guide (30px), Step 1: set pivot point |
| `CanvasSection` | State management, PromptDialog trigger, highlight integration |

### 18.3 Axis Conversion Logic

```
X (vertical, offset=100) → segment [(100, pivot.y-10000), (100, pivot.y+10000)] → rotatePoint() → XZ
Y (horizontal, offset=200) → segment [(pivot.x-10000, 200), (pivot.x+10000, 200)] → rotatePoint() → XZ
XZ (diagonal) → existing startPoint/endPoint → rotatePoint() → XZ (same type)
```

### 18.4 Edge Cases

| Case | Handling |
|------|---------|
| Locked guide | Skipped in hit-test |
| Invisible guide | Skipped in hit-test |
| Angle=0 or 360 | Rejected (no-op) |
| NaN input | Rejected by PromptDialog validation |
| Undo X/Y→XZ | `restoreGuideSnapshot()` restores original axis + offset |

### 18.5 Reused Systems

- `rotatePoint()` from `utils/rotation-math.ts` — zero new math code
- `PromptDialog` (centralized) — same pattern as parallel distance
- `ICommand` interface — enterprise command pattern
- Guide highlight — existing `needsToolHighlight` logic
- Keyboard chord G→H — existing leader key pattern (350ms window)

### 18.6 Files Modified (Session 2026-02-22 — B28)

| File | Changes |
|------|---------|
| `ui/toolbar/types.ts` | `'guide-rotate'` added to ToolType union |
| `systems/guides/guide-store.ts` | `replaceGuideWithRotated()`, `restoreGuideSnapshot()` methods |
| `systems/guides/guide-commands.ts` | `RotateGuideCommand` class (~100 lines) |
| `hooks/state/useGuideState.ts` | `rotateGuide()` method, EventBus emit |
| `hooks/canvas/useCanvasClickHandler.ts` | 2-step guide-rotate handler (PRIORITY 1.8992) |
| `components/dxf-layout/CanvasSection.tsx` | State, callbacks, PromptDialog, highlight, tool hint override |
| `config/keyboard-shortcuts.ts` | G→H chord for guide-rotate |
| `ui/toolbar/toolDefinitions.tsx` | Dropdown entry with RotateCw icon |
| `constants/property-statuses-enterprise.ts` | `GUIDE_ROTATE` label |
| i18n (el/en dxf-viewer.json) | Tool labels, PromptDialog titles |
| i18n (el/en tool-hints.json) | Tool hints: name, description, steps, shortcuts |

## 19. B30: Rotate All Guides — Implementation Details (2026-02-22)

### 19.1 Architecture

1-step workflow: Click pivot → PromptDialog for angle (degrees).
Applies rotation to ALL visible, unlocked guides atomically via `RotateAllGuidesCommand`.
Reuses B28 geometry engine: X/Y→XZ conversion (±10000 extent), `rotatePoint()`.
Full batch undo restores all original Guide snapshots in reverse order.

### 19.2 Core Components

| Component | Purpose |
|-----------|---------|
| `RotateAllGuidesCommand` | ICommand — iterates all eligible guides, pre-computes rotated endpoints, stores snapshots for batch undo |
| `useGuideState.rotateAllGuides()` | Creates + executes command, emits `grid:all-guides-rotated` |
| `useCanvasClickHandler` | 1-click handler: sets pivot directly (no guide selection step) |
| `CanvasSection.handleRotateAllPivotSet` | Opens PromptDialog, validates angle, calls `rotateAllGuides()` |

### 19.3 Key Differences from B28

| Aspect | B28 (Single) | B30 (All) |
|--------|-------------|-----------|
| Steps | 2 (guide + pivot) | 1 (pivot only) |
| Scope | Single guide | All visible, unlocked |
| Command | `RotateGuideCommand` | `RotateAllGuidesCommand` |
| Undo | 1 snapshot | N snapshots (reverse order) |
| Keyboard | G→H | G→J |

### 19.4 Files Modified (Session 2026-02-22 — B30)

| File | Changes |
|------|---------|
| `ui/toolbar/types.ts` | `'guide-rotate-all'` added to ToolType union |
| `systems/guides/guide-commands.ts` | `RotateAllGuidesCommand` class (~100 lines) |
| `hooks/state/useGuideState.ts` | `rotateAllGuides()` method, EventBus emit |
| `hooks/canvas/useCanvasClickHandler.ts` | 1-click handler (PRIORITY 1.8993) |
| `components/dxf-layout/CanvasSection.tsx` | `handleRotateAllPivotSet` callback with PromptDialog |
| `config/keyboard-shortcuts.ts` | G→J chord for guide-rotate-all |
| `ui/toolbar/toolDefinitions.tsx` | Dropdown entry with RotateCw icon |
| `constants/property-statuses-enterprise.ts` | `GUIDE_ROTATE_ALL` label |
| i18n (el/en dxf-viewer.json) | Tool labels + PromptDialog titles |
| i18n (el/en tool-hints.json) | Tool hints: name, description, steps, shortcuts |

## 20. B29: Rotate Guide Group — Implementation Details (2026-02-22)

### 20.1 Architecture

Smart 2-phase workflow without explicit mode switching:
- **Click near guide** (<30px tolerance) → toggles guide in/out of selection Set
- **Click empty space** (no guide within tolerance, ≥1 guide selected) → sets pivot → PromptDialog

`RotateGuideGroupCommand` reuses same geometry as B28/B30 but only operates on explicitly provided guide IDs.

### 20.2 Core Components

| Component | Purpose |
|-----------|---------|
| `RotateGuideGroupCommand` | ICommand — operates on `guideIds: readonly string[]`, same geometry as B30 |
| `useGuideState.rotateGuideGroup()` | Creates + executes command, emits `grid:guide-group-rotated` |
| `useCanvasClickHandler` | Smart click: near guide=toggle selection, far=set pivot |
| `CanvasSection` | `rotateGroupSelectedIds: Set<string>`, toggle/pivot callbacks |

### 20.3 Smart Click Detection

```
click at worldPoint:
  1. Find nearest guide within 30px tolerance
  2. If found → toggle its membership in rotateGroupSelectedIds
  3. If NOT found AND selectedIds.size > 0 → worldPoint becomes pivot → PromptDialog
  4. If NOT found AND selectedIds.size = 0 → no-op
```

### 20.4 Files Modified (Session 2026-02-22 — B29)

| File | Changes |
|------|---------|
| `ui/toolbar/types.ts` | `'guide-rotate-group'` added to ToolType union |
| `systems/guides/guide-commands.ts` | `RotateGuideGroupCommand` class |
| `hooks/state/useGuideState.ts` | `rotateGuideGroup()` method |
| `hooks/canvas/useCanvasClickHandler.ts` | Smart click handler (PRIORITY 1.8994) |
| `components/dxf-layout/CanvasSection.tsx` | Set-based selection state, toggle/pivot callbacks, hint override, highlight |
| `config/keyboard-shortcuts.ts` | G→F chord |
| `ui/toolbar/toolDefinitions.tsx` | Dropdown entry |
| `constants/property-statuses-enterprise.ts` | `GUIDE_ROTATE_GROUP` label |
| i18n (el/en dxf-viewer.json) | Tool labels + PromptDialog titles |
| i18n (el/en tool-hints.json) | Tool hints: name, description, 2 steps, shortcuts |

## 21. B33: Smart Equalize — Implementation Details (2026-02-22)

### 21.1 Architecture

Ισαπόσταση 3+ same-axis (X ή Y) οδηγών. Κρατά first/last fixed, αναδιανέμει τα ενδιάμεσα.

- **Αλγόριθμος**: `spacing = (lastOffset - firstOffset) / (count - 1)`
- **Validation**: Μόνο X ή Y axis (XZ αποκλείεται), ≥3 οδηγοί, ίδιος axis
- **No PromptDialog**: Πλήρως αυτόματο — select & click

### 21.2 Core Components

| Component | Role |
|-----------|------|
| `EqualizeGuidesCommand` | ICommand — pre-computes offsets, moveGuideById per guide |
| `isValid` getter | Returns false if <3 guides ή mixed axes |
| Smart click detection | Near guide (<30px) = toggle select, empty space = apply |
| Set-based multi-select | `useState<Set<string>>` for O(1) toggle/has |

### 21.3 Edge Cases

| Case | Handling |
|------|---------|
| XZ diagonal guide | Excluded — equalize only works on axis-aligned |
| < 3 guides selected | Warning notification, no-op |
| Mixed X + Y axes | Warning notification, no-op |
| Locked/invisible | Not excluded from selection (move still applies) |
| Undo | Restores original offsets via `originalOffsets` Map |

### 21.4 Files Modified (Session 2026-02-22 — B33)

| File | Changes |
|------|---------|
| `ui/toolbar/types.ts` | `'guide-equalize'` added to ToolType union |
| `systems/guides/guide-commands.ts` | `EqualizeGuidesCommand` class (~100 lines) |
| `hooks/state/useGuideState.ts` | `equalizeGuides()` method |
| `systems/events/EventBus.ts` | `grid:guides-equalized` event type |
| `hooks/canvas/useCanvasClickHandler.ts` | Smart click handler (PRIORITY 1.8995) |
| `components/dxf-layout/CanvasSection.tsx` | Set-based selection state, toggle/apply callbacks, hint override, highlight |
| `config/keyboard-shortcuts.ts` | G→Y chord |
| `systems/tools/ToolStateManager.ts` | Tool registry entry |
| `constants/property-statuses-enterprise.ts` | `GUIDE_EQUALIZE` label |
| `ui/toolbar/toolDefinitions.tsx` | Dropdown entry with ArrowDownUp icon |
| i18n (el/en dxf-viewer.json) | Tool labels + warning message |
| i18n (el/en tool-hints.json) | Tool hints: name, description, 2 steps, shortcuts |

## 22. B31: Polar Array — Implementation Details (2026-02-22)

### 22.1 Architecture

Δημιουργεί N οδηγούς σε ίσες γωνίες (360°/N) γύρω από κέντρο. Κάθε οδηγός είναι XZ diagonal (±10000 extent) που περνά μέσα από το center point.

- **Workflow**: 1-click center → PromptDialog (count) → create N guides
- **Αλγόριθμος**: angle_i = i × (360°/N), direction = (cos, sin), extend ±10000
- **Min count**: 2 (validates in command + dialog)

### 22.2 Core Components

| Component | Role |
|-----------|------|
| `PolarArrayGuidesCommand` | ICommand — creates N XZ guides, stores for undo |
| `isValid` getter | count ≥ 2 && angleIncrement > 0 |
| `addDiagonalGuideRaw()` | Creates each spoke via GuideStore |
| PromptDialog | Input for count (integer ≥ 2) |

### 22.3 Key Differences from B2 (Auto Grid)

| Aspect | B2 Auto Grid | B31 Polar Array |
|--------|-------------|-----------------|
| Pattern | Rectangular (X+Y) | Radial (XZ spokes) |
| Input | Spacing pattern | Count |
| Guides created | X + Y axis | XZ diagonal only |
| Undo | Individual guides | Single PolarArrayGuidesCommand |

### 22.4 Files Modified (Session 2026-02-22 — B31)

| File | Changes |
|------|---------|
| `ui/toolbar/types.ts` | `'guide-polar-array'` added to ToolType union |
| `systems/guides/guide-commands.ts` | `PolarArrayGuidesCommand` class (~85 lines) |
| `hooks/state/useGuideState.ts` | `createPolarArray()` method |
| `systems/events/EventBus.ts` | `grid:polar-array-created` event type |
| `hooks/canvas/useCanvasClickHandler.ts` | 1-click center handler (PRIORITY 1.8996) |
| `components/dxf-layout/CanvasSection.tsx` | `handlePolarArrayCenterSet` callback with PromptDialog |
| `config/keyboard-shortcuts.ts` | G→2 chord (numeric key) |
| `systems/tools/ToolStateManager.ts` | Tool registry entry |
| `constants/property-statuses-enterprise.ts` | `GUIDE_POLAR_ARRAY` label |
| `ui/toolbar/toolDefinitions.tsx` | Dropdown entry with Radar icon |
| i18n (el/en dxf-viewer.json) | Tool labels + PromptDialog titles |
| i18n (el/en tool-hints.json) | Tool hints: name, description, 2 steps, shortcuts |

## 23. B32: Scale Grid — Implementation Details (2026-02-22)

### 23.1 Architecture

Κλιμακώνει όλους τους ορατούς/μη-κλειδωμένους οδηγούς σε σχέση με σημείο αρχής (origin). Σε αντίθεση με τη rotation (B28-B30) που μετατρέπει X/Y σε XZ, η κλιμάκωση **διατηρεί τον τύπο άξονα**.

- **Workflow**: 1-click origin → PromptDialog (scale factor) → `ScaleAllGuidesCommand`
- **X guide**: `newOffset = origin.x + (offset − origin.x) × factor`
- **Y guide**: `newOffset = origin.y + (offset − origin.y) × factor`
- **XZ guide**: Scale both startPoint and endPoint relative to origin
- **Validation**: factor ≠ 0, factor ≠ 1, scaledValues.size > 0

### 23.2 Command Pattern

| Component | Implementation |
|-----------|---------------|
| `ScaleAllGuidesCommand` | ICommand — scales all visible/unlocked guides, stores snapshots for undo |
| `execute()` | Uses `moveGuideById` for X/Y, `moveDiagonalGuideById` for XZ |
| `undo()` | Restores original snapshots (offset or start/end points) |
| Undo | Per-guide snapshot restoration via `moveGuideById`/`moveDiagonalGuideById` |

### 23.3 Key Differences from Rotation

| Aspect | Rotation (B28-B30) | Scale (B32) |
|--------|-------------------|-------------|
| Axis preservation | X/Y → XZ conversion | X stays X, Y stays Y |
| Store method | `replaceGuideWithRotated` | `moveGuideById` / `moveDiagonalGuideById` |
| Math | `rotatePoint()` trigonometry | Linear scaling relative to origin |

### 23.4 Files Modified (Session 2026-02-22 — B32)

| File | Changes |
|------|---------|
| `ui/toolbar/types.ts` | `'guide-scale'` added to ToolType union |
| `systems/guides/guide-commands.ts` | `ScaleAllGuidesCommand` class (~115 lines) |
| `hooks/state/useGuideState.ts` | `scaleAllGuides()` method |
| `systems/events/EventBus.ts` | `grid:all-guides-scaled` event type |
| `hooks/canvas/useCanvasClickHandler.ts` | 1-click origin handler (PRIORITY 1.8997) |
| `components/dxf-layout/CanvasSection.tsx` | `handleScaleOriginSet` callback with PromptDialog |
| `config/keyboard-shortcuts.ts` | G→3 chord (numeric key) |
| `systems/tools/ToolStateManager.ts` | Tool registry entry |
| `constants/property-statuses-enterprise.ts` | `GUIDE_SCALE` label |
| `ui/toolbar/toolDefinitions.tsx` | Dropdown entry with Scaling icon |
| i18n (el/en dxf-viewer.json) | Tool labels + PromptDialog titles (scale factor) |
| i18n (el/en tool-hints.json) | Tool hints: name, description, 2 steps, shortcuts (G→3) |
