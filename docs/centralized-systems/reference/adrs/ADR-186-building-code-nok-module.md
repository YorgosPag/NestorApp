# ADR-186: Building Code Module — Modular Κανονισμός Δόμησης (ΝΟΚ)

> **Status**: DRAFT — Requirements Gathering
> **Date**: 2026-02-17
> **Category**: AI Architecture / Building Regulations / DXF Viewer
> **Parent ADR**: [ADR-185](./ADR-185-ai-powered-dxf-drawing-assistant.md)

---

## 1. Context

Κατά τη συζήτηση για το ADR-185 (AI Drawing Assistant), αναδείχθηκε η ανάγκη για **modular αρχιτεκτονική κανονισμών δόμησης**. Η πολεοδομική νομοθεσία στην Ελλάδα (ΝΟΚ) είναι εξαιρετικά περίπλοκη:

- Κάθε οικόπεδο μπορεί να έχει **διαφορετικούς όρους δόμησης**
- Ειδικά Προεδρικά Διατάγματα (ΠΔ) τροποποιούν τους γενικούς κανόνες
- ΓΠΣ/ΣΧΟΟΑΠ κάθε Δήμου ορίζει ειδικούς όρους
- Χρήσεις γης, ζώνες, ειδικές ρυθμίσεις

**ΚΡΙΣΙΜΗ ΑΠΟΦΑΣΗ (Q-10, ADR-185)**: Ο κανονισμός δόμησης είναι **ΑΠΑΡΑΙΤΗΤΟΣ εξαρχής** αλλά ως **modular plugin**, όχι hardcoded.

---

## 2. Βασικές Αρχές

### 2.1 Modular Architecture (Building Code Provider Pattern)

```
┌───────────────────────────────────────────────────┐
│              AI Drawing Assistant                  │
│                                                    │
│  ┌────────────────────────────────────────────┐    │
│  │       Building Code Provider Interface      │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐   │    │
│  │  │ ΝΟΚ      │ │ Γερμανι- │ │ Κυπρια-  │   │    │
│  │  │ Ελλάδας  │ │ κός      │ │ κός      │   │    │
│  │  └──────────┘ └──────────┘ └──────────┘   │    │
│  │  ┌──────────┐                              │    │
│  │  │ "Κανένας" │ (ελεύθερη σχεδίαση)        │    │
│  │  └──────────┘                              │    │
│  └────────────────────────────────────────────┘    │
└───────────────────────────────────────────────────┘
```

### 2.2 Ο χρήστης επιλέγει

| Λειτουργία | Περιγραφή |
|-----------|-----------|
| **"Σχεδιάζω με κανονισμό"** | Η AI εφαρμόζει constraints (ΣΔ, κάλυψη, ύψος, αποστάσεις) |
| **"Σχεδιάζω ελεύθερα"** | Η AI σχεδιάζει χωρίς περιορισμούς |
| **"Σχεδιάζω ελεύθερα + έλεγχος"** | Σχεδιάζει ελεύθερα αλλά στο τέλος ελέγχει compliance |

### 2.3 Κανονισμός ΔΕΝ είναι hardcoded

- Κάθε κανονισμός = ξεχωριστό module
- Αύριο πουλάμε σε Κύπρο → φορτώνουμε Κυπριακό module
- Αύριο πουλάμε σε Γερμανία → φορτώνουμε Γερμανικό module
- **Pattern**: Ίδιο με AI Provider (OpenAI σήμερα, Claude αύριο)

---

## 3. Παράμετροι Κανονισμού (ΝΟΚ Ελλάδας)

### 3.1 Βασικοί Όροι Δόμησης

| Παράμετρος | Περιγραφή | Τύπος | Παράδειγμα |
|-----------|-----------|-------|-----------|
| **ΣΔ** (Συντελεστής Δόμησης) | Μέγιστη δομήσιμη επιφάνεια / εμβαδόν οικοπέδου | number | 0.8, 1.2, 2.4 |
| **Κάλυψη** | Ποσοστό κάλυψης οικοπέδου | percentage | 60%, 70% |
| **Μέγιστο ύψος** | Μέγιστο επιτρεπόμενο ύψος κτιρίου | meters | 10.5m, 17.5m |
| **Δ** (Πρόσωπο) | Ελάχιστη απόσταση από δρόμο | meters | 0m (σε Ο.Τ.), 4m |
| **δ** (Πλάγιες αποστάσεις) | Ελάχιστη απόσταση από πλάγια όρια | meters | 2.5m, 3m |
| **δ'** (Οπίσθια απόσταση) | Ελάχιστη απόσταση από πίσω όριο | meters | 2.5m, 3m |
| **Μέγιστοι όροφοι** | Μέγιστος αριθμός ορόφων | integer | 2, 4, 6 |
| **Χρήση γης** | Επιτρεπόμενη χρήση | enum | Κατοικία, Μικτή, Εμπορική |

### 3.2 Ειδικές Παράμετροι

| Παράμετρος | Περιγραφή |
|-----------|-----------|
| Εξωστέδες (μπαλκόνια) | Μέγιστη εξοχή, ελάχιστο ύψος |
| Υπόγειο | Επιτρεπόμενο ύψος, χρήσεις |
| Pilotis | Απαίτηση ή όχι, ελεύθερο ύψος |
| Στέγη | Μέγιστη κλίση, ύψος κορφιά |
| Ημιυπαίθριοι χώροι | Ποσοστό, μέγιστο εμβαδόν |
| Φωτοβολταϊκά / Ηλιακοί | Κανονισμοί τοποθέτησης |

---

## 4. Πηγές Δεδομένων Κανονισμού

### 4.1 Πολλαπλές πηγές (ranked by reliability)

| Πηγή | Αξιοπιστία | Τρόπος εισαγωγής |
|------|-----------|-----------------|
| **Χειροκίνητη εισαγωγή** | Υψηλή (ο μηχανικός ξέρει) | Form UI: ΣΔ, κάλυψη, ύψος, αποστάσεις |
| **Upload διατάγματος** | Μεσαία-Υψηλή | PDF/σκαν → AI Vision API → extraction |
| **AI web search** | Μεσαία | AI ψάχνει βάσει συντεταγμένων/περιοχής |
| **Αυτόματα (geodata.gov.gr)** | Υψηλή αν υπάρχει API | REST API integration (μελλοντικό) |

### 4.2 Override & Correction

- Ο χρήστης μπορεί **ΠΑΝΤΑ** να κάνει override: "Λάθος ΣΔ, είναι 0.8 όχι 1.2"
- Η AI διορθώνει αμέσως και εφαρμόζει τη νέα τιμή
- Η AI μπορεί να ζητήσει **re-search** αν ο χρήστης αμφιβάλλει

---

## 5. Αρχιτεκτονική (Planned)

### 5.1 Building Code Provider Interface

```typescript
interface BuildingCodeProvider {
  /** Unique identifier */
  id: string;  // 'nok-greece', 'bauordnung-germany', 'none'

  /** Display name */
  name: string;  // 'ΝΟΚ Ελλάδας', 'Bauordnung', 'Κανένας'

  /** Get constraints for a specific plot */
  getConstraints(plotData: PlotData): BuildingConstraints;

  /** Validate a design against constraints */
  validateDesign(design: DesignData, constraints: BuildingConstraints): ValidationResult;

  /** Get available parameters for UI form */
  getParameterDefinitions(): ParameterDefinition[];
}

interface BuildingConstraints {
  maxBuildingCoefficient: number;    // ΣΔ
  maxCoveragePercent: number;        // Κάλυψη
  maxHeight: number;                  // Μέγιστο ύψος (m)
  setbacks: {
    front: number;   // Δ
    side: number;    // δ
    rear: number;    // δ'
  };
  maxFloors: number;
  landUse: LandUseType;
  specialConditions?: string[];       // Ειδικοί όροι (ΠΔ κλπ)
}

interface ValidationResult {
  isCompliant: boolean;
  violations: Violation[];
  warnings: Warning[];
  suggestions: string[];
}
```

### 5.2 File Structure (Planned)

```
src/services/building-code/
├── types.ts                          — Interfaces (BuildingCodeProvider, BuildingConstraints)
├── building-code-registry.ts         — Registry of available providers
├── providers/
│   ├── nok-greece-provider.ts        — ΝΟΚ Ελλάδας implementation
│   ├── none-provider.ts              — "Ελεύθερη σχεδίαση" (no constraints)
│   └── [future-providers]/
├── constraint-validator.ts           — Validates design against constraints
└── parameter-extractor.ts            — Extract params from PDFs/web (AI Vision)
```

---

## 5b. Πολυπλοκότητα ΝΟΚ — AI ως "Σύμμαχος Μηχανικού"

> Καταγράφηκε κατά τη συζήτηση (2026-02-17). Ο ΝΟΚ είναι πολύ πιο σύνθετος από βασικούς αριθμούς.

**Πρόβλημα**: Ο ΝΟΚ δεν είναι απλά "ΣΔ 0.8, κάλυψη 60%". Περιλαμβάνει εκατοντάδες αλληλεπιδρώντες κανόνες:

| Κατηγορία | Παραδείγματα |
|-----------|-------------|
| **Τι ΔΕΝ μετράει στον ΣΔ** | Κλιμακοστάσια (μέχρι ένα εύρος), εξωτερικές μονώσεις, θερμομονωτικές τοιχοπληρώσεις, ορισμένα πατάρια, αποθήκες ορισμένων διαστάσεων, ενεργειακές αναβαθμίσεις |
| **Μπόνους ΣΔ** | Παραχώρηση οικοπέδου σε Δήμο (κοινόχρηστα), παροχή θέσεων στάθμευσης |
| **Εξώστες** | Μέγιστη προβολή από σκελετό, συνολικό εμβαδόν εξωστών ανά όροφο/κτίριο |
| **Ημιυπαίθριοι** | Ποσοστό, μέγιστο εμβαδόν, κλείσιμο σε μετέπειτα φάση |
| **Εξαιρέσεις** | Γωνιακά οικόπεδα, διατηρητέα, εκτός σχεδίου, παρεκκλίσεις |
| **Εγκύκλιοι** | Διευκρινιστικές, αναιρετικές, ερμηνευτικές — αλληλοαναιρούνται |

**Στρατηγική AI**:
- Η AI φορτώνεται με **ολόκληρο τον ΝΟΚ + εγκυκλίους** στο Knowledge Base
- Ο μηχανικός ρωτάει: "Η αποθήκη 8τμ μετράει στον ΣΔ;" → η AI απαντά με αναφορά άρθρου
- Η AI **προτείνει**, ο μηχανικός **αποφασίζει** — η ευθύνη παραμένει πάντα στον μηχανικό
- **Στόχος**: Η AI γίνεται ο πιο ισχυρός σύμμαχος του μηχανικού στην ερμηνεία του ΝΟΚ

---

## 6. Ερωτήσεις Ανοιχτές [ΠΡΟΣ ΣΥΖΗΤΗΣΗ]

> Ερωτήσεις 1-6 δημιουργήθηκαν κατά τη συζήτηση. Ερωτήσεις 7-10 εντοπίστηκαν κατά τον γραμμή-γραμμή έλεγχο (2026-02-17).

| # | Ερώτηση | Status |
|---|---------|--------|
| 1 | **Φόρμα παραμέτρων**: Και τα δύο — εισαγωγή στο Project Settings (μόνιμα), εμφάνιση/επεξεργασία και στο DXF Viewer (γρήγορη αλλαγή). Μία αποθήκευση, δύο σημεία πρόσβασης. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 2 | **Firestore αποθήκευση**: Ναι, μέσα στο project document ως `buildingCode` object (provider, enabled, params, source, lastUpdated). Δεν χρειάζεται ξεχωριστό collection. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 3 | **AI extraction PDF**: Upload PDF → Vision API (gpt-4o) → structured JSON πρόταση → ο χρήστης επιβεβαιώνει/διορθώνει → αποθήκευση. Phase 3 (Vision). | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 4 | **Visual setback lines**: Ναι, σε ξεχωριστό layer "Setbacks" (διακεκομμένη μπλε). Δομήσιμη ζώνη ημιδιαφανές πράσινο. Phase 2. Ο χρήστης ανοίγει/κλείνει layers. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 5 | **Εξαιρέσεις ΝΟΚ**: Δύο επίπεδα — (1) checkboxes για βασικά (γωνιακό, διατηρητέο, εκτός σχεδίου), (2) AI-powered deep knowledge ολόκληρου ΝΟΚ + εγκυκλίων για σύνθετες ερμηνείες. AI προτείνει, μηχανικός αποφασίζει. Knowledge Base φορτωμένο με ΝΟΚ, εγκυκλίους, παρεκκλίσεις. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 6 | **ΚΕΝΑΚ**: Ξεχωριστό module, ΟΧΙ Phase 1. Ο ΚΕΝΑΚ αφορά ενεργειακές απαιτήσεις (U-values, θερμομόνωση, ενεργειακή κλάση) — εντελώς διαφορετικά δεδομένα από τον ΝΟΚ. Η αρχιτεκτονική μας (Provider Pattern) ήδη το προβλέπει. Phase 1-2 = μόνο ΝΟΚ, Phase 3+ = ΚΕΝΑΚ ως ξεχωριστός provider. Μελλοντικά: Πυροπροστασία, Προσβασιμότητα ΑμΕΑ κλπ ως επιπλέον providers. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 7 | **Χρονισμός εισαγωγής**: Και τα δύο. Σενάριο Α: Πρώτα setup στο Project Settings → η AI ξέρει ήδη. Σενάριο Β: Αν ο χρήστης ξεκινήσει χωρίς setup, η AI ρωτάει "θέλεις ελεύθερη σχεδίαση ή πες μου ΣΔ/κάλυψη;" — δεν μπλοκάρει. Σενάριο Γ: Αλλαγή κατά τη σχεδίαση — ο χρήστης λέει "τελικά ΣΔ 1.2" → η AI ενημερώνει + ελέγχει τρέχουσα σχεδίαση. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 8 | **Σύνδεση με Project**: Αυτόματα από το context. Ο DXF Viewer ήδη γνωρίζει το `projectId` (URL/context) → φέρνει το `buildingCode` object από Firestore αυτόματα → η AI εφαρμόζει τους κανόνες χωρίς καμία ενέργεια του χρήστη. Αν δεν υπάρχουν παράμετροι, η AI ρωτάει (σενάριο Β, ερώτηση #7). | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 9 | **Hard vs Soft constraints**: ΜΑΛΑΚΟΙ — πάντα προειδοποίηση, ποτέ μπλόκο. Η AI σχεδιάζει ΚΑΙ ενημερώνει. Ο μηχανικός αποφασίζει (μπορεί να έχει παρέκκλιση). Τρία επίπεδα: ℹ️ Info (>80% ορίου), ⚠️ Warning (ξεπέρασες), 🔴 Critical (>20% υπέρβαση). Σε κανένα επίπεδο δεν μπλοκάρει — AI = σύμμαχος, όχι αφεντικό. | ✅ ΑΠΑΝΤΗΘΗΚΕ |
| 10 | **Versioning κανονισμών**: Phase 1 = μόνο τρέχων ΝΟΚ (τελευταία ισχύουσα έκδοση). Πεδίο `codeVersion: '2024'` στο `buildingCode` object. Όταν βγαίνει τροποποίηση → ενημερώνεται το Knowledge Base. Phase 3+ = πολλαπλές εκδόσεις αν χρειαστεί (παλιές οικοδομικές άδειες). Το 95% των projects χρησιμοποιεί τον τρέχοντα ΝΟΚ. | ✅ ΑΠΑΝΤΗΘΗΚΕ |

---

## 7. Changelog

| Date | Change | By |
|------|--------|-----|
| 2026-02-17 | Initial draft — Modular architecture, ΝΟΚ parameters, provider interface | Claude + Γιώργος |
| 2026-02-17 | Έλεγχος γραμμή-γραμμή: 4 νέες ερωτήσεις (#7-#10) | Claude |
