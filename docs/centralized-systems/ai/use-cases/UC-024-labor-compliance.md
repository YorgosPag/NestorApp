# UC-024: Εργατική Συμμόρφωση & Κοινωνική Ασφάλιση (Labor & Social Security Compliance)

> **Parent ADR**: [ADR-169 - Modular AI Architecture](../../reference/adrs/ADR-169-modular-ai-architecture.md)
> **Pipeline**: [pipeline.md](../pipeline.md)
> **Σχετικά UCs**: [UC-015](./UC-015-building-permit-process.md) (αδειοδότηση), [UC-018](./UC-018-daily-briefing.md) (briefing), [UC-019](./UC-019-reminders-followup.md) (reminders)

---

## Trigger

Ξεκινάει νέο κατασκευαστικό έργο ή προσλαμβάνεται εργάτης/υπάλληλος. Η AI παρακολουθεί **συνεχώς** τη συμμόρφωση σε 3 πυλώνες: ΕΦΚΑ αναγγελία, ασφαλιστικές εισφορές (ένσημα), και ΕΡΓΑΝΗ II (παρουσιολόγιο).

---

## Πυλώνας 1: Αναγγελία Έργου στο e-ΕΦΚΑ

### Επισκόπηση

```
ΝΕΟ ΕΡΓΟ → ΑΝΑΓΓΕΛΙΑ e-ΕΦΚΑ → ΑΜΟΕ → ΕΝΤΥΠΑ → ΠΑΡΑΚΟΛΟΥΘΗΣΗ
```

### Στάδιο 1.1: Προετοιμασία Αναγγελίας

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `efka_preparation` |
| **Ενέργειες AI** | Checklist εγγράφων, υπενθύμιση υποβολής |

**Απαιτούμενα στοιχεία για αναγγελία**:

| # | Στοιχείο | Πηγή | Σημειώσεις |
|---|----------|------|-----------|
| 1 | Στοιχεία εργοδότη (ΑΦΜ, Επωνυμία) | Σύστημα | Ήδη στο Firestore |
| 2 | Στοιχεία ιδιοκτήτη/ιδιοκτητών οικοπέδου | Χρήστης | Αποδοχή συνιδιοκτήτη απαιτείται |
| 3 | Διεύθυνση έργου | Σύστημα | Από Project record |
| 4 | Αριθμός οικοδομικής αδείας | Σύστημα | Σύνδεση με UC-015 |
| 5 | Είδος εργασιών | Χρήστης | Ανέγερση / Ανακαίνιση / Προσθήκη |
| 6 | Εκτιμώμενη διάρκεια | Χρήστης | Σε μήνες |
| 7 | Προϋπολογισμός έργου | Σύστημα | Από Project record |

**ΚΑΝΟΝΑΣ**: Η αναγγελία πρέπει να γίνει **ΠΡΙΝ** ξεκινήσουν οι εργασίες. Η AI ενημερώνει αμέσως μόλις εκδοθεί η οικοδομική άδεια (σύνδεση με UC-015, Στάδιο 4).

### Στάδιο 1.2: Υποβολή Αναγγελίας

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `efka_submitted` |
| **Πλατφόρμα** | e-ΕΦΚΑ (efka.gov.gr) |
| **Αποτέλεσμα** | Έκδοση **ΑΜΟΕ** (Αριθμός Μητρώου Οικοδομοτεχνικού Έργου) |

**Ενέργειες AI μετά την αναγγελία**:
- Αποθήκευση ΑΜΟΕ στο Project record
- Σύνδεση ΑΜΟΕ με όλα τα εργατικά έγγραφα του έργου
- Ενημέρωση `accountant` → "Αναγγελία έργου [Project] ολοκληρώθηκε — ΑΜΟΕ: [αριθμός]"

### Στάδιο 1.3: Έντυπα ΕΦΚΑ

| Έντυπο | Σκοπός | Πότε | Αρμόδιος |
|--------|--------|------|----------|
| **Ε.1 — Αναγγελία Πρόσληψης** | Δήλωση νέου εργαζόμενου | Πριν την έναρξη εργασίας | `accountant` |
| **Ε.3 — Αναγγελία Οικ. Έργου** | Αναγγελία νέου έργου | Πριν την έναρξη εργασιών | `accountant` |
| **Ε.4 — Μεταβολή Στοιχείων** | Αλλαγές σε στοιχεία έργου | Όταν αλλάξει κάτι | `accountant` |
| **Ε.12 — Βεβαίωση Απασχόλησης** | Βεβαίωση για εργαζόμενο | Κατ' απαίτηση | `accountant` |
| **ΑΠΔ** | Αναλυτική Περιοδική Δήλωση | Μηνιαία (αποκλειστικά ηλεκτρονικά) | `accountant` |

**AI Tracking**: Η AI δημιουργεί checklist με ΟΛΑ τα απαιτούμενα έντυπα ανά εργαζόμενο και ανά περίοδο. Alert αν κάτι λείπει.

---

## Πυλώνας 2: Ένσημα & Ασφαλιστικές Εισφορές

### Επισκόπηση

```
ΕΡΓΑΖΟΜΕΝΟΣ → ΚΛΑΣΗ ΕΝΣΗΜΩΝ → ΗΜΕΡΕΣ ΕΡΓΑΣΙΑΣ → ΥΠΟΛΟΓΙΣΜΟΣ → ΑΠΔ → ΠΛΗΡΩΜΗ
```

### 2.1: Κλάσεις Ημερομισθίων (2026)

| Κλάση | Εύρος Ημερομισθίου | Τεκμαρτό Ημερομίσθιο | Σημειώσεις |
|-------|--------------------|-----------------------|-----------|
| 1 | Έως 13,41€ | 11,07€ | Βοηθοί |
| 5 | 21,78€–25,37€ | 23,58€ | Ειδικευμένοι εργάτες |
| 10 | 38,65€–41,46€ | 39,30€ | Τεχνίτες (πλέον κοινή) |
| 14+ | 50,00€+ | Πραγματικό | Εξειδικευμένοι τεχνίτες |

**ΚΑΝΟΝΑΣ**: Οι κλάσεις ενημερώνονται ετησίως. Η AI διαβάζει τις τρέχουσες κλάσεις από config (όχι hardcoded).

**Config-driven κλάσεις**:
```
// Στο system/settings → laborCompliance.insuranceClasses
{
  "year": 2026,
  "classes": [
    { "class": 1, "min": 0, "max": 13.41, "imputed": 11.07 },
    { "class": 5, "min": 21.78, "max": 25.37, "imputed": 23.58 },
    { "class": 10, "min": 38.65, "max": 41.46, "imputed": 39.30 },
    ...
  ]
}
```

### 2.2: Υπολογισμός Εισφορών

| Εισφορά | Εργοδότης | Εργαζόμενος | Σύνολο |
|---------|-----------|-------------|--------|
| **Κύρια σύνταξη** | 13,33% | 6,67% | 20,00% |
| **Υγεία (ΕΟΠΥΥ)** | 4,30% | 2,15% | 6,45% |
| **Επικουρική** | 3,25% | 3,25% | 6,50% |
| **Εφάπαξ** | — | 4,00% | 4,00% |
| **Ανεργία (ΟΑΕΔ/ΔΥΠΑ)** | 2,43% | 1,20% | 3,63% |
| **ΟΕΚ/ΟΕΕ** | 0,77% | 0,27% | 1,04% |
| **Σύνολο** | ~24,08% | ~17,54% | ~41,62% |

**AI Υπολογισμός**:
- Εισαγωγή: Κλάση εργαζόμενου + Ημέρες εργασίας μήνα
- Αποτέλεσμα: Αυτόματος υπολογισμός εισφορών εργοδότη & εργαζόμενου
- Cross-check: Σύγκριση με ΑΠΔ (alert αν δεν ταιριάζουν)

### 2.3: Περίοδοι Υποβολής ΑΠΔ

| Περίοδος | Υποβολή ΑΠΔ | Πληρωμή Εισφορών | AI Alert |
|----------|-------------|-------------------|----------|
| **Μηνιαία** | Έως τελευταία εργάσιμη μήνα | Έως τέλος επόμενου μήνα | 5 μέρες πριν τη λήξη |
| **Τελική (λήξη έργου)** | 30 μέρες μετά τη λήξη | Αμέσως | Αυτόματο alert στη λήξη |

**ΚΑΝΟΝΑΣ**: Η ΑΠΔ υποβάλλεται **ΑΠΟΚΛΕΙΣΤΙΚΑ ΗΛΕΚΤΡΟΝΙΚΑ** μέσω e-ΕΦΚΑ. Δεν γίνεται δεκτή σε έντυπη μορφή.

**AI Reminders**:
- 7 μέρες πριν τη λήξη → ενημέρωση `accountant`
- 3 μέρες πριν τη λήξη → escalation σε `owner`
- 1 μέρα πριν → URGENT alert
- Μετά τη λήξη → WARNING: Πρόστιμα! Ενημέρωση `owner` + `accountant`

### 2.4: Πρόστιμα Μη-Συμμόρφωσης

| Παράβαση | Πρόστιμο | Σοβαρότητα |
|----------|----------|------------|
| Εκπρόθεσμη ΑΠΔ | Πρόσθετα τέλη + τόκοι | 🟠 Medium |
| Μη αναγγελία εργαζόμενου | 10.500€+ ανά εργαζόμενο | 🔴 Critical |
| Ανασφάλιστη εργασία | Πολλαπλάσια πρόστιμα + ποινικές | 🔴 Critical |
| Λανθασμένα στοιχεία ΑΠΔ | Διορθωτική ΑΠΔ + πρόστιμο | 🟡 Low |

**AI Prevention**: Η AI ελέγχει αυτόματα αν κάθε εργαζόμενος στο παρουσιολόγιο έχει αντίστοιχη αναγγελία και ένσημα.

---

## Πυλώνας 3: ΕΡΓΑΝΗ II & Ψηφιακή Κάρτα Εργασίας

### Επισκόπηση

**Νέο σύστημα σε παραγωγή: 16 Φεβρουαρίου 2026**

```
ΕΡΓΑΖΟΜΕΝΟΣ → CHECK-IN → ΕΡΓΑΣΙΑ → ΔΙΑΛΕΙΜΜΑ → ΕΡΓΑΣΙΑ → CHECK-OUT → ΑΝΑΦΟΡΑ
```

### 3.1: Ψηφιακή Κάρτα Εργασίας

| Λειτουργία | Περιγραφή | Μέθοδος |
|-----------|-----------|---------|
| **Check-in** | Έναρξη εργασίας | App / QR code / NFC |
| **Check-out** | Λήξη εργασίας | App / QR code / NFC |
| **Διάλειμμα** | Καταγραφή διαλείμματος | App |
| **Υπερωρία** | Δήλωση υπερωριακής απασχόλησης | Ηλεκτρονικά πριν την έναρξη |
| **Άδεια** | Κανονική, ασθένεια, ειδικές | Ηλεκτρονικά |

**Real-time tracking**: Το ΕΡΓΑΝΗ II παρακολουθεί σε πραγματικό χρόνο τις ώρες εργασίας.

### 3.2: Υποχρεώσεις Εργοδότη

| Υποχρέωση | Προθεσμία | Πρόστιμο μη-συμμόρφωσης |
|-----------|-----------|------------------------|
| **Πρόσληψη (Ε3)** | Πριν την έναρξη εργασίας | 10.500€+ |
| **Πίνακας Προσωπικού (Ε4)** | Εντός 3 ημερών | Πρόστιμο ΣΕΠΕ |
| **Δήλωση Υπερωρίας** | Πριν την υπερωρία | Πρόστιμο + αναδρομικές |
| **Ψηφιακή Κάρτα** | Καθημερινά (check-in/out) | Κυρώσεις ΕΡΓΑΝΗ |
| **Αλλαγή ωραρίου** | 24h πριν | Πρόστιμο |

### 3.3: AI Integration με ΕΡΓΑΝΗ II

| Λειτουργία AI | Περιγραφή |
|---------------|-----------|
| **Παρουσιολόγιο** | Καθημερινή καταγραφή ποιοι εργάτες δουλεύουν σε ποιο project |
| **Cross-check** | Σύγκριση παρουσιολογίου app ↔ ΕΡΓΑΝΗ II (εντοπισμός αποκλίσεων) |
| **Υπερωρίες Alert** | Αν εργαζόμενος πλησιάζει νόμιμο μέγιστο ωρών → ειδοποίηση |
| **Άδειες Tracking** | Υπόλοιπο αδειών, αυτόματος υπολογισμός δικαιωμάτων |
| **Μηνιαία Αναφορά** | Σύνοψη ανά εργαζόμενο: ημέρες, ώρες, υπερωρίες, άδειες |

---

## Πυλώνας 4: Σύστημα Παρουσιολογίου Εργοταξίου (Enterprise Attendance)

### 4.0: Αρχιτεκτονική Αρχή — Γιατί χρειαζόμαστε σύστημα παρουσιολογίου

**Νομικό πρόβλημα**: Αν εργάτης φύγει από το εργοτάξιο χωρίς καταγραφή, πάθει ατύχημα, και στα χαρτιά φαίνεται ότι εργαζόταν → **ο εργοδότης θεωρείται υπεύθυνος**. Αυτό σημαίνει πρόστιμα, αστικές ευθύνες, και πιθανές ποινικές κυρώσεις.

**Enterprise standard** (Procore, Oracle Aconex, Autodesk Construction Cloud): Κάθε είσοδος/έξοδος από το εργοτάξιο καταγράφεται σε **immutable log** — δεν μπορεί να τροποποιηθεί αναδρομικά.

---

### 4.1: Μέθοδοι Καταγραφής Παρουσίας (Υβριδική Λύση)

Δεδομένου ότι οι εργάτες κατασκευών μπορεί να μην έχουν σύγχρονα smartphones και τα εργοτάξια μπορεί να έχουν περιορισμένο internet, χρησιμοποιούμε **υβριδική λύση** με 3 μεθόδους:

| Προτεραιότητα | Μέθοδος | Πώς λειτουργεί | Πλεονεκτήματα | Μειονεκτήματα |
|---------------|---------|----------------|---------------|---------------|
| **ΚΥΡΙΑ** | QR Code στην πύλη | Ταμπέλα QR στην είσοδο εργοταξίου → ο εργάτης σκανάρει με κινητό | Φθηνό, απλό, offline sync | Απαιτεί κινητό με κάμερα |
| **ΔΕΥΤΕΡΕΥΟΥΣΑ** | Geofencing + App | GPS ακτίνα γύρω από εργοτάξιο → αυτόματο check-in/out | Αυτόματο, αδιάβλητο | Απαιτεί smartphone + GPS |
| **FALLBACK** | Χειρόγραφο | Ο εργοδηγός καταγράφει χειρόγραφα → ψηφιοποιεί στο app | Λειτουργεί πάντα | Χειροκίνητο, πιθανά λάθη |

#### Μέθοδος 1: QR Code (Κύρια)

```
ΕΙΣΟΔΟΣ ΕΡΓΟΤΑΞΙΟΥ:
[QR CODE] ← Σκανάρισμα = CHECK-IN (timestamp + GPS + worker ID)

ΕΞΟΔΟΣ ΕΡΓΟΤΑΞΙΟΥ:
[QR CODE] ← Σκανάρισμα = CHECK-OUT (timestamp + GPS + worker ID)
```

**Λεπτομέρειες υλοποίησης**:
- Κάθε εργοτάξιο έχει **μοναδικό QR code** (δεν μεταφέρεται)
- Το QR code αλλάζει **ημερησίως** (αποτρέπει αντιγραφή/screenshot)
- Αν δεν υπάρχει internet → αποθηκεύεται τοπικά στο κινητό → sync μόλις υπάρξει σήμα
- Ο `siteManager` μπορεί να εκτυπώνει νέο QR κάθε πρωί από το app

#### Μέθοδος 2: Geofencing (Δευτερεύουσα)

| Ρύθμιση | Τιμή | Config-driven |
|---------|-------|---------------|
| **Ακτίνα geofence** | 50-100 μέτρα (ανά εργοτάξιο) | ✅ |
| **Αυτόματο check-out** | Αν εργάτης εκτός geofence >15 λεπτά | ✅ |
| **Alert εργοδηγού** | Αν εργάτης εκτός geofence >5 λεπτά | ✅ |
| **GPS ακρίβεια** | Ελάχιστη: 20 μέτρα | ✅ |

**Ροή geofencing**:
```
Εργάτης μπαίνει στο geofence → AUTO CHECK-IN → Ειδοποίηση siteManager
     ↓
Εργάτης βγαίνει >5 λεπτά → ALERT siteManager: "Ο [Εργάτης] έφυγε από το εργοτάξιο"
     ↓
Εργάτης βγαίνει >15 λεπτά → AUTO CHECK-OUT → Καταγραφή gap
     ↓
Εργάτης ξαναμπαίνει → AUTO RE-CHECK-IN → Νέα εγγραφή (gap documented)
```

#### Μέθοδος 3: Χειρόγραφο (Fallback)

- Ο `siteManager` έχει φόρμα στο app: επιλέγει εργάτη → πατάει "Check-in" / "Check-out"
- Η εγγραφή σημαδεύεται ως `method: manual_sitemanager` (διαφορετική αξιοπιστία)
- Χρησιμοποιείται **μόνο** αν οι μέθοδοι 1 & 2 δεν λειτουργούν

---

### 4.2: Event Types — Τύποι Καταγραφών

Κάθε καταγραφή παρουσίας είναι ένα **immutable event** (δεν μπορεί να τροποποιηθεί μετά):

| Event Type | Κωδικός | Περιγραφή | Ποιος |
|-----------|---------|-----------|-------|
| **Έναρξη εργασίας** | `check_in` | Ο εργάτης μπαίνει στο εργοτάξιο | Εργάτης ή siteManager |
| **Λήξη εργασίας** | `check_out` | Ο εργάτης φεύγει στο τέλος | Εργάτης ή siteManager |
| **Αποχώρηση ενδιάμεσα** | `left_site` | Ο εργάτης φεύγει κατά τη διάρκεια | Εργάτης ή auto (geofence) |
| **Επιστροφή** | `returned` | Ο εργάτης επιστρέφει μετά από αποχώρηση | Εργάτης ή auto (geofence) |
| **Διάλειμμα αρχή** | `break_start` | Αρχή νόμιμου διαλείμματος | Εργάτης |
| **Διάλειμμα τέλος** | `break_end` | Τέλος νόμιμου διαλείμματος | Εργάτης |
| **Άδεια εξόδου** | `exit_permission` | Ο εργάτης ζήτησε και πήρε άδεια εξόδου | siteManager (εγκρίνει) |

**Κάθε event περιέχει**:

| Πεδίο | Τύπος | Υποχρεωτικό | Σημειώσεις |
|-------|-------|-------------|-----------|
| `id` | string | ✅ | Μοναδικό, αυτόματο |
| `workerId` | reference | ✅ | Σύνδεση με μητρώο εργαζομένων |
| `projectId` | reference | ✅ | Σε ποιο εργοτάξιο |
| `eventType` | enum | ✅ | Βλ. πίνακα παραπάνω |
| `timestamp` | datetime | ✅ | Ακριβής ώρα (server-side, δεν μπορεί να αλλαχθεί) |
| `method` | enum | ✅ | `qr_scan` / `geofence_auto` / `manual_sitemanager` |
| `gpsLat` | number | Αν διαθέσιμο | Γεωγραφικό πλάτος |
| `gpsLng` | number | Αν διαθέσιμο | Γεωγραφικό μήκος |
| `gpsAccuracy` | number | Αν διαθέσιμο | Ακρίβεια GPS σε μέτρα |
| `notes` | string | — | Σημείωση (π.χ. "Πήγε φαρμακείο") |
| `approvedBy` | reference | Μόνο για `exit_permission` | Ποιος ενέκρινε την έξοδο |
| `immutable` | boolean | ✅ | Πάντα `true` — δεν τροποποιείται |

---

### 4.3: Παρουσιολόγιο ανά Project — Ημερήσια Σύνοψη

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | Ημερήσια αυτόματη σύνοψη |
| **Αρμόδιος** | `siteManager` (καταγραφή) → `accountant` (υπολογισμός) |

**Ημερήσια σύνοψη ανά εργαζόμενο** (AI generates αυτόματα):

| Στοιχείο | Τύπος | Πηγή |
|----------|-------|------|
| Ημερομηνία | date | Αυτόματη |
| Εργαζόμενος | reference | Μητρώο εργαζομένων |
| Project | reference | Εργοτάξιο |
| Ώρα πρώτου check-in | time | Πρώτο `check_in` event |
| Ώρα τελευταίου check-out | time | Τελευταίο `check_out` event |
| Συνολικές ώρες παρουσίας | number | Υπολογισμός από events |
| Ώρες εκτός εργοταξίου (gaps) | number | Σύνολο `left_site` → `returned` |
| Πραγματικές ώρες εργασίας | number | Παρουσία - gaps - breaks |
| Τύπος εργασίας | enum | Κανονική / Υπερωρία / Αργία / Νυχτερινή |
| Κατηγορία εργαζόμενου | enum | Τεχνίτης / Εργάτης / Βοηθός / Μηχανοδηγός |
| Κλάση ενσήμων | number | Βάσει ημερομισθίου |
| Μέθοδος καταγραφής | enum | `qr_scan` / `geofence_auto` / `manual_sitemanager` |
| Anomalies | array | Gaps χωρίς permission, check-in χωρίς check-out, κ.λπ. |

---

### 4.4: Ροές Καθημερινής Λειτουργίας

#### Πρωί — Έναρξη βάρδιας

1. Εργάτες σκανάρουν QR ή μπαίνουν στο geofence → `check_in`
2. AI cross-check σε κάθε check-in:
   - Είναι αναγγελμένος στο ΕΦΚΑ; → Αν **ΟΧΙ** → 🔴 CRITICAL ALERT στον `accountant` + `owner`
   - Ψηφιακή κάρτα ΕΡΓΑΝΗ ενεργοποιημένη; → Αν **ΟΧΙ** → 🟠 WARNING στον `siteManager`
   - Σύμβαση ενεργή; → Αν **ΟΧΙ** → 🔴 CRITICAL ALERT
3. `siteManager` βλέπει dashboard: ποιοι είναι παρόντες, ποιοι λείπουν, ποιοι καθυστερούν

#### Κατά τη Διάρκεια — Αποχωρήσεις & Επιστροφές

**Σενάριο Α — Εργάτης ζητά άδεια εξόδου**:
```
Εργάτης → siteManager: "Θέλω να φύγω για φαρμακείο"
     ↓
siteManager → App: "Exit Permission" → Επιλέγει εργάτη → Εγκρίνει
     ↓
Σύστημα: event `exit_permission` + `left_site` (approved, timestamp, notes)
     ↓
Εργάτης επιστρέφει → Σκανάρει QR → event `returned`
     ↓
AI: Υπολογίζει gap = [left_site → returned] → ΔΕΝ μετράει ως εργάσιμος χρόνος
```

**Σενάριο Β — Εργάτης φεύγει ΧΩΡΙΣ άδεια (geofence detect)**:
```
Geofence: Εργάτης εκτός ακτίνας >5 λεπτά
     ↓
🟠 ALERT siteManager: "Ο [Εργάτης] έφυγε από το εργοτάξιο χωρίς άδεια"
     ↓
siteManager αποφασίζει:
  → "Εγκρίνω εκ των υστέρων" → event `exit_permission` (retroactive)
  → "Δεν ενέκρινα" → event `unauthorized_absence` → ΠΑΡΑΜΕΝΕΙ στο log
     ↓
>15 λεπτά → AUTO CHECK-OUT
     ↓
Εργάτης ξαναμπαίνει → AUTO RE-CHECK-IN → Gap documented
```

**Σενάριο Γ — Εργάτης check-in χωρίς check-out (ξέχασε)**:
```
23:59 → AI ελέγχει: Εργάτης [X] έχει check-in αλλά ΟΧΙ check-out
     ↓
🟡 ALERT siteManager: "Ο [Εργάτης] δεν έκανε check-out — ξέχασε ή είναι ακόμα;"
     ↓
siteManager: Καταχωρεί χειροκίνητο check-out (method: manual_sitemanager)
     ↓
Σύστημα: Σημαδεύει ημέρα ως `anomaly: missing_checkout`
```

#### Βράδυ — Λήξη βάρδιας

1. Εργάτες σκανάρουν QR ή βγαίνουν από geofence → `check_out`
2. AI υπολογίζει ώρες εργασίας (αφαιρεί gaps + breaks)
3. Αν πραγματικές ώρες > 8h → Αυτόματος υπολογισμός υπερωρίας
4. Αν υπερωρία → AI ελέγχει: Δηλώθηκε στο ΕΡΓΑΝΗ; → Αν **ΟΧΙ** → 🔴 CRITICAL ALERT

#### Τέλος μήνα

1. AI δημιουργεί **μηνιαία σύνοψη** ανά εργαζόμενο ανά project:
   - Σύνολο ημερών εργασίας
   - Σύνολο ωρών (κανονικές + υπερωρίες)
   - Σύνολο gaps (εγκεκριμένα + μη εγκεκριμένα)
   - Σύνολο anomalies
2. AI υπολογίζει εισφορές (ένσημα) βάσει πραγματικών ημερών/ωρών
3. AI **cross-check**: Παρουσιολόγιο ↔ ΑΠΔ (alert αν δεν συμφωνούν)
4. Ενημέρωση `accountant` → "Μηνιαία αναφορά εργατικών έτοιμη — [X] εργαζόμενοι, [Y] ημέρες, [Z] anomalies"

---

### 4.5: Νομική Κάλυψη — Immutable Audit Trail

**Κρίσιμο**: Κάθε event αποθηκεύεται ως **immutable record** στο Firestore:

| Αρχή | Υλοποίηση |
|------|-----------|
| **Αμεταβλητότητα** | Κανένα event δεν μπορεί να τροποποιηθεί ή διαγραφεί μετά τη δημιουργία |
| **Server timestamp** | Ο χρόνος ορίζεται από τον server (όχι από το κινητό του εργάτη) |
| **GPS proof** | Κάθε event αποθηκεύει GPS coordinates αν διαθέσιμα |
| **Method tracking** | Κάθε event καταγράφει τη μέθοδο (`qr_scan`, `geofence_auto`, `manual_sitemanager`) |
| **Retroactive flag** | Αν εγκριθεί εκ των υστέρων, σημαδεύεται ως `retroactive: true` |

**Σε περίπτωση ελέγχου ΣΕΠΕ ή ατυχήματος**:
- Το σύστημα παράγει **πλήρη αναφορά** για κάθε εργαζόμενο σε κάθε ημερομηνία
- Η αναφορά δείχνει: πότε μπήκε, πότε βγήκε, πότε ήταν εκτός, αν είχε άδεια
- **Αν ο εργάτης είχε κάνει check-out και πάθει ατύχημα εκτός εργοταξίου** → Ο εργοδότης έχει τεκμηριωμένη απόδειξη ότι ο εργάτης ΔΕΝ ήταν σε εργασία

---

### 4.6: Alerts & Compliance Checks

| Έλεγχος | Συχνότητα | Alert Level | Αρμόδιος |
|---------|-----------|-------------|----------|
| Εργαζόμενος χωρίς αναγγελία ΕΦΚΑ | Ανά check-in | 🔴 Critical | `accountant` + `owner` |
| Εργαζόμενος χωρίς ενεργή σύμβαση | Ανά check-in | 🔴 Critical | `accountant` + `owner` |
| Αποχώρηση χωρίς άδεια (geofence) | Real-time | 🟠 High | `siteManager` |
| Check-in χωρίς check-out (τέλος ημέρας) | Ημερήσια (23:59) | 🟡 Medium | `siteManager` |
| Υπερωρία χωρίς δήλωση ΕΡΓΑΝΗ | Ανά check-out (>8h) | 🔴 Critical | `siteManager` + `accountant` |
| Εργαζόμενος >10h σε μία ημέρα | Real-time | 🟠 High | `siteManager` |
| Εργαζόμενος >48h/εβδομάδα | Εβδομαδιαία | 🟠 High | `siteManager` |
| Εκπρόθεσμη ΑΠΔ | Ημερήσια (τελευταίες 7 ημέρες μήνα) | 🟠 High | `accountant` |
| Ασφαλιστικές εισφορές σε καθυστέρηση | Μηνιαία | 🟠 High | `accountant` + `owner` |
| Λήξη σύμβασης εργασίας | 15 ημέρες πριν | 🟡 Low | `accountant` |
| Εκκρεμείς άδειες (>2 μήνες) | Μηνιαία | 🟡 Low | `siteManager` |
| Ασυμφωνία παρουσιολόγιο ↔ ΑΠΔ | Μηνιαία | 🟠 High | `accountant` |

---

### 4.7: Dashboard Εργοδηγού (siteManager)

Ο `siteManager` βλέπει σε πραγματικό χρόνο:

| Widget | Περιεχόμενο |
|--------|-------------|
| **Παρόντες** | Λίστα εργατών που είναι ΤΩΡΑ στο εργοτάξιο (πράσινο) |
| **Απόντες** | Εργάτες που αναμένονται αλλά δεν ήρθαν (κόκκινο) |
| **Εκτός εργοταξίου** | Εργάτες που έφυγαν ενδιάμεσα — με ή χωρίς άδεια (πορτοκαλί) |
| **Ώρες σήμερα** | Σύνολο ωρών ανά εργάτη μέχρι τώρα |
| **Anomalies** | Προβληματικές εγγραφές (missing checkout, unauthorized absence) |
| **Μηνιαία πρόοδος** | Ημέρες/ώρες εργασίας μέχρι σήμερα ανά εργάτη |

---

## Έντυπα — Σειρά Υποβολής (Lifecycle)

### Για νέο έργο:

```
1. Ε.3 Αναγγελία Έργου (πριν εργασίες)
   ↓
2. ΑΜΟΕ εκδίδεται
   ↓
3. Ε.1 Αναγγελία Πρόσληψης (ανά εργαζόμενο, πριν εργασία)
   ↓
4. Ε.4 Πίνακας Προσωπικού (εντός 3 ημερών)
   ↓
5. Ψηφιακή Κάρτα ΕΡΓΑΝΗ II (καθημερινά)
   ↓
6. ΑΠΔ (μηνιαία, ηλεκτρονικά)
   ↓
7. Πληρωμή εισφορών (μηνιαία)
   ↓
8. Τελική ΑΠΔ (30 ημέρες μετά λήξη έργου)
```

### AI Checklist ανά εργαζόμενο:

| # | Βήμα | Status | Deadline |
|---|------|--------|----------|
| 1 | ☐ Αναγγελία πρόσληψης (Ε.1) | `pending` | Πριν 1η ημέρα εργασίας |
| 2 | ☐ Πίνακας προσωπικού (Ε.4) | `pending` | Εντός 3 ημερών |
| 3 | ☐ Ψηφιακή κάρτα ενεργοποιημένη | `pending` | 1η ημέρα εργασίας |
| 4 | ☐ Κλάση ενσήμων καθορισμένη | `pending` | 1η ημέρα εργασίας |
| 5 | ☐ ΑΠΔ περιλαμβάνει εργαζόμενο | `pending` | Τέλος 1ου μήνα |

---

## Κανάλια Επικοινωνίας

- **In-app**: Παρουσιολόγιο, checklists, alerts, reports
- **Email**: Μηνιαίες αναφορές, ΑΠΔ reminders
- **Telegram**: Urgent alerts (ανασφάλιστος εργαζόμενος, εκπρόθεσμη ΑΠΔ)

---

## Routing

| Λειτουργία | Κύριος αρμόδιος | Εμπλεκόμενοι |
|-----------|-----------------|-------------|
| Αναγγελία ΕΦΚΑ | `accountant` | `siteManager`, `owner` |
| Παρουσιολόγιο | `siteManager` | `accountant` |
| ΑΠΔ & εισφορές | `accountant` | `owner` |
| Ψηφιακή κάρτα | `siteManager` | `accountant` |
| Alerts non-compliance | AI → `accountant` + `owner` | `siteManager` |

---

## AI Model Tier

- **FAST**: Checklists, alerts, υπολογισμός εισφορών, cross-checks, reminders
- **QUALITY**: Μηνιαίες αναφορές εργατικών, ανάλυση κόστους εργασίας ανά project

---

## Κανόνες

### Εργατική Συμμόρφωση
- **Μηδέν ανασφάλιστη εργασία**: Αν εργαζόμενος δεν έχει αναγγελία → ΑΜΕΣΟ 🔴 ALERT (πρόστιμο 10.500€+)
- **ΑΠΔ = υποχρεωτική ηλεκτρονικά**: Δεν γίνεται δεκτή σε χαρτί
- **Υπερωρία = πρότερη δήλωση**: Πρέπει να δηλωθεί στο ΕΡΓΑΝΗ II ΠΡΙΝ γίνει
- **Κλάσεις = config-driven**: Ενημερώνονται ετησίως, δεν είναι hardcoded
- **AI δεν υποβάλλει**: Η AI ετοιμάζει, υπολογίζει, υπενθυμίζει — ο `accountant` υποβάλλει
- **Cross-check = υποχρεωτικό**: Παρουσιολόγιο ↔ ΕΦΚΑ ↔ ΕΡΓΑΝΗ ↔ ΑΠΔ πρέπει να συμφωνούν
- **Πρόστιμα = prevention-first**: Η AI στοχεύει στο μηδέν πρόστιμα μέσω proactive alerts

### Παρουσιολόγιο
- **Immutable events**: Κανένα event παρουσίας δεν μπορεί να τροποποιηθεί ή διαγραφεί μετά τη δημιουργία
- **Server timestamp ΜΟΝΟ**: Ο χρόνος ορίζεται από τον server — ποτέ από το κινητό του εργάτη
- **Mandatory check-out**: Κάθε check-in ΠΡΕΠΕΙ να έχει αντίστοιχο check-out (alert αν λείπει)
- **Αποχώρηση = καταγραφή**: Κάθε έξοδος από το εργοτάξιο ΠΡΕΠΕΙ να καταγραφεί (QR/geofence/manual)
- **Exit permission**: Αν ο εργάτης φύγει με άδεια → gap documented + εγκεκριμένο
- **Unauthorized absence**: Αν ο εργάτης φύγει ΧΩΡΙΣ άδεια → alert + documented (νομική κάλυψη)
- **Νομική κάλυψη ατυχήματος**: Αν ο εργάτης δεν είναι checked-in κατά τη στιγμή ατυχήματος → τεκμηριωμένη απόδειξη
- **Geofence = config-driven**: Ακτίνα, thresholds, alert times — ρυθμίζονται ανά εργοτάξιο
- **QR rotation**: Το QR code αλλάζει καθημερινά (αποτρέπει απάτη/screenshot)

---

## Data Model — Σύνδεση με Contacts System

Το UC-024 βασίζεται **πλήρως** στο existing Contacts System της εφαρμογής. Δεν δημιουργούμε νέο μητρώο εργαζομένων — χρησιμοποιούμε τις υπάρχουσες δομές.

### Οντότητες & Αντιστοίχιση

| Οντότητα UC-024 | Contacts System | Collection | Παράδειγμα |
|-----------------|-----------------|------------|-----------|
| **Εργαζόμενος** | `individual` contact | `contacts` | Νίκος Γεωργίου (τεχνίτης σκυροδέματος) |
| **Συνεργείο / Υπεργολάβος** | `company` contact | `contacts` | "Παπαδόπουλος Κατασκευαστική ΙΚΕ" |
| **Σχέση Εργάτη ↔ Συνεργείο** | `ContactRelationship` | `contact_relationships` | type: `employee` ή `contractor` |
| **Σχέση Συνεργείου ↔ Project** | `ContactLink` | `contact_links` | targetEntityType: `project` |
| **Εργοδότης (εμείς)** | `company` contact | `contacts` | Η εταιρεία μας |

### Πώς λειτουργεί η σύνδεση

```
COMPANY CONTACT (Συνεργείο "Παπαδόπουλος ΙΚΕ")
│
├── contact_relationships → Individual "Νίκος Γεωργίου"
│   ├── relationshipType: "employee"
│   ├── position: "Τεχνίτης σκυροδέματος"
│   ├── employmentStatus: "full_time"
│   ├── employmentType: "permanent"
│   ├── certifications: ["Χειριστής αντλίας"]
│   ├── financialInfo.billingRate: 39.30€ (κλάση 10)
│   └── startDate: "2024-03-15"
│
├── contact_relationships → Individual "Κώστας Δημητρίου"
│   ├── relationshipType: "employee"
│   ├── position: "Εργάτης"
│   ├── employmentStatus: "seasonal"
│   └── ...
│
└── contact_links → Project "Πολυκατοικία Μαρούσι"
    ├── targetEntityType: "project"
    └── status: "active"
```

### Mapping πεδίων UC-024 → Contacts

| Πεδίο UC-024 | Πεδίο Contacts System | Τοποθεσία |
|--------------|----------------------|-----------|
| `workerId` (στα events) | `contact.id` | `contacts/{id}` (individual) |
| Κλάση ενσήμων | `relationship.financialInfo.billingRate` | `contact_relationships` |
| Κατηγορία εργαζόμενου | `relationship.position` | `contact_relationships` |
| Ειδικότητα | `contact.specialty` (individual) | `contacts/{id}` |
| ΑΜΚΑ | `contact.amka` (individual) | `contacts/{id}` |
| ΑΦΜ | `contact.vatNumber` | `contacts/{id}` (individual ή company) |
| Σύμβαση ενεργή; | `relationship.status` + `relationship.endDate` | `contact_relationships` |
| Σε ποιο project | `contactLink.targetEntityId` | `contact_links` |
| Σε ποιο συνεργείο | `relationship.targetContactId` | `contact_relationships` |

### Κρίσιμοι κανόνες data model

- **Κάθε εργάτης** που κάνει check-in ΠΡΕΠΕΙ να είναι `individual` contact στο σύστημα
- **Κάθε συνεργείο** ΠΡΕΠΕΙ να είναι `company` contact με `vatNumber`
- **Η σχέση εργάτη ↔ συνεργείου** γίνεται μέσω `contact_relationships` (ΟΧΙ custom collection)
- **Η σχέση συνεργείου ↔ project** γίνεται μέσω `contact_links` (ΟΧΙ custom collection)
- **Κλάση ενσήμων** αντλείται από `financialInfo.billingRate` στο relationship
- **Πιστοποιήσεις** αποθηκεύονται στο `relationship.certifications` (βλ. UC-028)

---

## Σύνδεση με Υπάρχοντα UCs

| UC | Σύνδεση |
|----|---------|
| **UC-002** (Τιμολόγιο) | Τιμολόγιο μισθοδοσίας → cross-check με ΑΠΔ |
| **UC-015** (Αδειοδότηση) | Οικοδομική άδεια → trigger αναγγελίας ΕΦΚΑ |
| **UC-016** (Προμήθεια) | Υπεργολάβοι → δικό τους ΕΦΚΑ; Ή δικό μας; |
| **UC-018** (Daily Briefing) | `accountant` briefing περιλαμβάνει εκκρεμείς ΑΠΔ |
| **UC-019** (Reminders) | Auto-reminders για ΑΠΔ deadlines, λήξη συμβάσεων |
| **UC-025** (Κοστολόγηση) | Κόστος εργασίας ανά project ← παρουσιολόγιο × κλάση ενσήμων |
| **UC-027** (Ασφάλεια) | Ατύχημα → ποιος εργάτης → ποιο συνεργείο → νομική ευθύνη |
| **UC-028** (Πιστοποιήσεις) | Check-in → AI ελέγχει πιστοποιήσεις εργάτη πριν επιτρέψει είσοδο |

---

## Νομοθετικό Πλαίσιο (αναφορές)

| Νόμος/Σύστημα | Περιγραφή |
|---------------|-----------|
| **e-ΕΦΚΑ** | Ηλεκτρονική πλατφόρμα ΕΦΚΑ (efka.gov.gr) |
| **ΕΡΓΑΝΗ II** | Ψηφιακή πλατφόρμα Υπ. Εργασίας (σε παραγωγή 16/02/2026) |
| **Ν.4808/2021** | Μεταρρύθμιση εργασιακών σχέσεων, ψηφιακή κάρτα |
| **Ν.4997/2022** | Τροποποιήσεις εργατικής νομοθεσίας |
| **ΑΠΔ** | Αναλυτική Περιοδική Δήλωση — μηνιαία ηλεκτρονικά |
| **ΣΕΠΕ** | Σώμα Επιθεώρησης Εργασίας (ελέγχει συμμόρφωση) |

