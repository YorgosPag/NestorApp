# UC-026: Ταμειακές Ροές (Cash Flow Forecasting & Management)

> **Parent ADR**: [ADR-169 - Modular AI Architecture](../../reference/adrs/ADR-169-modular-ai-architecture.md)
> **Pipeline**: [pipeline.md](../pipeline.md)
> **Σχετικά UCs**: [UC-002](./UC-002-invoice.md) (τιμολόγια), [UC-014](./UC-014-property-sale-process.md) (πωλήσεις), [UC-016](./UC-016-procurement-process.md) (προμήθειες), [UC-024](./UC-024-labor-compliance.md) (εργατικά), [UC-025](./UC-025-project-costing.md) (κοστολόγηση), [UC-031](./UC-031-payment-plan-management.md) (πληρωμές αγοραστών)

---

## Trigger

Αυτόματο — η AI αναλύει συνεχώς τις εισροές και εκροές και δημιουργεί πρόβλεψη ταμειακών ροών. Επίσης trigger σε κάθε νέα οικονομική κίνηση (τιμολόγιο, πληρωμή, δόση).

---

## Επισκόπηση

```
ΕΙΣΡΟΕΣ (πότε μπαίνουν λεφτά) ↔ ΕΚΡΟΕΣ (πότε βγαίνουν λεφτά) → ΥΠΟΛΟΙΠΟ → FORECAST → ALERTS
```

**Κρίσιμη διαφορά UC-025 vs UC-026**:
- **UC-025** (Κοστολόγηση): "Πόσα ξοδέψαμε συνολικά;" — backward-looking
- **UC-026** (Ταμειακές Ροές): "Πόσα λεφτά θα ΕΧΟΥΜΕ τον επόμενο μήνα;" — forward-looking

---

## 1. Πηγές Εισροών (Cash In)

| Πηγή | Πώς αντλείται | Προβλεψιμότητα |
|------|---------------|----------------|
| **Δόσεις αγοραστών** | UC-014 → πρόγραμμα πληρωμών ανά αγοραστή | Υψηλή (συμβατικές) |
| **Αρχική προκαταβολή** | UC-014 → Στάδιο 3 (Κράτηση) | Υψηλή |
| **Συμβολαιογραφικά** | UC-014 → Στάδιο 7 (Υπογραφή) | Υψηλή |
| **Δάνειο τράπεζας** | Manual entry → εκταμιεύσεις | Μέτρια |
| **Ίδια κεφάλαια** | Manual entry | Γνωστά |
| **Επιστροφές ΦΠΑ** | Περιοδική (τριμηνιαία) | Μέτρια |

### Αυτόματη παρακολούθηση εισπράξεων

| Κατάσταση δόσης | Σημασία | AI Action |
|----------------|---------|-----------|
| `scheduled` | Αναμένεται βάσει συμβολαίου | Μετράει στο forecast |
| `overdue` | Πέρασε η ημερομηνία | 🟠 Alert + μετράει ως "at risk" |
| `overdue_30d` | >30 μέρες καθυστέρηση | 🔴 Alert `owner` + αφαιρείται από forecast |
| `received` | Εισπράχθηκε | Ενημέρωση υπολοίπου |

---

## 2. Πηγές Εκροών (Cash Out)

| Πηγή | Πώς αντλείται | Προβλεψιμότητα |
|------|---------------|----------------|
| **Τιμολόγια προμηθευτών** | UC-002 → ημ/νία λήξης πληρωμής | Υψηλή (γνωστά ποσά) |
| **Μισθοδοσία / Ένσημα** | UC-024 → μηνιαία εισφορά | Υψηλή (σταθερά) |
| **Υπεργολάβοι** | UC-016 → πρόγραμμα πληρωμών | Μέτρια (εξαρτάται από πρόοδο) |
| **Δόσεις δανείου** | Manual entry → τοκοχρεολύσιο | Υψηλή |
| **ΦΠΑ / Φόροι** | Περιοδική (μηνιαία/τριμηνιαία) | Υψηλή |
| **Πάγια έξοδα** | Ρεύμα, νερό, ενοίκια, ασφάλειες | Υψηλή (recurring) |
| **Απρόβλεπτα** | Buffer 5% μηνιαίων εκροών | Εκτίμηση |

---

## 3. Πρόβλεψη Ταμειακών Ροών (AI Forecast)

### 3.1: Μηνιαίος πίνακας

| Μήνας | Αρχικό Υπόλοιπο | Εισροές | Εκροές | Τελικό Υπόλοιπο | Status |
|-------|-----------------|---------|--------|-----------------|--------|
| Φεβ 2026 | 150.000€ | 85.000€ | 110.000€ | 125.000€ | ✅ OK |
| Μαρ 2026 | 125.000€ | 40.000€ | 95.000€ | 70.000€ | ⚠️ Χαμηλό |
| Απρ 2026 | 70.000€ | 120.000€ | 105.000€ | 85.000€ | ✅ OK |
| Μαϊ 2026 | 85.000€ | 30.000€ | 100.000€ | 15.000€ | 🔴 Κρίσιμο |

### 3.2: AI Ανάλυση

| Λειτουργία | Περιγραφή |
|-----------|-----------|
| **Forecast 3 μηνών** | Πρόβλεψη εισροών/εκροών βάσει γνωστών υποχρεώσεων + ιστορικού |
| **Forecast 6 μηνών** | Πιο αβέβαιο — χρησιμοποιεί πιθανολογικά σενάρια |
| **Best/Worst/Expected** | 3 σενάρια: Αισιόδοξο (όλοι πληρώνουν), Αναμενόμενο, Απαισιόδοξο (καθυστερήσεις) |
| **What-if analysis** | "Αν ο αγοραστής Χ καθυστερήσει 2 μήνες → τι γίνεται;" |

### 3.3: Αυτόματες Προτάσεις

Η AI δεν ειδοποιεί μόνο — **προτείνει λύσεις**:

| Πρόβλεψη | AI Πρόταση |
|----------|-----------|
| Έλλειμμα σε 2 μήνες | "Προτείνω να ζητήσετε την 3η δόση του [αγοραστή] νωρίτερα (ποσό: 45.000€)" |
| Μεγάλη πληρωμή προμηθευτή | "Ο [προμηθευτής] δέχεται 60 ημέρες πίστωση — αξιοποιήστε το" |
| Πλεόνασμα τρέχοντος μήνα | "Υπάρχει πλεόνασμα 50.000€ — μπορείτε να εξοφλήσετε τον [προμηθευτή] νωρίτερα για 2% έκπτωση" |
| Overdue δόσεις | "3 αγοραστές έχουν overdue δόσεις (σύνολο 75.000€) — ξεκινήστε follow-up" |

---

## 4. Alerts

| Alert | Trigger | Level | Αρμόδιος |
|-------|---------|-------|----------|
| Υπόλοιπο < minimum threshold | Config-driven (π.χ. <50.000€) | 🔴 Critical | `owner` + `accountant` |
| Forecast δείχνει αρνητικό | Οποιοσδήποτε μήνας στο 3μηνο forecast | 🔴 Critical | `owner` |
| Overdue εισπράξεις >30 ημέρες | Δόση αγοραστή >30d overdue | 🟠 High | `accountant` + `salesManager` |
| Μεγάλη πληρωμή σε 7 ημέρες | Εκροή >20.000€ τις επόμενες 7 ημέρες | 🟡 Medium | `accountant` |
| Εισροές μήνα < εκροές μήνα | Μηνιαία σύγκριση | 🟡 Medium | `accountant` |

---

## 5. Αναφορές

| Αναφορά | Συχνότητα | Παραλήπτης |
|---------|-----------|------------|
| **Εβδομαδιαίο cash position** | Εβδομαδιαία (Δευτέρα πρωί) | `owner`, `accountant` |
| **Μηνιαίο cash flow statement** | Μηνιαία | `owner`, `accountant` |
| **3μηνη πρόβλεψη** | Μηνιαία (rolling) | `owner` |
| **Overdue δόσεις report** | Εβδομαδιαία | `accountant`, `salesManager` |

---

## Routing

| Λειτουργία | Κύριος αρμόδιος | Εμπλεκόμενοι |
|-----------|-----------------|-------------|
| Καταχώρηση εισροών/εκροών | `accountant` | — |
| Εβδομαδιαία αναφορά | AI → `owner` | `accountant` |
| Follow-up overdue | `salesManager` (δόσεις) / `accountant` (τιμολόγια) | `owner` |
| Απόφαση αναχρηματοδότησης | `owner` | `accountant` |

---

## AI Model Tier

- **FAST**: Υπολογισμοί, alerts, αυτόματη κατηγοριοποίηση
- **QUALITY**: Forecast, what-if analysis, αυτόματες προτάσεις, αναφορές

---

## Data Model — Σύνδεση με Contacts System

Οι ταμειακές ροές συνδέονται με **contacts** για αντιστοίχιση εισροών/εκροών σε οντότητες:

### Εισροές ↔ Contacts

| Εισροή | Contact Type | Relationship | Πώς αντλείται |
|--------|-------------|--------------|---------------|
| **Δόσεις αγοραστών** | `individual`/`company` contacts | `client` relationship | UC-014 πρόγραμμα πληρωμών ανά αγοραστή contact |
| **Αρχική προκαταβολή** | `individual`/`company` contacts | `client` relationship | UC-014 Στάδιο 3 |
| **Επιστροφές ΦΠΑ** | `service` contact (ΑΑΔΕ) | — | Περιοδική |

### Εκροές ↔ Contacts

| Εκροή | Contact Type | Relationship | Πώς αντλείται |
|--------|-------------|--------------|---------------|
| **Τιμολόγια προμηθευτών** | `company` contacts | `vendor` relationship | UC-002 τιμολόγια ανά προμηθευτή contact |
| **Μισθοδοσία / Ένσημα** | `individual` contacts (εργάτες) | `employee` relationship | UC-024 ανά εργάτη × κλάση |
| **Υπεργολάβοι** | `company` contacts | `contractor` relationship | UC-016 πρόγραμμα πληρωμών ανά υπεργολάβο contact |
| **ΦΠΑ / Φόροι** | `service` contact (ΑΑΔΕ/ΔΟΥ) | — | Περιοδική |

### Τραπεζικοί λογαριασμοί

Τα στοιχεία πληρωμής αντλούνται από το **Banking** system στα contacts:
- `BankAccount.iban` — IBAN πληρωμής
- `BankAccount.bankName` — Τράπεζα
- `BankAccount.isPrimary` — Κύριος λογαριασμός
- Κάθε `company` ή `individual` contact μπορεί να έχει πολλαπλούς τραπεζικούς λογαριασμούς

### Αυτόματες αναφορές ανά contact

| Αναφορά | Βάσει Contact |
|---------|--------------|
| "Top 5 αγοραστές με overdue δόσεις" | Aggregation ανά `client` contacts |
| "Top 5 προμηθευτές σε αξία εκροών" | Aggregation ανά `vendor` contacts |
| "Υπεργολάβοι με εκκρεμείς πληρωμές" | Filter `contractor` contacts + open invoices |

---

## Κανόνες

- **Real-time ενημέρωση**: Κάθε νέο τιμολόγιο/πληρωμή → αυτόματη ενημέρωση forecast
- **Conservative forecast**: Το default σενάριο είναι το "Expected" (όχι αισιόδοξο)
- **Overdue = at risk**: Δόσεις >30 ημέρες overdue αφαιρούνται από το forecast (δεν τις μετράμε σαν σίγουρες)
- **Minimum cash threshold**: Config-driven ανά εταιρεία (π.χ. 50.000€)
- **AI δεν πληρώνει**: Η AI προτείνει — ο `accountant`/`owner` αποφασίζει και εκτελεί
- **Audit trail**: Κάθε πρόβλεψη αποθηκεύεται → σύγκριση forecast vs actual (ακρίβεια AI)
- **Contact-linked**: Κάθε εισροή/εκροή πρέπει να συνδέεται με συγκεκριμένο contact (ποιος πληρώνει/πληρώνεται)
