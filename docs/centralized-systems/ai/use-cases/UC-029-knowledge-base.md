# UC-029: Βάση Γνώσης Εταιρείας (Institutional Knowledge Base)

> **Parent ADR**: [ADR-169 - Modular AI Architecture](../../reference/adrs/ADR-169-modular-ai-architecture.md)
> **Pipeline**: [pipeline.md](../pipeline.md)
> **Σχετικά UCs**: Όλα — η Βάση Γνώσης αντλεί δεδομένα από κάθε UC

---

## Trigger

Οποιοσδήποτε εσωτερικός χρήστης κάνει ερώτηση στο σύστημα σχετικά με ιστορικά δεδομένα, αποφάσεις, εμπειρίες, ή best practices της εταιρείας.

---

## Επισκόπηση

```
ΕΡΩΤΗΣΗ ΧΡΗΣΤΗ → AI ΑΝΑΖΗΤΗΣΗ ΣΕ ΟΛΕΣ ΤΙΣ ΠΗΓΕΣ → ΣΥΝΘΕΣΗ ΑΠΑΝΤΗΣΗΣ → ΠΑΡΑΘΕΣΗ ΠΗΓΩΝ
```

**Τι είναι**: Ένα AI-powered σύστημα που "θυμάται" ΟΛΑ όσα έχουν γίνει στην εταιρεία και απαντάει σε ερωτήσεις εσωτερικών χρηστών, αντλώντας από πραγματικά δεδομένα.

**Γιατί χρειάζεται**: Σε μια κατασκευαστική εταιρεία, η γνώση βρίσκεται σε emails, σε σημειώσεις, στα μυαλά ανθρώπων. Αν φύγει ένας μηχανικός, φεύγει μαζί του πολύτιμη γνώση. Η Βάση Γνώσης σώζει αυτή τη γνώση.

---

## 1. Πηγές Δεδομένων

Η AI αντλεί απαντήσεις από **ΟΛΑ τα δεδομένα** της εφαρμογής:

| Πηγή | Τι περιέχει | Παράδειγμα ερωτήσεων |
|------|------------|---------------------|
| **Projects** | Ιστορικά projects, specifications, κόστη | "Τι υλικά χρησιμοποιήσαμε στο έργο Μαρούσι;" |
| **Communications** | Emails, Telegram μηνύματα | "Τι μας είπε ο αρχιτέκτονας για τη μόνωση;" |
| **Invoices** | Τιμολόγια, τιμές, ποσότητες | "Πόσο κόστιζε το αλουμίνιο τον Μάρτιο 2025;" |
| **Procurement** | Προσφορές, συμφωνίες, αξιολογήσεις | "Ποιον υπεργολάβο χρησιμοποιήσαμε για πλακάκια;" |
| **Defects** | Αναφορές ελαττωμάτων, λύσεις | "Πώς λύσαμε το πρόβλημα υγρασίας στο υπόγειο;" |
| **Safety** | Ατυχήματα, near-misses, μέτρα | "Τι ατυχήματα είχαμε σε σκαλωσιές;" |
| **Contacts** | Προμηθευτές, πελάτες, rating | "Ποιοι ηλεκτρολόγοι δούλεψαν στο Αιγάλεω;" |
| **Documents** | Μελέτες, σχέδια, πιστοποιήσεις | "Ποια μελέτη στατικής χρησιμοποιήσαμε;" |
| **Permits** | Αδειοδοτήσεις, εγκρίσεις | "Πόσο κράτησε η αδειοδότηση στο Χαλάνδρι;" |

---

## 2. Τύποι Ερωτήσεων

### 2.1: Ιστορικά / Factual

| Ερώτηση | AI Απάντηση (παράδειγμα) |
|---------|-------------------------|
| "Ποιον ηδραυλικό είχαμε στο έργο Γλυφάδας;" | "Τον Κώστα Παπαδόπουλο (εταιρεία: Hydro Solutions). Εργάστηκε Μάρτιο-Μάιο 2025. 3 τιμολόγια, σύνολο 12.500€. Αξιολόγηση: ★★★★☆" |
| "Πόσο κόστισε η στεγανοποίηση στο Μαρούσι;" | "Σύνολο 28.400€ (υλικά: 15.200€ + εργασία: 13.200€). Προμηθευτής υλικών: SIKA Greece. 3 τιμολόγια." |
| "Πόσο κράτησε η αδειοδότηση στο τελευταίο έργο;" | "Η αδειοδότηση στο Χαλάνδρι κράτησε 8 μήνες (Μάρτιος-Νοέμβριος 2025). Η καθυστέρηση ήταν στην Αρχαιολογία (3 μήνες)." |

### 2.2: Συγκριτικά

| Ερώτηση | AI Απάντηση (παράδειγμα) |
|---------|-------------------------|
| "Ποιος προμηθευτής αλουμινίων είναι καλύτερος;" | "Βάσει ιστορικού: Alpha Aluminium (3 projects, 0 defects, τιμή μέτρια) vs Beta Windows (2 projects, 2 defects, φθηνότερο 15%). Πρόταση: Alpha Aluminium." |
| "Πόσο κοστίζει κατά μέσο όρο η Η/Μ ανά τ.μ.;" | "Βάσει 5 τελευταίων projects: 85-120€/τ.μ. Μέσος: 98€/τ.μ. Τα πολυτελή projects 130€/τ.μ." |

### 2.3: Τεχνικά / Problem-Solving

| Ερώτηση | AI Απάντηση (παράδειγμα) |
|---------|-------------------------|
| "Πώς λύσαμε το πρόβλημα υγρασίας στο υπόγειο του Αιγάλεω;" | "Defect #187 (Ιούνιος 2025): Υγρασία από ρωγμή στη στεγανοποίηση. Λύση: Εφαρμογή SIKA Injection (2-component resin). Κόστος: 3.200€. Διορθώθηκε σε 3 ημέρες. Δεν επανεμφανίστηκε." |
| "Τι πρόβλημα είχαμε με τον γερανό στη Γλυφάδα;" | "Safety Incident #12 (Απρίλιος 2025): Near-miss, αστάθεια γερανού λόγω μαλακού εδάφους. Μέτρο: Τοποθέτηση πλάκας βάσης 2×2m. Δεν επαναλήφθηκε." |

### 2.4: Στατιστικά / Reporting

| Ερώτηση | AI Απάντηση (παράδειγμα) |
|---------|-------------------------|
| "Πόσα projects ολοκληρώσαμε το 2025;" | "4 projects. Σύνολο τ.μ.: 12.500. Μέσος χρόνος κατασκευής: 14 μήνες. Μέσο κόστος/τ.μ.: 1.250€." |
| "Ποιοι ήταν οι top 5 προμηθευτές μας σε αξία;" | "1. Κ. Σιδηρόπουλος (σίδερα): 285.000€, 2. SIKA Greece: 180.000€..." |

---

## 3. Λειτουργία AI

### 3.1: Αναζήτηση & Σύνθεση

```
ΕΡΩΤΗΣΗ: "Ποιον ηδραυλικό να χρησιμοποιήσω στο νέο έργο;"
     ↓
AI ΑΝΑΖΗΤΗΣΗ:
  → Contacts: Υδραυλικοί στη βάση
  → Procurement: Προηγούμενες συνεργασίες
  → Defects: Defects σε υδραυλικά → ποιος τα έφτιαξε
  → Invoices: Τιμές ανά υδραυλικό
  → Safety: Συμβάντα σχετικά με υδραυλικά
     ↓
AI ΣΥΝΘΕΣΗ:
  "Βάσει ιστορικού, προτείνω τον [Υδραυλικό Α]:
   - 3 projects μαζί, 0 defects
   - Μέση τιμή: ανταγωνιστική (2η φθηνότερη)
   - Τηρεί deadlines (0 καθυστερήσεις)
   Εναλλακτικά: [Υδραυλικός Β] (φθηνότερος 10% αλλά 2 defects)
   Πηγές: [link στα records]"
```

### 3.2: Πάντα με πηγές

**ΚΑΝΟΝΑΣ**: Η AI **ΠΑΝΤΑ** παραθέτει πηγές (records, τιμολόγια, defects, emails). Δεν "φαντάζεται" — αντλεί μόνο από πραγματικά δεδομένα.

| Στοιχείο απάντησης | Υποχρεωτικό |
|--------------------| -------------|
| Απάντηση στην ερώτηση | ✅ |
| Πηγές (links σε records) | ✅ |
| Ημερομηνίες | ✅ |
| Ποσά (αν σχετικά) | ✅ |
| Confidence level | ✅ ("Σίγουρο βάσει δεδομένων" / "Εκτίμηση βάσει μερικών δεδομένων") |

### 3.3: Τι ΔΕΝ κάνει η Βάση Γνώσης

- ❌ Δεν απαντά σε ερωτήσεις εκτός εταιρείας (δεν είναι Google)
- ❌ Δεν φαντάζεται δεδομένα — αν δεν βρει, λέει "Δεν βρήκα σχετικά δεδομένα"
- ❌ Δεν αποκαλύπτει confidential δεδομένα σε χρήστες χωρίς δικαίωμα (role-based)
- ❌ Δεν αποθηκεύει νέα γνώση αυτόματα — μόνο ανακτά υπάρχοντα δεδομένα

---

## 4. Role-Based Access

Κάθε χρήστης βλέπει μόνο δεδομένα που δικαιούται:

| Ρόλος | Βλέπει | ΔΕΝ βλέπει |
|-------|--------|------------|
| `owner` | Τα πάντα | — |
| `accountant` | Τιμολόγια, κόστη, πληρωμές, εργατικά | Τεχνικές αποφάσεις |
| `architect` | Μελέτες, σχέδια, υλικά, specifications | Οικονομικά |
| `civilEngineer` | Στατικά, κατασκευή, defects | Οικονομικά πωλήσεων |
| `siteManager` | Εργοτάξιο, εργάτες, υλικά, ασφάλεια | Οικονομικά πωλήσεων |
| `salesManager` | Πωλήσεις, πελάτες, τιμές πώλησης | Κόστη κατασκευής |
| `secretary` | Επαφές, ραντεβού, αλληλογραφία | Τεχνικά, οικονομικά |

---

## 5. Alerts & Proactive Suggestions

Η Βάση Γνώσης δεν περιμένει μόνο ερωτήσεις — **προτείνει proactively**:

| Trigger | AI Suggestion |
|---------|-------------|
| Νέο project ξεκινάει | "Βάσει ιστορικού, project αυτού του μεγέθους θέλει ~14 μήνες και ~1.250€/τ.μ." |
| Νέα προμήθεια αλουμινίων | "Τελευταία φορά αγοράσαμε αλουμίνια από [X] στα [Y]€/τ.μ. — θέλετε να ζητήσω προσφορά;" |
| Defect αναφέρεται (υγρασία) | "Παρόμοιο πρόβλημα στο [Project Β] λύθηκε με [μέθοδος] — λεπτομέρειες: [link]" |
| Νέος υπεργολάβος εισάγεται | "Δεν υπάρχει ιστορικό με αυτόν τον υπεργολάβο. Θέλετε αξιολόγηση μετά τη συνεργασία;" |

---

## Routing

| Λειτουργία | Κύριος αρμόδιος | Εμπλεκόμενοι |
|-----------|-----------------|-------------|
| Ερωτήσεις | Οποιοσδήποτε χρήστης | — |
| Proactive suggestions | AI → σχετικός ρόλος | — |
| Feedback ("σωστή/λάθος απάντηση") | Χρήστης που ρώτησε | — |

---

## AI Model Tier

- **FAST**: Απλές ερωτήσεις (factual lookup) — "Πόσο κόστισε X;"
- **QUALITY**: Σύνθετες ερωτήσεις (σύγκριση, σύνθεση, πρόταση) — "Ποιος είναι ο καλύτερος υδραυλικός;"

---

## Data Model — Σύνδεση με Contacts System

Η Βάση Γνώσης αξιοποιεί **πλήρως** το Contacts System ως πηγή δεδομένων για απαντήσεις:

### Τύποι ερωτήσεων ↔ Contacts

| Τύπος ερώτησης | Contact Data που αντλείται | Παράδειγμα |
|---------------|--------------------------|-----------|
| **Ποιος υπεργολάβος;** | `company` contacts + `contact_relationships` + `contact_links` | "Ποιον ηδραυλικό είχαμε στη Γλυφάδα;" → Αναζήτηση company contacts με link σε project |
| **Αξιολόγηση;** | `relationship.performanceInfo` | "Πώς πήγε ο [Χ];" → performanceRating, achievements, disciplinaryActions |
| **Ιστορικό τιμών;** | Τιμολόγια (UC-002) linked σε `company` contacts | "Πόσο κόστιζε η σιδηρά στον [Χ];" → Invoices ανά vendor contact |
| **Ποιος εργάτης;** | `individual` contacts + `employee` relationships | "Ποιοι ηλεκτρολόγοι δούλεψαν στο Αιγάλεω;" → Contacts + contact_links σε project |
| **Πιστοποιήσεις;** | `relationship.certifications` | "Ποιοι χειριστές γερανού είναι διαθέσιμοι;" → Individual contacts με certification |

### AI Σύνθεση από Contacts

Όταν ρωτηθεί "Ποιον υπεργολάβο να χρησιμοποιήσω;", η AI συνθέτει:

```
ΕΡΩΤΗΣΗ: "Ποιον ηδραυλικό να βάλω στο νέο έργο;"
     ↓
AI ΑΝΑΖΗΤΗΣΗ σε Contacts:
  → company contacts με sector "Υδραυλικά"
  → contact_links: σε ποια projects δούλεψαν
  → contact_relationships: performanceInfo.performanceRating
  → Invoices (UC-002): κόστος ανά υπεργολάβο
  → Defects (UC-011): ελαττώματα σε υδραυλικά ανά project
  → Safety (UC-027): ατυχήματα σε υδραυλικά
  → Certifications (UC-028): ενεργές ενημερότητες
     ↓
AI ΣΥΝΘΕΣΗ:
  "Βάσει ιστορικού, προτείνω [Υδραυλικός Α]:
   - 3 projects μαζί, 0 defects, rating: ★★★★☆
   - Ενεργή ασφαλιστική + φορολογική ενημερότητα
   - Μέση τιμή: ανταγωνιστική
   Εναλλακτικά: [Υδραυλικός Β] (φθηνότερος αλλά 2 defects)
   Πηγές: [links σε records]"
```

### Organization Hierarchy

Η Βάση Γνώσης μπορεί να απαντήσει ερωτήσεις **δομής**:

| Ερώτηση | Data Source |
|---------|-----------|
| "Ποιοι εργάζονται στο συνεργείο Χ;" | `contact_relationships` (employee → company) |
| "Ποιος είναι ο υπεύθυνος του συνεργείου Χ;" | `company.contactPersons` ή `relationship.type = 'representative'` |
| "Σε ποια projects δουλεύει ο εργάτης Χ;" | `contact_links` (individual → projects) |
| "Πόσους εργάτες έχει το συνεργείο Χ;" | Count `contact_relationships` (employee → company) |

---

## Κανόνες

- **Μόνο πραγματικά δεδομένα**: Η AI δεν "φαντάζεται" — αντλεί αποκλειστικά από records στο Firestore
- **Πάντα πηγές**: Κάθε απάντηση συνοδεύεται από references σε συγκεκριμένα records
- **Role-based**: Κάθε χρήστης βλέπει μόνο δεδομένα που δικαιούται
- **Confidence indicator**: Η AI δηλώνει πόσο σίγουρη είναι βάσει ποσότητας δεδομένων
- **"Δεν ξέρω" > ψέμα**: Αν δεν βρει σχετικά δεδομένα, το λέει ξεκάθαρα
- **Feedback loop**: Ο χρήστης μπορεί να αξιολογήσει κάθε απάντηση → βελτίωση ακρίβειας
- **Tenant isolation**: Δεδομένα μόνο εντός εταιρείας — ποτέ cross-tenant
- **Contacts = πρώτη πηγή**: Για ερωτήσεις "ποιος", "πόσοι", "rating" → η AI ψάχνει ΠΡΩΤΑ στα contacts
