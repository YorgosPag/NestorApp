# UC-028: Πιστοποιήσεις & Άδειες Εργαζομένων/Υπεργολάβων (Certifications & Licenses Tracking)

> **Parent ADR**: [ADR-169 - Modular AI Architecture](../../reference/adrs/ADR-169-modular-ai-architecture.md)
> **Pipeline**: [pipeline.md](../pipeline.md)
> **Σχετικά UCs**: [UC-024](./UC-024-labor-compliance.md) (εργατικά), [UC-027](./UC-027-site-safety.md) (ασφάλεια), [UC-016](./UC-016-procurement-process.md) (υπεργολάβοι)

---

## Trigger

Νέος εργαζόμενος ή υπεργολάβος εισέρχεται στο σύστημα, ή πλησιάζει η λήξη υπάρχουσας πιστοποίησης/ενημερότητας.

---

## Επισκόπηση

```
ΕΓΓΡΑΦΗ ΕΡΓΑΖΟΜΕΝΟΥ/ΥΠΕΡΓΟΛΑΒΟΥ → ΠΙΣΤΟΠΟΙΗΣΕΙΣ → ΠΑΡΑΚΟΛΟΥΘΗΣΗ ΛΗΞΕΩΝ → ALERTS → ΑΝΑΝΕΩΣΗ
```

---

## 1. Πιστοποιήσεις Εργαζομένων

### 1.1: Επαγγελματικές Άδειες

| Ειδικότητα | Άδεια | Εκδότης | Ισχύς | Ανανέωση |
|-----------|-------|---------|-------|----------|
| **Χειριστής γερανού** | Άδεια χειριστή μηχ. έργου | Περιφέρεια | 5 χρόνια | Εξέταση |
| **Ηλεκτρολόγος** | Άδεια ηλεκτρολόγου (Α'-Δ') | Περιφέρεια | Αόριστη (αλλά ελέγχεται) | — |
| **Υδραυλικός** | Άδεια τεχνίτη υδραυλικού | Περιφέρεια | Αόριστη | — |
| **Ψυκτικός** | Πιστοποιητικό φθοριούχων | ΥΠΕΝ | 5 χρόνια | Εξέταση |
| **Συγκολλητής** | Πιστοποιητικό EN ISO 9606 | Φορέας πιστοποίησης | 2-3 χρόνια | Εξέταση |
| **Χειριστής ανελκυστήρα** | Πιστοποιητικό | Εταιρεία ανελκυστήρα | Ετήσια | Ανανέωση |

### 1.2: Πιστοποιήσεις Ασφαλείας

| Πιστοποίηση | Υποχρεωτική; | Ισχύς | Αρμόδιος |
|------------|-------------|-------|----------|
| **Εκπαίδευση Υγεία & Ασφάλεια** | ✅ Ναι (νόμος) | Ετήσια ανανέωση | `siteManager` |
| **Εργασία σε ύψος** | ✅ Αν εργάζεται >2m | 2-3 χρόνια | `siteManager` |
| **Χρήση ικριωμάτων** | ✅ Αν εργάζεται σε σκαλωσιές | 2-3 χρόνια | `siteManager` |
| **Πρώτες βοήθειες** | Συνιστάται (1 ανά 50 εργαζόμενους) | 2 χρόνια | `siteManager` |
| **Πυρασφάλεια** | ✅ Βασική εκπαίδευση | Ετήσια | `siteManager` |

### 1.3: Προσωπικά Έγγραφα

| Έγγραφο | Ισχύς | AI Alert |
|---------|-------|----------|
| Ταυτότητα / Διαβατήριο | Μεταβλητή | 60 μέρες πριν λήξη |
| Άδεια εργασίας (αλλοδαποί) | 1-2 χρόνια | 90 μέρες πριν λήξη |
| Βιβλιάριο υγείας (αν απαιτείται) | Ετήσια | 30 μέρες πριν λήξη |

---

## 2. Ενημερότητες & Πιστοποιήσεις Υπεργολάβων

### 2.1: Υποχρεωτικές Ενημερότητες

| Ενημερότητα | Εκδότης | Ισχύς | AI Alert |
|------------|---------|-------|----------|
| **Ασφαλιστική ενημερότητα** | e-ΕΦΚΑ | 1-6 μήνες | 30 μέρες πριν λήξη |
| **Φορολογική ενημερότητα** | ΑΑΔΕ (TAXISnet) | 1-4 μήνες | 30 μέρες πριν λήξη |
| **Ασφάλεια αστικής ευθύνης** | Ασφαλιστική | 1 χρόνο | 60 μέρες πριν λήξη |
| **Εγγραφή ΜΕΚ/ΜΕΕΠ** (αν applicable) | ΥΠΥΜΕ | Ετήσια | 60 μέρες πριν λήξη |

### 2.2: Πιστοποιήσεις Ποιότητας (αν υπάρχουν)

| Πιστοποίηση | Σκοπός | Ισχύς |
|------------|--------|-------|
| ISO 9001 | Σύστημα ποιότητας | 3 χρόνια |
| ISO 14001 | Περιβαλλοντική διαχείριση | 3 χρόνια |
| ISO 45001 | Υγεία & Ασφάλεια | 3 χρόνια |

---

## 3. AI Tracking & Alerts

### 3.1: Κύκλος ζωής πιστοποίησης

```
ΕΙΣΑΓΩΓΗ → ΕΝΕΡΓΗ → ΠΡΟΕΙΔΟΠΟΙΗΣΗ (πλησιάζει λήξη) → ΛΗΓΜΕΝΗ → ΑΝΑΝΕΩΣΗ ή BLOCK
```

| Κατάσταση | Χρώμα | AI Action |
|-----------|-------|-----------|
| `active` | 🟢 Πράσινο | Κανένα — OK |
| `expiring_soon` | 🟡 Κίτρινο | Alert στον αρμόδιο |
| `expired` | 🔴 Κόκκινο | BLOCK — δεν μπορεί να εργαστεί / δεν πληρώνουμε υπεργολάβο |
| `renewed` | 🟢 Πράσινο | Ενημέρωση, νέα ημ/νία λήξης |
| `not_applicable` | ⚪ Γκρι | Δεν χρειάζεται αυτή η πιστοποίηση |

### 3.2: Alert Timeline

| Χρόνος πριν τη λήξη | Level | Alert |
|---------------------|-------|-------|
| **90 ημέρες** | 🟡 Info | Μόνο για πιστοποιήσεις που θέλουν χρόνο ανανέωσης (εξετάσεις) |
| **60 ημέρες** | 🟡 Low | Πρώτη ειδοποίηση αρμόδιου |
| **30 ημέρες** | 🟠 Medium | Δεύτερη ειδοποίηση + escalation |
| **7 ημέρες** | 🔴 High | Τρίτη ειδοποίηση + `owner` |
| **Λήξη** | 🔴 Critical | BLOCK εργαζόμενου/υπεργολάβου + ενημέρωση `owner` |

### 3.3: Σύνδεση με UC-024 (Παρουσιολόγιο)

**ΚΑΝΟΝΑΣ**: Κατά το check-in (UC-024), η AI ελέγχει αυτόματα:

```
Εργαζόμενος check-in
     ↓
AI: Άδεια/πιστοποιήσεις ενεργές?
     ↓
✅ ΝΑΙ → Check-in OK
❌ ΟΧΙ → 🔴 BLOCK CHECK-IN + Alert siteManager:
         "Ο [εργαζόμενος] δεν μπορεί να εισέλθει —
          ληγμένη [άδεια χειριστή γερανού] (λήξη: 15/01/2026)"
```

### 3.4: Σύνδεση με UC-016 (Υπεργολάβοι)

**ΚΑΝΟΝΑΣ**: Πριν κάθε πληρωμή υπεργολάβου, η AI ελέγχει:

```
Πληρωμή υπεργολάβου [X]
     ↓
AI: Ασφαλιστική + Φορολογική ενημερότητα ενεργές?
     ↓
✅ ΝΑΙ → Πληρωμή OK
❌ ΟΧΙ → 🔴 BLOCK ΠΛΗΡΩΜΗΣ + Alert accountant:
         "Δεν μπορεί να πληρωθεί ο [υπεργολάβος] —
          ληγμένη ασφαλιστική ενημερότητα (λήξη: 28/01/2026)"
```

---

## 4. Dashboard

### 4.1: Πίνακας πιστοποιήσεων

| Widget | Περιεχόμενο |
|--------|-------------|
| **Ενεργές** | Αριθμός πιστοποιήσεων σε ισχύ (🟢) |
| **Λήγουν σύντομα** | Πιστοποιήσεις που λήγουν εντός 60 ημερών (🟡) |
| **Ληγμένες** | Πιστοποιήσεις που έληξαν (🔴) — ΑΠΑΙΤΕΙ ΕΝΕΡΓΕΙΑ |
| **Ανά εργαζόμενο** | Κατάσταση πιστοποιήσεων κάθε εργαζόμενου |
| **Ανά υπεργολάβο** | Κατάσταση ενημεροτήτων κάθε υπεργολάβου |

---

## Routing

| Λειτουργία | Κύριος αρμόδιος | Εμπλεκόμενοι |
|-----------|-----------------|-------------|
| Εισαγωγή πιστοποιήσεων εργαζομένων | `siteManager` | `accountant` |
| Εισαγωγή ενημεροτήτων υπεργολάβων | `accountant` | `procurementManager` |
| Alerts ληγμένων | AI → αρμόδιος | `owner` (escalation) |
| Block check-in | AI (αυτόματο) | `siteManager` (ενημέρωση) |
| Block πληρωμής | AI (αυτόματο) | `accountant` (ενημέρωση) |

---

## AI Model Tier

- **FAST**: Alerts, expiry tracking, cross-checks στο check-in/πληρωμή
- **VISION**: Ανάγνωση σκαναρισμένων πιστοποιητικών → εξαγωγή ημ/νίας λήξης (μελλοντικό)

---

## Data Model — Σύνδεση με Contacts System

Οι πιστοποιήσεις αποθηκεύονται **μέσα** στο existing Contacts System — δεν δημιουργούμε νέα collection:

### Πιστοποιήσεις Εργαζομένων (Individual Contacts)

Αποθηκεύονται στο `ContactRelationship` μεταξύ εργαζόμενου (individual) ↔ εργοδότη/συνεργείου (company):

| Πεδίο Contacts System | Χρήση UC-028 | Τοποθεσία |
|----------------------|-------------|-----------|
| `relationship.certifications` | Array πιστοποιήσεων (άδειες, εκπαιδεύσεις) | `contact_relationships` |
| `relationship.requiredQualifications` | Τι πιστοποιήσεις ΧΡΕΙΑΖΕΤΑΙ η θέση | `contact_relationships` |
| `contact.documentType` / `documentExpiryDate` | Ταυτότητα/Διαβατήριο + λήξη | `contacts/{id}` (individual) |

### Ενημερότητες Υπεργολάβων (Company Contacts)

| Ενημερότητα | Πεδίο Contacts System | Τοποθεσία |
|------------|----------------------|-----------|
| Ασφαλιστική ενημερότητα | `relationship.attachedDocuments` (type: `compliance`) | `contact_relationships` |
| Φορολογική ενημερότητα | `relationship.attachedDocuments` (type: `compliance`) | `contact_relationships` |
| ISO πιστοποιήσεις | `relationship.attachedDocuments` (type: `certification`) | `contact_relationships` |
| ΜΕΕΠ/ΜΕΚ εγγραφή | `relationship.attachedDocuments` (type: `license`) | `contact_relationships` |

### Ροή ελέγχου κατά check-in

```
ΕΡΓΑΖΟΜΕΝΟΣ check-in (UC-024)
     ↓
workerId = contact.id (individual contact)
     ↓
AI → contact_relationships: Βρες relationship με company (συνεργείο)
     ↓
AI → relationship.certifications: Ελεγχος κάθε πιστοποίησης
     ↓
AI → relationship.attachedDocuments: Ελεγχος ενημεροτήτων συνεργείου
     ↓
ΟΛΕΣ ενεργές? → ✅ CHECK-IN OK
ΚΑΠΟΙΑ ληγμένη? → 🔴 BLOCK + Alert siteManager
```

### Ροή ελέγχου κατά πληρωμή

```
ΠΛΗΡΩΜΗ υπεργολάβου (UC-016)
     ↓
υπεργολάβος = company contact
     ↓
AI → contact_relationships: Βρες relationship εμάς ↔ υπεργολάβου
     ↓
AI → relationship.attachedDocuments: Ασφαλιστική + Φορολογική ενημερότητα
     ↓
ΟΛΕΣ ενεργές? → ✅ ΠΛΗΡΩΜΗ OK
ΚΑΠΟΙΑ ληγμένη? → 🔴 BLOCK ΠΛΗΡΩΜΗΣ + Alert accountant
```

---

## Κανόνες

- **Ληγμένη πιστοποίηση = BLOCK**: Εργαζόμενος δεν μπαίνει στο εργοτάξιο, υπεργολάβος δεν πληρώνεται
- **Ασφαλιστική ενημερότητα = ΥΠΟΧΡΕΩΤΙΚΗ**: Δεν πληρώνουμε υπεργολάβο χωρίς ενεργή ενημερότητα (νομική ευθύνη)
- **Alert timeline = config-driven**: Τα thresholds (90/60/30/7 ημέρες) ρυθμίζονται ανά τύπο πιστοποίησης
- **AI δεν ανανεώνει**: Η AI ενημερώνει, υπενθυμίζει, blocks — ο αρμόδιος φροντίζει την ανανέωση
- **Immutable records**: Η λήξη πιστοποίησης δεν μπορεί να "παραταθεί" χειροκίνητα στο σύστημα — πρέπει νέο πιστοποιητικό
- **Contacts = SSoT**: Οι πιστοποιήσεις ΔΕΝ αποθηκεύονται σε custom collection — αποθηκεύονται στο `contact_relationships` (Single Source of Truth)
