# UC-011: Αναφορά Ελαττώματος / Παράπονο (Defect Reporting)

> **Parent ADR**: [ADR-169 - Modular AI Architecture](../../reference/adrs/ADR-169-modular-ai-architecture.md)
> **Pipeline**: [pipeline.md](../pipeline.md)

---

## Trigger

Αγοραστής, ένοικος ή εξωτερικός συνεργάτης αναφέρει πρόβλημα/ελάττωμα σε ακίνητο ή έργο.

### Παραδείγματα εισερχόμενων

- "Στάζει η βρύση στο μπάνιο του 3ου ορόφου"
- "Υπάρχει ρωγμή στον τοίχο του σαλονιού"
- "Δεν λειτουργεί το κλιματιστικό"
- "Τα πλακάκια στο μπαλκόνι σηκώθηκαν"
- "Μπαίνουν νερά από το παράθυρο"
- "Δεν ανοίγει η γκαραζόπορτα"

---

## Ροή

1. **Intake**: Μήνυμα εισέρχεται (email / Telegram / in-app), πιθανώς με φωτογραφίες
2. **Acknowledge**: Άμεση απάντηση → "Λάβαμε την αναφορά σας, θα εξεταστεί άμεσα"
3. **Understand**: AI αναγνωρίζει:
   - intent: `defect_report`
   - **Κατηγορία ελαττώματος**:

   | Κατηγορία | Παραδείγματα | Αρμόδιος |
   |-----------|-------------|----------|
   | **structural** | Ρωγμές σε τοίχους/δοκούς, καθίζηση, αστοχία σκυροδέματος | `civilEngineer` |
   | **mechanical** | Υδραυλικά, ηλεκτρολογικά, θέρμανση, κλιματισμός, ανελκυστήρας | `mechanicalEngineer` |
   | **cosmetic** | Βαφή, πλακάκια, πόρτες, παράθυρα, πάτωμα | `siteManager` |
   | **safety** | Διαρροή αερίου, ηλεκτροπληξία, πυρασφάλεια, πτώση στοιχείων | `siteManager` + `owner` (ΑΜΕΣΗ ΚΛΙΜΑΚΩΣΗ) |

   - **Σοβαρότητα** (AI εκτίμηση):

   | Σοβαρότητα | Κριτήρια | SLA απόκρισης |
   |------------|----------|---------------|
   | **critical** | Κίνδυνος υγείας/ασφάλειας, ακατοικησιμότητα | Εντός 2 ωρών |
   | **high** | Σημαντική δυσλειτουργία (χωρίς νερό, χωρίς ρεύμα) | Εντός 24 ωρών |
   | **medium** | Λειτουργικό πρόβλημα (στάζει βρύση, δεν κλείνει πόρτα) | Εντός 3 ημερών |
   | **low** | Αισθητικό (γρατζουνιά, μικρή αποχρωματισμός) | Εντός 7 ημερών |

   - Εξαγωγή entities: ακίνητο/unit, όροφος, χώρος (μπάνιο/κουζίνα/σαλόνι), περιγραφή

4. **Company Detection**: Multi-Signal (βλ. [pipeline.md](../pipeline.md) → Company Detection)
5. **Lookup**:
   - Αναγνώριση αποστολέα στα **contacts** → σε ποιο unit/project ανήκει
   - Έλεγχος **εγγύησης**: Αν το ακίνητο είναι εντός περιόδου εγγύησης ή όχι
   - Έλεγχος **ιστορικού**: Υπάρχουν προηγούμενες αναφορές για το ίδιο unit ή ίδιο θέμα;
   - Αν υπάρχει φωτογραφία → **VISION tier** για αξιολόγηση (ρωγμή, υγρασία, κ.λπ.)
6. **Propose**: Δείχνει στον operator:
   - Ποιος αναφέρει (contact card + unit/project)
   - Κατηγορία + σοβαρότητα (AI εκτίμηση)
   - Ανάλυση φωτογραφίας (αν υπάρχει)
   - Ιστορικό αναφορών για το unit
   - Κατάσταση εγγύησης
   - Προτεινόμενες ενέργειες:
     - Δημιουργία **task/ticket** με ανάθεση στον αρμόδιο μηχανικό
     - Draft απάντηση στον αναφέροντα
     - Αν critical/safety → **άμεση ειδοποίηση** σε siteManager + owner
7. **Approve**: Ο operator:
   - Επιβεβαιώνει ή αλλάζει κατηγορία/σοβαρότητα
   - Εγκρίνει ανάθεση μηχανικού
   - Εγκρίνει απάντηση
8. **Execute**:
   - Δημιουργία task/ticket στο σύστημα
   - Αποστολή απάντησης στον αναφέροντα
   - Ειδοποίηση αρμόδιου μηχανικού
   - Αν safety → ταυτόχρονη ειδοποίηση owner + siteManager

---

## Κανάλια επικοινωνίας

Email, Telegram, In-app, κ.λπ.

---

## Routing

| Κατηγορία | Ρόλος | Fallback | Κλιμάκωση |
|-----------|-------|----------|-----------|
| `structural` | `civilEngineer` | `architect` | `owner` (αν critical) |
| `mechanical` | `mechanicalEngineer` | `siteManager` | `owner` (αν critical) |
| `cosmetic` | `siteManager` | `defaultResponsible` | — |
| `safety` | `siteManager` + `owner` | — | ΑΜΕΣΗ (χωρίς αναμονή έγκρισης routing) |

---

## AI Model Tier

- **FAST**: Intent detection, κατηγοριοποίηση, εξαγωγή entities
- **VISION**: Ανάλυση φωτογραφιών ελαττωμάτων (ρωγμές, υγρασία, αποκολλήσεις)

---

## Lifecycle — Tracking μετά την αναφορά

| Στάδιο | Κατάσταση | Ενέργεια |
|--------|-----------|----------|
| Αναφορά ελήφθη | `reported` | Task δημιουργήθηκε, operator ενημερώθηκε |
| Ανατέθηκε | `assigned` | Μηχανικός ενημερώθηκε, SLA ξεκίνησε |
| Σε εξέλιξη | `in_progress` | Μηχανικός εργάζεται, αναφέρων ενημερώνεται |
| Αναμονή υλικών/εργολάβου | `waiting` | Αιτιολόγηση + εκτιμώμενη ημερομηνία |
| Ολοκληρώθηκε | `resolved` | Αυτόματο μήνυμα στον αναφέροντα → "Το πρόβλημα διορθώθηκε" |
| Επιβεβαίωση | `confirmed` | Ο αναφέρων επιβεβαιώνει ότι λύθηκε |

---

## Κανόνες

- **Safety = Μηδέν καθυστέρηση**: Αν η AI εκτιμήσει safety → ειδοποίηση ΑΜΕΣΑ, χωρίς αναμονή approval
- **Επαναλαμβανόμενα**: Αν το ίδιο unit έχει >3 αναφορές σε 6 μήνες → αυτόματο alert στον owner
- **Εγγύηση**: Αν εκτός εγγύησης → ο operator ενημερώνει τον αναφέροντα για τις επιλογές (επισκευή με χρέωση ή όχι)
- **Φωτογραφίες**: Πάντα ζητούνται αν δεν υπάρχουν → "Μπορείτε να μας στείλετε φωτογραφία του προβλήματος;"
