# UC-016: Προμήθεια Υλικών & Υπηρεσιών (Procurement Process)

> **Parent ADR**: [ADR-169 - Modular AI Architecture](../../reference/adrs/ADR-169-modular-ai-architecture.md)
> **Pipeline**: [pipeline.md](../pipeline.md)
> **Prerequisites**: [PRE-003](../prerequisites.md#pre-003-procurement-system) (Procurement System — καταχώριση προσφορών)
> **Σχετικά UCs**: [UC-002](./UC-002-invoice.md) (τιμολόγιο + 3-Way Matching), [UC-015](./UC-015-building-permit-process.md) (αδειοδότηση — η κατασκευή γεννά τις ανάγκες)

---

## Trigger

Εντοπίστηκε ανάγκη για υλικά ή υπηρεσίες σε κάποιο έργο (π.χ. σκυρόδεμα, σίδερο, πλακίδια, ηλεκτρολογικά, υπεργολάβος σοβατίσματος).

---

## Στάδια Διαδικασίας

### Επισκόπηση

```
ΑΝΑΓΚΗ → ΑΙΤΗΜΑ ΠΡΟΣΦΟΡΩΝ → ΛΗΨΗ ΠΡΟΣΦΟΡΩΝ → ΣΥΓΚΡΙΣΗ → ΕΠΙΛΟΓΗ
→ ΣΥΜΦΩΝΙΑ → ΠΑΡΑΓΓΕΛΙΑ → ΠΑΡΑΛΑΒΗ → ΤΙΜΟΛΟΓΙΟ (→ UC-002) → ΠΛΗΡΩΜΗ
```

---

### Στάδιο 1: Καταγραφή Ανάγκης

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `need_identified` |
| **Ποιος δημιουργεί** | `siteManager`, `civilEngineer`, `mechanicalEngineer`, `architect` |
| **Ενέργειες AI** | Καταγραφή ανάγκης, σύνδεση με project/φάση κατασκευής |

**Στοιχεία ανάγκης**:

| Πεδίο | Παράδειγμα |
|-------|-----------|
| Έργο | Πολυκατοικία Γλυφάδα |
| Φάση κατασκευής | Θεμελίωση |
| Κατηγορία | Υλικό / Υπηρεσία / Υπεργολαβία |
| Περιγραφή | Σκυρόδεμα C25/30 |
| Ποσότητα | 180 m³ |
| Ημερομηνία που χρειάζεται | 2026-03-15 |
| Αιτών | Πολιτικός μηχανικός |

---

### Στάδιο 2: Αίτημα Προσφορών (RFQ)

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `rfq_sent` |
| **Ενέργειες AI** | Εύρεση γνωστών προμηθευτών για αυτή την κατηγορία, draft αιτήματος, αποστολή |

**Ροή**:
1. AI ψάχνει **γνωστούς προμηθευτές** για αυτή την κατηγορία υλικού (από contacts + ιστορικό παραγγελιών)
2. Προτείνει αποστολή αιτήματος σε **2-3 προμηθευτές** minimum
3. Draft αίτημα: "Παρακαλούμε για προσφορά: [περιγραφή], [ποσότητα], παράδοση μέχρι [ημερομηνία]"
4. Ο `procurementManager` εγκρίνει και στέλνεται

**ΚΑΝΟΝΑΣ**: Minimum 2 προσφορές για ποσά >1.000€, minimum 3 προσφορές για ποσά >10.000€ (config-driven thresholds)

**Alert**: Αν πέρασαν 5 μέρες χωρίς απάντηση από προμηθευτή → "Ο [προμηθευτής] δεν απάντησε — να στείλουμε reminder;"

---

### Στάδιο 3: Λήψη Προσφορών

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `quotes_received` |
| **Ενέργειες AI** | Αναγνώριση εισερχόμενης προσφοράς, εξαγωγή στοιχείων, αποθήκευση |

**Τι εξάγει η AI από κάθε προσφορά**:

| Πεδίο | Παράδειγμα |
|-------|-----------|
| Προμηθευτής | ΑΦΟΙ ΠΑΠΑΔΟΠΟΥΛΟΙ ΑΕ |
| Τιμή μονάδας | 85€/m³ |
| Συνολική τιμή | 15.300€ |
| ΦΠΑ | 24% |
| Χρόνος παράδοσης | 3 εργάσιμες |
| Όροι πληρωμής | 30 μέρες πίστωση |
| Ισχύς προσφοράς | 30 μέρες |
| Ειδικοί όροι | Ελάχιστη παραγγελία 50 m³ |

**AI Tier**: FAST για text προσφορές, **VISION** για σκαναρισμένες/PDF προσφορές

---

### Στάδιο 4: Σύγκριση Προσφορών

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `quotes_compared` |
| **Ενέργειες AI** | Αυτόματος συγκριτικός πίνακας, σύσταση |

**Παράδειγμα συγκριτικού πίνακα (AI-generated)**:

| Κριτήριο | Προμηθευτής Α | Προμηθευτής Β | Προμηθευτής Γ |
|----------|--------------|--------------|--------------|
| Τιμή/m³ | 85€ | 82€ ✅ | 90€ |
| Παράδοση | 3 μέρες | 5 μέρες | 2 μέρες ✅ |
| Πίστωση | 30 μέρες | 15 μέρες | 45 μέρες ✅ |
| Ιστορικό | 12 παραγγελίες, 0 προβλήματα ✅ | 3 παραγγελίες, 1 καθυστέρηση | Νέος προμηθευτής |
| **Σύσταση AI** | ⭐ Βέλτιστη σχέση αξίας | Χαμηλότερη τιμή | Ταχύτερη παράδοση |

**Παράγοντες σύγκρισης**:
- Τιμή μονάδας
- Χρόνος παράδοσης
- Όροι πληρωμής (πίστωση)
- Ιστορικό συνεργασίας (αξιοπιστία, ποιότητα, καθυστερήσεις)
- Ειδικοί όροι (ελάχιστη ποσότητα, μεταφορικά)

**ΚΑΝΟΝΑΣ**: Η AI προτείνει, ο **άνθρωπος αποφασίζει**. Ποτέ αυτόματη επιλογή προμηθευτή.

---

### Στάδιο 5: Επιλογή Προμηθευτή

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `supplier_selected` |
| **Έγκριση** | `procurementManager`. Αν ποσό >10.000€ → + `owner` |

---

### Στάδιο 6: Συμφωνία / Σύμβαση

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `agreement_pending` → `agreement_signed` |
| **Ενέργειες AI** | Καταγραφή συμφωνημένων όρων — αυτοί γίνονται η βάση για 3-Way Matching |

**Τι καταγράφεται στη συμφωνία** (αποθηκεύεται στο Firestore):

| Πεδίο | Σκοπός |
|-------|--------|
| Προμηθευτής | Ποιος |
| Υλικό/Υπηρεσία | Τι |
| Τιμή μονάδας | **Βάση σύγκρισης** για τιμολόγιο |
| Ποσότητα | **Βάση σύγκρισης** για δελτίο αποστολής |
| Συνολικό ποσό | **Βάση σύγκρισης** για πληρωμή |
| Χρόνος παράδοσης | Deadline tracking |
| Όροι πληρωμής | Πότε πληρώνουμε |
| Ισχύς | Πότε λήγει η συμφωνία |
| Έργο + Φάση | Σε τι αφορά |

**ΚΡΙΣΙΜΟ**: Αυτά τα στοιχεία τροφοδοτούν το **3-Way Matching** στο [UC-002](./UC-002-invoice.md) (Επίπεδο 5). Χωρίς αυτά, το UC-002 δεν μπορεί να ελέγξει αν το τιμολόγιο ταιριάζει.

---

### Στάδιο 7: Παραγγελία (Purchase Order)

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `order_placed` |
| **Ενέργειες AI** | Δημιουργία PO, αποστολή στον προμηθευτή, tracking παράδοσης |

**Στοιχεία PO**:
- Αριθμός PO (αυτόματος)
- Αναφορά σε συμφωνία
- Ποσότητα, τιμή, ημερομηνία παράδοσης
- Τόπος παράδοσης (εργοτάξιο)

**Alert**: Αν η ημερομηνία παράδοσης πλησιάζει (3 μέρες πριν) → "Η παραγγελία [X] αναμένεται σε 3 μέρες — κανονική παράδοση;"

---

### Στάδιο 8: Παραλαβή + Δελτίο Αποστολής

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `delivered` / `partial_delivery` / `delivery_issue` |
| **Ενέργειες AI** | Αντιστοίχιση δελτίου με PO, έλεγχος ποσοτήτων |

**Έλεγχοι παραλαβής**:

| Έλεγχος | Αν αποτύχει |
|---------|------------|
| Ποσότητα = παραγγελία; | "Παραλάβαμε 150 m³ αντί 180 m³ — μερική παράδοση" |
| Σωστό υλικό; | "Παραλάβαμε C20/25 αντί C25/30 — ειδοποίηση μηχανικού" |
| Κατάσταση υλικού; | Flag για damage/quality issues |

**Αρμόδιος παραλαβής**: `siteManager` (υλικά εργοταξίου) ή `procurementManager` (γραφείο)

---

### Στάδιο 9: Τιμολόγιο → 3-Way Matching

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `invoice_received` → `invoice_matched` / `invoice_mismatch` |
| **Σύνδεση** | **→ [UC-002](./UC-002-invoice.md) Επίπεδο 5** |

Αυτό το στάδιο **δεν επαναλαμβάνεται εδώ** — η πλήρης λογική βρίσκεται στο UC-002. Συνοπτικά:

```
ΣΥΜΦΩΝΙΑ (Στάδιο 6) ↔ ΔΕΛΤΙΟ (Στάδιο 8) ↔ ΤΙΜΟΛΟΓΙΟ (UC-002)
```

| Έλεγχος | Παράδειγμα αστοχίας |
|---------|-------------------|
| Τιμή μονάδας = συμφωνία; | Συμφωνία 85€/m³, τιμολόγιο 92€/m³ → **+8.2% παρέκκλιση** |
| Ποσότητα = δελτίο; | Δελτίο 150 m³, τιμολόγιο 180 m³ → **χρεώνει περισσότερα** |
| Σύνολο εντός budget; | Συμφωνία 15.300€, τιμολόγιο 16.560€ → **υπέρβαση** |

**Αν mismatch**: Alert σε `procurementManager` + `accountant` → "Τιμολόγιο αποκλίνει από συμφωνία — χρειάζεται έγκριση/αμφισβήτηση"

---

### Στάδιο 10: Πληρωμή

| Πεδίο | Λεπτομέρεια |
|-------|-------------|
| **Κατάσταση** | `payment_pending` → `payment_scheduled` → `payment_complete` |
| **Ενέργειες AI** | Tracking πληρωμής βάσει συμφωνημένων όρων, alerts overdue |

**Alerts**:
- Πληρωμή overdue >7 μέρες → ειδοποίηση `accountant`
- Πληρωμή overdue >30 μέρες → ειδοποίηση `owner`
- Πιστωτικό υπόλοιπο προμηθευτή (σύνολο ανεξόφλητων τιμολογίων) >threshold → alert

---

## Κανάλια επικοινωνίας

Email (κυρίως για RFQ/PO/προμηθευτές), Telegram (εσωτερικές ειδοποιήσεις), In-app

---

## Routing

| Στάδιο | Κύριος αρμόδιος | Εμπλεκόμενοι |
|--------|-----------------|-------------|
| 1 Ανάγκη | `siteManager` / `civilEngineer` | — |
| 2-3 RFQ + Προσφορές | `procurementManager` | `secretary` |
| 4-5 Σύγκριση + Επιλογή | `procurementManager` | `owner` (αν >10.000€) |
| 6 Συμφωνία | `procurementManager` | `owner` (υπογραφή) |
| 7 Παραγγελία | `procurementManager` | — |
| 8 Παραλαβή | `siteManager` | `procurementManager` |
| 9 Τιμολόγιο | `accountant` | `procurementManager` (→ UC-002) |
| 10 Πληρωμή | `accountant` | `owner` (αν >ποσό threshold) |

---

## AI Model Tier

- **FAST**: Tracking, alerts, PO generation, ποσοτικοί έλεγχοι
- **VISION**: Ανάγνωση σκαναρισμένων προσφορών/δελτίων αποστολής
- **QUALITY**: Σύγκριση προσφορών, 3-Way Matching (→ UC-002)

---

## Κανόνες

- **Minimum προσφορές**: >1.000€ → 2 προσφορές, >10.000€ → 3 προσφορές (config-driven)
- **Ποτέ αυτόματη επιλογή**: Η AI συγκρίνει και προτείνει, ο άνθρωπος αποφασίζει
- **Ιστορικό προμηθευτή**: Η AI λαμβάνει υπόψη αξιοπιστία/ποιότητα/καθυστερήσεις από προηγούμενες συνεργασίες
- **Λήξη προσφοράς**: Αν η προσφορά λήγει σε <5 μέρες και δεν έχει αποφασιστεί → alert
- **Budget check**: Αν η παραγγελία υπερβαίνει το budget φάσης κατασκευής → alert `owner`
- **Επαναλαμβανόμενες αγορές**: Αν αγοράζουμε το ίδιο υλικό >3 φορές σε 6 μήνες → AI προτείνει "Σκεφτείτε ετήσια σύμβαση για καλύτερη τιμή"
