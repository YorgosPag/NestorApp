{
  "category": "FEATURE",
  "shortDescription": "ADR-173 Phase 6: Context-Aware Suggested Action Buttons",
  "problem": "ÎšÎ¬Î¸Îµ AI Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Ï„ÎµÎ»ÎµÎ¯Ï‰Î½Îµ Î¼Îµ Î³ÎµÎ½Î¹ÎºÎ® Ï†ÏÎ¬ÏƒÎ· 'Î‘Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ­ Î¼Îµ!' - ÎºÎ±ÎºÏŒ UX, Î¼Î¿Î½ÏŒÏ„Î¿Î½Î¿, Î¼Î· actionable",
  "cause": "Î”ÎµÎ½ Ï…Ï€Î®ÏÏ‡Îµ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ context-aware suggested follow-ups ÏƒÏ„Î¿ AI pipeline",
  "filesChanged": [
    "src/services/ai-pipeline/agentic-loop.ts",
    "src/services/ai-pipeline/feedback-keyboard.ts",
    "src/services/ai-pipeline/feedback-service.ts",
    "src/services/ai-pipeline/pipeline-orchestrator.ts",
    "src/services/ai-pipeline/index.ts",
    "src/app/api/communications/webhooks/telegram/message/callback-query.ts",
    "src/app/api/communications/webhooks/telegram/handler.ts",
    "docs/centralized-systems/reference/adrs/ADR-173-ai-self-improvement-system.md"
  ],
  "solution": {
    "phase6A": "System prompt update - 2 Î½Î­Î¿Î¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚: ban Î³ÎµÎ½Î¹ÎºÎ­Ï‚ Ï†ÏÎ¬ÏƒÎµÎ¹Ï‚ + [SUGGESTIONS] block format",
    "phase6B": "extractSuggestions() parser + AgenticResult.suggestions field",
    "phase6C": "createSuggestedActionsKeyboard() + isSuggestionCallback/parseSuggestionCallback",
    "phase6D": "suggestedActions field in FeedbackSnapshot + getSuggestedActions() method",
    "phase6E": "Pipeline orchestrator sends suggestions keyboard between AI answer and feedback",
    "phase6F": "Suggestion callback handler + pipeline re-feed via feedSuggestionToPipeline()"
  },
  "testing": {
    "typescript": "npx tsc --noEmit: 0 new errors (3 pre-existing in obligations/design-system/geo-canvas)",
    "preCommit": "Pre-commit checks passed",
    "deployment": "Pushed to main for Vercel auto-deployment"
  },
  "notes": [
    "Message order: [1] AI Answer (clean), [2] Suggested Actions buttons, [3] Feedback (ğŸ‘/ğŸ‘)",
    "Clicking suggestion re-feeds as new message through full pipeline with chat history context",
    "Callback format: sa:{index}:{feedbackDocId} (fits 64-byte Telegram limit)",
    "Graceful fallback: if AI doesn't include [SUGGESTIONS] block, no crash - empty suggestions",
    "8 files changed, +309 insertions, -15 deletions"
  ],
  "contributors": {
    "user": "Î“Î¹ÏÏÎ³Î¿Ï‚ Î Î±Î³ÏÎ½Î·Ï‚",
    "assistant": "Claude Opus 4.6",
    "sessionDate": "2026-02-10"
  },
  "relatedBackups": [
    "backup-2026-02-10-adr173-ai-self-improvement-hardening"
  ],
  "commits": [
    {
      "hash": "9ec8b595",
      "message": "feat(ADR-173): Phase 6 â€” context-aware suggested action buttons for AI responses"
    }
  ]
}
