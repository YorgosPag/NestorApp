{
  "category": "FIX",
  "shortDescription": "Fix contact photo save failure — non-serializable File objects leaked to Firestore",
  "problem": "Οι φωτογραφίες δεν αποθηκεύονταν. Η ενημέρωση επαφής απέτυχε με γενικό σφάλμα 'Update failed Object' χωρίς λεπτομέρειες.",
  "cause": "Το πεδίο multiplePhotos (PhotoSlot[] με File/Blob objects) δεν αφαιρούνταν πριν σταλεί στο Firestore. Το Firestore ΑΠΟΡΡΙΠΤΕΙ μη-σειριοποιήσιμα αντικείμενα (File, Blob). Επιπλέον, τα error logs έδειχαν μόνο 'Object' αντί του πραγματικού μηνύματος σφάλματος.",
  "filesChanged": [
    "src/services/contacts.service.ts (uiOnlyFields + error logging)",
    "src/utils/contacts/EnterpriseContactSaver.ts (UI fields cleanup)"
  ],
  "solution": "1. Προστέθηκαν 6 νέα UI-only πεδία στη λίστα αφαίρεσης πριν το Firestore write: multiplePhotos, _isLogoUploading, _isPhotoUploading, _forceDeleteLogo, activePersonaTab, photoFileName. 2. Δεύτερο layer ασφαλείας στο EnterpriseContactSaver.convertToEnterpriseStructure(). 3. Βελτιωμένο error logging — εμφανίζει errorMessage, errorCode, contactId αντί για generic 'Object'.",
  "testing": "npx tsc --noEmit — 0 TS errors",
  "notes": "Το deprecation warning για canonical fields (companyId, contactId, createdBy) παραμένει — η legacy pipeline λειτουργεί αλλά δεν δημιουργεί FileRecord. Αυτό είναι δευτερεύον ζήτημα.",
  "contributors": {
    "user": "Γιώργος Παγώνης",
    "assistant": "Claude Opus 4.6",
    "sessionDate": "2026-02-13"
  },
  "relatedBackups": [],
  "commits": [
    {
      "hash": "76fcdcfe",
      "message": "fix: prevent non-serializable File objects from leaking into Firestore payload"
    }
  ]
}
