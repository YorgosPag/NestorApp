{
  "category": "FIX",
  "shortDescription": "Canvas residue hardening — eliminate implicit cache dependency in DxfRenderer + CanvasUtils",
  "problem": "Colored overlay layers left residual artifacts (ghost strips) at the bottom of the screen when zooming. The initial fix (fe5c3f64) addressed LayerRenderer but DxfRenderer still had a fragile implicit cache dependency.",
  "cause": "DxfRenderer.render() called refreshBounds() then CanvasUtils.clearCanvas() which re-fetched from CanvasBoundsService cache internally — fragile coupling. If cache expired between the two calls, clear and draw would use different dimensions.",
  "filesChanged": [
    "src/subapps/dxf-viewer/canvas-v2/dxf-canvas/DxfRenderer.ts",
    "src/subapps/dxf-viewer/rendering/canvas/utils/CanvasUtils.ts"
  ],
  "solution": "1) DxfRenderer: replaced CanvasUtils.clearCanvas() with direct ctx.clearRect() using fresh canvasRect (same pattern as LayerRenderer) | 2) Removed unused CanvasUtils import from DxfRenderer | 3) Added optional 'dimensions' parameter to CanvasUtils.clearCanvas() so render-loop callers can bypass cache | 4) Full audit of all 7 canvas clear paths — only DxfRenderer and LayerRenderer are in the main render loop",
  "testing": "TypeScript compilation: 0 errors (npx tsc --noEmit). Full audit of all canvas clear paths confirmed no other stale-bounds risks.",
  "notes": "Based on OpenAI Codex deep investigation report (dxf-overlay-residue-deep-investigation-2026-02-14-2.md). Applied hardening recommendations 1-3 from Section 7. PreviewRenderer uses identity transform reset + backing store dims (correct pattern). Overlay-drawing, Canvas2DContext, EntityRendererComposite, CanvasManager are not in main render loop — safe.",
  "contributors": {
    "user": "Γιώργος Παγώνης",
    "assistant": "Claude Opus 4.6",
    "sessionDate": "2026-02-15"
  },
  "relatedBackups": [],
  "commits": [
    {
      "hash": "04d573b0",
      "message": "fix(dxf-viewer): prevent entity click from auto-opening layering toolbar (includes residue hardening)"
    }
  ]
}
